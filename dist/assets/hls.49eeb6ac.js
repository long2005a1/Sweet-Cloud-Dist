import{cG as Ke,co as Be}from"./index.fd284143.js";import{c as Ne}from"./_commonjs-dynamic-modules.30ae7933.js";var We={exports:{}};(function(ie,de){/*!
 * artplayer-plugin-danmuku.js v5.1.4
 * Github: https://github.com/zhw2590582/ArtPlayer
 * (c) 2017-2024 Harvey Zack
 * Released under the MIT License.
 */(function(K,M,L,x,R){var O=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof Be<"u"?Be:{},b=typeof O[x]=="function"&&O[x],C=b.cache||{},I=typeof Ne=="function"&&Ne.bind(ie);function T(g,D){if(!C[g]){if(!K[g]){var E=typeof O[x]=="function"&&O[x];if(!D&&E)return E(g,!0);if(b)return b(g,!0);if(I&&typeof g=="string")return I(g);var d=Error("Cannot find module '"+g+"'");throw d.code="MODULE_NOT_FOUND",d}e.resolve=function(a){var l=K[g][1][a];return l!=null?l:a},e.cache={};var r=C[g]=new T.Module(g);K[g][0].call(r.exports,e,r,r.exports,this)}return C[g].exports;function e(a){var l=e.resolve(a);return l===!1?{}:T(l)}}T.isParcelRequire=!0,T.Module=function(g){this.id=g,this.bundle=T,this.exports={}},T.modules=K,T.cache=C,T.parent=b,T.register=function(g,D){K[g]=[function(E,d){d.exports=D},{}]},Object.defineProperty(T,"root",{get:function(){return O[x]}}),O[x]=T;for(var m=0;m<M.length;m++)T(M[m]);if(L){var p=T(L);ie.exports=p}})({bgm6t:[function(K,M,L){var x=K("@parcel/transformer-js/src/esmodule-helpers.js");x.defineInteropFlag(L),x.export(L,"default",()=>m);var R=K("./danmuku"),O=x.interopDefault(R),b=K("./setting"),C=x.interopDefault(b),I=K("./heatmap"),T=x.interopDefault(I);function m(p){return g=>{let D=new O.default(g,p),E=new C.default(g,D);return D.option.heatmap&&(0,T.default)(g,D,D.option.heatmap),{name:"artplayerPluginDanmuku",emit:D.emit.bind(D),load:D.load.bind(D),config:D.config.bind(D),hide:D.hide.bind(D),show:D.show.bind(D),reset:D.reset.bind(D),mount:E.mount.bind(E),get option(){return D.option},get isHide(){return D.isHide},get isStop(){return D.isStop}}}}m.icons=C.default.icons,typeof window<"u"&&(window.artplayerPluginDanmuku=m)},{"./danmuku":"4ns48","./setting":"lO8OT","./heatmap":"8AxLD","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"4ns48":[function(K,M,L){var x=K("@parcel/transformer-js/src/esmodule-helpers.js");x.defineInteropFlag(L);var R=K("./bilibili"),O=K("bundle-text:./worker"),b=x.interopDefault(O);class C{constructor(T,m){let{constructor:p,template:g}=T;this.utils=p.utils,this.validator=p.validator,this.$danmuku=g.$danmuku,this.$player=g.$player,this.art=T,this.queue=[],this.$refs=[],this.isStop=!1,this.isHide=!1,this.timer=null,this.index=0,this.option=C.option,this.states={wait:[],ready:[],emit:[],stop:[]},this.config(m),this.worker=new Worker(URL.createObjectURL(new Blob([b.default]))),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this.reset=this.reset.bind(this),this.resize=this.resize.bind(this),this.destroy=this.destroy.bind(this),T.on("video:play",this.start),T.on("video:playing",this.start),T.on("video:pause",this.stop),T.on("video:waiting",this.stop),T.on("destroy",this.destroy),T.on("resize",this.resize),this.load()}static get option(){return{danmuku:[],speed:5,margin:[10,"25%"],opacity:1,color:"#FFFFFF",mode:0,modes:[0,1,2],fontSize:25,antiOverlap:!0,synchronousPlayback:!1,mount:void 0,heatmap:!1,width:512,points:[],filter:()=>!0,beforeEmit:()=>!0,beforeVisible:()=>!0,visible:!0,emitter:!0,maxLength:200,lockTime:5,theme:"dark",OPACITY:{},FONT_SIZE:{},MARGIN:{},SPEED:{},COLOR:[]}}static get scheme(){return{danmuku:"array|function|string",speed:"number",margin:"array",opacity:"number",color:"string",mode:"number",modes:"array",fontSize:"number|string",antiOverlap:"boolean",synchronousPlayback:"boolean",mount:"?htmldivelement|string",heatmap:"object|boolean",width:"number",points:"array",filter:"function",beforeEmit:"function",beforeVisible:"function",visible:"boolean",emitter:"boolean",maxLength:"number",lockTime:"number",theme:"string",OPACITY:"object",FONT_SIZE:"object",MARGIN:"object",SPEED:"object",COLOR:"array"}}static get cssText(){return' user-select: none; position: absolute; white-space: pre; pointer-events: none; perspective: 500px; display: inline-block; will-change: transform; font-weight: normal; line-height: 1.125; visibility: hidden; font-family: SimHei, "Microsoft JhengHei", Arial, Helvetica, sans-serif; text-shadow: rgb(0, 0, 0) 1px 0px 1px, rgb(0, 0, 0) 0px 1px 1px, rgb(0, 0, 0) 0px -1px 1px, rgb(0, 0, 0) -1px 0px 1px; '}get isRotate(){var T,m;return(m=(T=this.art.plugins)==null?void 0:T.autoOrientation)==null?void 0:m.state}get marginTop(){let{clamp:T}=this.utils,m=this.option.margin[0],{clientHeight:p}=this.$player;return typeof m=="number"?T(m,0,p):typeof m=="string"&&m.endsWith("%")?T(p*(parseFloat(m)/100),0,p):C.option.margin[0]}get marginBottom(){let{clamp:T}=this.utils,m=this.option.margin[1],{clientHeight:p}=this.$player;return typeof m=="number"?T(m,0,p):typeof m=="string"&&m.endsWith("%")?T(p*(parseFloat(m)/100),0,p):C.option.margin[1]}get fontSize(){let{clamp:T}=this.utils,{clientHeight:m}=this.$player,p=this.option.fontSize;return typeof p=="number"?Math.round(T(p,12,m)):typeof p=="string"&&p.endsWith("%")?Math.round(T(m*(parseFloat(p)/100),12,m)):C.option.fontSize}get $ref(){let T=this.$refs.pop()||document.createElement("div");return T.style.cssText=C.cssText,T.dataset.mode="",T.className="",T}get readys(){let{currentTime:T}=this.art,m=[];return this.filter("ready",p=>m.push(p)),this.filter("wait",p=>{T+.1>=p.time&&p.time>=T-.1&&m.push(p)}),m}get visibles(){let T=[],{clientWidth:m}=this.$player,p=this.getLeft(this.$player);return this.filter("emit",g=>{let D=g.$ref.offsetTop,E=this.getLeft(g.$ref)-p,d=g.$ref.clientHeight,r=g.$ref.clientWidth,e=E+r,a=e/g.$restTime,l={};l.top=D,l.left=E,l.height=d,l.width=r,l.right=m-e,l.speed=a,l.distance=e,l.time=g.$restTime,l.mode=g.mode,T.push(l)}),T}get speed(){return this.option.synchronousPlayback&&this.art.playbackRate?this.option.speed/Number(this.art.playbackRate):this.option.speed}async load(T){let{errorHandle:m}=this.utils,p=[],g=T||this.option.danmuku;try{typeof g=="function"?p=await g():g instanceof Promise?p=await g:typeof g=="string"?p=await(0,R.bilibiliDanmuParseFromUrl)(g):Array.isArray(g)&&(p=g),m(Array.isArray(p),"Danmuku need return an array as result"),T===void 0&&(this.reset(),this.queue=[],this.states={wait:[],ready:[],emit:[],stop:[]},this.$refs=[],this.$danmuku.innerText="");for(let D=0;D<p.length;D++){let E=p[D];await this.emit(E)}this.art.emit("artplayerPluginDanmuku:loaded",this.queue)}catch(D){throw this.art.emit("artplayerPluginDanmuku:error",D),D}return this}async emit(T){let{clamp:m}=this.utils;if(this.validator(T,{text:"string",mode:"?number",color:"?string",time:"?number",border:"?boolean",style:"?object"}),!T.text.trim()||(T.time?T.time=m(T.time,0,1/0):T.time=this.art.currentTime+.5,T.mode===void 0&&(T.mode=this.option.mode),T.style===void 0&&(T.style={}),T.color===void 0&&(T.color=this.option.color),![0,1,2].includes(T.mode)||!this.option.filter(T)))return this;let p={...T,$state:"wait",$id:this.index++,$ref:null,$restTime:0,$lastStartTime:0};return this.setState(p,"wait"),this.queue.push(p),this}config(T){let{clamp:m}=this.utils,{$controlsCenter:p}=this.art.template;return Object.keys(T).some(g=>JSON.stringify(this.option[g])!==JSON.stringify(T[g]))&&(this.option=Object.assign({},C.option,this.option,T),this.validator(this.option,C.scheme),this.option.mode=m(this.option.mode,0,2),this.option.speed=m(this.option.speed,1,10),this.option.opacity=m(this.option.opacity,0,1),this.option.lockTime=m(this.option.lockTime,1,60),this.option.maxLength=m(this.option.maxLength,1,1e3),this.option.mount=this.option.mount||p,T.fontSize&&this.reset(),this.option.visible?this.show():this.hide(),this.art.emit("artplayerPluginDanmuku:config",this.option)),this}getLeft(T){let m=T.getBoundingClientRect();return this.isRotate?m.top:m.left}postMessage(T={}){return new Promise(m=>{T.id=Date.now(),this.worker.postMessage(T),this.worker.onmessage=p=>{let{data:g}=p;g.id===T.id&&m(g)}})}filter(T,m){let p=this.states[T]||[];for(let g=0;g<p.length;g++)m(p[g]);return p}setState(T,m){this.states[T.$state]=this.states[T.$state].filter(p=>p!==T),T.$state=m,T.$ref&&(T.$ref.dataset.state=m),this.states[m].push(T)}makeWait(T){this.setState(T,"wait"),T.$ref&&(T.$ref.style.cssText=C.cssText,T.$ref.style.visibility="hidden",T.$ref.style.marginLeft="0px",T.$ref.style.transform="translateX(0px)",T.$ref.style.transition="transform 0s linear 0s",this.$refs.push(T.$ref),T.$ref=null)}update(){let{setStyles:T}=this.utils;return this.timer=window.requestAnimationFrame(async()=>{if(this.art.playing&&!this.isHide){this.filter("emit",p=>{let g=(Date.now()-p.$lastStartTime)/1e3;p.$restTime-=g,p.$lastStartTime=Date.now(),p.$restTime<=0&&this.makeWait(p)});let m=this.readys;for(let p=0;p<m.length;p++){let g=m[p];if(await this.option.beforeVisible(g)){let{clientWidth:D,clientHeight:E}=this.$player;g.$ref=this.$ref,g.$ref.innerText=g.text,this.$danmuku.appendChild(g.$ref),g.$ref.style.opacity=this.option.opacity,g.$ref.style.fontSize=`${this.fontSize}px`,g.$ref.style.color=g.color,g.$ref.style.border=g.border?`1px solid ${g.color}`:null,g.$ref.style.backgroundColor=g.border?"rgb(0 0 0 / 50%)":null,T(g.$ref,g.style),g.$lastStartTime=Date.now(),g.$restTime=this.speed;let d=D+g.$ref.clientWidth,{result:r}=await this.postMessage({type:"getDanmuTop",target:{mode:g.mode,height:g.$ref.clientHeight,speed:d/g.$restTime},visibles:this.visibles,antiOverlap:this.option.antiOverlap,clientWidth:D,clientHeight:E,marginBottom:this.marginBottom,marginTop:this.marginTop});if(g.$ref)if(this.isStop||r===void 0)this.setState(g,"ready"),this.$refs.push(g.$ref),g.$ref=null;else{switch(this.setState(g,"emit"),g.$ref.style.top=`${r}px`,g.$ref.style.visibility="visible",g.$ref.dataset.mode=g.mode,g.mode){case 0:g.$ref.style.left=`${D}px`,g.$ref.style.marginLeft="0px",g.$ref.style.transform=`translateX(${-d}px)`,g.$ref.style.transition=`transform ${g.$restTime}s linear 0s`;break;case 1:case 2:g.$ref.style.left="50%",g.$ref.style.marginLeft=`-${g.$ref.clientWidth/2}px`}this.art.emit("artplayerPluginDanmuku:visible",g)}}}}this.isStop||this.update()}),this}resize(){let{clientWidth:T}=this.$player;this.filter("stop",m=>{m.mode===0&&(m.$ref.style.left=`${T}px`)}),this.filter("emit",m=>{if(m.$lastStartTime=Date.now(),m.mode===0){let p=T+m.$ref.clientWidth;m.$ref.style.left=`${T}px`,m.$ref.style.transform=`translateX(${-p}px)`,m.$ref.style.transition=`transform ${m.$restTime}s linear 0s`}})}continue(){let{clientWidth:T}=this.$player;return this.filter("stop",m=>{if(this.setState(m,"emit"),m.$lastStartTime=Date.now(),m.mode===0){let p=T+m.$ref.clientWidth;m.$ref.style.transform=`translateX(${-p}px)`,m.$ref.style.transition=`transform ${m.$restTime}s linear 0s`}}),this}suspend(){let{clientWidth:T}=this.$player;return this.filter("emit",m=>{if(this.setState(m,"stop"),m.mode===0){let p=T-(this.getLeft(m.$ref)-this.getLeft(this.$player));m.$ref.style.transform=`translateX(${-p}px)`,m.$ref.style.transition="transform 0s linear 0s"}}),this}stop(){return this.isStop=!0,this.suspend(),window.cancelAnimationFrame(this.timer),this.art.emit("artplayerPluginDanmuku:stop"),this}start(){return this.isStop=!1,this.continue(),this.update(),this.art.emit("artplayerPluginDanmuku:start"),this}reset(){return this.queue.forEach(T=>this.makeWait(T)),this.art.emit("artplayerPluginDanmuku:reset"),this}show(){return this.isHide=!1,this.$danmuku.style.opacity=1,this.option.visible=!0,this.art.emit("artplayerPluginDanmuku:show"),this}hide(){return this.isHide=!0,this.$danmuku.style.opacity=0,this.option.visible=!1,this.art.emit("artplayerPluginDanmuku:hide"),this}destroy(){this.stop(),this.worker.terminate(),this.art.off("video:play",this.start),this.art.off("video:playing",this.start),this.art.off("video:pause",this.stop),this.art.off("video:waiting",this.stop),this.art.off("resize",this.reset),this.art.off("destroy",this.destroy),this.art.emit("artplayerPluginDanmuku:destroy")}}L.default=C},{"./bilibili":"f83sx","bundle-text:./worker":"lfIAi","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],f83sx:[function(K,M,L){var x=K("@parcel/transformer-js/src/esmodule-helpers.js");function R(I){switch(I){case 1:case 2:case 3:default:return 0;case 4:return 2;case 5:return 1}}function O(I){if(typeof I!="string")return[];let T=new RegExp(/<d (?:.*? )??p="(?<p>.+?)"(?: .*?)?>(?<text>.+?)<\/d>/gs);return Array.from(I.matchAll(T)).map(m=>{let p=m.groups.p.split(",");return p.length>=8?{text:m.groups.text.trim().replaceAll("&quot;",'"').replaceAll("&apos;","'").replaceAll("&lt;","<").replaceAll("&gt;",">").replaceAll("&amp;","&"),time:Number(p[0]),mode:R(Number(p[1])),fontSize:Number(p[2]),color:`#${Number(p[3]).toString(16)}`,timestamp:Number(p[4]),pool:Number(p[5]),userID:p[6],rowID:Number(p[7])}:null}).filter(Boolean)}function b({data:I}){let{xml:T,id:m}=I;if(!m||!T)return;let p=O(T);self.postMessage({danmus:p,id:m})}function C(I){return new Promise(async T=>{let m=await fetch(I),p=await m.text();try{let g=function(){let D=new Blob([` ${R.toString()} ${O.toString()} onmessage = ${b.toString()} `],{type:"application/javascript"});return new Worker(URL.createObjectURL(D))}();g.onmessage=D=>{let{danmus:E,id:d}=D.data;d&&E&&(T(E),g.terminate())},g.postMessage({xml:p,id:Date.now()})}catch{T(O(p))}})}x.defineInteropFlag(L),x.export(L,"bilibiliDanmuParseFromUrl",()=>C)},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"9pCYc":[function(K,M,L){L.interopDefault=function(x){return x&&x.__esModule?x:{default:x}},L.defineInteropFlag=function(x){Object.defineProperty(x,"__esModule",{value:!0})},L.exportAll=function(x,R){return Object.keys(x).forEach(function(O){O==="default"||O==="__esModule"||Object.prototype.hasOwnProperty.call(R,O)||Object.defineProperty(R,O,{enumerable:!0,get:function(){return x[O]}})}),R},L.export=function(x,R,O){Object.defineProperty(x,R,{enumerable:!0,get:O})}},{}],lfIAi:[function(K,M,L){M.exports=`!function(e,t,n,o,i){var r="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},f="function"==typeof r[o]&&r[o],l=f.cache||{},d="undefined"!=typeof module&&"function"==typeof module.require&&module.require.bind(module);function u(t,n){if(!l[t]){if(!e[t]){var i="function"==typeof r[o]&&r[o];if(!n&&i)return i(t,!0);if(f)return f(t,!0);if(d&&"string"==typeof t)return d(t);var h=Error("Cannot find module '"+t+"'");throw h.code="MODULE_NOT_FOUND",h}s.resolve=function(n){var o=e[t][1][n];return null!=o?o:n},s.cache={};var p=l[t]=new u.Module(t);e[t][0].call(p.exports,s,p,p.exports,this)}return l[t].exports;function s(e){var t=s.resolve(e);return!1===t?{}:u(t)}}u.isParcelRequire=!0,u.Module=function(e){this.id=e,this.bundle=u,this.exports={}},u.modules=e,u.cache=l,u.parent=f,u.register=function(t,n){e[t]=[function(e,t){t.exports=n},{}]},Object.defineProperty(u,"root",{get:function(){return r[o]}}),r[o]=u;for(var h=0;h<t.length;h++)u(t[h]);if(n){var p=u(n);"object"==typeof exports&&"undefined"!=typeof module?module.exports=p:"function"==typeof define&&define.amd&&define(function(){return p})}}({"59OZS":[function(e,t,n){function o({target:e,visibles:t,clientWidth:n,clientHeight:o,marginBottom:i,marginTop:r,antiOverlap:f}){let l=o-i,d=t.filter(t=>t.mode===e.mode&&t.top<=l).sort((e,t)=>e.top-t.top);if(0===d.length)return 2===e.mode?l-e.height:r;if(d.unshift({type:"top",top:0,left:0,right:0,height:r,width:n,speed:0,distance:n}),d.push({type:"bottom",top:l,left:0,right:0,height:i,width:n,speed:0,distance:n}),2===e.mode)for(let t=d.length-2;t>=0;t-=1){let n=d[t],o=d[t+1],i=n.top+n.height;if(o.top-i>=e.height)return o.top-e.height}else for(let t=1;t<d.length;t+=1){let n=d[t],o=d[t-1],i=o.top+o.height;if(n.top-i>=e.height)return i}let u=[];for(let e=1;e<d.length-1;e+=1){let t=d[e];if(u.length){let e=u[u.length-1];e[0].top===t.top?e.push(t):u.push([t])}else u.push([t])}if(f)switch(e.mode){case 0:{let t=u.find(t=>t.every(t=>!(n<t.distance)&&(e.speed<t.speed||t.right/(e.speed-t.speed)>t.time)));return t&&t[0]?t[0].top:void 0}case 1:case 2:return}else{switch(e.mode){case 0:u.sort((e,t)=>{let n=Math.min(...t.map(e=>e.right)),o=Math.min(...e.map(e=>e.right));return n*t.length-o*e.length});break;case 1:case 2:u.sort((e,t)=>{let n=Math.max(...t.map(e=>e.width));return Math.max(...e.map(e=>e.width))*e.length-n*t.length})}return u[0][0].top}}onmessage=e=>{let{data:t}=e;if(!t.id||!t.type)return;let n=(0,({getDanmuTop:o})[t.type])(t);self.postMessage({result:n,id:t.id})}},{}]},["59OZS"],"59OZS","parcelRequire4dc0");`},{}],lO8OT:[function(K,M,L){var x=K("@parcel/transformer-js/src/esmodule-helpers.js");x.defineInteropFlag(L);var R=K("bundle-text:./style.less"),O=x.interopDefault(R),b=K("bundle-text:./img/on.svg"),C=x.interopDefault(b),I=K("bundle-text:./img/off.svg"),T=x.interopDefault(I),m=K("bundle-text:./img/config.svg"),p=x.interopDefault(m),g=K("bundle-text:./img/style.svg"),D=x.interopDefault(g),E=K("bundle-text:./img/mode_0_off.svg"),d=x.interopDefault(E),r=K("bundle-text:./img/mode_0_on.svg"),e=x.interopDefault(r),a=K("bundle-text:./img/mode_1_off.svg"),l=x.interopDefault(a),h=K("bundle-text:./img/mode_1_on.svg"),n=x.interopDefault(h),t=K("bundle-text:./img/mode_2_off.svg"),i=x.interopDefault(t),y=K("bundle-text:./img/mode_2_on.svg"),u=x.interopDefault(y),f=K("bundle-text:./img/check_on.svg"),c=x.interopDefault(f),s=K("bundle-text:./img/check_off.svg"),o=x.interopDefault(s);if(L.default=class{constructor(v,S){this.art=v,this.danmuku=S,this.utils=v.constructor.utils;let{setStyle:A}=this.utils,{$controlsCenter:P}=v.template;A(P,"display","flex"),this.template={$controlsCenter:P,$mount:P,$danmuku:null,$toggle:null,$config:null,$configPanel:null,$configModes:null,$style:null,$stylePanel:null,$styleModes:null,$colors:null,$opacitySlider:null,$opacityValue:null,$marginSlider:null,$marginValue:null,$fontSizeSlider:null,$fontSizeValue:null,$speedSlider:null,$speedValue:null,$input:null,$send:null},this.slider={opacity:null,margin:null,fontSize:null,speed:null},this.emitting=!1,this.isLock=!1,this.timer=null,this.createTemplate(),this.createSliders(),this.createEvents(),this.mount(this.option.mount),v.on("resize",()=>this.resize()),v.on("fullscreen",_=>this.onFullscreen(_)),v.on("fullscreenWeb",_=>this.onFullscreen(_)),v.proxy(this.template.$config,"mouseenter",()=>{this.onMouseEnter({$control:this.template.$config,$panel:this.template.$configPanel})}),v.proxy(this.template.$style,"mouseenter",()=>{this.onMouseEnter({$control:this.template.$style,$panel:this.template.$stylePanel})})}static get icons(){return{$on:C.default,$off:T.default,$config:p.default,$style:D.default,$mode_0_off:d.default,$mode_0_on:e.default,$mode_1_off:l.default,$mode_1_on:n.default,$mode_2_off:i.default,$mode_2_on:u.default,$check_on:c.default,$check_off:o.default}}get option(){return this.danmuku.option}get outside(){return this.template.$mount!==this.template.$controlsCenter}get TEMPLATE(){let{option:v}=this;return`<div class="apd-toggle">${C.default}${T.default}</div><div class="apd-config">${p.default}<div class="apd-config-panel"><div class="apd-config-panel-inner"><div class="apd-config-mode">\u6309\u7C7B\u578B\u5C4F\u853D<div class="apd-modes"><div data-mode="0" class="apd-mode">${d.default}${e.default}<div>\u6EDA\u52A8</div></div><div data-mode="1" class="apd-mode">${l.default}${n.default}<div>\u9876\u90E8</div></div><div data-mode="2" class="apd-mode">${i.default}${u.default}<div>\u5E95\u90E8</div></div></div></div><div class="apd-config-other"><div class="apd-other apd-anti-overlap">${c.default}${o.default} \u9632\u6B62\u5F39\u5E55\u91CD\u53E0</div><div class="apd-other apd-sync-video">${c.default}${o.default} \u540C\u6B65\u89C6\u9891\u901F\u5EA6</div></div><div class="apd-config-slider apd-config-opacity">\u4E0D\u900F\u660E\u5EA6<div class="apd-slider"></div><div class="apd-value">\u672A\u77E5</div></div><div class="apd-config-slider apd-config-margin">\u663E\u793A\u533A\u57DF<div class="apd-slider"></div><div class="apd-value">\u672A\u77E5</div></div><div class="apd-config-slider apd-config-fontSize">\u5F39\u5E55\u5B57\u53F7<div class="apd-slider"></div><div class="apd-value">\u672A\u77E5</div></div><div class="apd-config-slider apd-config-speed">\u5F39\u5E55\u901F\u5EA6<div class="apd-slider"></div><div class="apd-value">\u672A\u77E5</div></div></div></div></div><div class="apd-emitter"><div class="apd-style">${D.default}<div class="apd-style-panel"><div class="apd-style-panel-inner"><div class="apd-style-mode">\u6A21\u5F0F<div class="apd-modes"><div data-mode="0" class="apd-mode">${e.default}<div>\u6EDA\u52A8</div></div><div data-mode="1" class="apd-mode">${n.default}<div>\u9876\u90E8</div></div><div data-mode="2" class="apd-mode">${u.default}<div>\u5E95\u90E8</div></div></div></div><div class="apd-style-color">\u989C\u8272<div class="apd-colors">${this.COLOR.map(S=>`<div data-color="${S}" class="apd-color" style="background-color: ${S}"></div>`).join("")}</div></div></div></div></div><input class="apd-input" placeholder="\u53D1\u4E2A\u53CB\u5584\u7684\u5F39\u5E55\u89C1\u8BC1\u5F53\u4E0B" autocomplete="off" maxLength="${v.maxLength}" /><div class="apd-send">\u53D1\u9001</div></div>`}get OPACITY(){return{min:0,max:100,steps:[],...this.option.OPACITY}}get FONT_SIZE(){return{min:12,max:120,steps:[],...this.option.FONT_SIZE}}get MARGIN(){return{min:0,max:3,steps:[{name:"1/4",value:[10,"75%"]},{name:"\u534A\u5C4F",value:[10,"50%"]},{name:"3/4",value:[10,"25%"]},{name:"\u6EE1\u5C4F",value:[10,10]}],...this.option.MARGIN}}get SPEED(){return{min:0,max:4,steps:[{name:"\u6781\u6162",value:10},{name:"\u8F83\u6162",value:7.5,hide:!0},{name:"\u9002\u4E2D",value:5},{name:"\u8F83\u5FEB",value:2.5,hide:!0},{name:"\u6781\u5FEB",value:1}],...this.option.SPEED}}get COLOR(){return this.option.COLOR.length?this.option.COLOR:["#FE0302","#FF7204","#FFAA02","#FFD302","#FFFF00","#A0EE00","#00CD00","#019899","#4266BE","#89D5FF","#CC0273","#222222","#9B9B9B","#FFFFFF"]}query(v){let{query:S}=this.utils,{$danmuku:A}=this.template;return S(v,A)}append(v,S){let{append:A}=this.utils;[...v.children].some(P=>P===S)||A(v,S)}setData(v,S){let{$player:A}=this.art.template,{$mount:P}=this.template;A.dataset[v]=S,this.outside&&(P.dataset[v]=S)}createTemplate(){let{createElement:v,tooltip:S}=this.utils,A=v("div");A.className="artplayer-plugin-danmuku",A.innerHTML=this.TEMPLATE,this.template.$danmuku=A,this.template.$toggle=this.query(".apd-toggle"),this.template.$config=this.query(".apd-config"),this.template.$configPanel=this.query(".apd-config-panel"),this.template.$configModes=this.query(".apd-config-mode .apd-modes"),this.template.$style=this.query(".apd-style"),this.template.$stylePanel=this.query(".apd-style-panel"),this.template.$styleModes=this.query(".apd-style-mode .apd-modes"),this.template.$colors=this.query(".apd-colors"),this.template.$antiOverlap=this.query(".apd-anti-overlap"),this.template.$syncVideo=this.query(".apd-sync-video"),this.template.$opacitySlider=this.query(".apd-config-opacity .apd-slider"),this.template.$opacityValue=this.query(".apd-config-opacity .apd-value"),this.template.$marginSlider=this.query(".apd-config-margin .apd-slider"),this.template.$marginValue=this.query(".apd-config-margin .apd-value"),this.template.$fontSizeSlider=this.query(".apd-config-fontSize .apd-slider"),this.template.$fontSizeValue=this.query(".apd-config-fontSize .apd-value"),this.template.$speedSlider=this.query(".apd-config-speed .apd-slider"),this.template.$speedValue=this.query(".apd-config-speed .apd-value"),this.template.$input=this.query(".apd-input"),this.template.$send=this.query(".apd-send");let{$toggle:P}=this.template;this.art.on("artplayerPluginDanmuku:show",()=>{S(P,"\u5173\u95ED\u5F39\u5E55")}),this.art.on("artplayerPluginDanmuku:hide",()=>{S(P,"\u6253\u5F00\u5F39\u5E55")})}createEvents(){let{$toggle:v,$configModes:S,$styleModes:A,$colors:P,$antiOverlap:_,$syncVideo:F,$send:k,$input:B}=this.template;this.art.proxy(v,"click",()=>{this.danmuku.config({visible:!this.option.visible}),this.reset()}),this.art.proxy(S,"click",w=>{let U=w.target.closest(".apd-mode");if(!U)return;let N=Number(U.dataset.mode);this.option.modes.includes(N)?this.danmuku.config({modes:this.option.modes.filter(W=>W!==N)}):this.danmuku.config({modes:[...this.option.modes,N]}),this.reset()}),this.art.proxy(_,"click",()=>{this.danmuku.config({antiOverlap:!this.option.antiOverlap}),this.reset()}),this.art.proxy(F,"click",()=>{this.danmuku.config({synchronousPlayback:!this.option.synchronousPlayback}),this.reset()}),this.art.proxy(A,"click",w=>{let U=w.target.closest(".apd-mode");if(!U)return;let N=Number(U.dataset.mode);this.danmuku.config({mode:N}),this.reset()}),this.art.proxy(P,"click",w=>{let U=w.target.closest(".apd-color");U&&(this.danmuku.config({color:U.dataset.color}),this.reset())}),this.art.proxy(k,"click",()=>this.emit()),this.art.proxy(B,"keypress",w=>{w.key==="Enter"&&(w.preventDefault(),this.emit())})}createSliders(){this.slider.opacity=this.createSlider({...this.OPACITY,container:this.template.$opacitySlider,findIndex:()=>Math.round(100*this.option.opacity),onChange:v=>{let{$opacityValue:S}=this.template;S.textContent=`${v}%`,this.danmuku.config({opacity:v/100})}}),this.slider.margin=this.createSlider({...this.MARGIN,container:this.template.$marginSlider,findIndex:()=>this.MARGIN.steps.findIndex(v=>v.value[0]===this.option.margin[0]&&v.value[1]===this.option.margin[1]),onChange:v=>{let S=this.MARGIN.steps[v];if(!S)return;let{$marginValue:A}=this.template;A.textContent=S.name,this.danmuku.config({margin:S.value})}}),this.slider.fontSize=this.createSlider({...this.FONT_SIZE,container:this.template.$fontSizeSlider,findIndex:()=>this.danmuku.fontSize,onChange:v=>{let{$fontSizeValue:S}=this.template;S.textContent=`${v}px`,v!==this.danmuku.fontSize&&this.danmuku.config({fontSize:v})}}),this.slider.speed=this.createSlider({...this.SPEED,container:this.template.$speedSlider,findIndex:()=>this.SPEED.steps.findIndex(v=>v.value===this.option.speed),onChange:v=>{let S=this.SPEED.steps[v];if(!S)return;let{$speedValue:A}=this.template;A.textContent=S.name,this.danmuku.config({speed:S.value})}})}createSlider({min:v,max:S,container:A,findIndex:P,onChange:_,steps:F=[]}){let{query:k,clamp:B}=this.utils;A.innerHTML=`<div class="apd-slider-line"><div class="apd-slider-points">${F.map(()=>'<div class="apd-slider-point"></div>').join("")}</div><div class="apd-slider-progress"></div></div><div class="apd-slider-dot"></div><div class="apd-slider-steps">${F.map(H=>H.hide?"":`<div class="apd-slider-step">${H.name}</div>`).join("")}</div>`;let w=k(".apd-slider-dot",A),U=k(".apd-slider-progress",A),N=!1;function W(H=P()){if(H<v||H>S)return;let G=(H-v)/(S-v);w.style.left=`${100*G}%`,F.length===0&&(U.style.width=w.style.left),_(H)}function j(H){let{left:G,width:z}=A.getBoundingClientRect();W(Math.round(B(H.clientX-G,0,z)/z*(S-v)+v))}return this.art.proxy(A,"click",H=>{j(H)}),this.art.proxy(A,"mousedown",H=>{N=H.button===0}),this.art.on("document:mousemove",H=>{N&&j(H)}),this.art.on("document:mouseup",H=>{N&&(N=!1,j(H))}),{reset:W}}onFullscreen(v){let{$danmuku:S,$controlsCenter:A,$mount:P}=this.template;this.outside?v?this.append(A,S):this.append(P,S):this.append(A,S)}onMouseEnter({$control:v,$panel:S}){let{$player:A}=this.art.template,P=v.getBoundingClientRect(),_=S.getBoundingClientRect(),F=A.getBoundingClientRect(),k=_.width/2-P.width/2,B=F.left-(P.left-k),w=P.right+k-F.right;B>0?S.style.left=`${-k+B}px`:w>0?S.style.left=`${-k-w}px`:S.style.left=`${-k}px`}async emit(){let{$input:v}=this.template,S=v.value.trim();if(!S.length||this.isLock||this.emitting)return;let A={text:S,mode:this.option.mode,color:this.option.color,time:this.art.currentTime};try{this.emitting=!0;let P=await this.option.beforeEmit(A);if(this.emitting=!1,P!==!0)return;A.border=!0,delete A.time,this.danmuku.emit(A),v.value="",this.lock()}catch{this.emitting=!1}}lock(){let{addClass:v}=this.utils,{$send:S}=this.template;this.isLock=!0;let A=this.option.lockTime;S.innerText=A,v(S,"apd-lock");let P=()=>{this.timer=setTimeout(()=>{A===0?this.unlock():(A-=1,S.innerText=A,P())},1e3)};P()}unlock(){let{removeClass:v}=this.utils,{$send:S}=this.template;clearTimeout(this.timer),this.isLock=!1,S.innerText="\u53D1\u9001",v(S,"apd-lock")}resize(){if(this.outside||this.art.fullscreen||this.art.fullscreenWeb)return;let{$player:v,$controlsCenter:S}=this.art.template,{$danmuku:A}=this.template;this.art.width<this.option.width?this.append(v,A):this.append(S,A)}reset(){let{inverseClass:v,tooltip:S}=this.utils,{$toggle:A,$colors:P}=this.template;this.slider.opacity.reset(),this.slider.margin.reset(),this.slider.fontSize.reset(),this.slider.speed.reset(),this.setData("danmukuVisible",this.option.visible),this.setData("danmukuMode",this.option.mode),this.setData("danmukuColor",this.option.color),this.setData("danmukuMode0",this.option.modes.includes(0)),this.setData("danmukuMode1",this.option.modes.includes(1)),this.setData("danmukuMode2",this.option.modes.includes(2)),this.setData("danmukuAntiOverlap",this.option.antiOverlap),this.setData("danmukuSyncVideo",this.option.synchronousPlayback),this.setData("danmukuTheme",this.option.theme),this.setData("danmukuEmitter",this.option.emitter);let _=Array.from(P.children).find(F=>F.dataset.color===this.option.color.toUpperCase());_&&v(_,"apd-active"),S(A,this.option.visible?"\u5173\u95ED\u5F39\u5E55":"\u6253\u5F00\u5F39\u5E55"),this.resize()}mount(v){let{errorHandle:S}=this.utils,A=typeof v=="string"?document.querySelector(v):v;S(A,`Can not find the mount point: ${v}`),this.append(A,this.template.$danmuku),this.template.$mount=A,this.reset()}},typeof document<"u"){let v="artplayer-plugin-danmuku",S=document.getElementById(v);if(S)S.textContent=O.default;else{let A=document.createElement("style");A.id=v,A.textContent=O.default,document.head.appendChild(A)}}},{"bundle-text:./style.less":"hViDo","bundle-text:./img/on.svg":"9pjcf","bundle-text:./img/off.svg":"b2dkP","bundle-text:./img/config.svg":"l8tyy","bundle-text:./img/style.svg":"5iZC3","bundle-text:./img/mode_0_off.svg":"i0Vut","bundle-text:./img/mode_0_on.svg":"hOSvZ","bundle-text:./img/mode_1_off.svg":"bOXC3","bundle-text:./img/mode_1_on.svg":"lKuh0","bundle-text:./img/mode_2_off.svg":"eB8W6","bundle-text:./img/mode_2_on.svg":"bpe2E","bundle-text:./img/check_on.svg":"kL9zy","bundle-text:./img/check_off.svg":"22xpM","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],hViDo:[function(K,M,L){M.exports='.artplayer-plugin-danmuku{z-index:99;color:#fff;flex-shrink:0;justify-content:center;align-items:center;gap:10px;width:100%;height:32px;font-size:12px;font-weight:300;display:flex;position:relative}.artplayer-plugin-danmuku .apd-icon{cursor:pointer;opacity:.75;fill:#fff;transition:all .2s}.artplayer-plugin-danmuku .apd-icon:hover{opacity:1}.artplayer-plugin-danmuku .apd-config{display:flex;position:relative}.artplayer-plugin-danmuku .apd-config .apd-config-panel{opacity:0;pointer-events:none;width:320px;padding:10px;position:absolute;bottom:24px;left:0}.artplayer-plugin-danmuku .apd-config .apd-config-panel .apd-config-panel-inner{background-color:#000000d9;border-radius:3px;width:100%;padding:10px}.artplayer-plugin-danmuku .apd-config:hover .apd-config-panel{opacity:100;pointer-events:all}.artplayer-plugin-danmuku .apd-config-mode,.artplayer-plugin-danmuku .apd-config-slider,.artplayer-plugin-danmuku .apd-config-other,.artplayer-plugin-danmuku .apd-style-mode{margin-bottom:15px}.artplayer-plugin-danmuku .apd-modes{align-items:center;gap:20px;margin-top:5px;display:flex}.artplayer-plugin-danmuku .apd-modes .apd-mode{cursor:pointer;text-align:center}.artplayer-plugin-danmuku .apd-modes .apd-mode:hover{color:#00a1d6}.artplayer-plugin-danmuku .apd-config-slider{align-items:center;gap:12px;display:flex}.artplayer-plugin-danmuku .apd-config-slider .apd-value{text-align:right;width:32px}.artplayer-plugin-danmuku .apd-slider{cursor:pointer;flex:1;justify-content:center;align-items:center;height:20px;display:flex;position:relative}.artplayer-plugin-danmuku .apd-slider .apd-slider-line{background-color:#ffffff40;border-radius:3px;width:100%;height:2px;position:relative;overflow:hidden}.artplayer-plugin-danmuku .apd-slider .apd-slider-points{justify-content:space-between;align-items:center;display:flex;position:absolute;inset:0}.artplayer-plugin-danmuku .apd-slider .apd-slider-points .apd-slider-point{background-color:#ffffff80;border-radius:50%;width:2px;height:2px}.artplayer-plugin-danmuku .apd-slider .apd-slider-progress{background-color:#00a1d6;width:0%;height:100%}.artplayer-plugin-danmuku .apd-slider .apd-slider-dot{background-color:#00a1d6;border-radius:50%;width:12px;height:12px;position:absolute;left:0%;transform:translate(-6px)}.artplayer-plugin-danmuku .apd-slider .apd-slider-steps{color:#777;justify-content:space-between;align-items:center;width:calc(100% + 32px);display:flex;position:absolute;bottom:-12px}.artplayer-plugin-danmuku .apd-slider .apd-slider-steps .apd-slider-step{text-align:center;flex-shrink:0;width:36px;scale:.95}.artplayer-plugin-danmuku .apd-config-other{align-items:center;gap:20px;display:flex}.artplayer-plugin-danmuku .apd-config-other .apd-check-off,.artplayer-plugin-danmuku .apd-config-other .apd-check-on{width:16px;height:16px}.artplayer-plugin-danmuku .apd-config-other .apd-other{cursor:pointer;align-items:center;gap:2px;display:flex}.artplayer-plugin-danmuku .apd-config-other .apd-other:hover{color:#00a1d6}.artplayer-plugin-danmuku .apd-emitter{background-color:#ffffff40;border-radius:5px;flex:1;align-items:center;height:100%;display:flex}.artplayer-plugin-danmuku .apd-style{justify-content:center;align-items:center;display:flex;position:relative}.artplayer-plugin-danmuku .apd-style .apd-style-panel{opacity:0;pointer-events:none;width:200px;padding:10px;position:absolute;bottom:24px;left:0}.artplayer-plugin-danmuku .apd-style .apd-style-panel .apd-style-panel-inner{background-color:#000000d9;border-radius:3px;width:100%;padding:10px}.artplayer-plugin-danmuku .apd-style:hover .apd-style-panel{opacity:100;pointer-events:all}.artplayer-plugin-danmuku .apd-colors{flex-wrap:wrap;gap:8px;margin-top:5px;display:flex}.artplayer-plugin-danmuku .apd-colors .apd-color{cursor:pointer;border-radius:2px;width:16px;height:16px}.artplayer-plugin-danmuku .apd-colors .apd-color.apd-active{border:1px solid #000;box-shadow:0 0 0 1px #fff}.artplayer-plugin-danmuku .apd-input{color:#fff;background-color:#0000;border:none;outline:none;flex:1;width:auto;min-width:0;height:100%;line-height:1}.artplayer-plugin-danmuku .apd-input::placeholder{color:#ffffff80}.artplayer-plugin-danmuku .apd-send{cursor:pointer;text-shadow:none;background-color:#00a1d6;border-top-right-radius:5px;border-bottom-right-radius:5px;flex-shrink:0;justify-content:center;align-items:center;width:60px;height:100%;display:flex}.artplayer-plugin-danmuku .apd-send.apd-lock{cursor:not-allowed;color:#666;background-color:#e7e7e7}.art-controls-center .apd-emitter{flex:none;width:260px}.art-fullscreen .artplayer-plugin-danmuku,.art-fullscreen-web .artplayer-plugin-danmuku{gap:16px;height:38px}.art-fullscreen .artplayer-plugin-danmuku .apd-config-icon,.art-fullscreen-web .artplayer-plugin-danmuku .apd-config-icon,.art-fullscreen .artplayer-plugin-danmuku .apd-toggle-off,.art-fullscreen-web .artplayer-plugin-danmuku .apd-toggle-off,.art-fullscreen .artplayer-plugin-danmuku .apd-toggle-on,.art-fullscreen-web .artplayer-plugin-danmuku .apd-toggle-on{width:28px;height:28px}.art-fullscreen .artplayer-plugin-danmuku .apd-emitter,.art-fullscreen-web .artplayer-plugin-danmuku .apd-emitter{flex:none;width:400px}.art-video-player>.artplayer-plugin-danmuku{padding:0 10px;position:absolute;bottom:-40px;left:0;right:0}.art-video-player:has(>.artplayer-plugin-danmuku){margin-bottom:40px}[data-danmuku-emitter=false] .apd-emitter{display:none!important}[data-danmuku-emitter=false] .art-controls-center .artplayer-plugin-danmuku{justify-content:flex-end;gap:18px}[data-danmuku-emitter=false].art-fullscreen .art-controls-center .artplayer-plugin-danmuku,[data-danmuku-emitter=false].art-fullscreen-web .art-controls-center .artplayer-plugin-danmuku{gap:24px}[data-danmuku-theme=light]>.artplayer-plugin-danmuku .apd-icon{fill:#333}[data-danmuku-theme=light]>.artplayer-plugin-danmuku .apd-emitter{background-color:#f1f2f3}[data-danmuku-theme=light]>.artplayer-plugin-danmuku .apd-input{color:#000}[data-danmuku-theme=light]>.artplayer-plugin-danmuku .apd-input::placeholder{color:#0000004d}[data-danmuku-visible=false] .apd-toggle-off{display:block}[data-danmuku-visible=false] .apd-toggle-on,[data-danmuku-visible=true] .apd-toggle-off{display:none}[data-danmuku-visible=true] .apd-toggle-on{display:block}[data-danmuku-anti-overlap=false] .apd-anti-overlap .apd-check-on{display:none}[data-danmuku-anti-overlap=false] .apd-anti-overlap .apd-check-off,[data-danmuku-anti-overlap=true] .apd-anti-overlap .apd-check-on{display:block}[data-danmuku-anti-overlap=true] .apd-anti-overlap .apd-check-off,[data-danmuku-sync-video=false] .apd-sync-video .apd-check-on{display:none}[data-danmuku-sync-video=false] .apd-sync-video .apd-check-off,[data-danmuku-sync-video=true] .apd-sync-video .apd-check-on{display:block}[data-danmuku-sync-video=true] .apd-sync-video .apd-check-off{display:none}[data-danmuku-mode0=false] .apd-config-mode .apd-mode-0-off{display:block}[data-danmuku-mode0=false] .apd-config-mode .apd-mode-0-on{display:none}[data-danmuku-mode0=false] .art-danmuku [data-mode="0"]{opacity:0!important}[data-danmuku-mode0=true] .apd-config-mode .apd-mode-0-off{display:none}[data-danmuku-mode0=true] .apd-config-mode .apd-mode-0-on{display:block}[data-danmuku-mode="0"] .apd-style-mode [data-mode="0"]{color:#00a1d6}[data-danmuku-mode="0"] .apd-style-mode [data-mode="0"] path{fill:#00a1d6}[data-danmuku-mode1=false] .apd-config-mode .apd-mode-1-off{display:block}[data-danmuku-mode1=false] .apd-config-mode .apd-mode-1-on{display:none}[data-danmuku-mode1=false] .art-danmuku [data-mode="1"]{opacity:0!important}[data-danmuku-mode1=true] .apd-config-mode .apd-mode-1-off{display:none}[data-danmuku-mode1=true] .apd-config-mode .apd-mode-1-on{display:block}[data-danmuku-mode="1"] .apd-style-mode [data-mode="1"]{color:#00a1d6}[data-danmuku-mode="1"] .apd-style-mode [data-mode="1"] path{fill:#00a1d6}[data-danmuku-mode2=false] .apd-config-mode .apd-mode-2-off{display:block}[data-danmuku-mode2=false] .apd-config-mode .apd-mode-2-on{display:none}[data-danmuku-mode2=false] .art-danmuku [data-mode="2"]{opacity:0!important}[data-danmuku-mode2=true] .apd-config-mode .apd-mode-2-off{display:none}[data-danmuku-mode2=true] .apd-config-mode .apd-mode-2-on{display:block}[data-danmuku-mode="2"] .apd-style-mode [data-mode="2"]{color:#00a1d6}[data-danmuku-mode="2"] .apd-style-mode [data-mode="2"] path{fill:#00a1d6}'},{}],"9pjcf":[function(K,M,L){M.exports='<svg class="apd-icon apd-toggle-on" xmlns="http://www.w3.org/2000/svg" data-pointer="none" viewBox="0 0 24 24" width="24" height="24"><path fill-rule="evenodd" d="M11.989 4.828c-.47 0-.975.004-1.515.012l-1.71-2.566a1.008 1.008 0 0 0-1.678 1.118l.999 1.5c-.681.018-1.403.04-2.164.068a4.013 4.013 0 0 0-3.83 3.44c-.165 1.15-.245 2.545-.245 4.185 0 1.965.115 3.67.35 5.116a4.012 4.012 0 0 0 3.763 3.363l.906.046c1.205.063 1.808.095 3.607.095a.988.988 0 0 0 0-1.975c-1.758 0-2.339-.03-3.501-.092l-.915-.047a2.037 2.037 0 0 1-1.91-1.708c-.216-1.324-.325-2.924-.325-4.798 0-1.563.076-2.864.225-3.904.14-.977.96-1.713 1.945-1.747 2.444-.087 4.465-.13 6.063-.131 1.598 0 3.62.044 6.064.13.96.034 1.71.81 1.855 1.814.075.524.113 1.962.141 3.065v.002c.01.342.017.65.025.88a.987.987 0 1 0 1.974-.068c-.008-.226-.016-.523-.025-.856v-.027c-.03-1.118-.073-2.663-.16-3.276-.273-1.906-1.783-3.438-3.74-3.507-.9-.032-1.743-.058-2.531-.078l1.05-1.46a1.008 1.008 0 0 0-1.638-1.177l-1.862 2.59c-.38-.004-.744-.007-1.088-.007h-.13Zm.521 4.775h-1.32v4.631h2.222v.847h-2.618v1.078h2.618l.003.678c.36.026.714.163 1.01.407h.11v-1.085h2.694v-1.078h-2.695v-.847H16.8v-4.63h-1.276a8.59 8.59 0 0 0 .748-1.42L15.183 7.8a14.232 14.232 0 0 1-.814 1.804h-1.518l.693-.308a8.862 8.862 0 0 0-.814-1.408l-1.045.352c.297.396.572.847.825 1.364Zm-4.18 3.564.154-1.485h1.98V8.294h-3.2v.98H9.33v1.43H7.472l-.308 3.453h2.277c0 1.166-.044 1.925-.12 2.277-.078.352-.386.528-.936.528-.308 0-.616-.022-.902-.055l.297 1.067.062.005c.285.02.551.04.818.04 1.001-.067 1.562-.419 1.694-1.057.11-.638.176-1.903.176-3.795h-2.2Zm7.458.11v-.858h-1.254v.858h1.254Zm-2.376-.858v.858h-1.199v-.858h1.2Zm-1.199-.946h1.2v-.902h-1.2v.902Zm2.321 0v-.902h1.254v.902h-1.254Z" clip-rule="evenodd"/><path fill="#00AEEC" fill-rule="evenodd" d="M22.846 14.627a1 1 0 0 0-1.412.075l-5.091 5.703-2.216-2.275-.097-.086-.008-.005a1 1 0 0 0-1.322 1.493l2.963 3.041.093.083.007.005a1 1 0 0 0 1.354-.124l5.81-6.505.08-.102.005-.008a1 1 0 0 0-.166-1.295Z" clip-rule="evenodd"/></svg>'},{}],b2dkP:[function(K,M,L){M.exports='<svg class="apd-icon apd-toggle-off" xmlns="http://www.w3.org/2000/svg" data-pointer="none" viewBox="0 0 24 24" width="24" height="24"><path fill-rule="evenodd" d="m8.085 4.891-.999-1.499a1.008 1.008 0 0 1 1.679-1.118l1.709 2.566c.54-.008 1.045-.012 1.515-.012h.13c.345 0 .707.003 1.088.007l1.862-2.59a1.008 1.008 0 0 1 1.637 1.177l-1.049 1.46c.788.02 1.631.046 2.53.078 1.958.069 3.468 1.6 3.74 3.507.088.613.13 2.158.16 3.276l.001.027c.01.333.017.63.025.856a.987.987 0 0 1-1.974.069c-.008-.23-.016-.539-.025-.881v-.002c-.028-1.103-.066-2.541-.142-3.065-.143-1.004-.895-1.78-1.854-1.813a179.14 179.14 0 0 0-6.064-.131c-1.598 0-3.619.044-6.063.13a2.037 2.037 0 0 0-1.945 1.748c-.15 1.04-.225 2.341-.225 3.904 0 1.874.11 3.474.325 4.798.154.949.95 1.66 1.91 1.708a97.58 97.58 0 0 0 5.416.139.988.988 0 0 1 0 1.975 99.78 99.78 0 0 1-5.513-.141A4.012 4.012 0 0 1 2.197 17.7c-.236-1.446-.351-3.151-.351-5.116 0-1.64.08-3.035.245-4.184A4.013 4.013 0 0 1 5.92 4.96c.761-.027 1.483-.05 2.164-.069Zm4.436 4.707h-1.32v4.63h2.222v.848h-2.618v1.078h2.431a5.01 5.01 0 0 1 3.575-3.115V9.598h-1.276a8.59 8.59 0 0 0 .748-1.42l-1.089-.384a14.232 14.232 0 0 1-.814 1.804h-1.518l.693-.308a8.862 8.862 0 0 0-.814-1.408l-1.045.352c.297.396.572.847.825 1.364Zm-4.18 3.564.154-1.485h1.98V8.289h-3.2v.979h2.067v1.43H7.483l-.308 3.454h2.277c0 1.166-.044 1.925-.12 2.277-.078.352-.386.528-.936.528-.308 0-.616-.022-.902-.055l.297 1.067.062.004c.285.02.551.04.818.04 1.001-.066 1.562-.418 1.694-1.056.11-.638.176-1.903.176-3.795h-2.2Zm7.458.11v-.858h-1.254v.858H15.8Zm-2.376-.858v.858h-1.199v-.858h1.2Zm-1.199-.946h1.2v-.902h-1.2v.902Zm2.321 0v-.902H15.8v.902h-1.254Zm3.517 10.594a4 4 0 1 0 0-8 4 4 0 0 0 0 8Zm-.002-1.502a2.5 2.5 0 0 1-2.217-3.657l3.326 3.398a2.49 2.49 0 0 1-1.109.259Zm2.5-2.5c0 .42-.103.815-.286 1.162l-3.328-3.401a2.5 2.5 0 0 1 3.614 2.239Z" clip-rule="evenodd"/></svg>'},{}],l8tyy:[function(K,M,L){M.exports='<svg class="apd-icon apd-config-icon" xmlns="http://www.w3.org/2000/svg" data-pointer="none" viewBox="0 0 24 24" width="24" height="24"><path fill-rule="evenodd" d="m15.645 4.881 1.06-1.473a.998.998 0 1 0-1.622-1.166L13.22 4.835a110.67 110.67 0 0 0-1.1-.007h-.131c-.47 0-.975.004-1.515.012L8.783 2.3A.998.998 0 0 0 7.12 3.408l.988 1.484c-.688.019-1.418.042-2.188.069a4.013 4.013 0 0 0-3.83 3.44c-.165 1.15-.245 2.545-.245 4.185 0 1.965.115 3.67.35 5.116a4.012 4.012 0 0 0 3.763 3.363 99.78 99.78 0 0 0 5.513.141.988.988 0 0 0 0-1.975 97.58 97.58 0 0 1-5.416-.139 2.037 2.037 0 0 1-1.91-1.708c-.216-1.324-.325-2.924-.325-4.798 0-1.563.076-2.864.225-3.904.14-.977.96-1.713 1.945-1.747 2.444-.087 4.465-.13 6.063-.131 1.598 0 3.62.044 6.064.13.96.034 1.71.81 1.855 1.814.075.524.113 1.962.141 3.065v.002c.005.183.01.07.014-.038.004-.096.008-.189.011-.081a.987.987 0 1 0 1.974-.069c-.004-.105-.007-.009-.011.09a2.175 2.175 0 0 1-.007.135l-.002.01a.574.574 0 0 1-.005-.091v-.027c-.03-1.118-.073-2.663-.16-3.276-.273-1.906-1.783-3.438-3.74-3.507-.905-.032-1.752-.058-2.543-.079Zm-3.113 4.703h-1.307v4.643h2.2v.04l.651-1.234c.113-.215.281-.389.482-.509v-.11h.235c.137-.049.283-.074.433-.074h1.553V9.584h-1.264a8.5 8.5 0 0 0 .741-1.405l-1.078-.381c-.24.631-.501 1.23-.806 1.786h-1.503l.686-.305a8.613 8.613 0 0 0-.806-1.394l-1.034.348c.294.392.566.839.817 1.35Zm-1.7 5.502h2.16l-.564 1.068h-1.595v-1.068Zm-2.498-1.863.152-1.561h1.96V8.289H7.277v.969h2.048v1.435h-1.84l-.306 3.51h2.254c0 1.155-.043 1.906-.12 2.255-.076.348-.38.523-.925.523-.305 0-.61-.022-.893-.055l.294 1.056.061.005c.282.02.546.039.81.039.991-.065 1.547-.414 1.677-1.046.11-.631.175-1.883.175-3.757H8.334Zm5.09-.8v.85h-1.188v-.85h1.187Zm-1.188-.955h1.187v-.893h-1.187v.893Zm2.322.007v-.893h1.241v.893h-1.241Zm.528 2.757a1.26 1.26 0 0 1 1.087-.627l4.003-.009a1.26 1.26 0 0 1 1.094.63l1.721 2.982c.226.39.225.872-.001 1.263l-1.743 3a1.26 1.26 0 0 1-1.086.628l-4.003.009a1.26 1.26 0 0 1-1.094-.63l-1.722-2.982a1.26 1.26 0 0 1 .002-1.263l1.742-3Zm1.967.858a1.26 1.26 0 0 0-1.08.614l-.903 1.513a1.26 1.26 0 0 0-.002 1.289l.885 1.492c.227.384.64.62 1.086.618l2.192-.005a1.26 1.26 0 0 0 1.08-.615l.904-1.518a1.26 1.26 0 0 0 .001-1.288l-.884-1.489a1.26 1.26 0 0 0-1.086-.616l-2.193.005Zm2.517 2.76a1.4 1.4 0 1 1-2.8 0 1.4 1.4 0 0 1 2.8 0Z" clip-rule="evenodd"/></svg>'},{}],"5iZC3":[function(K,M,L){M.exports='<svg class="apd-icon apd-style-icon" xmlns="http://www.w3.org/2000/svg" xml:space="preserve" data-pointer="none" style="enable-background:new 0 0 22 22" viewBox="0 0 22 22" width="36" height="24"><path d="M17 16H5c-.55 0-1 .45-1 1s.45 1 1 1h12c.55 0 1-.45 1-1s-.45-1-1-1zM6.96 15c.39 0 .74-.24.89-.6l.65-1.6h5l.66 1.6c.15.36.5.6.89.6.69 0 1.15-.71.88-1.34l-3.88-8.97C11.87 4.27 11.46 4 11 4s-.87.27-1.05.69l-3.88 8.97c-.27.63.2 1.34.89 1.34zM11 5.98 12.87 11H9.13L11 5.98z"/></svg>'},{}],i0Vut:[function(K,M,L){M.exports='<svg class="apd-icon apd-mode-0-off" xmlns="http://www.w3.org/2000/svg" xml:space="preserve" data-pointer="none" style="enable-background:new 0 0 28 28" viewBox="0 0 28 28" width="28" height="28"><path d="M23 15c1.487 0 2.866.464 4 1.255V7a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v14a4 4 0 0 0 4 4h11.674A7 7 0 0 1 23 15zM11 9h6a1 1 0 0 1 0 2h-6a1 1 0 0 1 0-2zm-3 2H6V9h2v2zm4 4h-2v-2h2v2zm2-1a1 1 0 0 1 1-1h1a1 1 0 0 1 0 2h-1a1 1 0 0 1-1-1z" fill="#00AEEC"/><path d="M26.536 18.464a5 5 0 0 0-7.071 0 5 5 0 0 0 0 7.071 5 5 0 1 0 7.071-7.071zm-5.657 5.657a3 3 0 0 1-.586-3.415l4.001 4.001a3 3 0 0 1-3.415-.586zm4.829-.827-4.001-4.001a3.002 3.002 0 0 1 4.001 4.001z" fill="#00AEEC"/></svg>'},{}],hOSvZ:[function(K,M,L){M.exports='<svg class="apd-icon apd-mode-0-on" xmlns="http://www.w3.org/2000/svg" xml:space="preserve" data-pointer="none" style="enable-background:new 0 0 28 28" viewBox="0 0 28 28" width="28" height="28"><path d="M23 3H5a4 4 0 0 0-4 4v14a4 4 0 0 0 4 4h18a4 4 0 0 0 4-4V7a4 4 0 0 0-4-4zM11 9h6a1 1 0 0 1 0 2h-6a1 1 0 0 1 0-2zm-3 2H6V9h2v2zm4 4h-2v-2h2v2zm9 0h-6a1 1 0 0 1 0-2h6a1 1 0 0 1 0 2z" fill="#FFF"/></svg>'},{}],bOXC3:[function(K,M,L){M.exports='<svg class="apd-icon apd-mode-1-off" xmlns="http://www.w3.org/2000/svg" xml:space="preserve" data-pointer="none" style="enable-background:new 0 0 28 28" viewBox="0 0 28 28" width="28" height="28"><path d="M23 15c1.487 0 2.866.464 4 1.255V7a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v14a4 4 0 0 0 4 4h11.674A7 7 0 0 1 23 15zm-4-8h2v2h-2V7zM9 9H7V7h2v2zm4 0h-2V7h2v2zm2-2h2v2h-2V7z" fill="#00AEEC"/><path d="M26.536 18.464a5 5 0 0 0-7.071 0 5 5 0 0 0 0 7.071 5 5 0 1 0 7.071-7.071zm-5.657 5.657a3 3 0 0 1-.586-3.415l4.001 4.001a3 3 0 0 1-3.415-.586zm4.829-.827-4.001-4.001a3.002 3.002 0 0 1 4.001 4.001z" fill="#00AEEC"/></svg>'},{}],lKuh0:[function(K,M,L){M.exports='<svg class="apd-icon apd-mode-1-on" xmlns="http://www.w3.org/2000/svg" xml:space="preserve" data-pointer="none" style="enable-background:new 0 0 28 28" viewBox="0 0 28 28" width="28" height="28"><path d="M23 3H5a4 4 0 0 0-4 4v14a4 4 0 0 0 4 4h18a4 4 0 0 0 4-4V7a4 4 0 0 0-4-4zM9 9H7V7h2v2zm4 0h-2V7h2v2zm4 0h-2V7h2v2zm4 0h-2V7h2v2z" fill="#FFF"/></svg>'},{}],eB8W6:[function(K,M,L){M.exports='<svg class="apd-icon apd-mode-2-off" xmlns="http://www.w3.org/2000/svg" xml:space="preserve" data-pointer="none" style="enable-background:new 0 0 28 28" viewBox="0 0 28 28" width="28" height="28"><path d="M23 15c1.487 0 2.866.464 4 1.255V7a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v14a4 4 0 0 0 4 4h11.674A7 7 0 0 1 23 15zM9 21H7v-2h2v2zm4 0h-2v-2h2v2z" fill="#00AEEC"/><path d="M26.536 18.464a5 5 0 0 0-7.071 0 5 5 0 0 0 0 7.071 5 5 0 1 0 7.071-7.071zm-5.657 5.657a3 3 0 0 1-.586-3.415l4.001 4.001a3 3 0 0 1-3.415-.586zm4.829-.827-4.001-4.001a3.002 3.002 0 0 1 4.001 4.001z" fill="#00AEEC"/></svg>'},{}],bpe2E:[function(K,M,L){M.exports='<svg class="apd-icon apd-mode-2-on" xmlns="http://www.w3.org/2000/svg" xml:space="preserve" data-pointer="none" style="enable-background:new 0 0 28 28" viewBox="0 0 28 28" width="28" height="28"><path d="M23 3H5a4 4 0 0 0-4 4v14a4 4 0 0 0 4 4h18a4 4 0 0 0 4-4V7a4 4 0 0 0-4-4zM9 21H7v-2h2v2zm4 0h-2v-2h2v2zm4 0h-2v-2h2v2zm4 0h-2v-2h2v2z" fill="#FFF"/></svg>'},{}],kL9zy:[function(K,M,L){M.exports='<svg class="apd-icon apd-check-on" xmlns="http://www.w3.org/2000/svg" data-pointer="none" viewBox="0 0 32 32" width="32" height="32"><path d="m13 18.25-1.8-1.8c-.6-.6-1.65-.6-2.25 0s-.6 1.5 0 2.25l2.85 2.85c.318.318.762.468 1.2.448.438.02.882-.13 1.2-.448l8.85-8.85c.6-.6.6-1.65 0-2.25s-1.65-.6-2.25 0l-7.8 7.8zM8 4h16c2.21 0 4 1.79 4 4v16c0 2.21-1.79 4-4 4H8c-2.21 0-4-1.79-4-4V8c0-2.21 1.79-4 4-4z" fill="#00AEEC"/></svg>'},{}],"22xpM":[function(K,M,L){M.exports='<svg class="apd-icon apd-check-off" xmlns="http://www.w3.org/2000/svg" data-pointer="none" viewBox="0 0 32 32" width="32" height="32"><path d="M8 6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2H8zm0-2h16c2.21 0 4 1.79 4 4v16c0 2.21-1.79 4-4 4H8c-2.21 0-4-1.79-4-4V8c0-2.21 1.79-4 4-4z" fill="#FFF"/></svg>'},{}],"8AxLD":[function(K,M,L){var x=K("@parcel/transformer-js/src/esmodule-helpers.js");x.defineInteropFlag(L),x.export(L,"default",()=>b);let R={map:(C,I,T,m,p)=>(C-I)*(p-m)/(T-I)+m,range(C,I,T){let m=Math.round(C/T)*T;return Array.from({length:Math.floor((I-C)/T)},(p,g)=>g*T+m)}},O=(C,I)=>{let T=I[0]-C[0],m=I[1]-C[1];return{length:Math.sqrt(Math.pow(T,2)+Math.pow(m,2)),angle:Math.atan2(m,T)}};function b(C,I,T){let{query:m}=C.constructor.utils;C.controls.add({name:"heatmap",position:"top",html:"",style:{position:"absolute",top:"-100px",left:"0px",right:"0px",height:"100px",width:"100%",pointerEvents:"none"},mounted(p){let g=null,D=null;function E(d=[]){if(g=null,D=null,p.innerHTML="",!C.duration||C.option.isLive)return;let r={w:p.offsetWidth,h:p.offsetHeight},e={xMin:0,xMax:r.w,yMin:0,yMax:128,scale:.25,opacity:.2,minHeight:Math.floor(.05*r.h),sampling:Math.floor(r.w/100),smoothing:.2,flattening:.2};typeof T=="object"&&Object.assign(e,T);let a=[];if(Array.isArray(d)&&d.length)a=[...d];else{let c=C.duration/r.w;for(let s=0;s<=r.w;s+=e.sampling){let o=I.queue.filter(({time:v})=>v>s*c&&v<=(s+e.sampling)*c).length;a.push([s,o])}}if(a.length===0)return;let l=a[a.length-1],h=l[0],n=l[1];h!==r.w&&a.push([r.w,n]);let t=a.map(c=>c[1]),i=(Math.min(...t)+Math.max(...t))/2;for(let c=0;c<a.length;c++){let s=a[c],o=s[1];s[1]=o*(o>i?1+e.scale:1-e.scale)+e.minHeight}let y=(c,s,o,v)=>{let S=O(s||c,o||c),A=R.map(Math.cos(S.angle)*e.flattening,0,1,1,0),P=S.angle*A+(v?Math.PI:0),_=S.length*e.smoothing;return[c[0]+Math.cos(P)*_,c[1]+Math.sin(P)*_]},u=(c,s,o)=>{let v=y(o[s-1],o[s-2],c),S=y(c,o[s-1],o[s+1],!0),A=s===o.length-1?" z":"";return`C ${v[0]},${v[1]} ${S[0]},${S[1]} ${c[0]},${c[1]}${A}`},f=a.map(c=>[R.map(c[0],e.xMin,e.xMax,0,r.w),R.map(c[1],e.yMin,e.yMax,r.h,0)]).reduce((c,s,o,v)=>o===0?`M ${v[v.length-1][0]},${r.h} L ${s[0]},${r.h} L ${s[0]},${s[1]}`:`${c} ${u(s,o,v)}`,"");p.innerHTML=`<svg viewBox="0 0 ${r.w} ${r.h}"><defs><linearGradient id="heatmap-solids" x1="0%" y1="0%" x2="100%" y2="0%"><stop offset="0%" style="stop-color:var(--art-theme);stop-opacity:${e.opacity}" /><stop offset="0%" style="stop-color:var(--art-theme);stop-opacity:${e.opacity}" id="heatmap-start" /><stop offset="0%" style="stop-color:var(--art-progress-color);stop-opacity:1" id="heatmap-stop" /><stop offset="100%" style="stop-color:var(--art-progress-color);stop-opacity:1" /></linearGradient></defs><path fill="url(#heatmap-solids)" d="${f}"></path></svg>`,g=m("#heatmap-start",p),D=m("#heatmap-stop",p),g.setAttribute("offset",`${100*C.played}%`),D.setAttribute("offset",`${100*C.played}%`)}C.on("video:timeupdate",()=>{g&&D&&(g.setAttribute("offset",`${100*C.played}%`),D.setAttribute("offset",`${100*C.played}%`))}),C.on("setBar",(d,r)=>{g&&D&&d==="played"&&(g.setAttribute("offset",`${100*r}%`),D.setAttribute("offset",`${100*r}%`))}),C.on("ready",()=>E()),C.on("resize",()=>E()),C.on("artplayerPluginDanmuku:loaded",()=>E()),C.on("artplayerPluginDanmuku:points",d=>E(d))}})}},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}]},["bgm6t"],"bgm6t","parcelRequire4dc0")})(We);const st=Ke(We.exports);var Ge={exports:{}};(function(ie,de){var K=function(M){var L=!1;try{if(typeof WebAssembly=="object"&&typeof WebAssembly.instantiate=="function"){const d=new WebAssembly.Module(Uint8Array.of(0,97,115,109,1,0,0,0));d instanceof WebAssembly.Module&&(L=new WebAssembly.Instance(d)instanceof WebAssembly.Instance)}}catch{}console.log("WebAssembly support detected: "+(L?"yes":"no"));var x=this;x.canvas=M.canvas,x.renderMode=M.renderMode||(M.lossyRender?"lossy":"wasm-blend"),x.libassMemoryLimit=M.libassMemoryLimit||0,x.libassGlyphLimit=M.libassGlyphLimit||0,x.targetFps=M.targetFps||24,x.prescaleFactor=M.prescaleFactor||1,x.prescaleHeightLimit=M.prescaleHeightLimit||1080,x.maxRenderHeight=M.maxRenderHeight||0,x.dropAllAnimations=M.dropAllAnimations||!1,x.isOurCanvas=!1,x.video=M.video,x.canvasParent=null,x.fonts=M.fonts||[],x.availableFonts=M.availableFonts||[],x.fallbackFont=M.fallbackFont||"default.woff2",x.lazyFileLoading=M.lazyFileLoading||!1,x.onReadyEvent=M.onReady,L?x.workerUrl=M.workerUrl||"subtitles-octopus-worker.js":x.workerUrl=M.legacyWorkerUrl||"subtitles-octopus-worker-legacy.js",x.subUrl=M.subUrl,x.subContent=M.subContent||null,x.onErrorEvent=M.onError,x.debug=M.debug||!1,x.lastRenderTime=0,x.pixelRatio=window.devicePixelRatio||1,x.timeOffset=M.timeOffset||0,x.hasAlphaBug=!1,function(){if(typeof ImageData.prototype.constructor=="function")try{new window.ImageData(new Uint8ClampedArray([0,0,0,0]),1,1);return}catch{console.log("detected that ImageData is not constructable despite browser saying so")}var d=document.createElement("canvas"),r=d.getContext("2d");window.ImageData=function(){var e=0;if(arguments[0]instanceof Uint8ClampedArray)var a=arguments[e++];var l=arguments[e++],h=arguments[e],n=r.createImageData(l,h);return a&&n.data.set(a),n}}(),x.workerError=function(d){if(console.error("Worker error: ",d),x.onErrorEvent&&x.onErrorEvent(d),!x.debug)throw x.dispose(),new Error("Worker error: "+d)},x.init=function(){if(!window.Worker){x.workerError("worker not supported");return}x.worker||(x.worker=new Worker(x.workerUrl),x.worker.addEventListener("message",x.onWorkerMessage),x.worker.addEventListener("error",x.workerError)),x.workerActive=!1,x.createCanvas(),x.setVideo(M.video),x.setSubUrl(M.subUrl),x.worker.postMessage({target:"worker-init",width:x.canvas.width,height:x.canvas.height,URL:document.URL,currentScript:x.workerUrl,preMain:!0,renderMode:x.renderMode,subUrl:x.subUrl,subContent:x.subContent,fonts:x.fonts,availableFonts:x.availableFonts,fallbackFont:x.fallbackFont,lazyFileLoading:x.lazyFileLoading,debug:x.debug,targetFps:x.targetFps,libassMemoryLimit:x.libassMemoryLimit,libassGlyphLimit:x.libassGlyphLimit,dropAllAnimations:x.dropAllAnimations})},x.createCanvas=function(){x.canvas||(x.video?(x.isOurCanvas=!0,x.canvas=document.createElement("canvas"),x.canvas.className="libassjs-canvas",x.canvas.style.display="none",x.canvasParent=document.createElement("div"),x.canvasParent.className="libassjs-canvas-parent",x.canvasParent.appendChild(x.canvas),x.video.nextSibling?x.video.parentNode.insertBefore(x.canvasParent,x.video.nextSibling):x.video.parentNode.appendChild(x.canvasParent)):x.canvas||x.workerError("Don't know where to render: you should give video or canvas in options.")),x.ctx=x.canvas.getContext("2d"),x.bufferCanvas=document.createElement("canvas"),x.bufferCanvasCtx=x.bufferCanvas.getContext("2d"),x.bufferCanvas.width=1,x.bufferCanvas.height=1;var d=new Uint8ClampedArray([0,255,0,0]),r=new ImageData(d,1,1);x.bufferCanvasCtx.clearRect(0,0,1,1),x.ctx.clearRect(0,0,1,1);var e=x.ctx.getImageData(0,0,1,1).data;x.bufferCanvasCtx.putImageData(r,0,0),x.ctx.drawImage(x.bufferCanvas,0,0);var a=x.ctx.getImageData(0,0,1,1).data;x.hasAlphaBug=e[1]!=a[1],x.hasAlphaBug&&console.log("Detected a browser having issue with transparent pixels, applying workaround")};function R(){x.setCurrentTime(x.video.currentTime+x.timeOffset)}function O(){x.setIsPaused(!1,x.video.currentTime+x.timeOffset)}function b(){x.setIsPaused(!0,x.video.currentTime+x.timeOffset)}function C(){x.video.removeEventListener("timeupdate",R,!1)}function I(){x.video.addEventListener("timeupdate",R,!1);var d=x.video.currentTime+x.timeOffset;x.setCurrentTime(d)}function T(){x.setRate(x.video.playbackRate)}function m(){x.setIsPaused(!0,x.video.currentTime+x.timeOffset)}function p(d){d.target.removeEventListener(d.type,p,!1),x.resize()}x.setVideo=function(d){x.video=d,x.video&&(x.video.addEventListener("timeupdate",R,!1),x.video.addEventListener("playing",O,!1),x.video.addEventListener("pause",b,!1),x.video.addEventListener("seeking",C,!1),x.video.addEventListener("seeked",I,!1),x.video.addEventListener("ratechange",T,!1),x.video.addEventListener("waiting",m,!1),document.addEventListener("fullscreenchange",x.resizeWithTimeout,!1),document.addEventListener("mozfullscreenchange",x.resizeWithTimeout,!1),document.addEventListener("webkitfullscreenchange",x.resizeWithTimeout,!1),document.addEventListener("msfullscreenchange",x.resizeWithTimeout,!1),window.addEventListener("resize",x.resizeWithTimeout,!1),typeof ResizeObserver<"u"&&(x.ro=new ResizeObserver(x.resizeWithTimeout),x.ro.observe(x.video)),x.video.videoWidth>0?x.resize():x.video.addEventListener("loadedmetadata",p,!1))},x.getVideoPosition=function(){var d=x.video.videoWidth/x.video.videoHeight,r=x.video.offsetWidth,e=x.video.offsetHeight,a=r/e,l=r,h=e;a>d?l=Math.floor(e*d):h=Math.floor(r/d);var n=(r-l)/2,t=(e-h)/2;return{width:l,height:h,x:n,y:t}},x.setSubUrl=function(d){x.subUrl=d},x.renderFrameData=null;function g(){var d=x.renderFramesData,r=performance.now();x.ctx.clearRect(0,0,x.canvas.width,x.canvas.height);for(var e=0;e<d.canvases.length;e++){var a=d.canvases[e];x.bufferCanvas.width=a.w,x.bufferCanvas.height=a.h;var l=new Uint8ClampedArray(a.buffer);if(x.hasAlphaBug)for(var h=3;h<l.length;h=h+4)l[h]=l[h]>=1?l[h]:1;var n=new ImageData(l,a.w,a.h);x.bufferCanvasCtx.putImageData(n,0,0),x.ctx.drawImage(x.bufferCanvas,a.x,a.y)}if(x.debug){var t=Math.round(performance.now()-r),i=d.blendTime;console.log(typeof i<"u"?"render: "+Math.round(d.spentTime-i)+" ms, blend: "+Math.round(i)+" ms, draw: "+t+" ms; TOTAL="+Math.round(d.spentTime+t)+" ms":Math.round(d.spentTime)+" ms (+ "+t+" ms draw)"),x.renderStart=performance.now()}}function D(){var d=x.renderFramesData,r=performance.now();x.ctx.clearRect(0,0,x.canvas.width,x.canvas.height);for(var e=0;e<d.bitmaps.length;e++){var a=d.bitmaps[e];x.ctx.drawImage(a.bitmap,a.x,a.y)}if(x.debug){var l=Math.round(performance.now()-r);console.log(d.bitmaps.length+" bitmaps, libass: "+Math.round(d.libassTime)+"ms, decode: "+Math.round(d.decodeTime)+"ms, draw: "+l+"ms"),x.renderStart=performance.now()}}x.workerActive=!1,x.frameId=0,x.onWorkerMessage=function(d){x.workerActive||(x.workerActive=!0,x.onReadyEvent&&x.onReadyEvent());var r=d.data;switch(r.target){case"stdout":{console.log(r.content);break}case"console-log":{console.log.apply(console,JSON.parse(r.content));break}case"console-debug":{console.debug.apply(console,JSON.parse(r.content));break}case"console-info":{console.info.apply(console,JSON.parse(r.content));break}case"console-warn":{console.warn.apply(console,JSON.parse(r.content));break}case"console-error":{console.error.apply(console,JSON.parse(r.content));break}case"stderr":{console.error(r.content);break}case"window":{window[r.method]();break}case"canvas":{switch(r.op){case"getContext":{x.ctx=x.canvas.getContext(r.type,r.attributes);break}case"resize":{x.resize(r.width,r.height);break}case"renderCanvas":{x.lastRenderTime<r.time&&(x.lastRenderTime=r.time,x.renderFramesData=r,window.requestAnimationFrame(g));break}case"renderFastCanvas":{x.lastRenderTime<r.time&&(x.lastRenderTime=r.time,x.renderFramesData=r,window.requestAnimationFrame(D));break}case"setObjectProperty":{x.canvas[r.object][r.property]=r.value;break}default:throw"eh?"}break}case"tick":{x.frameId=r.id,x.worker.postMessage({target:"tock",id:x.frameId});break}case"custom":{if(x.onCustomMessage)x.onCustomMessage(d);else throw"Custom message received but client onCustomMessage not implemented.";break}case"setimmediate":{x.worker.postMessage({target:"setimmediate"});break}case"get-events":break;case"get-styles":break;case"ready":break;default:throw"what? "+r.target}};function E(d,r){var e=x.prescaleFactor<=0?1:x.prescaleFactor;if(r<=0||d<=0)d=0,r=0;else{var a=e<1?-1:1,l=r;a*l*e<=a*x.prescaleHeightLimit?l*=e:a*l<a*x.prescaleHeightLimit&&(l=x.prescaleHeightLimit),x.maxRenderHeight>0&&l>x.maxRenderHeight&&(l=x.maxRenderHeight),d*=l/r,r=l}return{width:d,height:r}}x.resize=function(d,r,e,a){var l=null;if(e=e||0,a=a||0,(!d||!r)&&x.video){l=x.getVideoPosition();var h=E(l.width*x.pixelRatio,l.height*x.pixelRatio);d=h.width,r=h.height;var n=x.canvasParent.getBoundingClientRect().top-x.video.getBoundingClientRect().top;e=l.y-n,a=l.x}if(!d||!r){x.video||console.error("width or height is 0. You should specify width & height for resize.");return}(x.canvas.width!=d||x.canvas.height!=r||x.canvas.style.top!=e||x.canvas.style.left!=a)&&(x.canvas.width=d,x.canvas.height=r,l!=null&&(x.canvasParent.style.position="relative",x.canvas.style.display="block",x.canvas.style.position="absolute",x.canvas.style.width=l.width+"px",x.canvas.style.height=l.height+"px",x.canvas.style.top=e+"px",x.canvas.style.left=a+"px",x.canvas.style.pointerEvents="none"),x.worker.postMessage({target:"canvas",width:x.canvas.width,height:x.canvas.height}))},x.resizeWithTimeout=function(){x.resize(),setTimeout(x.resize,100)},x.runBenchmark=function(){x.worker.postMessage({target:"runBenchmark"})},x.customMessage=function(d,r){r=r||{},x.worker.postMessage({target:"custom",userData:d,preMain:r.preMain})},x.setCurrentTime=function(d){x.worker.postMessage({target:"video",currentTime:d})},x.setTrackByUrl=function(d){x.worker.postMessage({target:"set-track-by-url",url:d})},x.setTrack=function(d){x.worker.postMessage({target:"set-track",content:d})},x.freeTrack=function(d){x.worker.postMessage({target:"free-track"})},x.render=x.setCurrentTime,x.setIsPaused=function(d,r){x.worker.postMessage({target:"video",isPaused:d,currentTime:r})},x.setRate=function(d){x.worker.postMessage({target:"video",rate:d})},x.dispose=function(){x.worker.postMessage({target:"destroy"}),x.worker.terminate(),x.worker.removeEventListener("message",x.onWorkerMessage),x.worker.removeEventListener("error",x.workerError),x.workerActive=!1,x.worker=null,x.video&&(x.video.removeEventListener("timeupdate",R,!1),x.video.removeEventListener("playing",O,!1),x.video.removeEventListener("pause",b,!1),x.video.removeEventListener("seeking",C,!1),x.video.removeEventListener("seeked",I,!1),x.video.removeEventListener("ratechange",T,!1),x.video.removeEventListener("waiting",m,!1),x.video.removeEventListener("loadedmetadata",p,!1),document.removeEventListener("fullscreenchange",x.resizeWithTimeout,!1),document.removeEventListener("mozfullscreenchange",x.resizeWithTimeout,!1),document.removeEventListener("webkitfullscreenchange",x.resizeWithTimeout,!1),document.removeEventListener("msfullscreenchange",x.resizeWithTimeout,!1),window.removeEventListener("resize",x.resizeWithTimeout,!1),x.video.parentNode.removeChild(x.canvasParent),x.video=null),x.ro&&(x.ro.disconnect(),x.ro=null),x.onCustomMessage=null,x.onErrorEvent=null,x.onReadyEvent=null},x.fetchFromWorker=function(d,r,e){try{var a=d.target,l=setTimeout(function(){n(Error("Error: Timeout while try to fetch "+a))},5e3),h=function(t){t.data.target==a&&(r(t.data),x.worker.removeEventListener("message",h),x.worker.removeEventListener("error",n),clearTimeout(l))},n=function(t){e(t),x.worker.removeEventListener("message",h),x.worker.removeEventListener("error",n),clearTimeout(l)};x.worker.addEventListener("message",h),x.worker.addEventListener("error",n),x.worker.postMessage(d)}catch(t){e(t)}},x.createEvent=function(d){x.worker.postMessage({target:"create-event",event:d})},x.getEvents=function(d,r){x.fetchFromWorker({target:"get-events"},function(e){d(e.events)},r)},x.setEvent=function(d,r){x.worker.postMessage({target:"set-event",event:d,index:r})},x.removeEvent=function(d){x.worker.postMessage({target:"remove-event",index:d})},x.createStyle=function(d){x.worker.postMessage({target:"create-style",style:d})},x.getStyles=function(d,r){x.fetchFromWorker({target:"get-styles"},function(e){d(e.styles)},r)},x.setStyle=function(d,r){x.worker.postMessage({target:"set-style",style:d,index:r})},x.removeStyle=function(d){x.worker.postMessage({target:"remove-style",index:d})},x.init()};typeof SubtitlesOctopusOnLoad=="function"&&SubtitlesOctopusOnLoad(),ie.exports&&(ie.exports=K)})(Ge);const Qe=Ge.exports,Je= window.__dynamic_base__+"/assets/subtitles-octopus-worker.f95f2186.js",qe= window.__dynamic_base__+"/assets/subtitles-octopus-worker.62892886.wasm",et= window.__dynamic_base__+"/assets/TimesNewRoman.d9fb32eb.ttf",tt= window.__dynamic_base__+"/assets/SourceHanSansCN-Bold.b5627435.woff2";let xe=null;function rt(ie){return/^https?:\/\//.test(ie)}function be(ie){return rt(ie)?ie:new URL(ie,document.baseURI).toString()}function it({workerUrl:ie,wasmUrl:de}){return new Promise(K=>{fetch(ie).then(M=>M.text()).then(M=>{let L=M;L=L.replace(/wasmBinaryFile\s*=\s*"(subtitles-octopus-worker\.wasm)"/g,(R,O)=>(de?de=be(de):de=new URL(O,be(ie)).toString(),`wasmBinaryFile = "${de}"`));const x=new Blob([L],{type:"text/javascript"});K(URL.createObjectURL(x))})})}function ke(ie){xe.canvasParent&&(xe.canvasParent.style.display=ie?"block":"none")}function ot(ie){return async de=>(xe=new Qe({availableFonts:{"times new roman":be(et)},workerUrl:await it({workerUrl:Je,wasmUrl:qe}),fallbackFont:be(tt),video:de.template.$video,...ie}),xe.canvasParent.className="artplayer-plugin-ass",xe.canvasParent.style.cssText=`
      position: absolute;
      width: 100%;
      height: 100%;
      user-select: none;
      pointer-events: none;
      z-index: 20;
    `,de.on("artplayer-plugin-ass:switch",K=>{xe.freeTrack(),xe.setTrackByUrl(K),ke(!0)}),de.on("subtitle",K=>ke(K)),de.on("artplayer-plugin-ass:visible",K=>ke(K)),de.on("subtitleOffset",K=>xe.timeOffset=K),de.on("destroy",()=>xe.dispose()),{name:"artplayerPluginAss",instance:xe})}var je={exports:{}};(function(ie,de){typeof window<"u"&&function(M,L){ie.exports=L()}(Be,function(){return function(K){var M={};function L(x){if(M[x])return M[x].exports;var R=M[x]={i:x,l:!1,exports:{}};return K[x].call(R.exports,R,R.exports,L),R.l=!0,R.exports}return L.m=K,L.c=M,L.d=function(x,R,O){L.o(x,R)||Object.defineProperty(x,R,{enumerable:!0,get:O})},L.r=function(x){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(x,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(x,"__esModule",{value:!0})},L.t=function(x,R){if(R&1&&(x=L(x)),R&8||R&4&&typeof x=="object"&&x&&x.__esModule)return x;var O=Object.create(null);if(L.r(O),Object.defineProperty(O,"default",{enumerable:!0,value:x}),R&2&&typeof x!="string")for(var b in x)L.d(O,b,function(C){return x[C]}.bind(null,b));return O},L.n=function(x){var R=x&&x.__esModule?function(){return x.default}:function(){return x};return L.d(R,"a",R),R},L.o=function(x,R){return Object.prototype.hasOwnProperty.call(x,R)},L.p="/dist/",L(L.s="./src/hls.ts")}({"./node_modules/eventemitter3/index.js":function(K,M,L){var x=Object.prototype.hasOwnProperty,R="~";function O(){}Object.create&&(O.prototype=Object.create(null),new O().__proto__||(R=!1));function b(m,p,g){this.fn=m,this.context=p,this.once=g||!1}function C(m,p,g,D,E){if(typeof g!="function")throw new TypeError("The listener must be a function");var d=new b(g,D||m,E),r=R?R+p:p;return m._events[r]?m._events[r].fn?m._events[r]=[m._events[r],d]:m._events[r].push(d):(m._events[r]=d,m._eventsCount++),m}function I(m,p){--m._eventsCount===0?m._events=new O:delete m._events[p]}function T(){this._events=new O,this._eventsCount=0}T.prototype.eventNames=function(){var p=[],g,D;if(this._eventsCount===0)return p;for(D in g=this._events)x.call(g,D)&&p.push(R?D.slice(1):D);return Object.getOwnPropertySymbols?p.concat(Object.getOwnPropertySymbols(g)):p},T.prototype.listeners=function(p){var g=R?R+p:p,D=this._events[g];if(!D)return[];if(D.fn)return[D.fn];for(var E=0,d=D.length,r=new Array(d);E<d;E++)r[E]=D[E].fn;return r},T.prototype.listenerCount=function(p){var g=R?R+p:p,D=this._events[g];return D?D.fn?1:D.length:0},T.prototype.emit=function(p,g,D,E,d,r){var e=R?R+p:p;if(!this._events[e])return!1;var a=this._events[e],l=arguments.length,h,n;if(a.fn){switch(a.once&&this.removeListener(p,a.fn,void 0,!0),l){case 1:return a.fn.call(a.context),!0;case 2:return a.fn.call(a.context,g),!0;case 3:return a.fn.call(a.context,g,D),!0;case 4:return a.fn.call(a.context,g,D,E),!0;case 5:return a.fn.call(a.context,g,D,E,d),!0;case 6:return a.fn.call(a.context,g,D,E,d,r),!0}for(n=1,h=new Array(l-1);n<l;n++)h[n-1]=arguments[n];a.fn.apply(a.context,h)}else{var t=a.length,i;for(n=0;n<t;n++)switch(a[n].once&&this.removeListener(p,a[n].fn,void 0,!0),l){case 1:a[n].fn.call(a[n].context);break;case 2:a[n].fn.call(a[n].context,g);break;case 3:a[n].fn.call(a[n].context,g,D);break;case 4:a[n].fn.call(a[n].context,g,D,E);break;default:if(!h)for(i=1,h=new Array(l-1);i<l;i++)h[i-1]=arguments[i];a[n].fn.apply(a[n].context,h)}}return!0},T.prototype.on=function(p,g,D){return C(this,p,g,D,!1)},T.prototype.once=function(p,g,D){return C(this,p,g,D,!0)},T.prototype.removeListener=function(p,g,D,E){var d=R?R+p:p;if(!this._events[d])return this;if(!g)return I(this,d),this;var r=this._events[d];if(r.fn)r.fn===g&&(!E||r.once)&&(!D||r.context===D)&&I(this,d);else{for(var e=0,a=[],l=r.length;e<l;e++)(r[e].fn!==g||E&&!r[e].once||D&&r[e].context!==D)&&a.push(r[e]);a.length?this._events[d]=a.length===1?a[0]:a:I(this,d)}return this},T.prototype.removeAllListeners=function(p){var g;return p?(g=R?R+p:p,this._events[g]&&I(this,g)):(this._events=new O,this._eventsCount=0),this},T.prototype.off=T.prototype.removeListener,T.prototype.addListener=T.prototype.on,T.prefixed=R,T.EventEmitter=T,K.exports=T},"./node_modules/url-toolkit/src/url-toolkit.js":function(K,M,L){(function(x){var R=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,O=/^(?=([^\/?#]*))\1([^]*)$/,b=/(?:\/|^)\.(?=\/)/g,C=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,I={buildAbsoluteURL:function(T,m,p){if(p=p||{},T=T.trim(),m=m.trim(),!m){if(!p.alwaysNormalize)return T;var g=I.parseURL(T);if(!g)throw new Error("Error trying to parse base URL.");return g.path=I.normalizePath(g.path),I.buildURLFromParts(g)}var D=I.parseURL(m);if(!D)throw new Error("Error trying to parse relative URL.");if(D.scheme)return p.alwaysNormalize?(D.path=I.normalizePath(D.path),I.buildURLFromParts(D)):m;var E=I.parseURL(T);if(!E)throw new Error("Error trying to parse base URL.");if(!E.netLoc&&E.path&&E.path[0]!=="/"){var d=O.exec(E.path);E.netLoc=d[1],E.path=d[2]}E.netLoc&&!E.path&&(E.path="/");var r={scheme:E.scheme,netLoc:D.netLoc,path:null,params:D.params,query:D.query,fragment:D.fragment};if(!D.netLoc&&(r.netLoc=E.netLoc,D.path[0]!=="/"))if(!D.path)r.path=E.path,D.params||(r.params=E.params,D.query||(r.query=E.query));else{var e=E.path,a=e.substring(0,e.lastIndexOf("/")+1)+D.path;r.path=I.normalizePath(a)}return r.path===null&&(r.path=p.alwaysNormalize?I.normalizePath(D.path):D.path),I.buildURLFromParts(r)},parseURL:function(T){var m=R.exec(T);return m?{scheme:m[1]||"",netLoc:m[2]||"",path:m[3]||"",params:m[4]||"",query:m[5]||"",fragment:m[6]||""}:null},normalizePath:function(T){for(T=T.split("").reverse().join("").replace(b,"");T.length!==(T=T.replace(C,"")).length;);return T.split("").reverse().join("")},buildURLFromParts:function(T){return T.scheme+T.netLoc+T.path+T.params+T.query+T.fragment}};K.exports=I})()},"./node_modules/webworkify-webpack/index.js":function(K,M,L){function x(p){var g={};function D(d){if(g[d])return g[d].exports;var r=g[d]={i:d,l:!1,exports:{}};return p[d].call(r.exports,r,r.exports,D),r.l=!0,r.exports}D.m=p,D.c=g,D.i=function(d){return d},D.d=function(d,r,e){D.o(d,r)||Object.defineProperty(d,r,{configurable:!1,enumerable:!0,get:e})},D.r=function(d){Object.defineProperty(d,"__esModule",{value:!0})},D.n=function(d){var r=d&&d.__esModule?function(){return d.default}:function(){return d};return D.d(r,"a",r),r},D.o=function(d,r){return Object.prototype.hasOwnProperty.call(d,r)},D.p="/",D.oe=function(d){throw console.error(d),d};var E=D(D.s=ENTRY_MODULE);return E.default||E}var R="[\\.|\\-|\\+|\\w|/|@]+",O="\\(\\s*(/\\*.*?\\*/)?\\s*.*?("+R+").*?\\)";function b(p){return(p+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function C(p){return!isNaN(1*p)}function I(p,g,D){var E={};E[D]=[];var d=g.toString(),r=d.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!r)return E;for(var e=r[1],a=new RegExp("(\\\\n|\\W)"+b(e)+O,"g"),l;l=a.exec(d);)l[3]!=="dll-reference"&&E[D].push(l[3]);for(a=new RegExp("\\("+b(e)+'\\("(dll-reference\\s('+R+'))"\\)\\)'+O,"g");l=a.exec(d);)p[l[2]]||(E[D].push(l[1]),p[l[2]]=L(l[1]).m),E[l[2]]=E[l[2]]||[],E[l[2]].push(l[4]);for(var h=Object.keys(E),n=0;n<h.length;n++)for(var t=0;t<E[h[n]].length;t++)C(E[h[n]][t])&&(E[h[n]][t]=1*E[h[n]][t]);return E}function T(p){var g=Object.keys(p);return g.reduce(function(D,E){return D||p[E].length>0},!1)}function m(p,g){for(var D={main:[g]},E={main:[]},d={main:{}};T(D);)for(var r=Object.keys(D),e=0;e<r.length;e++){var a=r[e],l=D[a],h=l.pop();if(d[a]=d[a]||{},!(d[a][h]||!p[a][h])){d[a][h]=!0,E[a]=E[a]||[],E[a].push(h);for(var n=I(p,p[a][h],a),t=Object.keys(n),i=0;i<t.length;i++)D[t[i]]=D[t[i]]||[],D[t[i]]=D[t[i]].concat(n[t[i]])}}return E}K.exports=function(p,g){g=g||{};var D={main:L.m},E=g.all?{main:Object.keys(D.main)}:m(D,p),d="";Object.keys(E).filter(function(h){return h!=="main"}).forEach(function(h){for(var n=0;E[h][n];)n++;E[h].push(n),D[h][n]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",d=d+"var "+h+" = ("+x.toString().replace("ENTRY_MODULE",JSON.stringify(n))+")({"+E[h].map(function(t){return""+JSON.stringify(t)+": "+D[h][t].toString()}).join(",")+`});
`}),d=d+"new (("+x.toString().replace("ENTRY_MODULE",JSON.stringify(p))+")({"+E.main.map(function(h){return""+JSON.stringify(h)+": "+D.main[h].toString()}).join(",")+"}))(self);";var r=new window.Blob([d],{type:"text/javascript"});if(g.bare)return r;var e=window.URL||window.webkitURL||window.mozURL||window.msURL,a=e.createObjectURL(r),l=new window.Worker(a);return l.objectURL=a,l}},"./src/config.ts":function(K,M,L){L.r(M),L.d(M,"hlsDefaultConfig",function(){return i}),L.d(M,"mergeConfig",function(){return u}),L.d(M,"enableStreamingMode",function(){return f});var x=L("./src/controller/abr-controller.ts"),R=L("./src/controller/audio-stream-controller.ts"),O=L("./src/controller/audio-track-controller.ts"),b=L("./src/controller/subtitle-stream-controller.ts"),C=L("./src/controller/subtitle-track-controller.ts"),I=L("./src/controller/buffer-controller.ts"),T=L("./src/controller/timeline-controller.ts"),m=L("./src/controller/cap-level-controller.ts"),p=L("./src/controller/fps-controller.ts"),g=L("./src/controller/eme-controller.ts"),D=L("./src/controller/cmcd-controller.ts"),E=L("./src/utils/xhr-loader.ts"),d=L("./src/utils/fetch-loader.ts"),r=L("./src/utils/cues.ts"),e=L("./src/utils/mediakeys-helper.ts"),a=L("./src/utils/logger.ts");function l(){return l=Object.assign?Object.assign.bind():function(c){for(var s=1;s<arguments.length;s++){var o=arguments[s];for(var v in o)Object.prototype.hasOwnProperty.call(o,v)&&(c[v]=o[v])}return c},l.apply(this,arguments)}function h(c,s){var o=Object.keys(c);if(Object.getOwnPropertySymbols){var v=Object.getOwnPropertySymbols(c);s&&(v=v.filter(function(S){return Object.getOwnPropertyDescriptor(c,S).enumerable})),o.push.apply(o,v)}return o}function n(c){for(var s=1;s<arguments.length;s++){var o=arguments[s]!=null?arguments[s]:{};s%2?h(Object(o),!0).forEach(function(v){t(c,v,o[v])}):Object.getOwnPropertyDescriptors?Object.defineProperties(c,Object.getOwnPropertyDescriptors(o)):h(Object(o)).forEach(function(v){Object.defineProperty(c,v,Object.getOwnPropertyDescriptor(o,v))})}return c}function t(c,s,o){return s in c?Object.defineProperty(c,s,{value:o,enumerable:!0,configurable:!0,writable:!0}):c[s]=o,c}var i=n(n({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,maxBufferSize:60*1e3*1e3,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:E.default,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:x.default,bufferController:I.default,capLevelController:m.default,fpsController:p.default,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystemOptions:{},requestMediaKeySystemAccessFunc:e.requestMediaKeySystemAccess,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableID3MetadataCues:!0},y()),{},{subtitleStreamController:b.SubtitleStreamController,subtitleTrackController:C.default,timelineController:T.TimelineController,audioStreamController:R.default,audioTrackController:O.default,emeController:g.default,cmcdController:D.default});function y(){return{cueHandler:r.default,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function u(c,s){if((s.liveSyncDurationCount||s.liveMaxLatencyDurationCount)&&(s.liveSyncDuration||s.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(s.liveMaxLatencyDurationCount!==void 0&&(s.liveSyncDurationCount===void 0||s.liveMaxLatencyDurationCount<=s.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(s.liveMaxLatencyDuration!==void 0&&(s.liveSyncDuration===void 0||s.liveMaxLatencyDuration<=s.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');return l({},c,s)}function f(c){var s=c.loader;if(s!==d.default&&s!==E.default)a.logger.log("[config]: Custom loader detected, cannot enable progressive streaming"),c.progressive=!1;else{var o=Object(d.fetchSupported)();o&&(c.loader=d.default,c.progressive=!0,c.enableSoftwareAES=!0,a.logger.log("[config]: Progressive streaming enabled, using FetchLoader"))}}},"./src/controller/abr-controller.ts":function(K,M,L){L.r(M);var x=L("./src/polyfills/number.ts"),R=L("./src/utils/ewma-bandwidth-estimator.ts"),O=L("./src/events.ts"),b=L("./src/utils/buffer-helper.ts"),C=L("./src/errors.ts"),I=L("./src/types/loader.ts"),T=L("./src/utils/logger.ts");function m(D,E){for(var d=0;d<E.length;d++){var r=E[d];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(D,r.key,r)}}function p(D,E,d){return E&&m(D.prototype,E),d&&m(D,d),Object.defineProperty(D,"prototype",{writable:!1}),D}var g=function(){function D(d){this.hls=void 0,this.lastLoadedFragLevel=0,this._nextAutoLevel=-1,this.timer=void 0,this.onCheck=this._abandonRulesCheck.bind(this),this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this.hls=d;var r=d.config;this.bwEstimator=new R.default(r.abrEwmaSlowVoD,r.abrEwmaFastVoD,r.abrEwmaDefaultEstimate),this.registerListeners()}var E=D.prototype;return E.registerListeners=function(){var r=this.hls;r.on(O.Events.FRAG_LOADING,this.onFragLoading,this),r.on(O.Events.FRAG_LOADED,this.onFragLoaded,this),r.on(O.Events.FRAG_BUFFERED,this.onFragBuffered,this),r.on(O.Events.LEVEL_LOADED,this.onLevelLoaded,this),r.on(O.Events.ERROR,this.onError,this)},E.unregisterListeners=function(){var r=this.hls;r.off(O.Events.FRAG_LOADING,this.onFragLoading,this),r.off(O.Events.FRAG_LOADED,this.onFragLoaded,this),r.off(O.Events.FRAG_BUFFERED,this.onFragBuffered,this),r.off(O.Events.LEVEL_LOADED,this.onLevelLoaded,this),r.off(O.Events.ERROR,this.onError,this)},E.destroy=function(){this.unregisterListeners(),this.clearTimer(),this.hls=this.onCheck=null,this.fragCurrent=this.partCurrent=null},E.onFragLoading=function(r,e){var a=e.frag;if(a.type===I.PlaylistLevelType.MAIN&&!this.timer){var l;this.fragCurrent=a,this.partCurrent=(l=e.part)!=null?l:null,this.timer=self.setInterval(this.onCheck,100)}},E.onLevelLoaded=function(r,e){var a=this.hls.config;e.details.live?this.bwEstimator.update(a.abrEwmaSlowLive,a.abrEwmaFastLive):this.bwEstimator.update(a.abrEwmaSlowVoD,a.abrEwmaFastVoD)},E._abandonRulesCheck=function(){var r=this.fragCurrent,e=this.partCurrent,a=this.hls,l=a.autoLevelEnabled,h=a.config,n=a.media;if(!(!r||!n)){var t=e?e.stats:r.stats,i=e?e.duration:r.duration;if(t.aborted){T.logger.warn("frag loader destroy or aborted, disarm abandonRules"),this.clearTimer(),this._nextAutoLevel=-1;return}if(!(!l||n.paused||!n.playbackRate||!n.readyState)){var y=performance.now()-t.loading.start,u=Math.abs(n.playbackRate);if(!(y<=500*i/u)){var f=a.levels,c=a.minAutoLevel,s=f[r.level],o=t.total||Math.max(t.loaded,Math.round(i*s.maxBitrate/8)),v=Math.max(1,t.bwEstimate?t.bwEstimate/8:t.loaded*1e3/y),S=(o-t.loaded)/v,A=n.currentTime,P=(b.BufferHelper.bufferInfo(n,A,h.maxBufferHole).end-A)/u;if(!(P>=2*i/u||S<=P)){var _=Number.POSITIVE_INFINITY,F;for(F=r.level-1;F>c;F--){var k=f[F].maxBitrate;if(_=i*k/(8*.8*v),_<P)break}if(!(_>=S)){var B=this.bwEstimator.getEstimate();T.logger.warn("Fragment "+r.sn+(e?" part "+e.index:"")+" of level "+r.level+" is loading too slowly and will cause an underbuffer; aborting and switching to level "+F+`
      Current BW estimate: `+(Object(x.isFiniteNumber)(B)?(B/1024).toFixed(3):"Unknown")+` Kb/s
      Estimated load time for current fragment: `+S.toFixed(3)+` s
      Estimated load time for the next fragment: `+_.toFixed(3)+` s
      Time to underbuffer: `+P.toFixed(3)+" s"),a.nextLoadLevel=F,this.bwEstimator.sample(y,t.loaded),this.clearTimer(),r.loader&&(this.fragCurrent=this.partCurrent=null,r.loader.abort()),a.trigger(O.Events.FRAG_LOAD_EMERGENCY_ABORTED,{frag:r,part:e,stats:t})}}}}}},E.onFragLoaded=function(r,e){var a=e.frag,l=e.part;if(a.type===I.PlaylistLevelType.MAIN&&Object(x.isFiniteNumber)(a.sn)){var h=l?l.stats:a.stats,n=l?l.duration:a.duration;if(this.clearTimer(),this.lastLoadedFragLevel=a.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var t=this.hls.levels[a.level],i=(t.loaded?t.loaded.bytes:0)+h.loaded,y=(t.loaded?t.loaded.duration:0)+n;t.loaded={bytes:i,duration:y},t.realBitrate=Math.round(8*i/y)}if(a.bitrateTest){var u={stats:h,frag:a,part:l,id:a.type};this.onFragBuffered(O.Events.FRAG_BUFFERED,u),a.bitrateTest=!1}}},E.onFragBuffered=function(r,e){var a=e.frag,l=e.part,h=l?l.stats:a.stats;if(!h.aborted&&!(a.type!==I.PlaylistLevelType.MAIN||a.sn==="initSegment")){var n=h.parsing.end-h.loading.start;this.bwEstimator.sample(n,h.loaded),h.bwEstimate=this.bwEstimator.getEstimate(),a.bitrateTest?this.bitrateTestDelay=n/1e3:this.bitrateTestDelay=0}},E.onError=function(r,e){switch(e.details){case C.ErrorDetails.FRAG_LOAD_ERROR:case C.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer();break}},E.clearTimer=function(){self.clearInterval(this.timer),this.timer=void 0},E.getNextABRAutoLevel=function(){var r=this.fragCurrent,e=this.partCurrent,a=this.hls,l=a.maxAutoLevel,h=a.config,n=a.minAutoLevel,t=a.media,i=e?e.duration:r?r.duration:0,y=t?t.currentTime:0,u=t&&t.playbackRate!==0?Math.abs(t.playbackRate):1,f=this.bwEstimator?this.bwEstimator.getEstimate():h.abrEwmaDefaultEstimate,c=(b.BufferHelper.bufferInfo(t,y,h.maxBufferHole).end-y)/u,s=this.findBestLevel(f,n,l,c,h.abrBandWidthFactor,h.abrBandWidthUpFactor);if(s>=0)return s;T.logger.trace((c?"rebuffering expected":"buffer is empty")+", finding optimal quality level");var o=i?Math.min(i,h.maxStarvationDelay):h.maxStarvationDelay,v=h.abrBandWidthFactor,S=h.abrBandWidthUpFactor;if(!c){var A=this.bitrateTestDelay;if(A){var P=i?Math.min(i,h.maxLoadingDelay):h.maxLoadingDelay;o=P-A,T.logger.trace("bitrate test took "+Math.round(1e3*A)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*o)+" ms"),v=S=1}}return s=this.findBestLevel(f,n,l,c+o,v,S),Math.max(s,0)},E.findBestLevel=function(r,e,a,l,h,n){for(var t,i=this.fragCurrent,y=this.partCurrent,u=this.lastLoadedFragLevel,f=this.hls.levels,c=f[u],s=!!(c!=null&&(t=c.details)!==null&&t!==void 0&&t.live),o=c==null?void 0:c.codecSet,v=y?y.duration:i?i.duration:0,S=a;S>=e;S--){var A=f[S];if(!(!A||o&&A.codecSet!==o)){var P=A.details,_=(y?P==null?void 0:P.partTarget:P==null?void 0:P.averagetargetduration)||v,F=void 0;S<=u?F=h*r:F=n*r;var k=f[S].maxBitrate,B=k*_/F;if(T.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+S+"/"+Math.round(F)+"/"+k+"/"+_+"/"+l+"/"+B),F>k&&(!B||s&&!this.bitrateTestDelay||B<l))return S}}return-1},p(D,[{key:"nextAutoLevel",get:function(){var r=this._nextAutoLevel,e=this.bwEstimator;if(r!==-1&&(!e||!e.canEstimate()))return r;var a=this.getNextABRAutoLevel();return r!==-1&&(a=Math.min(r,a)),a},set:function(r){this._nextAutoLevel=r}}]),D}();M.default=g},"./src/controller/audio-stream-controller.ts":function(K,M,L){L.r(M);var x=L("./src/polyfills/number.ts"),R=L("./src/controller/base-stream-controller.ts"),O=L("./src/events.ts"),b=L("./src/utils/buffer-helper.ts"),C=L("./src/controller/fragment-tracker.ts"),I=L("./src/types/level.ts"),T=L("./src/types/loader.ts"),m=L("./src/loader/fragment.ts"),p=L("./src/demux/chunk-cache.ts"),g=L("./src/demux/transmuxer-interface.ts"),D=L("./src/types/transmuxer.ts"),E=L("./src/controller/fragment-finders.ts"),d=L("./src/utils/discontinuities.ts"),r=L("./src/errors.ts");function e(){return e=Object.assign?Object.assign.bind():function(t){for(var i=1;i<arguments.length;i++){var y=arguments[i];for(var u in y)Object.prototype.hasOwnProperty.call(y,u)&&(t[u]=y[u])}return t},e.apply(this,arguments)}function a(t,i){t.prototype=Object.create(i.prototype),t.prototype.constructor=t,l(t,i)}function l(t,i){return l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(u,f){return u.__proto__=f,u},l(t,i)}var h=100,n=function(t){a(i,t);function i(u,f){var c;return c=t.call(this,u,f,"[audio-stream-controller]")||this,c.videoBuffer=null,c.videoTrackCC=-1,c.waitingVideoCC=-1,c.audioSwitch=!1,c.trackId=-1,c.waitingData=null,c.mainDetails=null,c.bufferFlushed=!1,c.cachedTrackLoadedData=null,c._registerListeners(),c}var y=i.prototype;return y.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},y._registerListeners=function(){var f=this.hls;f.on(O.Events.MEDIA_ATTACHED,this.onMediaAttached,this),f.on(O.Events.MEDIA_DETACHING,this.onMediaDetaching,this),f.on(O.Events.MANIFEST_LOADING,this.onManifestLoading,this),f.on(O.Events.LEVEL_LOADED,this.onLevelLoaded,this),f.on(O.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),f.on(O.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),f.on(O.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),f.on(O.Events.ERROR,this.onError,this),f.on(O.Events.BUFFER_RESET,this.onBufferReset,this),f.on(O.Events.BUFFER_CREATED,this.onBufferCreated,this),f.on(O.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),f.on(O.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),f.on(O.Events.FRAG_BUFFERED,this.onFragBuffered,this)},y._unregisterListeners=function(){var f=this.hls;f.off(O.Events.MEDIA_ATTACHED,this.onMediaAttached,this),f.off(O.Events.MEDIA_DETACHING,this.onMediaDetaching,this),f.off(O.Events.MANIFEST_LOADING,this.onManifestLoading,this),f.off(O.Events.LEVEL_LOADED,this.onLevelLoaded,this),f.off(O.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),f.off(O.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),f.off(O.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),f.off(O.Events.ERROR,this.onError,this),f.off(O.Events.BUFFER_RESET,this.onBufferReset,this),f.off(O.Events.BUFFER_CREATED,this.onBufferCreated,this),f.off(O.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),f.off(O.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),f.off(O.Events.FRAG_BUFFERED,this.onFragBuffered,this)},y.onInitPtsFound=function(f,c){var s=c.frag,o=c.id,v=c.initPTS;if(o==="main"){var S=s.cc;this.initPTS[s.cc]=v,this.log("InitPTS for cc: "+S+" found from main: "+v),this.videoTrackCC=S,this.state===R.State.WAITING_INIT_PTS&&this.tick()}},y.startLoad=function(f){if(!this.levels){this.startPosition=f,this.state=R.State.STOPPED;return}var c=this.lastCurrentTime;this.stopLoad(),this.setInterval(h),this.fragLoadError=0,c>0&&f===-1?(this.log("Override startPosition with lastCurrentTime @"+c.toFixed(3)),f=c,this.state=R.State.IDLE):(this.loadedmetadata=!1,this.state=R.State.WAITING_TRACK),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=f,this.tick()},y.doTick=function(){switch(this.state){case R.State.IDLE:this.doTickIdle();break;case R.State.WAITING_TRACK:{var f,c=this.levels,s=this.trackId,o=c==null||(f=c[s])===null||f===void 0?void 0:f.details;if(o){if(this.waitForCdnTuneIn(o))break;this.state=R.State.WAITING_INIT_PTS}break}case R.State.FRAG_LOADING_WAITING_RETRY:{var v,S=performance.now(),A=this.retryDate;(!A||S>=A||(v=this.media)!==null&&v!==void 0&&v.seeking)&&(this.log("RetryDate reached, switch back to IDLE state"),this.state=R.State.IDLE);break}case R.State.WAITING_INIT_PTS:{var P=this.waitingData;if(P){var _=P.frag,F=P.part,k=P.cache,B=P.complete;if(this.initPTS[_.cc]!==void 0){this.waitingData=null,this.waitingVideoCC=-1,this.state=R.State.FRAG_LOADING;var w=k.flush(),U={frag:_,part:F,payload:w,networkDetails:null};this._handleFragmentLoadProgress(U),B&&t.prototype._handleFragmentLoadComplete.call(this,U)}else if(this.videoTrackCC!==this.waitingVideoCC)this.log("Waiting fragment cc ("+_.cc+") cancelled because video is at cc "+this.videoTrackCC),this.clearWaitingFragment();else{var N=this.getLoadPosition(),W=b.BufferHelper.bufferInfo(this.mediaBuffer,N,this.config.maxBufferHole),j=Object(E.fragmentWithinToleranceTest)(W.end,this.config.maxFragLookUpTolerance,_);j<0&&(this.log("Waiting fragment cc ("+_.cc+") @ "+_.start+" cancelled because another fragment at "+W.end+" is needed"),this.clearWaitingFragment())}}else this.state=R.State.IDLE}}this.onTickEnd()},y.clearWaitingFragment=function(){var f=this.waitingData;f&&(this.fragmentTracker.removeFragment(f.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=R.State.IDLE)},y.resetLoadingState=function(){this.clearWaitingFragment(),t.prototype.resetLoadingState.call(this)},y.onTickEnd=function(){var f=this.media;if(!(!f||!f.readyState)){var c=this.mediaBuffer?this.mediaBuffer:f,s=c.buffered;!this.loadedmetadata&&s.length&&(this.loadedmetadata=!0),this.lastCurrentTime=f.currentTime}},y.doTickIdle=function(){var f,c,s=this.hls,o=this.levels,v=this.media,S=this.trackId,A=s.config;if(!(!o||!o[S])&&!(!v&&(this.startFragRequested||!A.startFragPrefetch))){var P=o[S],_=P.details;if(!_||_.live&&this.levelLastLoaded!==S||this.waitForCdnTuneIn(_)){this.state=R.State.WAITING_TRACK;return}this.bufferFlushed&&(this.bufferFlushed=!1,this.afterBufferFlushed(this.mediaBuffer?this.mediaBuffer:this.media,m.ElementaryStreamTypes.AUDIO,T.PlaylistLevelType.AUDIO));var F=this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,T.PlaylistLevelType.AUDIO);if(F!==null){var k=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,T.PlaylistLevelType.MAIN),B=F.len,w=this.getMaxBufferLength(k==null?void 0:k.len),U=this.audioSwitch;if(!(B>=w&&!U)){if(!U&&this._streamEnded(F,_)){s.trigger(O.Events.BUFFER_EOS,{type:"audio"}),this.state=R.State.ENDED;return}var N=_.fragments,W=N[0].start,j=F.end;if(U){var H=this.getLoadPosition();j=H,_.PTSKnown&&H<W&&(F.end>W||F.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),v.currentTime=W+.05)}if(!(k&&j>k.end+_.targetduration)&&!((!k||!k.len)&&F.len)){var G=this.getNextFragment(j,_);if(!G){this.bufferFlushed=!0;return}((f=G.decryptdata)===null||f===void 0?void 0:f.keyFormat)==="identity"&&!((c=G.decryptdata)!==null&&c!==void 0&&c.key)?this.loadKey(G,_):this.loadFragment(G,_,j)}}}}},y.getMaxBufferLength=function(f){var c=t.prototype.getMaxBufferLength.call(this);return f?Math.max(c,f):c},y.onMediaDetaching=function(){this.videoBuffer=null,t.prototype.onMediaDetaching.call(this)},y.onAudioTracksUpdated=function(f,c){var s=c.audioTracks;this.resetTransmuxer(),this.levels=s.map(function(o){return new I.Level(o)})},y.onAudioTrackSwitching=function(f,c){var s=!!c.url;this.trackId=c.id;var o=this.fragCurrent;o!=null&&o.loader&&o.loader.abort(),this.fragCurrent=null,this.clearWaitingFragment(),s?this.setInterval(h):this.resetTransmuxer(),s?(this.audioSwitch=!0,this.state=R.State.IDLE):this.state=R.State.STOPPED,this.tick()},y.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=!1},y.onLevelLoaded=function(f,c){this.mainDetails=c.details,this.cachedTrackLoadedData!==null&&(this.hls.trigger(O.Events.AUDIO_TRACK_LOADED,this.cachedTrackLoadedData),this.cachedTrackLoadedData=null)},y.onAudioTrackLoaded=function(f,c){var s;if(this.mainDetails==null){this.cachedTrackLoadedData=c;return}var o=this.levels,v=c.details,S=c.id;if(!o){this.warn("Audio tracks were reset while loading level "+S);return}this.log("Track "+S+" loaded ["+v.startSN+","+v.endSN+"],duration:"+v.totalduration);var A=o[S],P=0;if(v.live||(s=A.details)!==null&&s!==void 0&&s.live){var _=this.mainDetails;if(v.fragments[0]||(v.deltaUpdateFailed=!0),v.deltaUpdateFailed||!_)return;!A.details&&v.hasProgramDateTime&&_.hasProgramDateTime?(Object(d.alignMediaPlaylistByPDT)(v,_),P=v.fragments[0].start):P=this.alignPlaylists(v,A.details)}A.details=v,this.levelLastLoaded=S,!this.startFragRequested&&(this.mainDetails||!v.live)&&this.setStartPosition(A.details,P),this.state===R.State.WAITING_TRACK&&!this.waitForCdnTuneIn(v)&&(this.state=R.State.IDLE),this.tick()},y._handleFragmentLoadProgress=function(f){var c,s=f.frag,o=f.part,v=f.payload,S=this.config,A=this.trackId,P=this.levels;if(!P){this.warn("Audio tracks were reset while fragment load was in progress. Fragment "+s.sn+" of level "+s.level+" will not be buffered");return}var _=P[A];console.assert(_,"Audio track is defined on fragment load progress");var F=_.details;console.assert(F,"Audio track details are defined on fragment load progress");var k=S.defaultAudioCodec||_.audioCodec||"mp4a.40.2",B=this.transmuxer;B||(B=this.transmuxer=new g.default(this.hls,T.PlaylistLevelType.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));var w=this.initPTS[s.cc],U=(c=s.initSegment)===null||c===void 0?void 0:c.data;if(w!==void 0){var N=!1,W=o?o.index:-1,j=W!==-1,H=new D.ChunkMetadata(s.level,s.sn,s.stats.chunkCount,v.byteLength,W,j);B.push(v,U,k,"",s,o,F.totalduration,N,H,w)}else{this.log("Unknown video PTS for cc "+s.cc+", waiting for video PTS before demuxing audio frag "+s.sn+" of ["+F.startSN+" ,"+F.endSN+"],track "+A);var G=this.waitingData=this.waitingData||{frag:s,part:o,cache:new p.default,complete:!1},z=G.cache;z.push(new Uint8Array(v)),this.waitingVideoCC=this.videoTrackCC,this.state=R.State.WAITING_INIT_PTS}},y._handleFragmentLoadComplete=function(f){if(this.waitingData){this.waitingData.complete=!0;return}t.prototype._handleFragmentLoadComplete.call(this,f)},y.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},y.onBufferCreated=function(f,c){var s=c.tracks.audio;s&&(this.mediaBuffer=s.buffer),c.tracks.video&&(this.videoBuffer=c.tracks.video.buffer)},y.onFragBuffered=function(f,c){var s=c.frag,o=c.part;if(s.type===T.PlaylistLevelType.AUDIO){if(this.fragContextChanged(s)){this.warn("Fragment "+s.sn+(o?" p: "+o.index:"")+" of level "+s.level+" finished buffering, but was aborted. state: "+this.state+", audioSwitch: "+this.audioSwitch);return}s.sn!=="initSegment"&&(this.fragPrevious=s,this.audioSwitch&&(this.audioSwitch=!1,this.hls.trigger(O.Events.AUDIO_TRACK_SWITCHED,{id:this.trackId}))),this.fragBufferedComplete(s,o)}},y.onError=function(f,c){switch(c.details){case r.ErrorDetails.FRAG_LOAD_ERROR:case r.ErrorDetails.FRAG_LOAD_TIMEOUT:case r.ErrorDetails.KEY_LOAD_ERROR:case r.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(T.PlaylistLevelType.AUDIO,c);break;case r.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case r.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:this.state!==R.State.ERROR&&this.state!==R.State.STOPPED&&(this.state=c.fatal?R.State.ERROR:R.State.IDLE,this.warn(c.details+" while loading frag, switching to "+this.state+" state"));break;case r.ErrorDetails.BUFFER_FULL_ERROR:if(c.parent==="audio"&&(this.state===R.State.PARSING||this.state===R.State.PARSED)){var s=!0,o=this.getFwdBufferInfo(this.mediaBuffer,T.PlaylistLevelType.AUDIO);o&&o.len>.5&&(s=!this.reduceMaxBufferLength(o.len)),s&&(this.warn("Buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,t.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.resetLoadingState()}break}},y.onBufferFlushed=function(f,c){var s=c.type;s===m.ElementaryStreamTypes.AUDIO&&(this.bufferFlushed=!0)},y._handleTransmuxComplete=function(f){var c,s="audio",o=this.hls,v=f.remuxResult,S=f.chunkMeta,A=this.getCurrentContext(S);if(!A){this.warn("The loading context changed while buffering fragment "+S.sn+" of level "+S.level+". This chunk will not be buffered."),this.resetLiveStartWhenNotLoaded(S.level);return}var P=A.frag,_=A.part,F=A.level.details,k=v.audio,B=v.text,w=v.id3,U=v.initSegment;if(!(this.fragContextChanged(P)||!F)){if(this.state=R.State.PARSING,this.audioSwitch&&k&&this.completeAudioSwitch(),U!=null&&U.tracks&&(this._bufferInitSegment(U.tracks,P,S),o.trigger(O.Events.FRAG_PARSING_INIT_SEGMENT,{frag:P,id:s,tracks:U.tracks})),k){var N=k.startPTS,W=k.endPTS,j=k.startDTS,H=k.endDTS;_&&(_.elementaryStreams[m.ElementaryStreamTypes.AUDIO]={startPTS:N,endPTS:W,startDTS:j,endDTS:H}),P.setElementaryStreamInfo(m.ElementaryStreamTypes.AUDIO,N,W,j,H),this.bufferFragmentData(k,P,_,S)}if(w!=null&&(c=w.samples)!==null&&c!==void 0&&c.length){var G=e({id:s,frag:P,details:F},w);o.trigger(O.Events.FRAG_PARSING_METADATA,G)}if(B){var z=e({id:s,frag:P,details:F},B);o.trigger(O.Events.FRAG_PARSING_USERDATA,z)}}},y._bufferInitSegment=function(f,c,s){if(this.state===R.State.PARSING){f.video&&delete f.video;var o=f.audio;if(!!o){o.levelCodec=o.codec,o.id="audio",this.log("Init audio buffer, container:"+o.container+", codecs[parsed]=["+o.codec+"]"),this.hls.trigger(O.Events.BUFFER_CODECS,f);var v=o.initSegment;if(v!=null&&v.byteLength){var S={type:"audio",frag:c,part:null,chunkMeta:s,parent:c.type,data:v};this.hls.trigger(O.Events.BUFFER_APPENDING,S)}this.tick()}}},y.loadFragment=function(f,c,s){var o=this.fragmentTracker.getState(f);this.fragCurrent=f,(this.audioSwitch||o===C.FragmentState.NOT_LOADED||o===C.FragmentState.PARTIAL)&&(f.sn==="initSegment"?this._loadInitSegment(f):c.live&&!Object(x.isFiniteNumber)(this.initPTS[f.cc])?(this.log("Waiting for video PTS in continuity counter "+f.cc+" of live stream before loading audio fragment "+f.sn+" of level "+this.trackId),this.state=R.State.WAITING_INIT_PTS):(this.startFragRequested=!0,t.prototype.loadFragment.call(this,f,c,s)))},y.completeAudioSwitch=function(){var f=this.hls,c=this.media,s=this.trackId;c&&(this.log("Switching audio track : flushing all audio"),t.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.audioSwitch=!1,f.trigger(O.Events.AUDIO_TRACK_SWITCHED,{id:s})},i}(R.default);M.default=n},"./src/controller/audio-track-controller.ts":function(K,M,L){L.r(M);var x=L("./src/events.ts"),R=L("./src/errors.ts"),O=L("./src/controller/base-playlist-controller.ts"),b=L("./src/types/loader.ts");function C(g,D){for(var E=0;E<D.length;E++){var d=D[E];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(g,d.key,d)}}function I(g,D,E){return D&&C(g.prototype,D),E&&C(g,E),Object.defineProperty(g,"prototype",{writable:!1}),g}function T(g,D){g.prototype=Object.create(D.prototype),g.prototype.constructor=g,m(g,D)}function m(g,D){return m=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(d,r){return d.__proto__=r,d},m(g,D)}var p=function(g){T(D,g);function D(d){var r;return r=g.call(this,d,"[audio-track-controller]")||this,r.tracks=[],r.groupId=null,r.tracksInGroup=[],r.trackId=-1,r.trackName="",r.selectDefaultTrack=!0,r.registerListeners(),r}var E=D.prototype;return E.registerListeners=function(){var r=this.hls;r.on(x.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.on(x.Events.MANIFEST_PARSED,this.onManifestParsed,this),r.on(x.Events.LEVEL_LOADING,this.onLevelLoading,this),r.on(x.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),r.on(x.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),r.on(x.Events.ERROR,this.onError,this)},E.unregisterListeners=function(){var r=this.hls;r.off(x.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.off(x.Events.MANIFEST_PARSED,this.onManifestParsed,this),r.off(x.Events.LEVEL_LOADING,this.onLevelLoading,this),r.off(x.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),r.off(x.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),r.off(x.Events.ERROR,this.onError,this)},E.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,g.prototype.destroy.call(this)},E.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.trackName="",this.selectDefaultTrack=!0},E.onManifestParsed=function(r,e){this.tracks=e.audioTracks||[]},E.onAudioTrackLoaded=function(r,e){var a=e.id,l=e.details,h=this.tracksInGroup[a];if(!h){this.warn("Invalid audio track id "+a);return}var n=h.details;h.details=e.details,this.log("audioTrack "+a+" loaded ["+l.startSN+"-"+l.endSN+"]"),a===this.trackId&&(this.retryCount=0,this.playlistLoaded(a,e,n))},E.onLevelLoading=function(r,e){this.switchLevel(e.level)},E.onLevelSwitching=function(r,e){this.switchLevel(e.level)},E.switchLevel=function(r){var e=this.hls.levels[r];if(!!(e!=null&&e.audioGroupIds)){var a=e.audioGroupIds[e.urlId];if(this.groupId!==a){this.groupId=a;var l=this.tracks.filter(function(n){return!a||n.groupId===a});this.selectDefaultTrack&&!l.some(function(n){return n.default})&&(this.selectDefaultTrack=!1),this.tracksInGroup=l;var h={audioTracks:l};this.log("Updating audio tracks, "+l.length+' track(s) found in "'+a+'" group-id'),this.hls.trigger(x.Events.AUDIO_TRACKS_UPDATED,h),this.selectInitialTrack()}}},E.onError=function(r,e){g.prototype.onError.call(this,r,e),!(e.fatal||!e.context)&&e.context.type===b.PlaylistContextType.AUDIO_TRACK&&e.context.id===this.trackId&&e.context.groupId===this.groupId&&this.retryLoadingOrFail(e)},E.setAudioTrack=function(r){var e=this.tracksInGroup;if(r<0||r>=e.length){this.warn("Invalid id passed to audio-track controller");return}this.clearTimer();var a=e[this.trackId];this.log("Now switching to audio-track index "+r);var l=e[r],h=l.id,n=l.groupId,t=n===void 0?"":n,i=l.name,y=l.type,u=l.url;if(this.trackId=r,this.trackName=i,this.selectDefaultTrack=!1,this.hls.trigger(x.Events.AUDIO_TRACK_SWITCHING,{id:h,groupId:t,name:i,type:y,url:u}),!(l.details&&!l.details.live)){var f=this.switchParams(l.url,a==null?void 0:a.details);this.loadPlaylist(f)}},E.selectInitialTrack=function(){var r=this.tracksInGroup;console.assert(r.length,"Initial audio track should be selected when tracks are known");var e=this.trackName,a=this.findTrackId(e)||this.findTrackId();a!==-1?this.setAudioTrack(a):(this.warn("No track found for running audio group-ID: "+this.groupId),this.hls.trigger(x.Events.ERROR,{type:R.ErrorTypes.MEDIA_ERROR,details:R.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal:!0}))},E.findTrackId=function(r){for(var e=this.tracksInGroup,a=0;a<e.length;a++){var l=e[a];if((!this.selectDefaultTrack||l.default)&&(!r||r===l.name))return l.id}return-1},E.loadPlaylist=function(r){var e=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(e)){var a=e.id,l=e.groupId,h=e.url;if(r)try{h=r.addDirectives(h)}catch(n){this.warn("Could not construct new URL with HLS Delivery Directives: "+n)}this.log("loading audio-track playlist for id: "+a),this.clearTimer(),this.hls.trigger(x.Events.AUDIO_TRACK_LOADING,{url:h,id:a,groupId:l,deliveryDirectives:r||null})}},I(D,[{key:"audioTracks",get:function(){return this.tracksInGroup}},{key:"audioTrack",get:function(){return this.trackId},set:function(r){this.selectDefaultTrack=!1,this.setAudioTrack(r)}}]),D}(O.default);M.default=p},"./src/controller/base-playlist-controller.ts":function(K,M,L){L.r(M),L.d(M,"default",function(){return I});var x=L("./src/polyfills/number.ts"),R=L("./src/types/level.ts"),O=L("./src/controller/level-helper.ts"),b=L("./src/utils/logger.ts"),C=L("./src/errors.ts"),I=function(){function T(p,g){this.hls=void 0,this.timer=-1,this.canLoad=!1,this.retryCount=0,this.log=void 0,this.warn=void 0,this.log=b.logger.log.bind(b.logger,g+":"),this.warn=b.logger.warn.bind(b.logger,g+":"),this.hls=p}var m=T.prototype;return m.destroy=function(){this.clearTimer(),this.hls=this.log=this.warn=null},m.onError=function(g,D){D.fatal&&D.type===C.ErrorTypes.NETWORK_ERROR&&this.clearTimer()},m.clearTimer=function(){clearTimeout(this.timer),this.timer=-1},m.startLoad=function(){this.canLoad=!0,this.retryCount=0,this.loadPlaylist()},m.stopLoad=function(){this.canLoad=!1,this.clearTimer()},m.switchParams=function(g,D){var E=D==null?void 0:D.renditionReports;if(E)for(var d=0;d<E.length;d++){var r=E[d],e=""+r.URI;if(e===g.slice(-e.length)){var a=parseInt(r["LAST-MSN"]),l=parseInt(r["LAST-PART"]);if(D&&this.hls.config.lowLatencyMode){var h=Math.min(D.age-D.partTarget,D.targetduration);l!==void 0&&h>D.partTarget&&(l+=1)}if(Object(x.isFiniteNumber)(a))return new R.HlsUrlParameters(a,Object(x.isFiniteNumber)(l)?l:void 0,R.HlsSkip.No)}}},m.loadPlaylist=function(g){},m.shouldLoadTrack=function(g){return this.canLoad&&g&&!!g.url&&(!g.details||g.details.live)},m.playlistLoaded=function(g,D,E){var d=this,r=D.details,e=D.stats,a=e.loading.end?Math.max(0,self.performance.now()-e.loading.end):0;if(r.advancedDateTime=Date.now()-a,r.live||E!=null&&E.live){if(r.reloaded(E),E&&this.log("live playlist "+g+" "+(r.advanced?"REFRESHED "+r.lastPartSn+"-"+r.lastPartIndex:"MISSED")),E&&r.fragments.length>0&&Object(O.mergeDetails)(E,r),!this.canLoad||!r.live)return;var l,h=void 0,n=void 0;if(r.canBlockReload&&r.endSN&&r.advanced){var t=this.hls.config.lowLatencyMode,i=r.lastPartSn,y=r.endSN,u=r.lastPartIndex,f=u!==-1,c=i===y,s=t?0:u;f?(h=c?y+1:i,n=c?s:u+1):h=y+1;var o=r.age,v=o+r.ageHeader,S=Math.min(v-r.partTarget,r.targetduration*1.5);if(S>0){if(E&&S>E.tuneInGoal)this.warn("CDN Tune-in goal increased from: "+E.tuneInGoal+" to: "+S+" with playlist age: "+r.age),S=0;else{var A=Math.floor(S/r.targetduration);if(h+=A,n!==void 0){var P=Math.round(S%r.targetduration/r.partTarget);n+=P}this.log("CDN Tune-in age: "+r.ageHeader+"s last advanced "+o.toFixed(2)+"s goal: "+S+" skip sn "+A+" to part "+n)}r.tuneInGoal=S}if(l=this.getDeliveryDirectives(r,D.deliveryDirectives,h,n),t||!c){this.loadPlaylist(l);return}}else l=this.getDeliveryDirectives(r,D.deliveryDirectives,h,n);var _=Object(O.computeReloadInterval)(r,e);h!==void 0&&r.canBlockReload&&(_-=r.partTarget||1),this.log("reload live playlist "+g+" in "+Math.round(_)+" ms"),this.timer=self.setTimeout(function(){return d.loadPlaylist(l)},_)}else this.clearTimer()},m.getDeliveryDirectives=function(g,D,E,d){var r=Object(R.getSkipValue)(g,E);return D!=null&&D.skip&&g.deltaUpdateFailed&&(E=D.msn,d=D.part,r=R.HlsSkip.No),new R.HlsUrlParameters(E,d,r)},m.retryLoadingOrFail=function(g){var D=this,E=this.hls.config,d=this.retryCount<E.levelLoadingMaxRetry;if(d){var r;if(this.retryCount++,g.details.indexOf("LoadTimeOut")>-1&&(r=g.context)!==null&&r!==void 0&&r.deliveryDirectives)this.warn("retry playlist loading #"+this.retryCount+' after "'+g.details+'"'),this.loadPlaylist();else{var e=Math.min(Math.pow(2,this.retryCount)*E.levelLoadingRetryDelay,E.levelLoadingMaxRetryTimeout);this.timer=self.setTimeout(function(){return D.loadPlaylist()},e),this.warn("retry playlist loading #"+this.retryCount+" in "+e+' ms after "'+g.details+'"')}}else this.warn('cannot recover from error "'+g.details+'"'),this.clearTimer(),g.fatal=!0;return d},T}()},"./src/controller/base-stream-controller.ts":function(K,M,L){L.r(M),L.d(M,"State",function(){return y}),L.d(M,"default",function(){return u});var x=L("./src/polyfills/number.ts"),R=L("./src/task-loop.ts"),O=L("./src/controller/fragment-tracker.ts"),b=L("./src/utils/buffer-helper.ts"),C=L("./src/utils/logger.ts"),I=L("./src/events.ts"),T=L("./src/errors.ts"),m=L("./src/types/transmuxer.ts"),p=L("./src/utils/mp4-tools.ts"),g=L("./src/utils/discontinuities.ts"),D=L("./src/controller/fragment-finders.ts"),E=L("./src/controller/level-helper.ts"),d=L("./src/loader/fragment-loader.ts"),r=L("./src/crypt/decrypter.ts"),e=L("./src/utils/time-ranges.ts"),a=L("./src/types/loader.ts");function l(f,c){for(var s=0;s<c.length;s++){var o=c[s];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(f,o.key,o)}}function h(f,c,s){return c&&l(f.prototype,c),s&&l(f,s),Object.defineProperty(f,"prototype",{writable:!1}),f}function n(f){if(f===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return f}function t(f,c){f.prototype=Object.create(c.prototype),f.prototype.constructor=f,i(f,c)}function i(f,c){return i=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,v){return o.__proto__=v,o},i(f,c)}var y={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"},u=function(f){t(c,f);function c(o,v,S){var A;return A=f.call(this)||this,A.hls=void 0,A.fragPrevious=null,A.fragCurrent=null,A.fragmentTracker=void 0,A.transmuxer=null,A._state=y.STOPPED,A.media=void 0,A.mediaBuffer=void 0,A.config=void 0,A.bitrateTest=!1,A.lastCurrentTime=0,A.nextLoadPosition=0,A.startPosition=0,A.loadedmetadata=!1,A.fragLoadError=0,A.retryDate=0,A.levels=null,A.fragmentLoader=void 0,A.levelLastLoaded=null,A.startFragRequested=!1,A.decrypter=void 0,A.initPTS=[],A.onvseeking=null,A.onvended=null,A.logPrefix="",A.log=void 0,A.warn=void 0,A.logPrefix=S,A.log=C.logger.log.bind(C.logger,S+":"),A.warn=C.logger.warn.bind(C.logger,S+":"),A.hls=o,A.fragmentLoader=new d.default(o.config),A.fragmentTracker=v,A.config=o.config,A.decrypter=new r.default(o,o.config),o.on(I.Events.KEY_LOADED,A.onKeyLoaded,n(A)),A}var s=c.prototype;return s.doTick=function(){this.onTickEnd()},s.onTickEnd=function(){},s.startLoad=function(v){},s.stopLoad=function(){this.fragmentLoader.abort();var v=this.fragCurrent;v&&this.fragmentTracker.removeFragment(v),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=y.STOPPED},s._streamEnded=function(v,S){var A=this.fragCurrent,P=this.fragmentTracker;if(!S.live&&A&&A.sn>=S.endSN&&!v.nextStart){var _=S.partList;if(_!=null&&_.length){var F=_[_.length-1],k=b.BufferHelper.isBuffered(this.media,F.start+F.duration/2);return k}var B=P.getState(A);return B===O.FragmentState.PARTIAL||B===O.FragmentState.OK}return!1},s.onMediaAttached=function(v,S){var A=this.media=this.mediaBuffer=S.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),A.addEventListener("seeking",this.onvseeking),A.addEventListener("ended",this.onvended);var P=this.config;this.levels&&P.autoStartLoad&&this.state===y.STOPPED&&this.startLoad(P.startPosition)},s.onMediaDetaching=function(){var v=this.media;v!=null&&v.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),v&&(v.removeEventListener("seeking",this.onvseeking),v.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()},s.onMediaSeeking=function(){var v=this.config,S=this.fragCurrent,A=this.media,P=this.mediaBuffer,_=this.state,F=A?A.currentTime:0,k=b.BufferHelper.bufferInfo(P||A,F,v.maxBufferHole);if(this.log("media seeking to "+(Object(x.isFiniteNumber)(F)?F.toFixed(3):F)+", state: "+_),_===y.ENDED)this.resetLoadingState();else if(S&&!k.len){var B=v.maxFragLookUpTolerance,w=S.start-B,U=S.start+S.duration+B,N=F>U;(F<w||N)&&(N&&S.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),S.loader.abort()),this.resetLoadingState())}A&&(this.lastCurrentTime=F),!this.loadedmetadata&&!k.len&&(this.nextLoadPosition=this.startPosition=F),this.tickImmediate()},s.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},s.onKeyLoaded=function(v,S){if(!(this.state!==y.KEY_LOADING||S.frag!==this.fragCurrent||!this.levels)){this.state=y.IDLE;var A=this.levels[S.frag.level].details;A&&this.loadFragment(S.frag,A,S.frag.start)}},s.onHandlerDestroying=function(){this.stopLoad(),f.prototype.onHandlerDestroying.call(this)},s.onHandlerDestroyed=function(){this.state=y.STOPPED,this.hls.off(I.Events.KEY_LOADED,this.onKeyLoaded,this),this.fragmentLoader&&this.fragmentLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.fragmentLoader=this.fragmentTracker=null,f.prototype.onHandlerDestroyed.call(this)},s.loadKey=function(v,S){this.log("Loading key for "+v.sn+" of ["+S.startSN+"-"+S.endSN+"], "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+v.level),this.state=y.KEY_LOADING,this.fragCurrent=v,this.hls.trigger(I.Events.KEY_LOADING,{frag:v})},s.loadFragment=function(v,S,A){this._loadFragForPlayback(v,S,A)},s._loadFragForPlayback=function(v,S,A){var P=this,_=function(k){if(P.fragContextChanged(v)){P.warn("Fragment "+v.sn+(k.part?" p: "+k.part.index:"")+" of level "+v.level+" was dropped during download."),P.fragmentTracker.removeFragment(v);return}v.stats.chunkCount++,P._handleFragmentLoadProgress(k)};this._doFragLoad(v,S,A,_).then(function(F){if(!!F){P.fragLoadError=0;var k=P.state;if(P.fragContextChanged(v)){(k===y.FRAG_LOADING||!P.fragCurrent&&k===y.PARSING)&&(P.fragmentTracker.removeFragment(v),P.state=y.IDLE);return}"payload"in F&&(P.log("Loaded fragment "+v.sn+" of level "+v.level),P.hls.trigger(I.Events.FRAG_LOADED,F)),P._handleFragmentLoadComplete(F)}}).catch(function(F){P.state!==y.STOPPED&&(P.warn(F),P.resetFragmentLoading(v))})},s.flushMainBuffer=function(v,S,A){if(A===void 0&&(A=null),!!(v-S)){var P={startOffset:v,endOffset:S,type:A};this.fragLoadError=0,this.hls.trigger(I.Events.BUFFER_FLUSHING,P)}},s._loadInitSegment=function(v){var S=this;this._doFragLoad(v).then(function(A){if(!A||S.fragContextChanged(v)||!S.levels)throw new Error("init load aborted");return A}).then(function(A){var P=S.hls,_=A.payload,F=v.decryptdata;if(_&&_.byteLength>0&&F&&F.key&&F.iv&&F.method==="AES-128"){var k=self.performance.now();return S.decrypter.webCryptoDecrypt(new Uint8Array(_),F.key.buffer,F.iv.buffer).then(function(B){var w=self.performance.now();return P.trigger(I.Events.FRAG_DECRYPTED,{frag:v,payload:B,stats:{tstart:k,tdecrypt:w}}),A.payload=B,A})}return A}).then(function(A){var P=S.fragCurrent,_=S.hls,F=S.levels;if(!F)throw new Error("init load aborted, missing levels");var k=F[v.level].details;console.assert(k,"Level details are defined when init segment is loaded");var B=v.stats;S.state=y.IDLE,S.fragLoadError=0,v.data=new Uint8Array(A.payload),B.parsing.start=B.buffering.start=self.performance.now(),B.parsing.end=B.buffering.end=self.performance.now(),A.frag===P&&_.trigger(I.Events.FRAG_BUFFERED,{stats:B,frag:P,part:null,id:v.type}),S.tick()}).catch(function(A){S.warn(A),S.resetFragmentLoading(v)})},s.fragContextChanged=function(v){var S=this.fragCurrent;return!v||!S||v.level!==S.level||v.sn!==S.sn||v.urlId!==S.urlId},s.fragBufferedComplete=function(v,S){var A=this.mediaBuffer?this.mediaBuffer:this.media;this.log("Buffered "+v.type+" sn: "+v.sn+(S?" part: "+S.index:"")+" of "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+v.level+" "+e.default.toString(b.BufferHelper.getBuffered(A))),this.state=y.IDLE,this.tick()},s._handleFragmentLoadComplete=function(v){var S=this.transmuxer;if(!!S){var A=v.frag,P=v.part,_=v.partsLoaded,F=!_||_.length===0||_.some(function(B){return!B}),k=new m.ChunkMetadata(A.level,A.sn,A.stats.chunkCount+1,0,P?P.index:-1,!F);S.flush(k)}},s._handleFragmentLoadProgress=function(v){},s._doFragLoad=function(v,S,A,P){var _=this;if(A===void 0&&(A=null),!this.levels)throw new Error("frag load aborted, missing levels");if(A=Math.max(v.start,A||0),this.config.lowLatencyMode&&S){var F=S.partList;if(F&&P){A>v.end&&S.fragmentHint&&(v=S.fragmentHint);var k=this.getNextPart(F,v,A);if(k>-1){var B=F[k];return this.log("Loading part sn: "+v.sn+" p: "+B.index+" cc: "+v.cc+" of playlist ["+S.startSN+"-"+S.endSN+"] parts [0-"+k+"-"+(F.length-1)+"] "+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+v.level+", target: "+parseFloat(A.toFixed(3))),this.nextLoadPosition=B.start+B.duration,this.state=y.FRAG_LOADING,this.hls.trigger(I.Events.FRAG_LOADING,{frag:v,part:F[k],targetBufferTime:A}),this.doFragPartsLoad(v,F,k,P).catch(function(w){return _.handleFragLoadError(w)})}else if(!v.url||this.loadedEndOfParts(F,A))return Promise.resolve(null)}}return this.log("Loading fragment "+v.sn+" cc: "+v.cc+" "+(S?"of ["+S.startSN+"-"+S.endSN+"] ":"")+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+v.level+", target: "+parseFloat(A.toFixed(3))),Object(x.isFiniteNumber)(v.sn)&&!this.bitrateTest&&(this.nextLoadPosition=v.start+v.duration),this.state=y.FRAG_LOADING,this.hls.trigger(I.Events.FRAG_LOADING,{frag:v,targetBufferTime:A}),this.fragmentLoader.load(v,P).catch(function(w){return _.handleFragLoadError(w)})},s.doFragPartsLoad=function(v,S,A,P){var _=this;return new Promise(function(F,k){var B=[],w=function U(N){var W=S[N];_.fragmentLoader.loadPart(v,W,P).then(function(j){B[W.index]=j;var H=j.part;_.hls.trigger(I.Events.FRAG_LOADED,j);var G=S[N+1];if(G&&G.fragment===v)U(N+1);else return F({frag:v,part:H,partsLoaded:B})}).catch(k)};w(A)})},s.handleFragLoadError=function(v){var S=v.data;return S&&S.details===T.ErrorDetails.INTERNAL_ABORTED?this.handleFragLoadAborted(S.frag,S.part):this.hls.trigger(I.Events.ERROR,S),null},s._handleTransmuxerFlush=function(v){var S=this.getCurrentContext(v);if(!S||this.state!==y.PARSING){this.fragCurrent||(this.state=y.IDLE);return}var A=S.frag,P=S.part,_=S.level,F=self.performance.now();A.stats.parsing.end=F,P&&(P.stats.parsing.end=F),this.updateLevelTiming(A,P,_,v.partial)},s.getCurrentContext=function(v){var S=this.levels,A=v.level,P=v.sn,_=v.part;if(!S||!S[A])return this.warn("Levels object was unset while buffering fragment "+P+" of level "+A+". The current chunk will not be buffered."),null;var F=S[A],k=_>-1?Object(E.getPartWith)(F,P,_):null,B=k?k.fragment:Object(E.getFragmentWithSN)(F,P,this.fragCurrent);return B?{frag:B,part:k,level:F}:null},s.bufferFragmentData=function(v,S,A,P){if(!(!v||this.state!==y.PARSING)){var _=v.data1,F=v.data2,k=_;if(_&&F&&(k=Object(p.appendUint8Array)(_,F)),!(!k||!k.length)){var B={type:v.type,frag:S,part:A,chunkMeta:P,parent:S.type,data:k};this.hls.trigger(I.Events.BUFFER_APPENDING,B),v.dropped&&v.independent&&!A&&this.flushBufferGap(S)}}},s.flushBufferGap=function(v){var S=this.media;if(!!S){if(!b.BufferHelper.isBuffered(S,S.currentTime)){this.flushMainBuffer(0,v.start);return}var A=S.currentTime,P=b.BufferHelper.bufferInfo(S,A,0),_=v.duration,F=Math.min(this.config.maxFragLookUpTolerance*2,_*.25),k=Math.max(Math.min(v.start-F,P.end-F),A+F);v.start-k>F&&this.flushMainBuffer(k,v.start)}},s.getFwdBufferInfo=function(v,S){var A=this.config,P=this.getLoadPosition();if(!Object(x.isFiniteNumber)(P))return null;var _=b.BufferHelper.bufferInfo(v,P,A.maxBufferHole);if(_.len===0&&_.nextStart!==void 0){var F=this.fragmentTracker.getBufferedFrag(P,S);if(F&&_.nextStart<F.end)return b.BufferHelper.bufferInfo(v,P,Math.max(_.nextStart,A.maxBufferHole))}return _},s.getMaxBufferLength=function(v){var S=this.config,A;return v?A=Math.max(8*S.maxBufferSize/v,S.maxBufferLength):A=S.maxBufferLength,Math.min(A,S.maxMaxBufferLength)},s.reduceMaxBufferLength=function(v){var S=this.config,A=v||S.maxBufferLength;return S.maxMaxBufferLength>=A?(S.maxMaxBufferLength/=2,this.warn("Reduce max buffer length to "+S.maxMaxBufferLength+"s"),!0):!1},s.getNextFragment=function(v,S){var A=S.fragments,P=A.length;if(!P)return null;var _=this.config,F=A[0].start,k;if(S.live){var B=_.initialLiveManifestSize;if(P<B)return this.warn("Not enough fragments to start playback (have: "+P+", need: "+B+")"),null;!S.PTSKnown&&!this.startFragRequested&&this.startPosition===-1&&(k=this.getInitialLiveFragment(S,A),this.startPosition=k?this.hls.liveSyncPosition||k.start:v)}else v<=F&&(k=A[0]);if(!k){var w=_.lowLatencyMode?S.partEnd:S.fragmentEnd;k=this.getFragmentAtPosition(v,w,S)}return this.mapToInitFragWhenRequired(k)},s.mapToInitFragWhenRequired=function(v){return v!=null&&v.initSegment&&!(v!=null&&v.initSegment.data)&&!this.bitrateTest?v.initSegment:v},s.getNextPart=function(v,S,A){for(var P=-1,_=!1,F=!0,k=0,B=v.length;k<B;k++){var w=v[k];if(F=F&&!w.independent,P>-1&&A<w.start)break;var U=w.loaded;!U&&(_||w.independent||F)&&w.fragment===S&&(P=k),_=U}return P},s.loadedEndOfParts=function(v,S){var A=v[v.length-1];return A&&S>A.start&&A.loaded},s.getInitialLiveFragment=function(v,S){var A=this.fragPrevious,P=null;if(A){if(v.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: "+A.programDateTime),P=Object(D.findFragmentByPDT)(S,A.endProgramDateTime,this.config.maxFragLookUpTolerance)),!P){var _=A.sn+1;if(_>=v.startSN&&_<=v.endSN){var F=S[_-v.startSN];A.cc===F.cc&&(P=F,this.log("Live playlist, switching playlist, load frag with next SN: "+P.sn))}P||(P=Object(D.findFragWithCC)(S,A.cc),P&&this.log("Live playlist, switching playlist, load frag with same CC: "+P.sn))}}else{var k=this.hls.liveSyncPosition;k!==null&&(P=this.getFragmentAtPosition(k,this.bitrateTest?v.fragmentEnd:v.edge,v))}return P},s.getFragmentAtPosition=function(v,S,A){var P=this.config,_=this.fragPrevious,F=A.fragments,k=A.endSN,B=A.fragmentHint,w=P.maxFragLookUpTolerance,U=!!(P.lowLatencyMode&&A.partList&&B);U&&B&&!this.bitrateTest&&(F=F.concat(B),k=B.sn);var N;if(v<S){var W=v>S-w?0:w;N=Object(D.findFragmentByPTS)(_,F,v,W)}else N=F[F.length-1];if(N){var j=N.sn-A.startSN,H=_&&N.level===_.level,G=F[j+1];_&&N.sn===_.sn&&!U&&H&&(N.sn<k&&this.fragmentTracker.getState(G)!==O.FragmentState.OK?(this.log("SN "+N.sn+" just loaded, load next one: "+G.sn),N=G):N=null)}return N},s.synchronizeToLiveEdge=function(v){var S=this.config,A=this.media;if(!!A){var P=this.hls.liveSyncPosition,_=A.currentTime,F=v.fragments[0].start,k=v.edge,B=_>=F-S.maxFragLookUpTolerance&&_<=k;if(P!==null&&A.duration>P&&(_<P||!B)){var w=S.liveMaxLatencyDuration!==void 0?S.liveMaxLatencyDuration:S.liveMaxLatencyDurationCount*v.targetduration;(!B&&A.readyState<4||_<k-w)&&(this.loadedmetadata||(this.nextLoadPosition=P),A.readyState&&(this.warn("Playback: "+_.toFixed(3)+" is located too far from the end of live sliding playlist: "+k+", reset currentTime to : "+P.toFixed(3)),A.currentTime=P))}}},s.alignPlaylists=function(v,S){var A=this.levels,P=this.levelLastLoaded,_=this.fragPrevious,F=P!==null?A[P]:null,k=v.fragments.length;if(!k)return this.warn("No fragments in live playlist"),0;var B=v.fragments[0].start,w=!S,U=v.alignedSliding&&Object(x.isFiniteNumber)(B);if(w||!U&&!B){Object(g.alignStream)(_,F,v);var N=v.fragments[0].start;return this.log("Live playlist sliding: "+N.toFixed(2)+" start-sn: "+(S?S.startSN:"na")+"->"+v.startSN+" prev-sn: "+(_?_.sn:"na")+" fragments: "+k),N}return B},s.waitForCdnTuneIn=function(v){var S=3;return v.live&&v.canBlockReload&&v.partTarget&&v.tuneInGoal>Math.max(v.partHoldBack,v.partTarget*S)},s.setStartPosition=function(v,S){var A=this.startPosition;if(A<S&&(A=-1),A===-1||this.lastCurrentTime===-1){var P=v.startTimeOffset;Object(x.isFiniteNumber)(P)?(A=S+P,P<0&&(A+=v.totalduration),A=Math.min(Math.max(S,A),S+v.totalduration),this.log("Start time offset "+P+" found in playlist, adjust startPosition to "+A),this.startPosition=A):v.live?A=this.hls.liveSyncPosition||S:this.startPosition=A=0,this.lastCurrentTime=A}this.nextLoadPosition=A},s.getLoadPosition=function(){var v=this.media,S=0;return this.loadedmetadata&&v?S=v.currentTime:this.nextLoadPosition&&(S=this.nextLoadPosition),S},s.handleFragLoadAborted=function(v,S){this.transmuxer&&v.sn!=="initSegment"&&v.stats.aborted&&(this.warn("Fragment "+v.sn+(S?" part"+S.index:"")+" of level "+v.level+" was aborted"),this.resetFragmentLoading(v))},s.resetFragmentLoading=function(v){(!this.fragCurrent||!this.fragContextChanged(v))&&(this.state=y.IDLE)},s.onFragmentOrKeyLoadError=function(v,S){if(!S.fatal){var A=S.frag;if(!(!A||A.type!==v)){var P=this.fragCurrent;console.assert(P&&A.sn===P.sn&&A.level===P.level&&A.urlId===P.urlId,"Frag load error must match current frag to retry");var _=this.config;if(this.fragLoadError+1<=_.fragLoadingMaxRetry){if(this.resetLiveStartWhenNotLoaded(A.level))return;var F=Math.min(Math.pow(2,this.fragLoadError)*_.fragLoadingRetryDelay,_.fragLoadingMaxRetryTimeout);this.warn("Fragment "+A.sn+" of "+v+" "+A.level+" failed to load, retrying in "+F+"ms"),this.retryDate=self.performance.now()+F,this.fragLoadError++,this.state=y.FRAG_LOADING_WAITING_RETRY}else S.levelRetry?(v===a.PlaylistLevelType.AUDIO&&(this.fragCurrent=null),this.fragLoadError=0,this.state=y.IDLE):(C.logger.error(S.details+" reaches max retry, redispatch as fatal ..."),S.fatal=!0,this.hls.stopLoad(),this.state=y.ERROR)}}},s.afterBufferFlushed=function(v,S,A){if(!!v){var P=b.BufferHelper.getBuffered(v);this.fragmentTracker.detectEvictedFragments(S,P,A),this.state===y.ENDED&&this.resetLoadingState()}},s.resetLoadingState=function(){this.fragCurrent=null,this.fragPrevious=null,this.state=y.IDLE},s.resetLiveStartWhenNotLoaded=function(v){if(!this.loadedmetadata){this.startFragRequested=!1;var S=this.levels?this.levels[v].details:null;if(S!=null&&S.live)return this.startPosition=-1,this.setStartPosition(S,0),this.resetLoadingState(),!0;this.nextLoadPosition=this.startPosition}return!1},s.updateLevelTiming=function(v,S,A,P){var _=this,F=A.details;console.assert(!!F,"level.details must be defined");var k=Object.keys(v.elementaryStreams).reduce(function(B,w){var U=v.elementaryStreams[w];if(U){var N=U.endPTS-U.startPTS;if(N<=0)return _.warn("Could not parse fragment "+v.sn+" "+w+" duration reliably ("+N+")"),B||!1;var W=P?0:Object(E.updateFragPTSDTS)(F,v,U.startPTS,U.endPTS,U.startDTS,U.endDTS);return _.hls.trigger(I.Events.LEVEL_PTS_UPDATED,{details:F,level:A,drift:W,type:w,frag:v,start:U.startPTS,end:U.endPTS}),!0}return B},!1);k||(this.warn("Found no media in fragment "+v.sn+" of level "+A.id+" resetting transmuxer to fallback to playlist timing"),this.resetTransmuxer()),this.state=y.PARSED,this.hls.trigger(I.Events.FRAG_PARSED,{frag:v,part:S})},s.resetTransmuxer=function(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)},h(c,[{key:"state",get:function(){return this._state},set:function(v){var S=this._state;S!==v&&(this._state=v,this.log(S+"->"+v))}}]),c}(R.default)},"./src/controller/buffer-controller.ts":function(K,M,L){L.r(M),L.d(M,"default",function(){return D});var x=L("./src/polyfills/number.ts"),R=L("./src/events.ts"),O=L("./src/utils/logger.ts"),b=L("./src/errors.ts"),C=L("./src/utils/buffer-helper.ts"),I=L("./src/utils/mediasource-helper.ts"),T=L("./src/loader/fragment.ts"),m=L("./src/controller/buffer-operation-queue.ts"),p=Object(I.getMediaSource)(),g=/([ha]vc.)(?:\.[^.,]+)+/,D=function(){function E(r){var e=this;this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.appendError=0,this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this._onMediaSourceOpen=function(){var a=e.hls,l=e.media,h=e.mediaSource;O.logger.log("[buffer-controller]: Media source opened"),l&&(e.updateMediaElementDuration(),a.trigger(R.Events.MEDIA_ATTACHED,{media:l})),h&&h.removeEventListener("sourceopen",e._onMediaSourceOpen),e.checkPendingTracks()},this._onMediaSourceClose=function(){O.logger.log("[buffer-controller]: Media source closed")},this._onMediaSourceEnded=function(){O.logger.log("[buffer-controller]: Media source ended")},this.hls=r,this._initSourceBuffer(),this.registerListeners()}var d=E.prototype;return d.hasSourceTypes=function(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0},d.destroy=function(){this.unregisterListeners(),this.details=null},d.registerListeners=function(){var e=this.hls;e.on(R.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(R.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(R.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.on(R.Events.BUFFER_RESET,this.onBufferReset,this),e.on(R.Events.BUFFER_APPENDING,this.onBufferAppending,this),e.on(R.Events.BUFFER_CODECS,this.onBufferCodecs,this),e.on(R.Events.BUFFER_EOS,this.onBufferEos,this),e.on(R.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(R.Events.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(R.Events.FRAG_PARSED,this.onFragParsed,this),e.on(R.Events.FRAG_CHANGED,this.onFragChanged,this)},d.unregisterListeners=function(){var e=this.hls;e.off(R.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(R.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(R.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.off(R.Events.BUFFER_RESET,this.onBufferReset,this),e.off(R.Events.BUFFER_APPENDING,this.onBufferAppending,this),e.off(R.Events.BUFFER_CODECS,this.onBufferCodecs,this),e.off(R.Events.BUFFER_EOS,this.onBufferEos,this),e.off(R.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(R.Events.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(R.Events.FRAG_PARSED,this.onFragParsed,this),e.off(R.Events.FRAG_CHANGED,this.onFragChanged,this)},d._initSourceBuffer=function(){this.sourceBuffer={},this.operationQueue=new m.default(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]}},d.onManifestParsed=function(e,a){var l=2;(a.audio&&!a.video||!a.altAudio)&&(l=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=l,this.details=null,O.logger.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},d.onMediaAttaching=function(e,a){var l=this.media=a.media;if(l&&p){var h=this.mediaSource=new p;h.addEventListener("sourceopen",this._onMediaSourceOpen),h.addEventListener("sourceended",this._onMediaSourceEnded),h.addEventListener("sourceclose",this._onMediaSourceClose),l.src=self.URL.createObjectURL(h),this._objectUrl=l.src}},d.onMediaDetaching=function(){var e=this.media,a=this.mediaSource,l=this._objectUrl;if(a){if(O.logger.log("[buffer-controller]: media source detaching"),a.readyState==="open")try{a.endOfStream()}catch(h){O.logger.warn("[buffer-controller]: onMediaDetaching: "+h.message+" while calling endOfStream")}this.onBufferReset(),a.removeEventListener("sourceopen",this._onMediaSourceOpen),a.removeEventListener("sourceended",this._onMediaSourceEnded),a.removeEventListener("sourceclose",this._onMediaSourceClose),e&&(l&&self.URL.revokeObjectURL(l),e.src===l?(e.removeAttribute("src"),e.load()):O.logger.warn("[buffer-controller]: media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(R.Events.MEDIA_DETACHED,void 0)},d.onBufferReset=function(){var e=this;this.getSourceBufferTypes().forEach(function(a){var l=e.sourceBuffer[a];try{l&&(e.removeBufferListeners(a),e.mediaSource&&e.mediaSource.removeSourceBuffer(l),e.sourceBuffer[a]=void 0)}catch(h){O.logger.warn("[buffer-controller]: Failed to reset the "+a+" buffer",h)}}),this._initSourceBuffer()},d.onBufferCodecs=function(e,a){var l=this,h=this.getSourceBufferTypes().length;Object.keys(a).forEach(function(n){if(h){var t=l.tracks[n];if(t&&typeof t.buffer.changeType=="function"){var i=a[n],y=i.id,u=i.codec,f=i.levelCodec,c=i.container,s=i.metadata,o=(t.levelCodec||t.codec).replace(g,"$1"),v=(f||u).replace(g,"$1");if(o!==v){var S=c+";codecs="+(f||u);l.appendChangeType(n,S),O.logger.log("[buffer-controller]: switching codec "+o+" to "+v),l.tracks[n]={buffer:t.buffer,codec:u,container:c,levelCodec:f,metadata:s,id:y}}}}else l.pendingTracks[n]=a[n]}),!h&&(this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&this.mediaSource.readyState==="open"&&this.checkPendingTracks())},d.appendChangeType=function(e,a){var l=this,h=this.operationQueue,n={execute:function(){var i=l.sourceBuffer[e];i&&(O.logger.log("[buffer-controller]: changing "+e+" sourceBuffer type to "+a),i.changeType(a)),h.shiftAndExecuteNext(e)},onStart:function(){},onComplete:function(){},onError:function(i){O.logger.warn("[buffer-controller]: Failed to change "+e+" SourceBuffer type",i)}};h.append(n,e)},d.onBufferAppending=function(e,a){var l=this,h=this.hls,n=this.operationQueue,t=this.tracks,i=a.data,y=a.type,u=a.frag,f=a.part,c=a.chunkMeta,s=c.buffering[y],o=self.performance.now();s.start=o;var v=u.stats.buffering,S=f?f.stats.buffering:null;v.start===0&&(v.start=o),S&&S.start===0&&(S.start=o);var A=t.audio,P=y==="audio"&&c.id===1&&(A==null?void 0:A.container)==="audio/mpeg",_={execute:function(){if(s.executeStart=self.performance.now(),P){var k=l.sourceBuffer[y];if(k){var B=u.start-k.timestampOffset;Math.abs(B)>=.1&&(O.logger.log("[buffer-controller]: Updating audio SourceBuffer timestampOffset to "+u.start+" (delta: "+B+") sn: "+u.sn+")"),k.timestampOffset=u.start)}}l.appendExecutor(i,y)},onStart:function(){},onComplete:function(){var k=self.performance.now();s.executeEnd=s.end=k,v.first===0&&(v.first=k),S&&S.first===0&&(S.first=k);var B=l.sourceBuffer,w={};for(var U in B)w[U]=C.BufferHelper.getBuffered(B[U]);l.appendError=0,l.hls.trigger(R.Events.BUFFER_APPENDED,{type:y,frag:u,part:f,chunkMeta:c,parent:u.type,timeRanges:w})},onError:function(k){O.logger.error("[buffer-controller]: Error encountered while trying to append to the "+y+" SourceBuffer",k);var B={type:b.ErrorTypes.MEDIA_ERROR,parent:u.type,details:b.ErrorDetails.BUFFER_APPEND_ERROR,err:k,fatal:!1};k.code===DOMException.QUOTA_EXCEEDED_ERR?B.details=b.ErrorDetails.BUFFER_FULL_ERROR:(l.appendError++,B.details=b.ErrorDetails.BUFFER_APPEND_ERROR,l.appendError>h.config.appendErrorMaxRetry&&(O.logger.error("[buffer-controller]: Failed "+h.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),B.fatal=!0)),h.trigger(R.Events.ERROR,B)}};n.append(_,y)},d.onBufferFlushing=function(e,a){var l=this,h=this.operationQueue,n=function(i){return{execute:l.removeExecutor.bind(l,i,a.startOffset,a.endOffset),onStart:function(){},onComplete:function(){l.hls.trigger(R.Events.BUFFER_FLUSHED,{type:i})},onError:function(u){O.logger.warn("[buffer-controller]: Failed to remove from "+i+" SourceBuffer",u)}}};a.type?h.append(n(a.type),a.type):this.getSourceBufferTypes().forEach(function(t){h.append(n(t),t)})},d.onFragParsed=function(e,a){var l=this,h=a.frag,n=a.part,t=[],i=n?n.elementaryStreams:h.elementaryStreams;i[T.ElementaryStreamTypes.AUDIOVIDEO]?t.push("audiovideo"):(i[T.ElementaryStreamTypes.AUDIO]&&t.push("audio"),i[T.ElementaryStreamTypes.VIDEO]&&t.push("video"));var y=function(){var f=self.performance.now();h.stats.buffering.end=f,n&&(n.stats.buffering.end=f);var c=n?n.stats:h.stats;l.hls.trigger(R.Events.FRAG_BUFFERED,{frag:h,part:n,stats:c,id:h.type})};t.length===0&&O.logger.warn("Fragments must have at least one ElementaryStreamType set. type: "+h.type+" level: "+h.level+" sn: "+h.sn),this.blockBuffers(y,t)},d.onFragChanged=function(e,a){this.flushBackBuffer()},d.onBufferEos=function(e,a){var l=this,h=this.getSourceBufferTypes().reduce(function(n,t){var i=l.sourceBuffer[t];return(!a.type||a.type===t)&&i&&!i.ended&&(i.ended=!0,O.logger.log("[buffer-controller]: "+t+" sourceBuffer now EOS")),n&&!!(!i||i.ended)},!0);h&&this.blockBuffers(function(){var n=l.mediaSource;!n||n.readyState!=="open"||n.endOfStream()})},d.onLevelUpdated=function(e,a){var l=a.details;!l.fragments.length||(this.details=l,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())},d.flushBackBuffer=function(){var e=this.hls,a=this.details,l=this.media,h=this.sourceBuffer;if(!(!l||a===null)){var n=this.getSourceBufferTypes();if(!!n.length){var t=a.live&&e.config.liveBackBufferLength!==null?e.config.liveBackBufferLength:e.config.backBufferLength;if(!(!Object(x.isFiniteNumber)(t)||t<0)){var i=l.currentTime,y=a.levelTargetDuration,u=Math.max(t,y),f=Math.floor(i/y)*y-u;n.forEach(function(c){var s=h[c];if(s){var o=C.BufferHelper.getBuffered(s);o.length>0&&f>o.start(0)&&(e.trigger(R.Events.BACK_BUFFER_REACHED,{bufferEnd:f}),a.live&&e.trigger(R.Events.LIVE_BACK_BUFFER_REACHED,{bufferEnd:f}),e.trigger(R.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:f,type:c}))}})}}}},d.updateMediaElementDuration=function(){if(!(!this.details||!this.media||!this.mediaSource||this.mediaSource.readyState!=="open")){var e=this.details,a=this.hls,l=this.media,h=this.mediaSource,n=e.fragments[0].start+e.totalduration,t=l.duration,i=Object(x.isFiniteNumber)(h.duration)?h.duration:0;e.live&&a.config.liveDurationInfinity?(O.logger.log("[buffer-controller]: Media Source duration is set to Infinity"),h.duration=1/0,this.updateSeekableRange(e)):(n>i&&n>t||!Object(x.isFiniteNumber)(t))&&(O.logger.log("[buffer-controller]: Updating Media Source duration to "+n.toFixed(3)),h.duration=n)}},d.updateSeekableRange=function(e){var a=this.mediaSource,l=e.fragments,h=l.length;if(h&&e.live&&a!==null&&a!==void 0&&a.setLiveSeekableRange){var n=Math.max(0,l[0].start),t=Math.max(n,n+e.totalduration);a.setLiveSeekableRange(n,t)}},d.checkPendingTracks=function(){var e=this.bufferCodecEventsExpected,a=this.operationQueue,l=this.pendingTracks,h=Object.keys(l).length;if(h&&!e||h===2){this.createSourceBuffers(l),this.pendingTracks={};var n=this.getSourceBufferTypes();if(n.length===0){this.hls.trigger(R.Events.ERROR,{type:b.ErrorTypes.MEDIA_ERROR,details:b.ErrorDetails.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,reason:"could not create source buffer for media codec(s)"});return}n.forEach(function(t){a.executeNext(t)})}},d.createSourceBuffers=function(e){var a=this.sourceBuffer,l=this.mediaSource;if(!l)throw Error("createSourceBuffers called when mediaSource was null");var h=0;for(var n in e)if(!a[n]){var t=e[n];if(!t)throw Error("source buffer exists for track "+n+", however track does not");var i=t.levelCodec||t.codec,y=t.container+";codecs="+i;O.logger.log("[buffer-controller]: creating sourceBuffer("+y+")");try{var u=a[n]=l.addSourceBuffer(y),f=n;this.addBufferListener(f,"updatestart",this._onSBUpdateStart),this.addBufferListener(f,"updateend",this._onSBUpdateEnd),this.addBufferListener(f,"error",this._onSBUpdateError),this.tracks[n]={buffer:u,codec:i,container:t.container,levelCodec:t.levelCodec,metadata:t.metadata,id:t.id},h++}catch(c){O.logger.error("[buffer-controller]: error while trying to add sourceBuffer: "+c.message),this.hls.trigger(R.Events.ERROR,{type:b.ErrorTypes.MEDIA_ERROR,details:b.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:c,mimeType:y})}}h&&this.hls.trigger(R.Events.BUFFER_CREATED,{tracks:this.tracks})},d._onSBUpdateStart=function(e){var a=this.operationQueue,l=a.current(e);l.onStart()},d._onSBUpdateEnd=function(e){var a=this.operationQueue,l=a.current(e);l.onComplete(),a.shiftAndExecuteNext(e)},d._onSBUpdateError=function(e,a){O.logger.error("[buffer-controller]: "+e+" SourceBuffer error",a),this.hls.trigger(R.Events.ERROR,{type:b.ErrorTypes.MEDIA_ERROR,details:b.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1});var l=this.operationQueue.current(e);l&&l.onError(a)},d.removeExecutor=function(e,a,l){var h=this.media,n=this.mediaSource,t=this.operationQueue,i=this.sourceBuffer,y=i[e];if(!h||!n||!y){O.logger.warn("[buffer-controller]: Attempting to remove from the "+e+" SourceBuffer, but it does not exist"),t.shiftAndExecuteNext(e);return}var u=Object(x.isFiniteNumber)(h.duration)?h.duration:1/0,f=Object(x.isFiniteNumber)(n.duration)?n.duration:1/0,c=Math.max(0,a),s=Math.min(l,u,f);s>c?(O.logger.log("[buffer-controller]: Removing ["+c+","+s+"] from the "+e+" SourceBuffer"),console.assert(!y.updating,e+" sourceBuffer must not be updating"),y.remove(c,s)):t.shiftAndExecuteNext(e)},d.appendExecutor=function(e,a){var l=this.operationQueue,h=this.sourceBuffer,n=h[a];if(!n){O.logger.warn("[buffer-controller]: Attempting to append to the "+a+" SourceBuffer, but it does not exist"),l.shiftAndExecuteNext(a);return}n.ended=!1,console.assert(!n.updating,a+" sourceBuffer must not be updating"),n.appendBuffer(e)},d.blockBuffers=function(e,a){var l=this;if(a===void 0&&(a=this.getSourceBufferTypes()),!a.length){O.logger.log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(e);return}var h=this.operationQueue,n=a.map(function(t){return h.appendBlocker(t)});Promise.all(n).then(function(){e(),a.forEach(function(t){var i=l.sourceBuffer[t];(!i||!i.updating)&&h.shiftAndExecuteNext(t)})})},d.getSourceBufferTypes=function(){return Object.keys(this.sourceBuffer)},d.addBufferListener=function(e,a,l){var h=this.sourceBuffer[e];if(!!h){var n=l.bind(this,e);this.listeners[e].push({event:a,listener:n}),h.addEventListener(a,n)}},d.removeBufferListeners=function(e){var a=this.sourceBuffer[e];!a||this.listeners[e].forEach(function(l){a.removeEventListener(l.event,l.listener)})},E}()},"./src/controller/buffer-operation-queue.ts":function(K,M,L){L.r(M),L.d(M,"default",function(){return R});var x=L("./src/utils/logger.ts"),R=function(){function O(C){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=C}var b=O.prototype;return b.append=function(I,T){var m=this.queues[T];m.push(I),m.length===1&&this.buffers[T]&&this.executeNext(T)},b.insertAbort=function(I,T){var m=this.queues[T];m.unshift(I),this.executeNext(T)},b.appendBlocker=function(I){var T,m=new Promise(function(g){T=g}),p={execute:T,onStart:function(){},onComplete:function(){},onError:function(){}};return this.append(p,I),m},b.executeNext=function(I){var T=this.buffers,m=this.queues,p=T[I],g=m[I];if(g.length){var D=g[0];try{D.execute()}catch(E){x.logger.warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),D.onError(E),(!p||!p.updating)&&(g.shift(),this.executeNext(I))}}},b.shiftAndExecuteNext=function(I){this.queues[I].shift(),this.executeNext(I)},b.current=function(I){return this.queues[I][0]},O}()},"./src/controller/cap-level-controller.ts":function(K,M,L){L.r(M);var x=L("./src/events.ts");function R(C,I){for(var T=0;T<I.length;T++){var m=I[T];m.enumerable=m.enumerable||!1,m.configurable=!0,"value"in m&&(m.writable=!0),Object.defineProperty(C,m.key,m)}}function O(C,I,T){return I&&R(C.prototype,I),T&&R(C,T),Object.defineProperty(C,"prototype",{writable:!1}),C}var b=function(){function C(T){this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.hls=void 0,this.streamController=void 0,this.clientRect=void 0,this.hls=T,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}var I=C.prototype;return I.setStreamController=function(m){this.streamController=m},I.destroy=function(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null},I.registerListeners=function(){var m=this.hls;m.on(x.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),m.on(x.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),m.on(x.Events.MANIFEST_PARSED,this.onManifestParsed,this),m.on(x.Events.BUFFER_CODECS,this.onBufferCodecs,this),m.on(x.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},I.unregisterListener=function(){var m=this.hls;m.off(x.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),m.off(x.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),m.off(x.Events.MANIFEST_PARSED,this.onManifestParsed,this),m.off(x.Events.BUFFER_CODECS,this.onBufferCodecs,this),m.off(x.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},I.onFpsDropLevelCapping=function(m,p){C.isLevelAllowed(p.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(p.droppedLevel)},I.onMediaAttaching=function(m,p){this.media=p.media instanceof HTMLVideoElement?p.media:null},I.onManifestParsed=function(m,p){var g=this.hls;this.restrictedLevels=[],this.firstLevel=p.firstLevel,g.config.capLevelToPlayerSize&&p.video&&this.startCapping()},I.onBufferCodecs=function(m,p){var g=this.hls;g.config.capLevelToPlayerSize&&p.video&&this.startCapping()},I.onMediaDetaching=function(){this.stopCapping()},I.detectPlayerSize=function(){if(this.media&&this.mediaHeight>0&&this.mediaWidth>0){var m=this.hls.levels;if(m.length){var p=this.hls;p.autoLevelCapping=this.getMaxLevel(m.length-1),p.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=p.autoLevelCapping}}},I.getMaxLevel=function(m){var p=this,g=this.hls.levels;if(!g.length)return-1;var D=g.filter(function(E,d){return C.isLevelAllowed(d,p.restrictedLevels)&&d<=m});return this.clientRect=null,C.getMaxLevelByMediaSize(D,this.mediaWidth,this.mediaHeight)},I.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},I.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)},I.getDimensions=function(){if(this.clientRect)return this.clientRect;var m=this.media,p={width:0,height:0};if(m){var g=m.getBoundingClientRect();p.width=g.width,p.height=g.height,!p.width&&!p.height&&(p.width=g.right-g.left||m.width||0,p.height=g.bottom-g.top||m.height||0)}return this.clientRect=p,p},C.isLevelAllowed=function(m,p){return p===void 0&&(p=[]),p.indexOf(m)===-1},C.getMaxLevelByMediaSize=function(m,p,g){if(!m||!m.length)return-1;for(var D=function(a,l){return l?a.width!==l.width||a.height!==l.height:!0},E=m.length-1,d=0;d<m.length;d+=1){var r=m[d];if((r.width>=p||r.height>=g)&&D(r,m[d+1])){E=d;break}}return E},O(C,[{key:"mediaWidth",get:function(){return this.getDimensions().width*this.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*this.contentScaleFactor}},{key:"contentScaleFactor",get:function(){var m=1;if(!this.hls.config.ignoreDevicePixelRatio)try{m=self.devicePixelRatio}catch{}return m}}]),C}();M.default=b},"./src/controller/cmcd-controller.ts":function(K,M,L){L.r(M),L.d(M,"default",function(){return D});var x=L("./src/events.ts"),R=L("./src/types/cmcd.ts"),O=L("./src/utils/buffer-helper.ts"),b=L("./src/utils/logger.ts");function C(E,d){for(var r=0;r<d.length;r++){var e=d[r];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(E,e.key,e)}}function I(E,d,r){return d&&C(E.prototype,d),r&&C(E,r),Object.defineProperty(E,"prototype",{writable:!1}),E}function T(E,d){var r=typeof Symbol<"u"&&E[Symbol.iterator]||E["@@iterator"];if(r)return(r=r.call(E)).next.bind(r);if(Array.isArray(E)||(r=m(E))||d&&E&&typeof E.length=="number"){r&&(E=r);var e=0;return function(){return e>=E.length?{done:!0}:{done:!1,value:E[e++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function m(E,d){if(!!E){if(typeof E=="string")return p(E,d);var r=Object.prototype.toString.call(E).slice(8,-1);if(r==="Object"&&E.constructor&&(r=E.constructor.name),r==="Map"||r==="Set")return Array.from(E);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return p(E,d)}}function p(E,d){(d==null||d>E.length)&&(d=E.length);for(var r=0,e=new Array(d);r<d;r++)e[r]=E[r];return e}function g(){return g=Object.assign?Object.assign.bind():function(E){for(var d=1;d<arguments.length;d++){var r=arguments[d];for(var e in r)Object.prototype.hasOwnProperty.call(r,e)&&(E[e]=r[e])}return E},g.apply(this,arguments)}var D=function(){function E(r){var e=this;this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=function(){e.initialized&&(e.starved=!0),e.buffering=!0},this.onPlaying=function(){e.initialized||(e.initialized=!0),e.buffering=!1},this.applyPlaylistData=function(h){try{e.apply(h,{ot:R.CMCDObjectType.MANIFEST,su:!e.initialized})}catch(n){b.logger.warn("Could not generate manifest CMCD data.",n)}},this.applyFragmentData=function(h){try{var n=h.frag,t=e.hls.levels[n.level],i=e.getObjectType(n),y={d:n.duration*1e3,ot:i};(i===R.CMCDObjectType.VIDEO||i===R.CMCDObjectType.AUDIO||i==R.CMCDObjectType.MUXED)&&(y.br=t.bitrate/1e3,y.tb=e.getTopBandwidth(i)/1e3,y.bl=e.getBufferLength(i)),e.apply(h,y)}catch(u){b.logger.warn("Could not generate segment CMCD data.",u)}},this.hls=r;var a=this.config=r.config,l=a.cmcd;l!=null&&(a.pLoader=this.createPlaylistLoader(),a.fLoader=this.createFragmentLoader(),this.sid=l.sessionId||E.uuid(),this.cid=l.contentId,this.useHeaders=l.useHeaders===!0,this.registerListeners())}var d=E.prototype;return d.registerListeners=function(){var e=this.hls;e.on(x.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(x.Events.MEDIA_DETACHED,this.onMediaDetached,this),e.on(x.Events.BUFFER_CREATED,this.onBufferCreated,this)},d.unregisterListeners=function(){var e=this.hls;e.off(x.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(x.Events.MEDIA_DETACHED,this.onMediaDetached,this),e.off(x.Events.BUFFER_CREATED,this.onBufferCreated,this),this.onMediaDetached()},d.destroy=function(){this.unregisterListeners(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null},d.onMediaAttached=function(e,a){this.media=a.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)},d.onMediaDetached=function(){!this.media||(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)},d.onBufferCreated=function(e,a){var l,h;this.audioBuffer=(l=a.tracks.audio)===null||l===void 0?void 0:l.buffer,this.videoBuffer=(h=a.tracks.video)===null||h===void 0?void 0:h.buffer},d.createData=function(){var e;return{v:R.CMCDVersion,sf:R.CMCDStreamingFormat.HLS,sid:this.sid,cid:this.cid,pr:(e=this.media)===null||e===void 0?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}},d.apply=function(e,a){a===void 0&&(a={}),g(a,this.createData());var l=a.ot===R.CMCDObjectType.INIT||a.ot===R.CMCDObjectType.VIDEO||a.ot===R.CMCDObjectType.MUXED;if(this.starved&&l&&(a.bs=!0,a.su=!0,this.starved=!1),a.su==null&&(a.su=this.buffering),this.useHeaders){var h=E.toHeaders(a);if(!Object.keys(h).length)return;e.headers||(e.headers={}),g(e.headers,h)}else{var n=E.toQuery(a);if(!n)return;e.url=E.appendQueryToUri(e.url,n)}},d.getObjectType=function(e){var a=e.type;if(a==="subtitle")return R.CMCDObjectType.TIMED_TEXT;if(e.sn==="initSegment")return R.CMCDObjectType.INIT;if(a==="audio")return R.CMCDObjectType.AUDIO;if(a==="main")return this.hls.audioTracks.length?R.CMCDObjectType.VIDEO:R.CMCDObjectType.MUXED},d.getTopBandwidth=function(e){var a=0,l,h=this.hls;if(e===R.CMCDObjectType.AUDIO)l=h.audioTracks;else{var n=h.maxAutoLevel,t=n>-1?n+1:h.levels.length;l=h.levels.slice(0,t)}for(var i=T(l),y;!(y=i()).done;){var u=y.value;u.bitrate>a&&(a=u.bitrate)}return a>0?a:NaN},d.getBufferLength=function(e){var a=this.hls.media,l=e===R.CMCDObjectType.AUDIO?this.audioBuffer:this.videoBuffer;if(!l||!a)return NaN;var h=O.BufferHelper.bufferInfo(l,a.currentTime,this.config.maxBufferHole);return h.len*1e3},d.createPlaylistLoader=function(){var e=this.config.pLoader,a=this.applyPlaylistData,l=e||this.config.loader;return function(){function h(t){this.loader=void 0,this.loader=new l(t)}var n=h.prototype;return n.destroy=function(){this.loader.destroy()},n.abort=function(){this.loader.abort()},n.load=function(i,y,u){a(i),this.loader.load(i,y,u)},I(h,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),h}()},d.createFragmentLoader=function(){var e=this.config.fLoader,a=this.applyFragmentData,l=e||this.config.loader;return function(){function h(t){this.loader=void 0,this.loader=new l(t)}var n=h.prototype;return n.destroy=function(){this.loader.destroy()},n.abort=function(){this.loader.abort()},n.load=function(i,y,u){a(i),this.loader.load(i,y,u)},I(h,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),h}()},E.uuid=function(){var e=URL.createObjectURL(new Blob),a=e.toString();return URL.revokeObjectURL(e),a.slice(a.lastIndexOf("/")+1)},E.serialize=function(e){for(var a=[],l=function(P){return!Number.isNaN(P)&&P!=null&&P!==""&&P!==!1},h=function(P){return Math.round(P)},n=function(P){return h(P/100)*100},t=function(P){return encodeURIComponent(P)},i={br:h,d:h,bl:n,dl:n,mtp:n,nor:t,rtp:n,tb:h},y=Object.keys(e||{}).sort(),u=T(y),f;!(f=u()).done;){var c=f.value,s=e[c];if(!!l(s)&&!(c==="v"&&s===1)&&!(c=="pr"&&s===1)){var o=i[c];o&&(s=o(s));var v=typeof s,S=void 0;c==="ot"||c==="sf"||c==="st"?S=c+"="+s:v==="boolean"?S=c:v==="number"?S=c+"="+s:S=c+"="+JSON.stringify(s),a.push(S)}}return a.join(",")},E.toHeaders=function(e){for(var a=Object.keys(e),l={},h=["Object","Request","Session","Status"],n=[{},{},{},{}],t={br:0,d:0,ot:0,tb:0,bl:1,dl:1,mtp:1,nor:1,nrr:1,su:1,cid:2,pr:2,sf:2,sid:2,st:2,v:2,bs:3,rtp:3},i=0,y=a;i<y.length;i++){var u=y[i],f=t[u]!=null?t[u]:1;n[f][u]=e[u]}for(var c=0;c<n.length;c++){var s=E.serialize(n[c]);s&&(l["CMCD-"+h[c]]=s)}return l},E.toQuery=function(e){return"CMCD="+encodeURIComponent(E.serialize(e))},E.appendQueryToUri=function(e,a){if(!a)return e;var l=e.includes("?")?"&":"?";return""+e+l+a},E}()},"./src/controller/eme-controller.ts":function(K,M,L){L.r(M);var x=L("./src/events.ts"),R=L("./src/errors.ts"),O=L("./src/utils/logger.ts"),b=L("./src/utils/mediakeys-helper.ts");function C(D,E){for(var d=0;d<E.length;d++){var r=E[d];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(D,r.key,r)}}function I(D,E,d){return E&&C(D.prototype,E),d&&C(D,d),Object.defineProperty(D,"prototype",{writable:!1}),D}var T=3,m=function(E,d,r){var e={audioCapabilities:[],videoCapabilities:[]};return E.forEach(function(a){e.audioCapabilities.push({contentType:'audio/mp4; codecs="'+a+'"',robustness:r.audioRobustness||""})}),d.forEach(function(a){e.videoCapabilities.push({contentType:'video/mp4; codecs="'+a+'"',robustness:r.videoRobustness||""})}),[e]},p=function(E,d,r,e){switch(E){case b.KeySystems.WIDEVINE:return m(d,r,e);default:throw new Error("Unknown key-system: "+E)}},g=function(){function D(d){this.hls=void 0,this._widevineLicenseUrl=void 0,this._licenseXhrSetup=void 0,this._licenseResponseCallback=void 0,this._emeEnabled=void 0,this._requestMediaKeySystemAccess=void 0,this._drmSystemOptions=void 0,this._config=void 0,this._mediaKeysList=[],this._media=null,this._hasSetMediaKeys=!1,this._requestLicenseFailureCount=0,this.mediaKeysPromise=null,this._onMediaEncrypted=this.onMediaEncrypted.bind(this),this.hls=d,this._config=d.config,this._widevineLicenseUrl=this._config.widevineLicenseUrl,this._licenseXhrSetup=this._config.licenseXhrSetup,this._licenseResponseCallback=this._config.licenseResponseCallback,this._emeEnabled=this._config.emeEnabled,this._requestMediaKeySystemAccess=this._config.requestMediaKeySystemAccessFunc,this._drmSystemOptions=this._config.drmSystemOptions,this._registerListeners()}var E=D.prototype;return E.destroy=function(){this._unregisterListeners(),this.hls=this._onMediaEncrypted=null,this._requestMediaKeySystemAccess=null},E._registerListeners=function(){this.hls.on(x.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(x.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(x.Events.MANIFEST_PARSED,this.onManifestParsed,this)},E._unregisterListeners=function(){this.hls.off(x.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(x.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(x.Events.MANIFEST_PARSED,this.onManifestParsed,this)},E.getLicenseServerUrl=function(r){switch(r){case b.KeySystems.WIDEVINE:if(!this._widevineLicenseUrl)break;return this._widevineLicenseUrl}throw new Error('no license server URL configured for key-system "'+r+'"')},E._attemptKeySystemAccess=function(r,e,a){var l=this,h=p(r,e,a,this._drmSystemOptions);O.logger.log("Requesting encrypted media key-system access");var n=this.requestMediaKeySystemAccess(r,h);this.mediaKeysPromise=n.then(function(t){return l._onMediaKeySystemAccessObtained(r,t)}),n.catch(function(t){O.logger.error('Failed to obtain key-system "'+r+'" access:',t)})},E._onMediaKeySystemAccessObtained=function(r,e){var a=this;O.logger.log('Access for key-system "'+r+'" obtained');var l={mediaKeysSessionInitialized:!1,mediaKeySystemAccess:e,mediaKeySystemDomain:r};this._mediaKeysList.push(l);var h=Promise.resolve().then(function(){return e.createMediaKeys()}).then(function(n){return l.mediaKeys=n,O.logger.log('Media-keys created for key-system "'+r+'"'),a._onMediaKeysCreated(),n});return h.catch(function(n){O.logger.error("Failed to create media-keys:",n)}),h},E._onMediaKeysCreated=function(){var r=this;this._mediaKeysList.forEach(function(e){e.mediaKeysSession||(e.mediaKeysSession=e.mediaKeys.createSession(),r._onNewMediaKeySession(e.mediaKeysSession))})},E._onNewMediaKeySession=function(r){var e=this;O.logger.log("New key-system session "+r.sessionId),r.addEventListener("message",function(a){e._onKeySessionMessage(r,a.message)},!1)},E._onKeySessionMessage=function(r,e){O.logger.log("Got EME message event, creating license request"),this._requestLicense(e,function(a){O.logger.log("Received license data (length: "+(a&&a.byteLength)+"), updating key-session"),r.update(a).catch(function(l){O.logger.warn("Updating key-session failed: "+l)})})},E.onMediaEncrypted=function(r){var e=this;if(O.logger.log('Media is encrypted using "'+r.initDataType+'" init data type'),!this.mediaKeysPromise){O.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been requested"),this.hls.trigger(x.Events.ERROR,{type:R.ErrorTypes.KEY_SYSTEM_ERROR,details:R.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});return}var a=function(h){!e._media||(e._attemptSetMediaKeys(h),e._generateRequestWithPreferredKeySession(r.initDataType,r.initData))};this.mediaKeysPromise.then(a).catch(a)},E._attemptSetMediaKeys=function(r){if(!this._media)throw new Error("Attempted to set mediaKeys without first attaching a media element");if(!this._hasSetMediaKeys){var e=this._mediaKeysList[0];if(!e||!e.mediaKeys){O.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been obtained yet"),this.hls.trigger(x.Events.ERROR,{type:R.ErrorTypes.KEY_SYSTEM_ERROR,details:R.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});return}O.logger.log("Setting keys for encrypted media"),this._media.setMediaKeys(e.mediaKeys),this._hasSetMediaKeys=!0}},E._generateRequestWithPreferredKeySession=function(r,e){var a=this,l=this._mediaKeysList[0];if(!l){O.logger.error("Fatal: Media is encrypted but not any key-system access has been obtained yet"),this.hls.trigger(x.Events.ERROR,{type:R.ErrorTypes.KEY_SYSTEM_ERROR,details:R.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});return}if(l.mediaKeysSessionInitialized){O.logger.warn("Key-Session already initialized but requested again");return}var h=l.mediaKeysSession;if(!h){O.logger.error("Fatal: Media is encrypted but no key-session existing"),this.hls.trigger(x.Events.ERROR,{type:R.ErrorTypes.KEY_SYSTEM_ERROR,details:R.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!0});return}if(!e){O.logger.warn("Fatal: initData required for generating a key session is null"),this.hls.trigger(x.Events.ERROR,{type:R.ErrorTypes.KEY_SYSTEM_ERROR,details:R.ErrorDetails.KEY_SYSTEM_NO_INIT_DATA,fatal:!0});return}O.logger.log('Generating key-session request for "'+r+'" init data type'),l.mediaKeysSessionInitialized=!0,h.generateRequest(r,e).then(function(){O.logger.debug("Key-session generation succeeded")}).catch(function(n){O.logger.error("Error generating key-session request:",n),a.hls.trigger(x.Events.ERROR,{type:R.ErrorTypes.KEY_SYSTEM_ERROR,details:R.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!1})})},E._createLicenseXhr=function(r,e,a){var l=new XMLHttpRequest;l.responseType="arraybuffer",l.onreadystatechange=this._onLicenseRequestReadyStageChange.bind(this,l,r,e,a);var h=this._licenseXhrSetup;if(h)try{h.call(this.hls,l,r),h=void 0}catch(n){O.logger.error(n)}try{l.readyState||l.open("POST",r,!0),h&&h.call(this.hls,l,r)}catch(n){throw new Error("issue setting up KeySystem license XHR "+n)}return l},E._onLicenseRequestReadyStageChange=function(r,e,a,l){switch(r.readyState){case 4:if(r.status===200){this._requestLicenseFailureCount=0,O.logger.log("License request succeeded");var h=r.response,n=this._licenseResponseCallback;if(n)try{h=n.call(this.hls,r,e)}catch(i){O.logger.error(i)}l(h)}else{if(O.logger.error("License Request XHR failed ("+e+"). Status: "+r.status+" ("+r.statusText+")"),this._requestLicenseFailureCount++,this._requestLicenseFailureCount>T){this.hls.trigger(x.Events.ERROR,{type:R.ErrorTypes.KEY_SYSTEM_ERROR,details:R.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0});return}var t=T-this._requestLicenseFailureCount+1;O.logger.warn("Retrying license request, "+t+" attempts left"),this._requestLicense(a,l)}break}},E._generateLicenseRequestChallenge=function(r,e){switch(r.mediaKeySystemDomain){case b.KeySystems.WIDEVINE:return e}throw new Error("unsupported key-system: "+r.mediaKeySystemDomain)},E._requestLicense=function(r,e){O.logger.log("Requesting content license for key-system");var a=this._mediaKeysList[0];if(!a){O.logger.error("Fatal error: Media is encrypted but no key-system access has been obtained yet"),this.hls.trigger(x.Events.ERROR,{type:R.ErrorTypes.KEY_SYSTEM_ERROR,details:R.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});return}try{var l=this.getLicenseServerUrl(a.mediaKeySystemDomain),h=this._createLicenseXhr(l,r,e);O.logger.log("Sending license request to URL: "+l);var n=this._generateLicenseRequestChallenge(a,r);h.send(n)}catch(t){O.logger.error("Failure requesting DRM license: "+t),this.hls.trigger(x.Events.ERROR,{type:R.ErrorTypes.KEY_SYSTEM_ERROR,details:R.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}},E.onMediaAttached=function(r,e){if(!!this._emeEnabled){var a=e.media;this._media=a,a.addEventListener("encrypted",this._onMediaEncrypted)}},E.onMediaDetached=function(){var r=this._media,e=this._mediaKeysList;!r||(r.removeEventListener("encrypted",this._onMediaEncrypted),this._media=null,this._mediaKeysList=[],Promise.all(e.map(function(a){if(a.mediaKeysSession)return a.mediaKeysSession.close().catch(function(){})})).then(function(){return r.setMediaKeys(null)}).catch(function(){}))},E.onManifestParsed=function(r,e){if(!!this._emeEnabled){var a=e.levels.map(function(h){return h.audioCodec}).filter(function(h){return!!h}),l=e.levels.map(function(h){return h.videoCodec}).filter(function(h){return!!h});this._attemptKeySystemAccess(b.KeySystems.WIDEVINE,a,l)}},I(D,[{key:"requestMediaKeySystemAccess",get:function(){if(!this._requestMediaKeySystemAccess)throw new Error("No requestMediaKeySystemAccess function configured");return this._requestMediaKeySystemAccess}}]),D}();M.default=g},"./src/controller/fps-controller.ts":function(K,M,L){L.r(M);var x=L("./src/events.ts"),R=L("./src/utils/logger.ts"),O=function(){function b(I){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=I,this.registerListeners()}var C=b.prototype;return C.setStreamController=function(T){this.streamController=T},C.registerListeners=function(){this.hls.on(x.Events.MEDIA_ATTACHING,this.onMediaAttaching,this)},C.unregisterListeners=function(){this.hls.off(x.Events.MEDIA_ATTACHING,this.onMediaAttaching)},C.destroy=function(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null},C.onMediaAttaching=function(T,m){var p=this.hls.config;if(p.capLevelOnFPSDrop){var g=m.media instanceof self.HTMLVideoElement?m.media:null;this.media=g,g&&typeof g.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),p.fpsDroppedMonitoringPeriod)}},C.checkFPS=function(T,m,p){var g=performance.now();if(m){if(this.lastTime){var D=g-this.lastTime,E=p-this.lastDroppedFrames,d=m-this.lastDecodedFrames,r=1e3*E/D,e=this.hls;if(e.trigger(x.Events.FPS_DROP,{currentDropped:E,currentDecoded:d,totalDroppedFrames:p}),r>0&&E>e.config.fpsDroppedMonitoringThreshold*d){var a=e.currentLevel;R.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+a),a>0&&(e.autoLevelCapping===-1||e.autoLevelCapping>=a)&&(a=a-1,e.trigger(x.Events.FPS_DROP_LEVEL_CAPPING,{level:a,droppedLevel:e.currentLevel}),e.autoLevelCapping=a,this.streamController.nextLevelSwitch())}}this.lastTime=g,this.lastDroppedFrames=p,this.lastDecodedFrames=m}},C.checkFPSInterval=function(){var T=this.media;if(T)if(this.isVideoPlaybackQualityAvailable){var m=T.getVideoPlaybackQuality();this.checkFPS(T,m.totalVideoFrames,m.droppedVideoFrames)}else this.checkFPS(T,T.webkitDecodedFrameCount,T.webkitDroppedFrameCount)},b}();M.default=O},"./src/controller/fragment-finders.ts":function(K,M,L){L.r(M),L.d(M,"findFragmentByPDT",function(){return O}),L.d(M,"findFragmentByPTS",function(){return b}),L.d(M,"fragmentWithinToleranceTest",function(){return C}),L.d(M,"pdtWithinToleranceTest",function(){return I}),L.d(M,"findFragWithCC",function(){return T});var x=L("./src/polyfills/number.ts"),R=L("./src/utils/binary-search.ts");function O(m,p,g){if(p===null||!Array.isArray(m)||!m.length||!Object(x.isFiniteNumber)(p))return null;var D=m[0].programDateTime;if(p<(D||0))return null;var E=m[m.length-1].endProgramDateTime;if(p>=(E||0))return null;g=g||0;for(var d=0;d<m.length;++d){var r=m[d];if(I(p,g,r))return r}return null}function b(m,p,g,D){g===void 0&&(g=0),D===void 0&&(D=0);var E=null;if(m?E=p[m.sn-p[0].sn+1]||null:g===0&&p[0].start===0&&(E=p[0]),E&&C(g,D,E)===0)return E;var d=R.default.search(p,C.bind(null,g,D));return d||E}function C(m,p,g){m===void 0&&(m=0),p===void 0&&(p=0);var D=Math.min(p,g.duration+(g.deltaPTS?g.deltaPTS:0));return g.start+g.duration-D<=m?1:g.start-D>m&&g.start?-1:0}function I(m,p,g){var D=Math.min(p,g.duration+(g.deltaPTS?g.deltaPTS:0))*1e3,E=g.endProgramDateTime||0;return E-D>m}function T(m,p){return R.default.search(m,function(g){return g.cc<p?1:g.cc>p?-1:0})}},"./src/controller/fragment-tracker.ts":function(K,M,L){L.r(M),L.d(M,"FragmentState",function(){return O}),L.d(M,"FragmentTracker",function(){return b});var x=L("./src/events.ts"),R=L("./src/types/loader.ts"),O;(function(T){T.NOT_LOADED="NOT_LOADED",T.APPENDING="APPENDING",T.PARTIAL="PARTIAL",T.OK="OK"})(O||(O={}));var b=function(){function T(p){this.activeFragment=null,this.activeParts=null,this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hls=p,this._registerListeners()}var m=T.prototype;return m._registerListeners=function(){var g=this.hls;g.on(x.Events.BUFFER_APPENDED,this.onBufferAppended,this),g.on(x.Events.FRAG_BUFFERED,this.onFragBuffered,this),g.on(x.Events.FRAG_LOADED,this.onFragLoaded,this)},m._unregisterListeners=function(){var g=this.hls;g.off(x.Events.BUFFER_APPENDED,this.onBufferAppended,this),g.off(x.Events.FRAG_BUFFERED,this.onFragBuffered,this),g.off(x.Events.FRAG_LOADED,this.onFragLoaded,this)},m.destroy=function(){this._unregisterListeners(),this.fragments=this.timeRanges=null},m.getAppendedFrag=function(g,D){if(D===R.PlaylistLevelType.MAIN){var E=this.activeFragment,d=this.activeParts;if(!E)return null;if(d)for(var r=d.length;r--;){var e=d[r],a=e?e.end:E.appendedPTS;if(e.start<=g&&a!==void 0&&g<=a)return r>9&&(this.activeParts=d.slice(r-9)),e}else if(E.start<=g&&E.appendedPTS!==void 0&&g<=E.appendedPTS)return E}return this.getBufferedFrag(g,D)},m.getBufferedFrag=function(g,D){for(var E=this.fragments,d=Object.keys(E),r=d.length;r--;){var e=E[d[r]];if((e==null?void 0:e.body.type)===D&&e.buffered){var a=e.body;if(a.start<=g&&g<=a.end)return a}}return null},m.detectEvictedFragments=function(g,D,E){var d=this;Object.keys(this.fragments).forEach(function(r){var e=d.fragments[r];if(!!e){if(!e.buffered){e.body.type===E&&d.removeFragment(e.body);return}var a=e.range[g];!a||a.time.some(function(l){var h=!d.isTimeBuffered(l.startPTS,l.endPTS,D);return h&&d.removeFragment(e.body),h})}})},m.detectPartialFragments=function(g){var D=this,E=this.timeRanges,d=g.frag,r=g.part;if(!(!E||d.sn==="initSegment")){var e=I(d),a=this.fragments[e];!a||(Object.keys(E).forEach(function(l){var h=d.elementaryStreams[l];if(!!h){var n=E[l],t=r!==null||h.partial===!0;a.range[l]=D.getBufferedTimes(d,r,t,n)}}),a.loaded=null,Object.keys(a.range).length?a.buffered=!0:this.removeFragment(a.body))}},m.fragBuffered=function(g){var D=I(g),E=this.fragments[D];E&&(E.loaded=null,E.buffered=!0)},m.getBufferedTimes=function(g,D,E,d){for(var r={time:[],partial:E},e=D?D.start:g.start,a=D?D.end:g.end,l=g.minEndPTS||a,h=g.maxStartPTS||e,n=0;n<d.length;n++){var t=d.start(n)-this.bufferPadding,i=d.end(n)+this.bufferPadding;if(h>=t&&l<=i){r.time.push({startPTS:Math.max(e,d.start(n)),endPTS:Math.min(a,d.end(n))});break}else if(e<i&&a>t)r.partial=!0,r.time.push({startPTS:Math.max(e,d.start(n)),endPTS:Math.min(a,d.end(n))});else if(a<=t)break}return r},m.getPartialFragment=function(g){var D=null,E,d,r,e=0,a=this.bufferPadding,l=this.fragments;return Object.keys(l).forEach(function(h){var n=l[h];!n||C(n)&&(d=n.body.start-a,r=n.body.end+a,g>=d&&g<=r&&(E=Math.min(g-d,r-g),e<=E&&(D=n.body,e=E)))}),D},m.getState=function(g){var D=I(g),E=this.fragments[D];return E?E.buffered?C(E)?O.PARTIAL:O.OK:O.APPENDING:O.NOT_LOADED},m.isTimeBuffered=function(g,D,E){for(var d,r,e=0;e<E.length;e++){if(d=E.start(e)-this.bufferPadding,r=E.end(e)+this.bufferPadding,g>=d&&D<=r)return!0;if(D<=d)return!1}return!1},m.onFragLoaded=function(g,D){var E=D.frag,d=D.part;if(!(E.sn==="initSegment"||E.bitrateTest||d)){var r=I(E);this.fragments[r]={body:E,loaded:D,buffered:!1,range:Object.create(null)}}},m.onBufferAppended=function(g,D){var E=this,d=D.frag,r=D.part,e=D.timeRanges;if(d.type===R.PlaylistLevelType.MAIN)if(this.activeFragment=d,r){var a=this.activeParts;a||(this.activeParts=a=[]),a.push(r)}else this.activeParts=null;this.timeRanges=e,Object.keys(e).forEach(function(l){var h=e[l];if(E.detectEvictedFragments(l,h),!r)for(var n=0;n<h.length;n++)d.appendedPTS=Math.max(h.end(n),d.appendedPTS||0)})},m.onFragBuffered=function(g,D){this.detectPartialFragments(D)},m.hasFragment=function(g){var D=I(g);return!!this.fragments[D]},m.removeFragmentsInRange=function(g,D,E){var d=this;Object.keys(this.fragments).forEach(function(r){var e=d.fragments[r];if(!!e&&e.buffered){var a=e.body;a.type===E&&a.start<D&&a.end>g&&d.removeFragment(a)}})},m.removeFragment=function(g){var D=I(g);g.stats.loaded=0,g.clearElementaryStreamInfo(),delete this.fragments[D]},m.removeAllFragments=function(){this.fragments=Object.create(null),this.activeFragment=null,this.activeParts=null},T}();function C(T){var m,p;return T.buffered&&(((m=T.range.video)===null||m===void 0?void 0:m.partial)||((p=T.range.audio)===null||p===void 0?void 0:p.partial))}function I(T){return T.type+"_"+T.level+"_"+T.urlId+"_"+T.sn}},"./src/controller/gap-controller.ts":function(K,M,L){L.r(M),L.d(M,"STALL_MINIMUM_DURATION_MS",function(){return C}),L.d(M,"MAX_START_GAP_JUMP",function(){return I}),L.d(M,"SKIP_BUFFER_HOLE_STEP_SECONDS",function(){return T}),L.d(M,"SKIP_BUFFER_RANGE_START",function(){return m}),L.d(M,"default",function(){return p});var x=L("./src/utils/buffer-helper.ts"),R=L("./src/errors.ts"),O=L("./src/events.ts"),b=L("./src/utils/logger.ts"),C=250,I=2,T=.1,m=.05,p=function(){function g(E,d,r,e){this.config=void 0,this.media=null,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=E,this.media=d,this.fragmentTracker=r,this.hls=e}var D=g.prototype;return D.destroy=function(){this.media=null,this.hls=this.fragmentTracker=null},D.poll=function(d,r){var e=this.config,a=this.media,l=this.stalled;if(a!==null){var h=a.currentTime,n=a.seeking,t=this.seeking&&!n,i=!this.seeking&&n;if(this.seeking=n,h!==d){if(this.moved=!0,l!==null){if(this.stallReported){var y=self.performance.now()-l;b.logger.warn("playback not stuck anymore @"+h+", after "+Math.round(y)+"ms"),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}return}if((i||t)&&(this.stalled=null),!(a.paused&&!n||a.ended||a.playbackRate===0||!x.BufferHelper.getBuffered(a).length)){var u=x.BufferHelper.bufferInfo(a,h,0),f=u.len>0,c=u.nextStart||0;if(!(!f&&!c)){if(n){var s=u.len>I,o=!c||r&&r.start<=h||c-h>I&&!this.fragmentTracker.getPartialFragment(h);if(s||o)return;this.moved=!1}if(!this.moved&&this.stalled!==null){var v,S=Math.max(c,u.start||0)-h,A=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,P=A==null||(v=A.details)===null||v===void 0?void 0:v.live,_=P?A.details.targetduration*2:I;if(S>0&&S<=_){this._trySkipBufferHole(null);return}}var F=self.performance.now();if(l===null){this.stalled=F;return}var k=F-l;if(!(!n&&k>=C&&(this._reportStall(u),!this.media))){var B=x.BufferHelper.bufferInfo(a,h,e.maxBufferHole);this._tryFixBufferStall(B,k)}}}}},D._tryFixBufferStall=function(d,r){var e=this.config,a=this.fragmentTracker,l=this.media;if(l!==null){var h=l.currentTime,n=a.getPartialFragment(h);if(n){var t=this._trySkipBufferHole(n);if(t||!this.media)return}d.len>e.maxBufferHole&&r>e.highBufferWatchdogPeriod*1e3&&(b.logger.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())}},D._reportStall=function(d){var r=this.hls,e=this.media,a=this.stallReported;!a&&e&&(this.stallReported=!0,b.logger.warn("Playback stalling at @"+e.currentTime+" due to low buffer ("+JSON.stringify(d)+")"),r.trigger(O.Events.ERROR,{type:R.ErrorTypes.MEDIA_ERROR,details:R.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:d.len}))},D._trySkipBufferHole=function(d){var r=this.config,e=this.hls,a=this.media;if(a===null)return 0;for(var l=a.currentTime,h=0,n=x.BufferHelper.getBuffered(a),t=0;t<n.length;t++){var i=n.start(t);if(l+r.maxBufferHole>=h&&l<i){var y=Math.max(i+m,a.currentTime+T);return b.logger.warn("skipping hole, adjusting currentTime from "+l+" to "+y),this.moved=!0,this.stalled=null,a.currentTime=y,d&&e.trigger(O.Events.ERROR,{type:R.ErrorTypes.MEDIA_ERROR,details:R.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+l+" to "+y,frag:d}),y}h=n.end(t)}return 0},D._tryNudgeBuffer=function(){var d=this.config,r=this.hls,e=this.media,a=this.nudgeRetry;if(e!==null){var l=e.currentTime;if(this.nudgeRetry++,a<d.nudgeMaxRetry){var h=l+(a+1)*d.nudgeOffset;b.logger.warn("Nudging 'currentTime' from "+l+" to "+h),e.currentTime=h,r.trigger(O.Events.ERROR,{type:R.ErrorTypes.MEDIA_ERROR,details:R.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})}else b.logger.error("Playhead still not moving while enough data buffered @"+l+" after "+d.nudgeMaxRetry+" nudges"),r.trigger(O.Events.ERROR,{type:R.ErrorTypes.MEDIA_ERROR,details:R.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})}},g}()},"./src/controller/id3-track-controller.ts":function(K,M,L){L.r(M);var x=L("./src/polyfills/number.ts"),R=L("./src/events.ts"),O=L("./src/utils/texttrack-utils.ts"),b=L("./src/demux/id3.ts"),C=L("./src/loader/date-range.ts"),I=L("./src/types/demuxer.ts"),T=.25;function m(){return self.WebKitDataCue||self.VTTCue||self.TextTrackCue}function p(E,d){return E.getTime()/1e3-d}function g(E){return Uint8Array.from(E.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}var D=function(){function E(r){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=r,this._registerListeners()}var d=E.prototype;return d.destroy=function(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=null},d._registerListeners=function(){var e=this.hls;e.on(R.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(R.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(R.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(R.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(R.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(R.Events.LEVEL_UPDATED,this.onLevelUpdated,this)},d._unregisterListeners=function(){var e=this.hls;e.off(R.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(R.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(R.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(R.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(R.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(R.Events.LEVEL_UPDATED,this.onLevelUpdated,this)},d.onMediaAttached=function(e,a){this.media=a.media},d.onMediaDetaching=function(){!this.id3Track||(Object(O.clearCurrentCues)(this.id3Track),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={})},d.onManifestLoading=function(){this.dateRangeCuesAppended={}},d.createTrack=function(e){var a=this.getID3Track(e.textTracks);return a.mode="hidden",a},d.getID3Track=function(e){if(!!this.media){for(var a=0;a<e.length;a++){var l=e[a];if(l.kind==="metadata"&&l.label==="id3")return Object(O.sendAddTrackEvent)(l,this.media),l}return this.media.addTextTrack("metadata","id3")}},d.onFragParsingMetadata=function(e,a){if(!!this.media){var l=this.hls.config,h=l.enableEmsgMetadataCues,n=l.enableID3MetadataCues;if(!(!h&&!n)){var t=a.frag,i=a.samples,y=a.details;this.id3Track||(this.id3Track=this.createTrack(this.media));for(var u=y.edge||t.end,f=m(),c=!1,s={},o=0;o<i.length;o++){var v=i[o].type;if(!(v===I.MetadataSchema.emsg&&!h||!n)){var S=b.getID3Frames(i[o].data);if(S){var A=i[o].pts,P=u,_=P-A;_<=0&&(P=A+T);for(var F=0;F<S.length;F++){var k=S[F];if(!b.isTimeStampFrame(k)){var B=new f(A,P,"");B.value=k,v&&(B.type=v),this.id3Track.addCue(B),s[k.key]=null,c=!0}}}}}c&&this.updateId3CueEnds(s)}}},d.updateId3CueEnds=function(e){var a,l=(a=this.id3Track)===null||a===void 0?void 0:a.cues;if(l)for(var h=l.length;h--;){var n,t=l[h],i=(n=t.value)===null||n===void 0?void 0:n.key;if(i&&i in e){var y=e[i];y&&t.endTime!==y&&(t.endTime=y),e[i]=t.startTime}}},d.onBufferFlushing=function(e,a){var l=a.startOffset,h=a.endOffset,n=a.type,t=this.id3Track,i=this.hls;if(!!i){var y=i.config,u=y.enableEmsgMetadataCues,f=y.enableID3MetadataCues;if(t&&(u||f)){var c;n==="audio"?c=function(o){return o.type===I.MetadataSchema.audioId3&&f}:n==="video"?c=function(o){return o.type===I.MetadataSchema.emsg&&u}:c=function(o){return o.type===I.MetadataSchema.audioId3&&f||o.type===I.MetadataSchema.emsg&&u},Object(O.removeCuesInRange)(t,l,h,c)}}},d.onLevelUpdated=function(e,a){var l=this,h=a.details;if(!(!this.media||!h.hasProgramDateTime||!this.hls.config.enableDateRangeMetadataCues)){var n=this.dateRangeCuesAppended,t=this.id3Track,i=h.dateRanges,y=Object.keys(i);if(t)for(var u=Object.keys(n).filter(function(_){return!y.includes(_)}),f=function(F){var k=u[F];Object.keys(n[k].cues).forEach(function(B){t.removeCue(n[k].cues[B])}),delete n[k]},c=u.length;c--;)f(c);var s=h.fragments[h.fragments.length-1];if(!(y.length===0||!Object(x.isFiniteNumber)(s==null?void 0:s.programDateTime))){this.id3Track||(this.id3Track=this.createTrack(this.media));for(var o=s.programDateTime/1e3-s.start,v=h.edge||s.end,S=m(),A=function(F){var k=y[F],B=i[k],w=n[k],U=(w==null?void 0:w.cues)||{},N=(w==null?void 0:w.durationKnown)||!1,W=p(B.startDate,o),j=v,H=B.endDate;if(H)j=p(H,o),N=!0;else if(B.endOnNext&&!N){var G=y.reduce(function(X,Q){var J=i[Q];return J.class===B.class&&J.id!==Q&&J.startDate>B.startDate&&X.push(J),X},[]).sort(function(X,Q){return X.startDate.getTime()-Q.startDate.getTime()})[0];G&&(j=p(G.startDate,o),N=!0)}for(var z=Object.keys(B.attr),Z=0;Z<z.length;Z++){var Y=z[Z];if(!(Y===C.DateRangeAttribute.ID||Y===C.DateRangeAttribute.CLASS||Y===C.DateRangeAttribute.START_DATE||Y===C.DateRangeAttribute.DURATION||Y===C.DateRangeAttribute.END_DATE||Y===C.DateRangeAttribute.END_ON_NEXT)){var V=U[Y];if(V)N&&!w.durationKnown&&(V.endTime=j);else{var $=B.attr[Y];V=new S(W,j,""),(Y===C.DateRangeAttribute.SCTE35_OUT||Y===C.DateRangeAttribute.SCTE35_IN)&&($=g($)),V.value={key:Y,data:$},V.type=I.MetadataSchema.dateRange,l.id3Track.addCue(V),U[Y]=V}}}n[k]={cues:U,dateRange:B,durationKnown:N}},P=0;P<y.length;P++)A(P)}}},E}();M.default=D},"./src/controller/latency-controller.ts":function(K,M,L){L.r(M),L.d(M,"default",function(){return I});var x=L("./src/errors.ts"),R=L("./src/events.ts"),O=L("./src/utils/logger.ts");function b(T,m){for(var p=0;p<m.length;p++){var g=m[p];g.enumerable=g.enumerable||!1,g.configurable=!0,"value"in g&&(g.writable=!0),Object.defineProperty(T,g.key,g)}}function C(T,m,p){return m&&b(T.prototype,m),p&&b(T,p),Object.defineProperty(T,"prototype",{writable:!1}),T}var I=function(){function T(p){var g=this;this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=function(){return g.timeupdate()},this.hls=p,this.config=p.config,this.registerListeners()}var m=T.prototype;return m.destroy=function(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null},m.registerListeners=function(){this.hls.on(R.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(R.Events.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(R.Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(R.Events.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(R.Events.ERROR,this.onError,this)},m.unregisterListeners=function(){this.hls.off(R.Events.MEDIA_ATTACHED,this.onMediaAttached),this.hls.off(R.Events.MEDIA_DETACHING,this.onMediaDetaching),this.hls.off(R.Events.MANIFEST_LOADING,this.onManifestLoading),this.hls.off(R.Events.LEVEL_UPDATED,this.onLevelUpdated),this.hls.off(R.Events.ERROR,this.onError)},m.onMediaAttached=function(g,D){this.media=D.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)},m.onMediaDetaching=function(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)},m.onManifestLoading=function(){this.levelDetails=null,this._latency=null,this.stallCount=0},m.onLevelUpdated=function(g,D){var E=D.details;this.levelDetails=E,E.advanced&&this.timeupdate(),!E.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)},m.onError=function(g,D){D.details===x.ErrorDetails.BUFFER_STALLED_ERROR&&(this.stallCount++,O.logger.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))},m.timeupdate=function(){var g=this.media,D=this.levelDetails;if(!(!g||!D)){this.currentTime=g.currentTime;var E=this.computeLatency();if(E!==null){this._latency=E;var d=this.config,r=d.lowLatencyMode,e=d.maxLiveSyncPlaybackRate;if(!(!r||e===1)){var a=this.targetLatency;if(a!==null){var l=E-a,h=Math.min(this.maxLatency,a+D.targetduration),n=l<h;if(D.live&&n&&l>.05&&this.forwardBufferLength>1){var t=Math.min(2,Math.max(1,e)),i=Math.round(2/(1+Math.exp(-.75*l-this.edgeStalled))*20)/20;g.playbackRate=Math.min(t,Math.max(1,i))}else g.playbackRate!==1&&g.playbackRate!==0&&(g.playbackRate=1)}}}}},m.estimateLiveEdge=function(){var g=this.levelDetails;return g===null?null:g.edge+g.age},m.computeLatency=function(){var g=this.estimateLiveEdge();return g===null?null:g-this.currentTime},C(T,[{key:"latency",get:function(){return this._latency||0}},{key:"maxLatency",get:function(){var g=this.config,D=this.levelDetails;return g.liveMaxLatencyDuration!==void 0?g.liveMaxLatencyDuration:D?g.liveMaxLatencyDurationCount*D.targetduration:0}},{key:"targetLatency",get:function(){var g=this.levelDetails;if(g===null)return null;var D=g.holdBack,E=g.partHoldBack,d=g.targetduration,r=this.config,e=r.liveSyncDuration,a=r.liveSyncDurationCount,l=r.lowLatencyMode,h=this.hls.userConfig,n=l&&E||D;(h.liveSyncDuration||h.liveSyncDurationCount||n===0)&&(n=e!==void 0?e:a*d);var t=d,i=1;return n+Math.min(this.stallCount*i,t)}},{key:"liveSyncPosition",get:function(){var g=this.estimateLiveEdge(),D=this.targetLatency,E=this.levelDetails;if(g===null||D===null||E===null)return null;var d=E.edge,r=g-D-this.edgeStalled,e=d-E.totalduration,a=d-(this.config.lowLatencyMode&&E.partTarget||E.targetduration);return Math.min(Math.max(e,r),a)}},{key:"drift",get:function(){var g=this.levelDetails;return g===null?1:g.drift}},{key:"edgeStalled",get:function(){var g=this.levelDetails;if(g===null)return 0;var D=(this.config.lowLatencyMode&&g.partTarget||g.targetduration)*3;return Math.max(g.age-D,0)}},{key:"forwardBufferLength",get:function(){var g=this.media,D=this.levelDetails;if(!g||!D)return 0;var E=g.buffered.length;return(E?g.buffered.end(E-1):D.edge)-this.currentTime}}]),T}()},"./src/controller/level-controller.ts":function(K,M,L){L.r(M),L.d(M,"default",function(){return r});var x=L("./src/types/level.ts"),R=L("./src/events.ts"),O=L("./src/errors.ts"),b=L("./src/utils/codecs.ts"),C=L("./src/controller/level-helper.ts"),I=L("./src/controller/base-playlist-controller.ts"),T=L("./src/types/loader.ts");function m(){return m=Object.assign?Object.assign.bind():function(e){for(var a=1;a<arguments.length;a++){var l=arguments[a];for(var h in l)Object.prototype.hasOwnProperty.call(l,h)&&(e[h]=l[h])}return e},m.apply(this,arguments)}function p(e,a){for(var l=0;l<a.length;l++){var h=a[l];h.enumerable=h.enumerable||!1,h.configurable=!0,"value"in h&&(h.writable=!0),Object.defineProperty(e,h.key,h)}}function g(e,a,l){return a&&p(e.prototype,a),l&&p(e,l),Object.defineProperty(e,"prototype",{writable:!1}),e}function D(e,a){e.prototype=Object.create(a.prototype),e.prototype.constructor=e,E(e,a)}function E(e,a){return E=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(h,n){return h.__proto__=n,h},E(e,a)}var d=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),r=function(e){D(a,e);function a(h){var n;return n=e.call(this,h,"[level-controller]")||this,n._levels=[],n._firstLevel=-1,n._startLevel=void 0,n.currentLevelIndex=-1,n.manualLevelIndex=-1,n.onParsedComplete=void 0,n._registerListeners(),n}var l=a.prototype;return l._registerListeners=function(){var n=this.hls;n.on(R.Events.MANIFEST_LOADED,this.onManifestLoaded,this),n.on(R.Events.LEVEL_LOADED,this.onLevelLoaded,this),n.on(R.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),n.on(R.Events.FRAG_LOADED,this.onFragLoaded,this),n.on(R.Events.ERROR,this.onError,this)},l._unregisterListeners=function(){var n=this.hls;n.off(R.Events.MANIFEST_LOADED,this.onManifestLoaded,this),n.off(R.Events.LEVEL_LOADED,this.onLevelLoaded,this),n.off(R.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),n.off(R.Events.FRAG_LOADED,this.onFragLoaded,this),n.off(R.Events.ERROR,this.onError,this)},l.destroy=function(){this._unregisterListeners(),this.manualLevelIndex=-1,this._levels.length=0,e.prototype.destroy.call(this)},l.startLoad=function(){var n=this._levels;n.forEach(function(t){t.loadError=0}),e.prototype.startLoad.call(this)},l.onManifestLoaded=function(n,t){var i=[],y=[],u=[],f,c={},s,o=!1,v=!1,S=!1;if(t.levels.forEach(function(F){var k=F.attrs;o=o||!!(F.width&&F.height),v=v||!!F.videoCodec,S=S||!!F.audioCodec,d&&F.audioCodec&&F.audioCodec.indexOf("mp4a.40.34")!==-1&&(F.audioCodec=void 0);var B=F.bitrate+"-"+F.attrs.RESOLUTION+"-"+F.attrs.CODECS;s=c[B],s?s.url.push(F.url):(s=new x.Level(F),c[B]=s,i.push(s)),k&&(k.AUDIO&&Object(C.addGroupId)(s,"audio",k.AUDIO),k.SUBTITLES&&Object(C.addGroupId)(s,"text",k.SUBTITLES))}),(o||v)&&S&&(i=i.filter(function(F){var k=F.videoCodec,B=F.width,w=F.height;return!!k||!!(B&&w)})),i=i.filter(function(F){var k=F.audioCodec,B=F.videoCodec;return(!k||Object(b.isCodecSupportedInMp4)(k,"audio"))&&(!B||Object(b.isCodecSupportedInMp4)(B,"video"))}),t.audioTracks&&(y=t.audioTracks.filter(function(F){return!F.audioCodec||Object(b.isCodecSupportedInMp4)(F.audioCodec,"audio")}),Object(C.assignTrackIdsByGroup)(y)),t.subtitles&&(u=t.subtitles,Object(C.assignTrackIdsByGroup)(u)),i.length>0){f=i[0].bitrate,i.sort(function(F,k){return F.bitrate-k.bitrate}),this._levels=i;for(var A=0;A<i.length;A++)if(i[A].bitrate===f){this._firstLevel=A,this.log("manifest loaded, "+i.length+" level(s) found, first bitrate: "+f);break}var P=S&&!v,_={levels:i,audioTracks:y,subtitleTracks:u,firstLevel:this._firstLevel,stats:t.stats,audio:S,video:v,altAudio:!P&&y.some(function(F){return!!F.url})};this.hls.trigger(R.Events.MANIFEST_PARSED,_),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}else this.hls.trigger(R.Events.ERROR,{type:O.ErrorTypes.MEDIA_ERROR,details:O.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,reason:"no level with compatible codecs found in manifest"})},l.onError=function(n,t){if(e.prototype.onError.call(this,n,t),!t.fatal){var i=t.context,y=this._levels[this.currentLevelIndex];if(i&&(i.type===T.PlaylistContextType.AUDIO_TRACK&&y.audioGroupIds&&i.groupId===y.audioGroupIds[y.urlId]||i.type===T.PlaylistContextType.SUBTITLE_TRACK&&y.textGroupIds&&i.groupId===y.textGroupIds[y.urlId])){this.redundantFailover(this.currentLevelIndex);return}var u=!1,f=!0,c;switch(t.details){case O.ErrorDetails.FRAG_LOAD_ERROR:case O.ErrorDetails.FRAG_LOAD_TIMEOUT:case O.ErrorDetails.KEY_LOAD_ERROR:case O.ErrorDetails.KEY_LOAD_TIMEOUT:if(t.frag){var s=this._levels[t.frag.level];s?(s.fragmentError++,s.fragmentError>this.hls.config.fragLoadingMaxRetry&&(c=t.frag.level)):c=t.frag.level}break;case O.ErrorDetails.LEVEL_LOAD_ERROR:case O.ErrorDetails.LEVEL_LOAD_TIMEOUT:i&&(i.deliveryDirectives&&(f=!1),c=i.level),u=!0;break;case O.ErrorDetails.REMUX_ALLOC_ERROR:c=t.level,u=!0;break}c!==void 0&&this.recoverLevel(t,c,u,f)}},l.recoverLevel=function(n,t,i,y){var u=n.details,f=this._levels[t];if(f.loadError++,i){var c=this.retryLoadingOrFail(n);if(c)n.levelRetry=!0;else{this.currentLevelIndex=-1;return}}if(y){var s=f.url.length;if(s>1&&f.loadError<s)n.levelRetry=!0,this.redundantFailover(t);else if(this.manualLevelIndex===-1){var o=t===0?this._levels.length-1:t-1;this.currentLevelIndex!==o&&this._levels[o].loadError===0&&(this.warn(u+": switch to "+o),n.levelRetry=!0,this.hls.nextAutoLevel=o)}}},l.redundantFailover=function(n){var t=this._levels[n],i=t.url.length;if(i>1){var y=(t.urlId+1)%i;this.warn("Switching to redundant URL-id "+y),this._levels.forEach(function(u){u.urlId=y}),this.level=n}},l.onFragLoaded=function(n,t){var i=t.frag;if(i!==void 0&&i.type===T.PlaylistLevelType.MAIN){var y=this._levels[i.level];y!==void 0&&(y.fragmentError=0,y.loadError=0)}},l.onLevelLoaded=function(n,t){var i,y=t.level,u=t.details,f=this._levels[y];if(!f){var c;this.warn("Invalid level index "+y),(c=t.deliveryDirectives)!==null&&c!==void 0&&c.skip&&(u.deltaUpdateFailed=!0);return}y===this.currentLevelIndex?(f.fragmentError===0&&(f.loadError=0,this.retryCount=0),this.playlistLoaded(y,t,f.details)):(i=t.deliveryDirectives)!==null&&i!==void 0&&i.skip&&(u.deltaUpdateFailed=!0)},l.onAudioTrackSwitched=function(n,t){var i=this.hls.levels[this.currentLevelIndex];if(!!i&&i.audioGroupIds){for(var y=-1,u=this.hls.audioTracks[t.id].groupId,f=0;f<i.audioGroupIds.length;f++)if(i.audioGroupIds[f]===u){y=f;break}y!==i.urlId&&(i.urlId=y,this.startLoad())}},l.loadPlaylist=function(n){var t=this.currentLevelIndex,i=this._levels[t];if(this.canLoad&&i&&i.url.length>0){var y=i.urlId,u=i.url[y];if(n)try{u=n.addDirectives(u)}catch(f){this.warn("Could not construct new URL with HLS Delivery Directives: "+f)}this.log("Attempt loading level index "+t+(n?" at sn "+n.msn+" part "+n.part:"")+" with URL-id "+y+" "+u),this.clearTimer(),this.hls.trigger(R.Events.LEVEL_LOADING,{url:u,level:t,id:y,deliveryDirectives:n||null})}},l.removeLevel=function(n,t){var i=function(f,c){return c!==t},y=this._levels.filter(function(u,f){return f!==n?!0:u.url.length>1&&t!==void 0?(u.url=u.url.filter(i),u.audioGroupIds&&(u.audioGroupIds=u.audioGroupIds.filter(i)),u.textGroupIds&&(u.textGroupIds=u.textGroupIds.filter(i)),u.urlId=0,!0):!1}).map(function(u,f){var c=u.details;return c!=null&&c.fragments&&c.fragments.forEach(function(s){s.level=f}),u});this._levels=y,this.hls.trigger(R.Events.LEVELS_UPDATED,{levels:y})},g(a,[{key:"levels",get:function(){return this._levels.length===0?null:this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(n){var t,i=this._levels;if(i.length!==0&&!(this.currentLevelIndex===n&&(t=i[n])!==null&&t!==void 0&&t.details)){if(n<0||n>=i.length){var y=n<0;if(this.hls.trigger(R.Events.ERROR,{type:O.ErrorTypes.OTHER_ERROR,details:O.ErrorDetails.LEVEL_SWITCH_ERROR,level:n,fatal:y,reason:"invalid level idx"}),y)return;n=Math.min(n,i.length-1)}this.clearTimer();var u=this.currentLevelIndex,f=i[u],c=i[n];this.log("switching to level "+n+" from "+u),this.currentLevelIndex=n;var s=m({},c,{level:n,maxBitrate:c.maxBitrate,uri:c.uri,urlId:c.urlId});delete s._urlId,this.hls.trigger(R.Events.LEVEL_SWITCHING,s);var o=c.details;if(!o||o.live){var v=this.switchParams(c.uri,f==null?void 0:f.details);this.loadPlaylist(v)}}}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(n){this.manualLevelIndex=n,this._startLevel===void 0&&(this._startLevel=n),n!==-1&&(this.level=n)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(n){this._firstLevel=n}},{key:"startLevel",get:function(){if(this._startLevel===void 0){var n=this.hls.config.startLevel;return n!==void 0?n:this._firstLevel}else return this._startLevel},set:function(n){this._startLevel=n}},{key:"nextLoadLevel",get:function(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(n){this.level=n,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=n)}}]),a}(I.default)},"./src/controller/level-helper.ts":function(K,M,L){L.r(M),L.d(M,"addGroupId",function(){return C}),L.d(M,"assignTrackIdsByGroup",function(){return I}),L.d(M,"updatePTS",function(){return T}),L.d(M,"updateFragPTSDTS",function(){return p}),L.d(M,"mergeDetails",function(){return g}),L.d(M,"mapPartIntersection",function(){return E}),L.d(M,"mapFragmentIntersection",function(){return d}),L.d(M,"adjustSliding",function(){return r}),L.d(M,"addSliding",function(){return e}),L.d(M,"computeReloadInterval",function(){return a}),L.d(M,"getFragmentWithSN",function(){return l}),L.d(M,"getPartWith",function(){return h});var x=L("./src/polyfills/number.ts"),R=L("./src/utils/logger.ts"),O=L("./src/loader/date-range.ts");function b(){return b=Object.assign?Object.assign.bind():function(n){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var y in i)Object.prototype.hasOwnProperty.call(i,y)&&(n[y]=i[y])}return n},b.apply(this,arguments)}function C(n,t,i){switch(t){case"audio":n.audioGroupIds||(n.audioGroupIds=[]),n.audioGroupIds.push(i);break;case"text":n.textGroupIds||(n.textGroupIds=[]),n.textGroupIds.push(i);break}}function I(n){var t={};n.forEach(function(i){var y=i.groupId||"";i.id=t[y]=t[y]||0,t[y]++})}function T(n,t,i){var y=n[t],u=n[i];m(y,u)}function m(n,t){var i=t.startPTS;if(Object(x.isFiniteNumber)(i)){var y=0,u;t.sn>n.sn?(y=i-n.start,u=n):(y=n.start-i,u=t),u.duration!==y&&(u.duration=y)}else if(t.sn>n.sn){var f=n.cc===t.cc;f&&n.minEndPTS?t.start=n.start+(n.minEndPTS-n.start):t.start=n.start+n.duration}else t.start=Math.max(n.start-t.duration,0)}function p(n,t,i,y,u,f){var c=y-i;c<=0&&(R.logger.warn("Fragment should have a positive duration",t),y=i+t.duration,f=u+t.duration);var s=i,o=y,v=t.startPTS,S=t.endPTS;if(Object(x.isFiniteNumber)(v)){var A=Math.abs(v-i);Object(x.isFiniteNumber)(t.deltaPTS)?t.deltaPTS=Math.max(A,t.deltaPTS):t.deltaPTS=A,s=Math.max(i,v),i=Math.min(i,v),u=Math.min(u,t.startDTS),o=Math.min(y,S),y=Math.max(y,S),f=Math.max(f,t.endDTS)}t.duration=y-i;var P=i-t.start;t.appendedPTS=y,t.start=t.startPTS=i,t.maxStartPTS=s,t.startDTS=u,t.endPTS=y,t.minEndPTS=o,t.endDTS=f;var _=t.sn;if(!n||_<n.startSN||_>n.endSN)return 0;var F,k=_-n.startSN,B=n.fragments;for(B[k]=t,F=k;F>0;F--)m(B[F],B[F-1]);for(F=k;F<B.length-1;F++)m(B[F],B[F+1]);return n.fragmentHint&&m(B[B.length-1],n.fragmentHint),n.PTSKnown=n.alignedSliding=!0,P}function g(n,t){for(var i=null,y=n.fragments,u=y.length-1;u>=0;u--){var f=y[u].initSegment;if(f){i=f;break}}n.fragmentHint&&delete n.fragmentHint.endPTS;var c=0,s;if(d(n,t,function(F,k){F.relurl&&(c=F.cc-k.cc),Object(x.isFiniteNumber)(F.startPTS)&&Object(x.isFiniteNumber)(F.endPTS)&&(k.start=k.startPTS=F.startPTS,k.startDTS=F.startDTS,k.appendedPTS=F.appendedPTS,k.maxStartPTS=F.maxStartPTS,k.endPTS=F.endPTS,k.endDTS=F.endDTS,k.minEndPTS=F.minEndPTS,k.duration=F.endPTS-F.startPTS,k.duration&&(s=k),t.PTSKnown=t.alignedSliding=!0),k.elementaryStreams=F.elementaryStreams,k.loader=F.loader,k.stats=F.stats,k.urlId=F.urlId,F.initSegment&&(k.initSegment=F.initSegment,i=F.initSegment)}),i){var o=t.fragmentHint?t.fragments.concat(t.fragmentHint):t.fragments;o.forEach(function(F){var k;(!F.initSegment||F.initSegment.relurl===((k=i)===null||k===void 0?void 0:k.relurl))&&(F.initSegment=i)})}if(t.skippedSegments)if(t.deltaUpdateFailed=t.fragments.some(function(F){return!F}),t.deltaUpdateFailed){R.logger.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(var v=t.skippedSegments;v--;)t.fragments.shift();t.startSN=t.fragments[0].sn,t.startCC=t.fragments[0].cc}else t.canSkipDateRanges&&(t.dateRanges=D(n.dateRanges,t.dateRanges,t.recentlyRemovedDateranges));var S=t.fragments;if(c){R.logger.warn("discontinuity sliding from playlist, take drift into account");for(var A=0;A<S.length;A++)S[A].cc+=c}t.skippedSegments&&(t.startCC=t.fragments[0].cc),E(n.partList,t.partList,function(F,k){k.elementaryStreams=F.elementaryStreams,k.stats=F.stats}),s?p(t,s,s.startPTS,s.endPTS,s.startDTS,s.endDTS):r(n,t),S.length&&(t.totalduration=t.edge-S[0].start),t.driftStartTime=n.driftStartTime,t.driftStart=n.driftStart;var P=t.advancedDateTime;if(t.advanced&&P){var _=t.edge;t.driftStart||(t.driftStartTime=P,t.driftStart=_),t.driftEndTime=P,t.driftEnd=_}else t.driftEndTime=n.driftEndTime,t.driftEnd=n.driftEnd,t.advancedDateTime=n.advancedDateTime}function D(n,t,i){var y=b({},n);return i&&i.forEach(function(u){delete y[u]}),Object.keys(t).forEach(function(u){var f=new O.DateRange(t[u].attr,y[u]);f.isValid?y[u]=f:R.logger.warn('Ignoring invalid Playlist Delta Update DATERANGE tag: "'+JSON.stringify(t[u].attr)+'"')}),y}function E(n,t,i){if(n&&t)for(var y=0,u=0,f=n.length;u<=f;u++){var c=n[u],s=t[u+y];c&&s&&c.index===s.index&&c.fragment.sn===s.fragment.sn?i(c,s):y--}}function d(n,t,i){for(var y=t.skippedSegments,u=Math.max(n.startSN,t.startSN)-t.startSN,f=(n.fragmentHint?1:0)+(y?t.endSN:Math.min(n.endSN,t.endSN))-t.startSN,c=t.startSN-n.startSN,s=t.fragmentHint?t.fragments.concat(t.fragmentHint):t.fragments,o=n.fragmentHint?n.fragments.concat(n.fragmentHint):n.fragments,v=u;v<=f;v++){var S=o[c+v],A=s[v];y&&!A&&v<y&&(A=t.fragments[v]=S),S&&A&&i(S,A)}}function r(n,t){var i=t.startSN+t.skippedSegments-n.startSN,y=n.fragments;i<0||i>=y.length||e(t,y[i].start)}function e(n,t){if(t){for(var i=n.fragments,y=n.skippedSegments;y<i.length;y++)i[y].start+=t;n.fragmentHint&&(n.fragmentHint.start+=t)}}function a(n,t){var i=1e3*n.levelTargetDuration,y=i/2,u=n.age,f=u>0&&u<i*3,c=t.loading.end-t.loading.start,s,o=n.availabilityDelay;if(n.updated===!1)if(f){var v=333*n.misses;s=Math.max(Math.min(y,c*2),v),n.availabilityDelay=(n.availabilityDelay||0)+s}else s=y;else f?(o=Math.min(o||i/2,u),n.availabilityDelay=o,s=o+i-u):s=i-c;return Math.round(s)}function l(n,t,i){if(!n||!n.details)return null;var y=n.details,u=y.fragments[t-y.startSN];return u||(u=y.fragmentHint,u&&u.sn===t)?u:t<y.startSN&&i&&i.sn===t?i:null}function h(n,t,i){if(!n||!n.details)return null;var y=n.details.partList;if(y)for(var u=y.length;u--;){var f=y[u];if(f.index===i&&f.fragment.sn===t)return f}return null}},"./src/controller/stream-controller.ts":function(K,M,L){L.r(M),L.d(M,"default",function(){return h});var x=L("./src/polyfills/number.ts"),R=L("./src/controller/base-stream-controller.ts"),O=L("./src/is-supported.ts"),b=L("./src/events.ts"),C=L("./src/utils/buffer-helper.ts"),I=L("./src/controller/fragment-tracker.ts"),T=L("./src/types/loader.ts"),m=L("./src/loader/fragment.ts"),p=L("./src/demux/transmuxer-interface.ts"),g=L("./src/types/transmuxer.ts"),D=L("./src/controller/gap-controller.ts"),E=L("./src/errors.ts");function d(n,t){for(var i=0;i<t.length;i++){var y=t[i];y.enumerable=y.enumerable||!1,y.configurable=!0,"value"in y&&(y.writable=!0),Object.defineProperty(n,y.key,y)}}function r(n,t,i){return t&&d(n.prototype,t),i&&d(n,i),Object.defineProperty(n,"prototype",{writable:!1}),n}function e(n,t){n.prototype=Object.create(t.prototype),n.prototype.constructor=n,a(n,t)}function a(n,t){return a=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(y,u){return y.__proto__=u,y},a(n,t)}var l=100,h=function(n){e(t,n);function t(y,u){var f;return f=n.call(this,y,u,"[stream-controller]")||this,f.audioCodecSwap=!1,f.gapController=null,f.level=-1,f._forceStartLoad=!1,f.altAudio=!1,f.audioOnly=!1,f.fragPlaying=null,f.onvplaying=null,f.onvseeked=null,f.fragLastKbps=0,f.couldBacktrack=!1,f.backtrackFragment=null,f.audioCodecSwitch=!1,f.videoBuffer=null,f._registerListeners(),f}var i=t.prototype;return i._registerListeners=function(){var u=this.hls;u.on(b.Events.MEDIA_ATTACHED,this.onMediaAttached,this),u.on(b.Events.MEDIA_DETACHING,this.onMediaDetaching,this),u.on(b.Events.MANIFEST_LOADING,this.onManifestLoading,this),u.on(b.Events.MANIFEST_PARSED,this.onManifestParsed,this),u.on(b.Events.LEVEL_LOADING,this.onLevelLoading,this),u.on(b.Events.LEVEL_LOADED,this.onLevelLoaded,this),u.on(b.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),u.on(b.Events.ERROR,this.onError,this),u.on(b.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),u.on(b.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),u.on(b.Events.BUFFER_CREATED,this.onBufferCreated,this),u.on(b.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),u.on(b.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),u.on(b.Events.FRAG_BUFFERED,this.onFragBuffered,this)},i._unregisterListeners=function(){var u=this.hls;u.off(b.Events.MEDIA_ATTACHED,this.onMediaAttached,this),u.off(b.Events.MEDIA_DETACHING,this.onMediaDetaching,this),u.off(b.Events.MANIFEST_LOADING,this.onManifestLoading,this),u.off(b.Events.MANIFEST_PARSED,this.onManifestParsed,this),u.off(b.Events.LEVEL_LOADED,this.onLevelLoaded,this),u.off(b.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),u.off(b.Events.ERROR,this.onError,this),u.off(b.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),u.off(b.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),u.off(b.Events.BUFFER_CREATED,this.onBufferCreated,this),u.off(b.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),u.off(b.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),u.off(b.Events.FRAG_BUFFERED,this.onFragBuffered,this)},i.onHandlerDestroying=function(){this._unregisterListeners(),this.onMediaDetaching()},i.startLoad=function(u){if(this.levels){var f=this.lastCurrentTime,c=this.hls;if(this.stopLoad(),this.setInterval(l),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var s=c.startLevel;s===-1&&(c.config.testBandwidth?(s=0,this.bitrateTest=!0):s=c.nextAutoLevel),this.level=c.nextLoadLevel=s,this.loadedmetadata=!1}f>0&&u===-1&&(this.log("Override startPosition with lastCurrentTime @"+f.toFixed(3)),u=f),this.state=R.State.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=u,this.tick()}else this._forceStartLoad=!0,this.state=R.State.STOPPED},i.stopLoad=function(){this._forceStartLoad=!1,n.prototype.stopLoad.call(this)},i.doTick=function(){switch(this.state){case R.State.IDLE:this.doTickIdle();break;case R.State.WAITING_LEVEL:{var u,f=this.levels,c=this.level,s=f==null||(u=f[c])===null||u===void 0?void 0:u.details;if(s&&(!s.live||this.levelLastLoaded===this.level)){if(this.waitForCdnTuneIn(s))break;this.state=R.State.IDLE;break}break}case R.State.FRAG_LOADING_WAITING_RETRY:{var o,v=self.performance.now(),S=this.retryDate;(!S||v>=S||(o=this.media)!==null&&o!==void 0&&o.seeking)&&(this.log("retryDate reached, switch back to IDLE state"),this.state=R.State.IDLE)}break}this.onTickEnd()},i.onTickEnd=function(){n.prototype.onTickEnd.call(this),this.checkBuffer(),this.checkFragmentChanged()},i.doTickIdle=function(){var u,f,c=this.hls,s=this.levelLastLoaded,o=this.levels,v=this.media,S=c.config,A=c.nextLoadLevel;if(!(s===null||!v&&(this.startFragRequested||!S.startFragPrefetch))&&!(this.altAudio&&this.audioOnly)&&!(!o||!o[A])){var P=o[A];this.level=c.nextLoadLevel=A;var _=P.details;if(!_||this.state===R.State.WAITING_LEVEL||_.live&&this.levelLastLoaded!==A){this.state=R.State.WAITING_LEVEL;return}var F=this.getMainFwdBufferInfo();if(F!==null){var k=F.len,B=this.getMaxBufferLength(P.maxBitrate);if(!(k>=B)){if(this._streamEnded(F,_)){var w={};this.altAudio&&(w.type="video"),this.hls.trigger(b.Events.BUFFER_EOS,w),this.state=R.State.ENDED;return}this.backtrackFragment&&this.backtrackFragment.start>F.end&&(this.backtrackFragment=null);var U=this.backtrackFragment?this.backtrackFragment.start:F.end,N=this.getNextFragment(U,_);if(this.couldBacktrack&&!this.fragPrevious&&N&&N.sn!=="initSegment"&&this.fragmentTracker.getState(N)!==I.FragmentState.OK){var W,j=((W=this.backtrackFragment)!=null?W:N).sn,H=j-_.startSN,G=_.fragments[H-1];G&&N.cc===G.cc&&(N=G,this.fragmentTracker.removeFragment(G))}else this.backtrackFragment&&F.len&&(this.backtrackFragment=null);if(N&&this.fragmentTracker.getState(N)===I.FragmentState.OK&&this.nextLoadPosition>U){var z=this.audioOnly&&!this.altAudio?m.ElementaryStreamTypes.AUDIO:m.ElementaryStreamTypes.VIDEO;this.afterBufferFlushed(v,z,T.PlaylistLevelType.MAIN),N=this.getNextFragment(this.nextLoadPosition,_)}!N||(N.initSegment&&!N.initSegment.data&&!this.bitrateTest&&(N=N.initSegment),((u=N.decryptdata)===null||u===void 0?void 0:u.keyFormat)==="identity"&&!((f=N.decryptdata)!==null&&f!==void 0&&f.key)?this.loadKey(N,_):this.loadFragment(N,_,U))}}}},i.loadFragment=function(u,f,c){var s,o=this.fragmentTracker.getState(u);this.fragCurrent=u,o===I.FragmentState.NOT_LOADED||o===I.FragmentState.PARTIAL?u.sn==="initSegment"?this._loadInitSegment(u):this.bitrateTest?(u.bitrateTest=!0,this.log("Fragment "+u.sn+" of level "+u.level+" is being downloaded to test bitrate and will not be buffered"),this._loadBitrateTestFrag(u)):(this.startFragRequested=!0,n.prototype.loadFragment.call(this,u,f,c)):o===I.FragmentState.APPENDING?this.reduceMaxBufferLength(u.duration)&&this.fragmentTracker.removeFragment(u):((s=this.media)===null||s===void 0?void 0:s.buffered.length)===0&&this.fragmentTracker.removeAllFragments()},i.getAppendedFrag=function(u){var f=this.fragmentTracker.getAppendedFrag(u,T.PlaylistLevelType.MAIN);return f&&"fragment"in f?f.fragment:f},i.getBufferedFrag=function(u){return this.fragmentTracker.getBufferedFrag(u,T.PlaylistLevelType.MAIN)},i.followingBufferedFrag=function(u){return u?this.getBufferedFrag(u.end+.5):null},i.immediateLevelSwitch=function(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},i.nextLevelSwitch=function(){var u=this.levels,f=this.media;if(f!=null&&f.readyState){var c,s=this.getAppendedFrag(f.currentTime);if(s&&s.start>1&&this.flushMainBuffer(0,s.start-1),!f.paused&&u){var o=this.hls.nextLoadLevel,v=u[o],S=this.fragLastKbps;S&&this.fragCurrent?c=this.fragCurrent.duration*v.maxBitrate/(1e3*S)+1:c=0}else c=0;var A=this.getBufferedFrag(f.currentTime+c);if(A){var P=this.followingBufferedFrag(A);if(P){this.abortCurrentFrag();var _=P.maxStartPTS?P.maxStartPTS:P.start,F=P.duration,k=Math.max(A.end,_+Math.min(Math.max(F-this.config.maxFragLookUpTolerance,F*.5),F*.75));this.flushMainBuffer(k,Number.POSITIVE_INFINITY)}}}},i.abortCurrentFrag=function(){var u=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,u!=null&&u.loader&&u.loader.abort(),this.state){case R.State.KEY_LOADING:case R.State.FRAG_LOADING:case R.State.FRAG_LOADING_WAITING_RETRY:case R.State.PARSING:case R.State.PARSED:this.state=R.State.IDLE;break}this.nextLoadPosition=this.getLoadPosition()},i.flushMainBuffer=function(u,f){n.prototype.flushMainBuffer.call(this,u,f,this.altAudio?"video":null)},i.onMediaAttached=function(u,f){n.prototype.onMediaAttached.call(this,u,f);var c=f.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),c.addEventListener("playing",this.onvplaying),c.addEventListener("seeked",this.onvseeked),this.gapController=new D.default(this.config,c,this.fragmentTracker,this.hls)},i.onMediaDetaching=function(){var u=this.media;u&&(u.removeEventListener("playing",this.onvplaying),u.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),n.prototype.onMediaDetaching.call(this)},i.onMediaPlaying=function(){this.tick()},i.onMediaSeeked=function(){var u=this.media,f=u?u.currentTime:null;Object(x.isFiniteNumber)(f)&&this.log("Media seeked to "+f.toFixed(3)),this.tick()},i.onManifestLoading=function(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(b.Events.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=!1,this.startPosition=this.lastCurrentTime=0,this.fragPlaying=null,this.backtrackFragment=null},i.onManifestParsed=function(u,f){var c=!1,s=!1,o;f.levels.forEach(function(v){o=v.audioCodec,o&&(o.indexOf("mp4a.40.2")!==-1&&(c=!0),o.indexOf("mp4a.40.5")!==-1&&(s=!0))}),this.audioCodecSwitch=c&&s&&!Object(O.changeTypeSupported)(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=f.levels,this.startFragRequested=!1},i.onLevelLoading=function(u,f){var c=this.levels;if(!(!c||this.state!==R.State.IDLE)){var s=c[f.level];(!s.details||s.details.live&&this.levelLastLoaded!==f.level||this.waitForCdnTuneIn(s.details))&&(this.state=R.State.WAITING_LEVEL)}},i.onLevelLoaded=function(u,f){var c,s=this.levels,o=f.level,v=f.details,S=v.totalduration;if(!s){this.warn("Levels were reset while loading level "+o);return}this.log("Level "+o+" loaded ["+v.startSN+","+v.endSN+"], cc ["+v.startCC+", "+v.endCC+"] duration:"+S);var A=this.fragCurrent;A&&(this.state===R.State.FRAG_LOADING||this.state===R.State.FRAG_LOADING_WAITING_RETRY)&&A.level!==f.level&&A.loader&&(this.state=R.State.IDLE,this.backtrackFragment=null,A.loader.abort());var P=s[o],_=0;if(v.live||(c=P.details)!==null&&c!==void 0&&c.live){if(v.fragments[0]||(v.deltaUpdateFailed=!0),v.deltaUpdateFailed)return;_=this.alignPlaylists(v,P.details)}if(P.details=v,this.levelLastLoaded=o,this.hls.trigger(b.Events.LEVEL_UPDATED,{details:v,level:o}),this.state===R.State.WAITING_LEVEL){if(this.waitForCdnTuneIn(v))return;this.state=R.State.IDLE}this.startFragRequested?v.live&&this.synchronizeToLiveEdge(v):this.setStartPosition(v,_),this.tick()},i._handleFragmentLoadProgress=function(u){var f,c=u.frag,s=u.part,o=u.payload,v=this.levels;if(!v){this.warn("Levels were reset while fragment load was in progress. Fragment "+c.sn+" of level "+c.level+" will not be buffered");return}var S=v[c.level],A=S.details;if(!A){this.warn("Dropping fragment "+c.sn+" of level "+c.level+" after level details were reset");return}var P=S.videoCodec,_=A.PTSKnown||!A.live,F=(f=c.initSegment)===null||f===void 0?void 0:f.data,k=this._getAudioCodec(S),B=this.transmuxer=this.transmuxer||new p.default(this.hls,T.PlaylistLevelType.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),w=s?s.index:-1,U=w!==-1,N=new g.ChunkMetadata(c.level,c.sn,c.stats.chunkCount,o.byteLength,w,U),W=this.initPTS[c.cc];B.push(o,F,k,P,c,s,A.totalduration,_,N,W)},i.onAudioTrackSwitching=function(u,f){var c=this.altAudio,s=!!f.url,o=f.id;if(!s){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var v=this.fragCurrent;v!=null&&v.loader&&(this.log("Switching to main audio track, cancel main fragment load"),v.loader.abort()),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();var S=this.hls;c&&S.trigger(b.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),S.trigger(b.Events.AUDIO_TRACK_SWITCHED,{id:o})}},i.onAudioTrackSwitched=function(u,f){var c=f.id,s=!!this.hls.audioTracks[c].url;if(s){var o=this.videoBuffer;o&&this.mediaBuffer!==o&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=o)}this.altAudio=s,this.tick()},i.onBufferCreated=function(u,f){var c=f.tracks,s,o,v=!1;for(var S in c){var A=c[S];if(A.id==="main"){if(o=S,s=A,S==="video"){var P=c[S];P&&(this.videoBuffer=P.buffer)}}else v=!0}v&&s?(this.log("Alternate track found, use "+o+".buffered to schedule main fragment loading"),this.mediaBuffer=s.buffer):this.mediaBuffer=this.media},i.onFragBuffered=function(u,f){var c=f.frag,s=f.part;if(!(c&&c.type!==T.PlaylistLevelType.MAIN)){if(this.fragContextChanged(c)){this.warn("Fragment "+c.sn+(s?" p: "+s.index:"")+" of level "+c.level+" finished buffering, but was aborted. state: "+this.state),this.state===R.State.PARSED&&(this.state=R.State.IDLE);return}var o=s?s.stats:c.stats;this.fragLastKbps=Math.round(8*o.total/(o.buffering.end-o.loading.first)),c.sn!=="initSegment"&&(this.fragPrevious=c),this.fragBufferedComplete(c,s)}},i.onError=function(u,f){switch(f.details){case E.ErrorDetails.FRAG_LOAD_ERROR:case E.ErrorDetails.FRAG_LOAD_TIMEOUT:case E.ErrorDetails.KEY_LOAD_ERROR:case E.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(T.PlaylistLevelType.MAIN,f);break;case E.ErrorDetails.LEVEL_LOAD_ERROR:case E.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==R.State.ERROR&&(f.fatal?(this.warn(""+f.details),this.state=R.State.ERROR):!f.levelRetry&&this.state===R.State.WAITING_LEVEL&&(this.state=R.State.IDLE));break;case E.ErrorDetails.BUFFER_FULL_ERROR:if(f.parent==="main"&&(this.state===R.State.PARSING||this.state===R.State.PARSED)){var c=!0,s=this.getFwdBufferInfo(this.media,T.PlaylistLevelType.MAIN);s&&s.len>.5&&(c=!this.reduceMaxBufferLength(s.len)),c&&(this.warn("buffer full error also media.currentTime is not buffered, flush main"),this.immediateLevelSwitch()),this.resetLoadingState()}break}},i.checkBuffer=function(){var u=this.media,f=this.gapController;if(!(!u||!f||!u.readyState)){var c=C.BufferHelper.getBuffered(u);if(!this.loadedmetadata&&c.length)this.loadedmetadata=!0,this.seekToStartPos();else{var s=this.state!==R.State.IDLE?this.fragCurrent:null;f.poll(this.lastCurrentTime,s)}this.lastCurrentTime=u.currentTime}},i.onFragLoadEmergencyAborted=function(){this.state=R.State.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()},i.onBufferFlushed=function(u,f){var c=f.type;if(c!==m.ElementaryStreamTypes.AUDIO||this.audioOnly&&!this.altAudio){var s=(c===m.ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(s,c,T.PlaylistLevelType.MAIN)}},i.onLevelsUpdated=function(u,f){this.levels=f.levels},i.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},i.seekToStartPos=function(){var u=this.media,f=u.currentTime,c=this.startPosition;if(c>=0&&f<c){if(u.seeking){this.log("could not seek to "+c+", already seeking at "+f);return}var s=C.BufferHelper.getBuffered(u),o=s.length?s.start(0):0,v=o-c;v>0&&(v<this.config.maxBufferHole||v<this.config.maxFragLookUpTolerance)&&(this.log("adjusting start position by "+v+" to match buffer start"),c+=v,this.startPosition=c),this.log("seek to target start position "+c+" from current time "+f),u.currentTime=c}},i._getAudioCodec=function(u){var f=this.config.defaultAudioCodec||u.audioCodec;return this.audioCodecSwap&&f&&(this.log("Swapping audio codec"),f.indexOf("mp4a.40.5")!==-1?f="mp4a.40.2":f="mp4a.40.5"),f},i._loadBitrateTestFrag=function(u){var f=this;this._doFragLoad(u).then(function(c){var s=f.hls;if(!(!c||s.nextLoadLevel||f.fragContextChanged(u))){f.fragLoadError=0,f.state=R.State.IDLE,f.startFragRequested=!1,f.bitrateTest=!1;var o=u.stats;o.parsing.start=o.parsing.end=o.buffering.start=o.buffering.end=self.performance.now(),s.trigger(b.Events.FRAG_LOADED,c)}})},i._handleTransmuxComplete=function(u){var f,c="main",s=this.hls,o=u.remuxResult,v=u.chunkMeta,S=this.getCurrentContext(v);if(!S){this.warn("The loading context changed while buffering fragment "+v.sn+" of level "+v.level+". This chunk will not be buffered."),this.resetLiveStartWhenNotLoaded(v.level);return}var A=S.frag,P=S.part,_=S.level,F=o.video,k=o.text,B=o.id3,w=o.initSegment,U=_.details,N=this.altAudio?void 0:o.audio;if(!this.fragContextChanged(A)){if(this.state=R.State.PARSING,w){w.tracks&&(this._bufferInitSegment(_,w.tracks,A,v),s.trigger(b.Events.FRAG_PARSING_INIT_SEGMENT,{frag:A,id:c,tracks:w.tracks}));var W=w.initPTS,j=w.timescale;Object(x.isFiniteNumber)(W)&&(this.initPTS[A.cc]=W,s.trigger(b.Events.INIT_PTS_FOUND,{frag:A,id:c,initPTS:W,timescale:j}))}if(F&&o.independent!==!1){if(U){var H=F.startPTS,G=F.endPTS,z=F.startDTS,Z=F.endDTS;if(P)P.elementaryStreams[F.type]={startPTS:H,endPTS:G,startDTS:z,endDTS:Z};else if(F.firstKeyFrame&&F.independent&&(this.couldBacktrack=!0),F.dropped&&F.independent){var Y=this.getMainFwdBufferInfo(),V=(Y?Y.end:this.getLoadPosition())+this.config.maxBufferHole,$=F.firstKeyFramePTS?F.firstKeyFramePTS:H;if(V<$-this.config.maxBufferHole){this.backtrack(A);return}A.setElementaryStreamInfo(F.type,A.start,G,A.start,Z,!0)}A.setElementaryStreamInfo(F.type,H,G,z,Z),this.backtrackFragment&&(this.backtrackFragment=A),this.bufferFragmentData(F,A,P,v)}}else if(o.independent===!1){this.backtrack(A);return}if(N){var X=N.startPTS,Q=N.endPTS,J=N.startDTS,q=N.endDTS;P&&(P.elementaryStreams[m.ElementaryStreamTypes.AUDIO]={startPTS:X,endPTS:Q,startDTS:J,endDTS:q}),A.setElementaryStreamInfo(m.ElementaryStreamTypes.AUDIO,X,Q,J,q),this.bufferFragmentData(N,A,P,v)}if(U&&B!==null&&B!==void 0&&(f=B.samples)!==null&&f!==void 0&&f.length){var ee={id:c,frag:A,details:U,samples:B.samples};s.trigger(b.Events.FRAG_PARSING_METADATA,ee)}if(U&&k){var te={id:c,frag:A,details:U,samples:k.samples};s.trigger(b.Events.FRAG_PARSING_USERDATA,te)}}},i._bufferInitSegment=function(u,f,c,s){var o=this;if(this.state===R.State.PARSING){this.audioOnly=!!f.audio&&!f.video,this.altAudio&&!this.audioOnly&&delete f.audio;var v=f.audio,S=f.video,A=f.audiovideo;if(v){var P=u.audioCodec,_=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(P&&(P.indexOf("mp4a.40.5")!==-1?P="mp4a.40.2":P="mp4a.40.5"),v.metadata.channelCount!==1&&_.indexOf("firefox")===-1&&(P="mp4a.40.5")),_.indexOf("android")!==-1&&v.container!=="audio/mpeg"&&(P="mp4a.40.2",this.log("Android: force audio codec to "+P)),u.audioCodec&&u.audioCodec!==P&&this.log('Swapping manifest audio codec "'+u.audioCodec+'" for "'+P+'"'),v.levelCodec=P,v.id="main",this.log("Init audio buffer, container:"+v.container+", codecs[selected/level/parsed]=["+(P||"")+"/"+(u.audioCodec||"")+"/"+v.codec+"]")}S&&(S.levelCodec=u.videoCodec,S.id="main",this.log("Init video buffer, container:"+S.container+", codecs[level/parsed]=["+(u.videoCodec||"")+"/"+S.codec+"]")),A&&this.log("Init audiovideo buffer, container:"+A.container+", codecs[level/parsed]=["+(u.attrs.CODECS||"")+"/"+A.codec+"]"),this.hls.trigger(b.Events.BUFFER_CODECS,f),Object.keys(f).forEach(function(F){var k=f[F],B=k.initSegment;B!=null&&B.byteLength&&o.hls.trigger(b.Events.BUFFER_APPENDING,{type:F,data:B,frag:c,part:null,chunkMeta:s,parent:c.type})}),this.tick()}},i.getMainFwdBufferInfo=function(){return this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,T.PlaylistLevelType.MAIN)},i.backtrack=function(u){this.couldBacktrack=!0,this.backtrackFragment=u,this.resetTransmuxer(),this.flushBufferGap(u),this.fragmentTracker.removeFragment(u),this.fragPrevious=null,this.nextLoadPosition=u.start,this.state=R.State.IDLE},i.checkFragmentChanged=function(){var u=this.media,f=null;if(u&&u.readyState>1&&u.seeking===!1){var c=u.currentTime;if(C.BufferHelper.isBuffered(u,c)?f=this.getAppendedFrag(c):C.BufferHelper.isBuffered(u,c+.1)&&(f=this.getAppendedFrag(c+.1)),f){this.backtrackFragment=null;var s=this.fragPlaying,o=f.level;(!s||f.sn!==s.sn||s.level!==o||f.urlId!==s.urlId)&&(this.hls.trigger(b.Events.FRAG_CHANGED,{frag:f}),(!s||s.level!==o)&&this.hls.trigger(b.Events.LEVEL_SWITCHED,{level:o}),this.fragPlaying=f)}}},r(t,[{key:"nextLevel",get:function(){var u=this.nextBufferedFrag;return u?u.level:-1}},{key:"currentFrag",get:function(){var u=this.media;return u?this.fragPlaying||this.getAppendedFrag(u.currentTime):null}},{key:"currentProgramDateTime",get:function(){var u=this.media;if(u){var f=u.currentTime,c=this.currentFrag;if(c&&Object(x.isFiniteNumber)(f)&&Object(x.isFiniteNumber)(c.programDateTime)){var s=c.programDateTime+(f-c.start)*1e3;return new Date(s)}}return null}},{key:"currentLevel",get:function(){var u=this.currentFrag;return u?u.level:-1}},{key:"nextBufferedFrag",get:function(){var u=this.currentFrag;return u?this.followingBufferedFrag(u):null}},{key:"forceStartLoad",get:function(){return this._forceStartLoad}}]),t}(R.default)},"./src/controller/subtitle-stream-controller.ts":function(K,M,L){L.r(M),L.d(M,"SubtitleStreamController",function(){return e});var x=L("./src/events.ts"),R=L("./src/utils/buffer-helper.ts"),O=L("./src/controller/fragment-finders.ts"),b=L("./src/utils/discontinuities.ts"),C=L("./src/controller/level-helper.ts"),I=L("./src/controller/fragment-tracker.ts"),T=L("./src/controller/base-stream-controller.ts"),m=L("./src/types/loader.ts"),p=L("./src/types/level.ts");function g(a,l){for(var h=0;h<l.length;h++){var n=l[h];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(a,n.key,n)}}function D(a,l,h){return l&&g(a.prototype,l),h&&g(a,h),Object.defineProperty(a,"prototype",{writable:!1}),a}function E(a,l){a.prototype=Object.create(l.prototype),a.prototype.constructor=a,d(a,l)}function d(a,l){return d=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,t){return n.__proto__=t,n},d(a,l)}var r=500,e=function(a){E(l,a);function l(n,t){var i;return i=a.call(this,n,t,"[subtitle-stream-controller]")||this,i.levels=[],i.currentTrackId=-1,i.tracksBuffered=[],i.mainDetails=null,i._registerListeners(),i}var h=l.prototype;return h.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},h._registerListeners=function(){var t=this.hls;t.on(x.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(x.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(x.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.on(x.Events.LEVEL_LOADED,this.onLevelLoaded,this),t.on(x.Events.ERROR,this.onError,this),t.on(x.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.on(x.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),t.on(x.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.on(x.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),t.on(x.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},h._unregisterListeners=function(){var t=this.hls;t.off(x.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(x.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(x.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.off(x.Events.LEVEL_LOADED,this.onLevelLoaded,this),t.off(x.Events.ERROR,this.onError,this),t.off(x.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.off(x.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),t.off(x.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.off(x.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),t.off(x.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},h.startLoad=function(){this.stopLoad(),this.state=T.State.IDLE,this.setInterval(r),this.tick()},h.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()},h.onLevelLoaded=function(t,i){this.mainDetails=i.details},h.onSubtitleFragProcessed=function(t,i){var y=i.frag,u=i.success;if(this.fragPrevious=y,this.state=T.State.IDLE,!!u){var f=this.tracksBuffered[this.currentTrackId];if(!!f){for(var c,s=y.start,o=0;o<f.length;o++)if(s>=f[o].start&&s<=f[o].end){c=f[o];break}var v=y.start+y.duration;c?c.end=v:(c={start:s,end:v},f.push(c)),this.fragmentTracker.fragBuffered(y)}}},h.onBufferFlushing=function(t,i){var y=i.startOffset,u=i.endOffset;if(y===0&&u!==Number.POSITIVE_INFINITY){var f=this.currentTrackId,c=this.levels;if(!c.length||!c[f]||!c[f].details)return;var s=c[f].details,o=s.targetduration,v=u-o;if(v<=0)return;i.endOffsetSubtitles=Math.max(0,v),this.tracksBuffered.forEach(function(S){for(var A=0;A<S.length;){if(S[A].end<=v){S.shift();continue}else if(S[A].start<v)S[A].start=v;else break;A++}}),this.fragmentTracker.removeFragmentsInRange(y,v,m.PlaylistLevelType.SUBTITLE)}},h.onError=function(t,i){var y,u=i.frag;!u||u.type!==m.PlaylistLevelType.SUBTITLE||((y=this.fragCurrent)!==null&&y!==void 0&&y.loader&&this.fragCurrent.loader.abort(),this.state=T.State.IDLE)},h.onSubtitleTracksUpdated=function(t,i){var y=this,u=i.subtitleTracks;this.tracksBuffered=[],this.levels=u.map(function(f){return new p.Level(f)}),this.fragmentTracker.removeAllFragments(),this.fragPrevious=null,this.levels.forEach(function(f){y.tracksBuffered[f.id]=[]}),this.mediaBuffer=null},h.onSubtitleTrackSwitch=function(t,i){if(this.currentTrackId=i.id,!this.levels.length||this.currentTrackId===-1){this.clearInterval();return}var y=this.levels[this.currentTrackId];y!=null&&y.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,y&&this.setInterval(r)},h.onSubtitleTrackLoaded=function(t,i){var y,u=i.details,f=i.id,c=this.currentTrackId,s=this.levels;if(!!s.length){var o=s[c];if(!(f>=s.length||f!==c||!o)){if(this.mediaBuffer=this.mediaBufferTimeRanges,u.live||(y=o.details)!==null&&y!==void 0&&y.live){var v=this.mainDetails;if(u.deltaUpdateFailed||!v)return;var S=v.fragments[0];if(!o.details)u.hasProgramDateTime&&v.hasProgramDateTime?Object(b.alignMediaPlaylistByPDT)(u,v):S&&Object(C.addSliding)(u,S.start);else{var A=this.alignPlaylists(u,o.details);A===0&&S&&Object(C.addSliding)(u,S.start)}}if(o.details=u,this.levelLastLoaded=f,this.tick(),u.live&&!this.fragCurrent&&this.media&&this.state===T.State.IDLE){var P=Object(O.findFragmentByPTS)(null,u.fragments,this.media.currentTime,0);P||(this.warn("Subtitle playlist not aligned with playback"),o.details=void 0)}}}},h._handleFragmentLoadComplete=function(t){var i=t.frag,y=t.payload,u=i.decryptdata,f=this.hls;if(!this.fragContextChanged(i)&&y&&y.byteLength>0&&u&&u.key&&u.iv&&u.method==="AES-128"){var c=performance.now();this.decrypter.webCryptoDecrypt(new Uint8Array(y),u.key.buffer,u.iv.buffer).then(function(s){var o=performance.now();f.trigger(x.Events.FRAG_DECRYPTED,{frag:i,payload:s,stats:{tstart:c,tdecrypt:o}})})}},h.doTick=function(){if(!this.media){this.state=T.State.IDLE;return}if(this.state===T.State.IDLE){var t=this.currentTrackId,i=this.levels;if(!i.length||!i[t]||!i[t].details)return;var y=i[t].details,u=y.targetduration,f=this.config,c=this.media,s=R.BufferHelper.bufferedInfo(this.mediaBufferTimeRanges,c.currentTime-u,f.maxBufferHole),o=s.end,v=s.len,S=this.getMaxBufferLength()+u;if(v>S)return;console.assert(y,"Subtitle track details are defined on idle subtitle stream controller tick");var A=y.fragments,P=A.length,_=y.edge,F,k=this.fragPrevious;if(o<_){var B=f.maxFragLookUpTolerance;F=Object(O.findFragmentByPTS)(k,A,Math.max(A[0].start,o),B),!F&&k&&k.start<A[0].start&&(F=A[0])}else F=A[P-1];if(F=this.mapToInitFragWhenRequired(F),!F)return;F.encrypted?this.loadKey(F,y):this.fragmentTracker.getState(F)===I.FragmentState.NOT_LOADED&&this.loadFragment(F,y,o)}},h.loadFragment=function(t,i,y){this.fragCurrent=t,t.sn==="initSegment"?this._loadInitSegment(t):a.prototype.loadFragment.call(this,t,i,y)},D(l,[{key:"mediaBufferTimeRanges",get:function(){return this.tracksBuffered[this.currentTrackId]||[]}}]),l}(T.default)},"./src/controller/subtitle-track-controller.ts":function(K,M,L){L.r(M);var x=L("./src/events.ts"),R=L("./src/utils/texttrack-utils.ts"),O=L("./src/controller/base-playlist-controller.ts"),b=L("./src/types/loader.ts");function C(D,E){for(var d=0;d<E.length;d++){var r=E[d];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(D,r.key,r)}}function I(D,E,d){return E&&C(D.prototype,E),d&&C(D,d),Object.defineProperty(D,"prototype",{writable:!1}),D}function T(D,E){D.prototype=Object.create(E.prototype),D.prototype.constructor=D,m(D,E)}function m(D,E){return m=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,e){return r.__proto__=e,r},m(D,E)}var p=function(D){T(E,D);function E(r){var e;return e=D.call(this,r,"[subtitle-track-controller]")||this,e.media=null,e.tracks=[],e.groupId=null,e.tracksInGroup=[],e.trackId=-1,e.selectDefaultTrack=!0,e.queuedDefaultTrack=-1,e.trackChangeListener=function(){return e.onTextTracksChanged()},e.asyncPollTrackChange=function(){return e.pollTrackChange(0)},e.useTextTrackPolling=!1,e.subtitlePollingInterval=-1,e._subtitleDisplay=!0,e.registerListeners(),e}var d=E.prototype;return d.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.trackChangeListener=this.asyncPollTrackChange=null,D.prototype.destroy.call(this)},d.registerListeners=function(){var e=this.hls;e.on(x.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(x.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(x.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(x.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.on(x.Events.LEVEL_LOADING,this.onLevelLoading,this),e.on(x.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(x.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(x.Events.ERROR,this.onError,this)},d.unregisterListeners=function(){var e=this.hls;e.off(x.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(x.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(x.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(x.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.off(x.Events.LEVEL_LOADING,this.onLevelLoading,this),e.off(x.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(x.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(x.Events.ERROR,this.onError,this)},d.onMediaAttached=function(e,a){this.media=a.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))},d.pollTrackChange=function(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.trackChangeListener,e)},d.onMediaDetaching=function(){if(!!this.media){self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId);var e=g(this.media.textTracks);e.forEach(function(a){Object(R.clearCurrentCues)(a)}),this.subtitleTrack=-1,this.media=null}},d.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0},d.onManifestParsed=function(e,a){this.tracks=a.subtitleTracks},d.onSubtitleTrackLoaded=function(e,a){var l=a.id,h=a.details,n=this.trackId,t=this.tracksInGroup[n];if(!t){this.warn("Invalid subtitle track id "+l);return}var i=t.details;t.details=a.details,this.log("subtitle track "+l+" loaded ["+h.startSN+"-"+h.endSN+"]"),l===this.trackId&&(this.retryCount=0,this.playlistLoaded(l,a,i))},d.onLevelLoading=function(e,a){this.switchLevel(a.level)},d.onLevelSwitching=function(e,a){this.switchLevel(a.level)},d.switchLevel=function(e){var a=this.hls.levels[e];if(!!(a!=null&&a.textGroupIds)){var l=a.textGroupIds[a.urlId];if(this.groupId!==l){var h=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0,n=this.tracks.filter(function(y){return!l||y.groupId===l});this.tracksInGroup=n;var t=this.findTrackId(h==null?void 0:h.name)||this.findTrackId();this.groupId=l;var i={subtitleTracks:n};this.log("Updating subtitle tracks, "+n.length+' track(s) found in "'+l+'" group-id'),this.hls.trigger(x.Events.SUBTITLE_TRACKS_UPDATED,i),t!==-1&&this.setSubtitleTrack(t,h)}}},d.findTrackId=function(e){for(var a=this.tracksInGroup,l=0;l<a.length;l++){var h=a[l];if((!this.selectDefaultTrack||h.default)&&(!e||e===h.name))return h.id}return-1},d.onError=function(e,a){D.prototype.onError.call(this,e,a),!(a.fatal||!a.context)&&a.context.type===b.PlaylistContextType.SUBTITLE_TRACK&&a.context.id===this.trackId&&a.context.groupId===this.groupId&&this.retryLoadingOrFail(a)},d.loadPlaylist=function(e){var a=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(a)){var l=a.id,h=a.groupId,n=a.url;if(e)try{n=e.addDirectives(n)}catch(t){this.warn("Could not construct new URL with HLS Delivery Directives: "+t)}this.log("Loading subtitle playlist for id "+l),this.hls.trigger(x.Events.SUBTITLE_TRACK_LOADING,{url:n,id:l,groupId:h,deliveryDirectives:e||null})}},d.toggleTrackModes=function(e){var a=this,l=this.media,h=this.trackId;if(!!l){var n=g(l.textTracks),t=n.filter(function(u){return u.groupId===a.groupId});if(e===-1)[].slice.call(n).forEach(function(u){u.mode="disabled"});else{var i=t[h];i&&(i.mode="disabled")}var y=t[e];y&&(y.mode=this.subtitleDisplay?"showing":"hidden")}},d.setSubtitleTrack=function(e,a){var l,h=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=e;return}if(this.trackId!==e&&this.toggleTrackModes(e),!(this.trackId===e&&(e===-1||(l=h[e])!==null&&l!==void 0&&l.details)||e<-1||e>=h.length)){this.clearTimer();var n=h[e];if(this.log("Switching to subtitle track "+e),this.trackId=e,n){var t=n.id,i=n.groupId,y=i===void 0?"":i,u=n.name,f=n.type,c=n.url;this.hls.trigger(x.Events.SUBTITLE_TRACK_SWITCH,{id:t,groupId:y,name:u,type:f,url:c});var s=this.switchParams(n.url,a==null?void 0:a.details);this.loadPlaylist(s)}else this.hls.trigger(x.Events.SUBTITLE_TRACK_SWITCH,{id:e})}},d.onTextTracksChanged=function(){if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!(!this.media||!this.hls.config.renderTextTracksNatively)){for(var e=-1,a=g(this.media.textTracks),l=0;l<a.length;l++)if(a[l].mode==="hidden")e=l;else if(a[l].mode==="showing"){e=l;break}this.subtitleTrack!==e&&(this.subtitleTrack=e)}},I(E,[{key:"subtitleDisplay",get:function(){return this._subtitleDisplay},set:function(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes(this.trackId)}},{key:"subtitleTracks",get:function(){return this.tracksInGroup}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(e){this.selectDefaultTrack=!1;var a=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;this.setSubtitleTrack(e,a)}}]),E}(O.default);function g(D){for(var E=[],d=0;d<D.length;d++){var r=D[d];r.kind==="subtitles"&&r.label&&E.push(D[d])}return E}M.default=p},"./src/controller/timeline-controller.ts":function(K,M,L){L.r(M),L.d(M,"TimelineController",function(){return D});var x=L("./src/polyfills/number.ts"),R=L("./src/events.ts"),O=L("./src/utils/cea-608-parser.ts"),b=L("./src/utils/output-filter.ts"),C=L("./src/utils/webvtt-parser.ts"),I=L("./src/utils/texttrack-utils.ts"),T=L("./src/utils/imsc1-ttml-parser.ts"),m=L("./src/utils/mp4-tools.ts"),p=L("./src/types/loader.ts"),g=L("./src/utils/logger.ts"),D=function(){function e(l){if(this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.timescale=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=r(),this.captionsProperties=void 0,this.hls=l,this.config=l.config,this.Cues=l.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},this.config.enableCEA708Captions){var h=new b.default(this,"textTrack1"),n=new b.default(this,"textTrack2"),t=new b.default(this,"textTrack3"),i=new b.default(this,"textTrack4");this.cea608Parser1=new O.default(1,h,n),this.cea608Parser2=new O.default(3,t,i)}l.on(R.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),l.on(R.Events.MEDIA_DETACHING,this.onMediaDetaching,this),l.on(R.Events.MANIFEST_LOADING,this.onManifestLoading,this),l.on(R.Events.MANIFEST_LOADED,this.onManifestLoaded,this),l.on(R.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),l.on(R.Events.FRAG_LOADING,this.onFragLoading,this),l.on(R.Events.FRAG_LOADED,this.onFragLoaded,this),l.on(R.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),l.on(R.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),l.on(R.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),l.on(R.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),l.on(R.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)}var a=e.prototype;return a.destroy=function(){var h=this.hls;h.off(R.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),h.off(R.Events.MEDIA_DETACHING,this.onMediaDetaching,this),h.off(R.Events.MANIFEST_LOADING,this.onManifestLoading,this),h.off(R.Events.MANIFEST_LOADED,this.onManifestLoaded,this),h.off(R.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),h.off(R.Events.FRAG_LOADING,this.onFragLoading,this),h.off(R.Events.FRAG_LOADED,this.onFragLoaded,this),h.off(R.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),h.off(R.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),h.off(R.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),h.off(R.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),h.off(R.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.cea608Parser1=this.cea608Parser2=null},a.addCues=function(h,n,t,i,y){for(var u=!1,f=y.length;f--;){var c=y[f],s=d(c[0],c[1],n,t);if(s>=0&&(c[0]=Math.min(c[0],n),c[1]=Math.max(c[1],t),u=!0,s/(t-n)>.5))return}if(u||y.push([n,t]),this.config.renderTextTracksNatively){var o=this.captionsTracks[h];this.Cues.newCue(o,n,t,i)}else{var v=this.Cues.newCue(null,n,t,i);this.hls.trigger(R.Events.CUES_PARSED,{type:"captions",cues:v,track:h})}},a.onInitPtsFound=function(h,n){var t=this,i=n.frag,y=n.id,u=n.initPTS,f=n.timescale,c=this.unparsedVttFrags;y==="main"&&(this.initPTS[i.cc]=u,this.timescale[i.cc]=f),c.length&&(this.unparsedVttFrags=[],c.forEach(function(s){t.onFragLoaded(R.Events.FRAG_LOADED,s)}))},a.getExistingTrack=function(h){var n=this.media;if(n)for(var t=0;t<n.textTracks.length;t++){var i=n.textTracks[t];if(i[h])return i}return null},a.createCaptionsTrack=function(h){this.config.renderTextTracksNatively?this.createNativeTrack(h):this.createNonNativeTrack(h)},a.createNativeTrack=function(h){if(!this.captionsTracks[h]){var n=this.captionsProperties,t=this.captionsTracks,i=this.media,y=n[h],u=y.label,f=y.languageCode,c=this.getExistingTrack(h);if(c)t[h]=c,Object(I.clearCurrentCues)(t[h]),Object(I.sendAddTrackEvent)(t[h],i);else{var s=this.createTextTrack("captions",u,f);s&&(s[h]=!0,t[h]=s)}}},a.createNonNativeTrack=function(h){if(!this.nonNativeCaptionsTracks[h]){var n=this.captionsProperties[h];if(!!n){var t=n.label,i={_id:h,label:t,kind:"captions",default:n.media?!!n.media.default:!1,closedCaptions:n.media};this.nonNativeCaptionsTracks[h]=i,this.hls.trigger(R.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[i]})}}},a.createTextTrack=function(h,n,t){var i=this.media;if(!!i)return i.addTextTrack(h,n,t)},a.onMediaAttaching=function(h,n){this.media=n.media,this._cleanTracks()},a.onMediaDetaching=function(){var h=this.captionsTracks;Object.keys(h).forEach(function(n){Object(I.clearCurrentCues)(h[n]),delete h[n]}),this.nonNativeCaptionsTracks={}},a.onManifestLoading=function(){this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=r(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.timescale=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())},a._cleanTracks=function(){var h=this.media;if(!!h){var n=h.textTracks;if(n)for(var t=0;t<n.length;t++)Object(I.clearCurrentCues)(n[t])}},a.onSubtitleTracksUpdated=function(h,n){var t=this;this.textTracks=[];var i=n.subtitleTracks||[],y=i.some(function(s){return s.textCodec===T.IMSC1_CODEC});if(this.config.enableWebVTT||y&&this.config.enableIMSC1){var u=this.tracks&&i&&this.tracks.length===i.length;if(this.tracks=i||[],this.config.renderTextTracksNatively){var f=this.media?this.media.textTracks:[];this.tracks.forEach(function(s,o){var v;if(o<f.length){for(var S=null,A=0;A<f.length;A++)if(E(f[A],s)){S=f[A];break}S&&(v=S)}if(v)Object(I.clearCurrentCues)(v);else{var P=t._captionsOrSubtitlesFromCharacteristics(s);v=t.createTextTrack(P,s.name,s.lang),v&&(v.mode="disabled")}v&&(v.groupId=s.groupId,t.textTracks.push(v))})}else if(!u&&this.tracks&&this.tracks.length){var c=this.tracks.map(function(s){return{label:s.name,kind:s.type.toLowerCase(),default:s.default,subtitleTrack:s}});this.hls.trigger(R.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:c})}}},a._captionsOrSubtitlesFromCharacteristics=function(h){var n;if((n=h.attrs)!==null&&n!==void 0&&n.CHARACTERISTICS){var t=/transcribes-spoken-dialog/gi.test(h.attrs.CHARACTERISTICS),i=/describes-music-and-sound/gi.test(h.attrs.CHARACTERISTICS);if(t&&i)return"captions"}return"subtitles"},a.onManifestLoaded=function(h,n){var t=this;this.config.enableCEA708Captions&&n.captions&&n.captions.forEach(function(i){var y=/(?:CC|SERVICE)([1-4])/.exec(i.instreamId);if(!!y){var u="textTrack"+y[1],f=t.captionsProperties[u];!f||(f.label=i.name,i.lang&&(f.languageCode=i.lang),f.media=i)}})},a.onFragLoading=function(h,n){var t=this.cea608Parser1,i=this.cea608Parser2,y=this.lastSn,u=this.lastPartIndex;if(!(!this.enabled||!(t&&i))&&n.frag.type===p.PlaylistLevelType.MAIN){var f,c,s=n.frag.sn,o=(f=n==null||(c=n.part)===null||c===void 0?void 0:c.index)!=null?f:-1;s===y+1||s===y&&o===u+1||(t.reset(),i.reset()),this.lastSn=s,this.lastPartIndex=o}},a.onFragLoaded=function(h,n){var t=n.frag,i=n.payload,y=this.initPTS,u=this.unparsedVttFrags;if(t.type===p.PlaylistLevelType.SUBTITLE)if(i.byteLength){if(!Object(x.isFiniteNumber)(y[t.cc])){u.push(n),y.length&&this.hls.trigger(R.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t,error:new Error("Missing initial subtitle PTS")});return}var f=t.decryptdata,c="stats"in n;if(f==null||f.key==null||f.method!=="AES-128"||c){var s=this.tracks[t.level],o=this.vttCCs;o[t.cc]||(o[t.cc]={start:t.start,prevCC:this.prevCC,new:!0},this.prevCC=t.cc),s&&s.textCodec===T.IMSC1_CODEC?this._parseIMSC1(t,i):this._parseVTTs(t,i,o)}}else this.hls.trigger(R.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t,error:new Error("Empty subtitle payload")})},a._parseIMSC1=function(h,n){var t=this,i=this.hls;Object(T.parseIMSC1)(n,this.initPTS[h.cc],this.timescale[h.cc],function(y){t._appendCues(y,h.level),i.trigger(R.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:h})},function(y){g.logger.log("Failed to parse IMSC1: "+y),i.trigger(R.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:h,error:y})})},a._parseVTTs=function(h,n,t){var i,y=this,u=this.hls,f=(i=h.initSegment)!==null&&i!==void 0&&i.data?Object(m.appendUint8Array)(h.initSegment.data,new Uint8Array(n)):n;Object(C.parseWebVTT)(f,this.initPTS[h.cc],this.timescale[h.cc],t,h.cc,h.start,function(c){y._appendCues(c,h.level),u.trigger(R.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:h})},function(c){y._fallbackToIMSC1(h,n),g.logger.log("Failed to parse VTT cue: "+c),u.trigger(R.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:h,error:c})})},a._fallbackToIMSC1=function(h,n){var t=this,i=this.tracks[h.level];i.textCodec||Object(T.parseIMSC1)(n,this.initPTS[h.cc],this.timescale[h.cc],function(){i.textCodec=T.IMSC1_CODEC,t._parseIMSC1(h,n)},function(){i.textCodec="wvtt"})},a._appendCues=function(h,n){var t=this.hls;if(this.config.renderTextTracksNatively){var i=this.textTracks[n];if(!i||i.mode==="disabled")return;h.forEach(function(f){return Object(I.addCueToTrack)(i,f)})}else{var y=this.tracks[n];if(!y)return;var u=y.default?"default":"subtitles"+n;t.trigger(R.Events.CUES_PARSED,{type:"subtitles",cues:h,track:u})}},a.onFragDecrypted=function(h,n){var t=n.frag;if(t.type===p.PlaylistLevelType.SUBTITLE){if(!Object(x.isFiniteNumber)(this.initPTS[t.cc])){this.unparsedVttFrags.push(n);return}this.onFragLoaded(R.Events.FRAG_LOADED,n)}},a.onSubtitleTracksCleared=function(){this.tracks=[],this.captionsTracks={}},a.onFragParsingUserdata=function(h,n){var t=this.cea608Parser1,i=this.cea608Parser2;if(!(!this.enabled||!(t&&i)))for(var y=0;y<n.samples.length;y++){var u=n.samples[y].bytes;if(u){var f=this.extractCea608Data(u);t.addData(n.samples[y].pts,f[0]),i.addData(n.samples[y].pts,f[1])}}},a.onBufferFlushing=function(h,n){var t=n.startOffset,i=n.endOffset,y=n.endOffsetSubtitles,u=n.type,f=this.media;if(!(!f||f.currentTime<i)){if(!u||u==="video"){var c=this.captionsTracks;Object.keys(c).forEach(function(o){return Object(I.removeCuesInRange)(c[o],t,i)})}if(this.config.renderTextTracksNatively&&t===0&&y!==void 0){var s=this.textTracks;Object.keys(s).forEach(function(o){return Object(I.removeCuesInRange)(s[o],t,y)})}}},a.extractCea608Data=function(h){for(var n=[[],[]],t=h[0]&31,i=2,y=0;y<t;y++){var u=h[i++],f=127&h[i++],c=127&h[i++];if(!(f===0&&c===0)){var s=(4&u)!==0;if(s){var o=3&u;(o===0||o===1)&&(n[o].push(f),n[o].push(c))}}}return n},e}();function E(e,a){return e&&e.label===a.name&&!(e.textTrack1||e.textTrack2)}function d(e,a,l,h){return Math.min(a,h)-Math.max(e,l)}function r(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!1}}}},"./src/crypt/aes-crypto.ts":function(K,M,L){L.r(M),L.d(M,"default",function(){return x});var x=function(){function R(b,C){this.subtle=void 0,this.aesIV=void 0,this.subtle=b,this.aesIV=C}var O=R.prototype;return O.decrypt=function(C,I){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},I,C)},R}()},"./src/crypt/aes-decryptor.ts":function(K,M,L){L.r(M),L.d(M,"removePadding",function(){return R}),L.d(M,"default",function(){return O});var x=L("./src/utils/typed-array.ts");function R(b){var C=b.byteLength,I=C&&new DataView(b.buffer).getUint8(C-1);return I?Object(x.sliceUint8)(b,0,C-I):b}var O=function(){function b(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}var C=b.prototype;return C.uint8ArrayToUint32Array_=function(T){for(var m=new DataView(T),p=new Uint32Array(4),g=0;g<4;g++)p[g]=m.getUint32(g*4);return p},C.initTable=function(){var T=this.sBox,m=this.invSBox,p=this.subMix,g=p[0],D=p[1],E=p[2],d=p[3],r=this.invSubMix,e=r[0],a=r[1],l=r[2],h=r[3],n=new Uint32Array(256),t=0,i=0,y=0;for(y=0;y<256;y++)y<128?n[y]=y<<1:n[y]=y<<1^283;for(y=0;y<256;y++){var u=i^i<<1^i<<2^i<<3^i<<4;u=u>>>8^u&255^99,T[t]=u,m[u]=t;var f=n[t],c=n[f],s=n[c],o=n[u]*257^u*16843008;g[t]=o<<24|o>>>8,D[t]=o<<16|o>>>16,E[t]=o<<8|o>>>24,d[t]=o,o=s*16843009^c*65537^f*257^t*16843008,e[u]=o<<24|o>>>8,a[u]=o<<16|o>>>16,l[u]=o<<8|o>>>24,h[u]=o,t?(t=f^n[n[n[s^f]]],i^=n[n[i]]):t=i=1}},C.expandKey=function(T){for(var m=this.uint8ArrayToUint32Array_(T),p=!0,g=0;g<m.length&&p;)p=m[g]===this.key[g],g++;if(!p){this.key=m;var D=this.keySize=m.length;if(D!==4&&D!==6&&D!==8)throw new Error("Invalid aes key size="+D);var E=this.ksRows=(D+6+1)*4,d,r,e=this.keySchedule=new Uint32Array(E),a=this.invKeySchedule=new Uint32Array(E),l=this.sBox,h=this.rcon,n=this.invSubMix,t=n[0],i=n[1],y=n[2],u=n[3],f,c;for(d=0;d<E;d++){if(d<D){f=e[d]=m[d];continue}c=f,d%D===0?(c=c<<8|c>>>24,c=l[c>>>24]<<24|l[c>>>16&255]<<16|l[c>>>8&255]<<8|l[c&255],c^=h[d/D|0]<<24):D>6&&d%D===4&&(c=l[c>>>24]<<24|l[c>>>16&255]<<16|l[c>>>8&255]<<8|l[c&255]),e[d]=f=(e[d-D]^c)>>>0}for(r=0;r<E;r++)d=E-r,r&3?c=e[d]:c=e[d-4],r<4||d<=4?a[r]=c:a[r]=t[l[c>>>24]]^i[l[c>>>16&255]]^y[l[c>>>8&255]]^u[l[c&255]],a[r]=a[r]>>>0}},C.networkToHostOrderSwap=function(T){return T<<24|(T&65280)<<8|(T&16711680)>>8|T>>>24},C.decrypt=function(T,m,p){for(var g=this.keySize+6,D=this.invKeySchedule,E=this.invSBox,d=this.invSubMix,r=d[0],e=d[1],a=d[2],l=d[3],h=this.uint8ArrayToUint32Array_(p),n=h[0],t=h[1],i=h[2],y=h[3],u=new Int32Array(T),f=new Int32Array(u.length),c,s,o,v,S,A,P,_,F,k,B,w,U,N,W=this.networkToHostOrderSwap;m<u.length;){for(F=W(u[m]),k=W(u[m+1]),B=W(u[m+2]),w=W(u[m+3]),S=F^D[0],A=w^D[1],P=B^D[2],_=k^D[3],U=4,N=1;N<g;N++)c=r[S>>>24]^e[A>>16&255]^a[P>>8&255]^l[_&255]^D[U],s=r[A>>>24]^e[P>>16&255]^a[_>>8&255]^l[S&255]^D[U+1],o=r[P>>>24]^e[_>>16&255]^a[S>>8&255]^l[A&255]^D[U+2],v=r[_>>>24]^e[S>>16&255]^a[A>>8&255]^l[P&255]^D[U+3],S=c,A=s,P=o,_=v,U=U+4;c=E[S>>>24]<<24^E[A>>16&255]<<16^E[P>>8&255]<<8^E[_&255]^D[U],s=E[A>>>24]<<24^E[P>>16&255]<<16^E[_>>8&255]<<8^E[S&255]^D[U+1],o=E[P>>>24]<<24^E[_>>16&255]<<16^E[S>>8&255]<<8^E[A&255]^D[U+2],v=E[_>>>24]<<24^E[S>>16&255]<<16^E[A>>8&255]<<8^E[P&255]^D[U+3],f[m]=W(c^n),f[m+1]=W(v^t),f[m+2]=W(o^i),f[m+3]=W(s^y),n=F,t=k,i=B,y=w,m=m+4}return f.buffer},b}()},"./src/crypt/decrypter.ts":function(K,M,L){L.r(M),L.d(M,"default",function(){return m});var x=L("./src/crypt/aes-crypto.ts"),R=L("./src/crypt/fast-aes-key.ts"),O=L("./src/crypt/aes-decryptor.ts"),b=L("./src/utils/logger.ts"),C=L("./src/utils/mp4-tools.ts"),I=L("./src/utils/typed-array.ts"),T=16,m=function(){function p(D,E,d){var r=d===void 0?{}:d,e=r.removePKCS7Padding,a=e===void 0?!0:e;if(this.logEnabled=!0,this.observer=void 0,this.config=void 0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.observer=D,this.config=E,this.removePKCS7Padding=a,a)try{var l=self.crypto;l&&(this.subtle=l.subtle||l.webkitSubtle)}catch{}this.subtle===null&&(this.config.enableSoftwareAES=!0)}var g=p.prototype;return g.destroy=function(){this.observer=null},g.isSync=function(){return this.config.enableSoftwareAES},g.flush=function(){var E=this.currentResult;if(!E){this.reset();return}var d=new Uint8Array(E);return this.reset(),this.removePKCS7Padding?Object(O.removePadding)(d):d},g.reset=function(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)},g.decrypt=function(E,d,r,e){if(this.config.enableSoftwareAES){this.softwareDecrypt(new Uint8Array(E),d,r);var a=this.flush();a&&e(a.buffer)}else this.webCryptoDecrypt(new Uint8Array(E),d,r).then(e)},g.softwareDecrypt=function(E,d,r){var e=this.currentIV,a=this.currentResult,l=this.remainderData;this.logOnce("JS AES decrypt"),l&&(E=Object(C.appendUint8Array)(l,E),this.remainderData=null);var h=this.getValidChunk(E);if(!h.length)return null;e&&(r=e);var n=this.softwareDecrypter;n||(n=this.softwareDecrypter=new O.default),n.expandKey(d);var t=a;return this.currentResult=n.decrypt(h.buffer,0,r),this.currentIV=Object(I.sliceUint8)(h,-16).buffer,t||null},g.webCryptoDecrypt=function(E,d,r){var e=this,a=this.subtle;return(this.key!==d||!this.fastAesKey)&&(this.key=d,this.fastAesKey=new R.default(a,d)),this.fastAesKey.expandKey().then(function(l){if(!a)return Promise.reject(new Error("web crypto not initialized"));var h=new x.default(a,r);return h.decrypt(E.buffer,l)}).catch(function(l){return e.onWebCryptoError(l,E,d,r)})},g.onWebCryptoError=function(E,d,r,e){return b.logger.warn("[decrypter.ts]: WebCrypto Error, disable WebCrypto API:",E),this.config.enableSoftwareAES=!0,this.logEnabled=!0,this.softwareDecrypt(d,r,e)},g.getValidChunk=function(E){var d=E,r=E.length-E.length%T;return r!==E.length&&(d=Object(I.sliceUint8)(E,0,r),this.remainderData=Object(I.sliceUint8)(E,r)),d},g.logOnce=function(E){!this.logEnabled||(b.logger.log("[decrypter.ts]: "+E),this.logEnabled=!1)},p}()},"./src/crypt/fast-aes-key.ts":function(K,M,L){L.r(M),L.d(M,"default",function(){return x});var x=function(){function R(b,C){this.subtle=void 0,this.key=void 0,this.subtle=b,this.key=C}var O=R.prototype;return O.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},R}()},"./src/demux/aacdemuxer.ts":function(K,M,L){L.r(M);var x=L("./src/demux/base-audio-demuxer.ts"),R=L("./src/demux/adts.ts"),O=L("./src/utils/logger.ts"),b=L("./src/demux/id3.ts");function C(m,p){m.prototype=Object.create(p.prototype),m.prototype.constructor=m,I(m,p)}function I(m,p){return I=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(D,E){return D.__proto__=E,D},I(m,p)}var T=function(m){C(p,m);function p(D,E){var d;return d=m.call(this)||this,d.observer=void 0,d.config=void 0,d.observer=D,d.config=E,d}var g=p.prototype;return g.resetInitSegment=function(E,d,r,e){m.prototype.resetInitSegment.call(this,E,d,r,e),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:d,duration:e,inputTimeScale:9e4,dropped:0}},p.probe=function(E){if(!E)return!1;for(var d=b.getID3Data(E,0)||[],r=d.length,e=E.length;r<e;r++)if(R.probe(E,r))return O.logger.log("ADTS sync word found !"),!0;return!1},g.canParse=function(E,d){return R.canParse(E,d)},g.appendFrame=function(E,d,r){R.initTrackConfig(E,this.observer,d,r,E.manifestCodec);var e=R.appendFrame(E,d,r,this.basePTS,this.frameIndex);if(e&&e.missing===0)return e},p}(x.default);T.minProbeByteLength=9,M.default=T},"./src/demux/adts.ts":function(K,M,L){L.r(M),L.d(M,"getAudioConfig",function(){return b}),L.d(M,"isHeaderPattern",function(){return C}),L.d(M,"getHeaderLength",function(){return I}),L.d(M,"getFullFrameLength",function(){return T}),L.d(M,"canGetFrameLength",function(){return m}),L.d(M,"isHeader",function(){return p}),L.d(M,"canParse",function(){return g}),L.d(M,"probe",function(){return D}),L.d(M,"initTrackConfig",function(){return E}),L.d(M,"getFrameDuration",function(){return d}),L.d(M,"parseFrameHeader",function(){return r}),L.d(M,"appendFrame",function(){return e});var x=L("./src/utils/logger.ts"),R=L("./src/errors.ts"),O=L("./src/events.ts");function b(a,l,h,n){var t,i,y,u,f=navigator.userAgent.toLowerCase(),c=n,s=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];t=((l[h+2]&192)>>>6)+1;var o=(l[h+2]&60)>>>2;if(o>s.length-1){a.trigger(O.Events.ERROR,{type:R.ErrorTypes.MEDIA_ERROR,details:R.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+o});return}return y=(l[h+2]&1)<<2,y|=(l[h+3]&192)>>>6,x.logger.log("manifest codec:"+n+", ADTS type:"+t+", samplingIndex:"+o),/firefox/i.test(f)?o>=6?(t=5,u=new Array(4),i=o-3):(t=2,u=new Array(2),i=o):f.indexOf("android")!==-1?(t=2,u=new Array(2),i=o):(t=5,u=new Array(4),n&&(n.indexOf("mp4a.40.29")!==-1||n.indexOf("mp4a.40.5")!==-1)||!n&&o>=6?i=o-3:((n&&n.indexOf("mp4a.40.2")!==-1&&(o>=6&&y===1||/vivaldi/i.test(f))||!n&&y===1)&&(t=2,u=new Array(2)),i=o)),u[0]=t<<3,u[0]|=(o&14)>>1,u[1]|=(o&1)<<7,u[1]|=y<<3,t===5&&(u[1]|=(i&14)>>1,u[2]=(i&1)<<7,u[2]|=2<<2,u[3]=0),{config:u,samplerate:s[o],channelCount:y,codec:"mp4a.40."+t,manifestCodec:c}}function C(a,l){return a[l]===255&&(a[l+1]&246)===240}function I(a,l){return a[l+1]&1?7:9}function T(a,l){return(a[l+3]&3)<<11|a[l+4]<<3|(a[l+5]&224)>>>5}function m(a,l){return l+5<a.length}function p(a,l){return l+1<a.length&&C(a,l)}function g(a,l){return m(a,l)&&C(a,l)&&T(a,l)<=a.length-l}function D(a,l){if(p(a,l)){var h=I(a,l);if(l+h>=a.length)return!1;var n=T(a,l);if(n<=h)return!1;var t=l+n;return t===a.length||p(a,t)}return!1}function E(a,l,h,n,t){if(!a.samplerate){var i=b(l,h,n,t);if(!i)return;a.config=i.config,a.samplerate=i.samplerate,a.channelCount=i.channelCount,a.codec=i.codec,a.manifestCodec=i.manifestCodec,x.logger.log("parsed codec:"+a.codec+", rate:"+i.samplerate+", channels:"+i.channelCount)}}function d(a){return 1024*9e4/a}function r(a,l){var h=I(a,l);if(l+h<=a.length){var n=T(a,l)-h;if(n>0)return{headerLength:h,frameLength:n}}}function e(a,l,h,n,t){var i=d(a.samplerate),y=n+t*i,u=r(l,h),f;if(u){var c=u.frameLength,s=u.headerLength,o=s+c,v=Math.max(0,h+o-l.length);v?(f=new Uint8Array(o-s),f.set(l.subarray(h+s,l.length),0)):f=l.subarray(h+s,h+o);var S={unit:f,pts:y};return v||a.samples.push(S),{sample:S,length:o,missing:v}}var A=l.length-h;f=new Uint8Array(A),f.set(l.subarray(h,l.length),0);var P={unit:f,pts:y};return{sample:P,length:A,missing:-1}}},"./src/demux/base-audio-demuxer.ts":function(K,M,L){L.r(M),L.d(M,"initPTSFn",function(){return m});var x=L("./src/polyfills/number.ts"),R=L("./src/demux/id3.ts"),O=L("./src/types/demuxer.ts"),b=L("./src/demux/dummy-demuxed-track.ts"),C=L("./src/utils/mp4-tools.ts"),I=L("./src/utils/typed-array.ts"),T=function(){function p(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null}var g=p.prototype;return g.resetInitSegment=function(E,d,r,e){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}},g.resetTimeStamp=function(E){this.initPTS=E,this.resetContiguity()},g.resetContiguity=function(){this.basePTS=null,this.frameIndex=0},g.canParse=function(E,d){return!1},g.appendFrame=function(E,d,r){},g.demux=function(E,d){this.cachedData&&(E=Object(C.appendUint8Array)(this.cachedData,E),this.cachedData=null);var r=R.getID3Data(E,0),e=r?r.length:0,a,l,h=this._audioTrack,n=this._id3Track,t=r?R.getTimeStamp(r):void 0,i=E.length;for((this.basePTS===null||this.frameIndex===0&&Object(x.isFiniteNumber)(t))&&(this.basePTS=m(t,d,this.initPTS)),r&&r.length>0&&n.samples.push({pts:this.basePTS,dts:this.basePTS,data:r,type:O.MetadataSchema.audioId3}),l=this.basePTS;e<i;){if(this.canParse(E,e)){var y=this.appendFrame(h,E,e);y?(this.frameIndex++,l=y.sample.pts,e+=y.length,a=e):e=i}else R.canParse(E,e)?(r=R.getID3Data(E,e),n.samples.push({pts:l,dts:l,data:r,type:O.MetadataSchema.audioId3}),e+=r.length,a=e):e++;if(e===i&&a!==i){var u=Object(I.sliceUint8)(E,a);this.cachedData?this.cachedData=Object(C.appendUint8Array)(this.cachedData,u):this.cachedData=u}}return{audioTrack:h,videoTrack:Object(b.dummyTrack)(),id3Track:n,textTrack:Object(b.dummyTrack)()}},g.demuxSampleAes=function(E,d,r){return Promise.reject(new Error("["+this+"] This demuxer does not support Sample-AES decryption"))},g.flush=function(E){var d=this.cachedData;return d&&(this.cachedData=null,this.demux(d,0)),{audioTrack:this._audioTrack,videoTrack:Object(b.dummyTrack)(),id3Track:this._id3Track,textTrack:Object(b.dummyTrack)()}},g.destroy=function(){},p}(),m=function(g,D,E){return Object(x.isFiniteNumber)(g)?g*90:D*9e4+(E||0)};M.default=T},"./src/demux/chunk-cache.ts":function(K,M,L){L.r(M),L.d(M,"default",function(){return x});var x=function(){function O(){this.chunks=[],this.dataLength=0}var b=O.prototype;return b.push=function(I){this.chunks.push(I),this.dataLength+=I.length},b.flush=function(){var I=this.chunks,T=this.dataLength,m;if(I.length)I.length===1?m=I[0]:m=R(I,T);else return new Uint8Array(0);return this.reset(),m},b.reset=function(){this.chunks.length=0,this.dataLength=0},O}();function R(O,b){for(var C=new Uint8Array(b),I=0,T=0;T<O.length;T++){var m=O[T];C.set(m,I),I+=m.length}return C}},"./src/demux/dummy-demuxed-track.ts":function(K,M,L){L.r(M),L.d(M,"dummyTrack",function(){return x});function x(R,O){return R===void 0&&(R=""),O===void 0&&(O=9e4),{type:R,id:-1,pid:-1,inputTimeScale:O,sequenceNumber:-1,samples:[],dropped:0}}},"./src/demux/exp-golomb.ts":function(K,M,L){L.r(M);var x=L("./src/utils/logger.ts"),R=function(){function O(C){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=C,this.bytesAvailable=C.byteLength,this.word=0,this.bitsAvailable=0}var b=O.prototype;return b.loadWord=function(){var I=this.data,T=this.bytesAvailable,m=I.byteLength-T,p=new Uint8Array(4),g=Math.min(4,T);if(g===0)throw new Error("no bytes available");p.set(I.subarray(m,m+g)),this.word=new DataView(p.buffer).getUint32(0),this.bitsAvailable=g*8,this.bytesAvailable-=g},b.skipBits=function(I){var T;this.bitsAvailable>I?(this.word<<=I,this.bitsAvailable-=I):(I-=this.bitsAvailable,T=I>>3,I-=T>>3,this.bytesAvailable-=T,this.loadWord(),this.word<<=I,this.bitsAvailable-=I)},b.readBits=function(I){var T=Math.min(this.bitsAvailable,I),m=this.word>>>32-T;return I>32&&x.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=T,this.bitsAvailable>0?this.word<<=T:this.bytesAvailable>0&&this.loadWord(),T=I-T,T>0&&this.bitsAvailable?m<<T|this.readBits(T):m},b.skipLZ=function(){var I;for(I=0;I<this.bitsAvailable;++I)if((this.word&2147483648>>>I)!==0)return this.word<<=I,this.bitsAvailable-=I,I;return this.loadWord(),I+this.skipLZ()},b.skipUEG=function(){this.skipBits(1+this.skipLZ())},b.skipEG=function(){this.skipBits(1+this.skipLZ())},b.readUEG=function(){var I=this.skipLZ();return this.readBits(I+1)-1},b.readEG=function(){var I=this.readUEG();return 1&I?1+I>>>1:-1*(I>>>1)},b.readBoolean=function(){return this.readBits(1)===1},b.readUByte=function(){return this.readBits(8)},b.readUShort=function(){return this.readBits(16)},b.readUInt=function(){return this.readBits(32)},b.skipScalingList=function(I){for(var T=8,m=8,p,g=0;g<I;g++)m!==0&&(p=this.readEG(),m=(T+p+256)%256),T=m===0?T:m},b.readSPS=function(){var I=0,T=0,m=0,p=0,g,D,E,d=this.readUByte.bind(this),r=this.readBits.bind(this),e=this.readUEG.bind(this),a=this.readBoolean.bind(this),l=this.skipBits.bind(this),h=this.skipEG.bind(this),n=this.skipUEG.bind(this),t=this.skipScalingList.bind(this);d();var i=d();if(r(5),l(3),d(),n(),i===100||i===110||i===122||i===244||i===44||i===83||i===86||i===118||i===128){var y=e();if(y===3&&l(1),n(),n(),l(1),a())for(D=y!==3?8:12,E=0;E<D;E++)a()&&(E<6?t(16):t(64))}n();var u=e();if(u===0)e();else if(u===1)for(l(1),h(),h(),g=e(),E=0;E<g;E++)h();n(),l(1);var f=e(),c=e(),s=r(1);s===0&&l(1),l(1),a()&&(I=e(),T=e(),m=e(),p=e());var o=[1,1];if(a()&&a()){var v=d();switch(v){case 1:o=[1,1];break;case 2:o=[12,11];break;case 3:o=[10,11];break;case 4:o=[16,11];break;case 5:o=[40,33];break;case 6:o=[24,11];break;case 7:o=[20,11];break;case 8:o=[32,11];break;case 9:o=[80,33];break;case 10:o=[18,11];break;case 11:o=[15,11];break;case 12:o=[64,33];break;case 13:o=[160,99];break;case 14:o=[4,3];break;case 15:o=[3,2];break;case 16:o=[2,1];break;case 255:{o=[d()<<8|d(),d()<<8|d()];break}}}return{width:Math.ceil((f+1)*16-I*2-T*2),height:(2-s)*(c+1)*16-(s?2:4)*(m+p),pixelRatio:o}},b.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},O}();M.default=R},"./src/demux/id3.ts":function(K,M,L){L.r(M),L.d(M,"isHeader",function(){return x}),L.d(M,"isFooter",function(){return R}),L.d(M,"getID3Data",function(){return O}),L.d(M,"canParse",function(){return C}),L.d(M,"getTimeStamp",function(){return I}),L.d(M,"isTimeStampFrame",function(){return T}),L.d(M,"getID3Frames",function(){return p}),L.d(M,"decodeFrame",function(){return g}),L.d(M,"utf8ArrayToStr",function(){return e}),L.d(M,"testables",function(){return a});var x=function(t,i){return i+10<=t.length&&t[i]===73&&t[i+1]===68&&t[i+2]===51&&t[i+3]<255&&t[i+4]<255&&t[i+6]<128&&t[i+7]<128&&t[i+8]<128&&t[i+9]<128},R=function(t,i){return i+10<=t.length&&t[i]===51&&t[i+1]===68&&t[i+2]===73&&t[i+3]<255&&t[i+4]<255&&t[i+6]<128&&t[i+7]<128&&t[i+8]<128&&t[i+9]<128},O=function(t,i){for(var y=i,u=0;x(t,i);){u+=10;var f=b(t,i+6);u+=f,R(t,i+10)&&(u+=10),i+=u}if(u>0)return t.subarray(y,y+u)},b=function(t,i){var y=0;return y=(t[i]&127)<<21,y|=(t[i+1]&127)<<14,y|=(t[i+2]&127)<<7,y|=t[i+3]&127,y},C=function(t,i){return x(t,i)&&b(t,i+6)+10<=t.length-i},I=function(t){for(var i=p(t),y=0;y<i.length;y++){var u=i[y];if(T(u))return r(u)}},T=function(t){return t&&t.key==="PRIV"&&t.info==="com.apple.streaming.transportStreamTimestamp"},m=function(t){var i=String.fromCharCode(t[0],t[1],t[2],t[3]),y=b(t,4),u=10;return{type:i,size:y,data:t.subarray(u,u+y)}},p=function(t){for(var i=0,y=[];x(t,i);){var u=b(t,i+6);i+=10;for(var f=i+u;i+8<f;){var c=m(t.subarray(i)),s=g(c);s&&y.push(s),i+=c.size+10}R(t,i)&&(i+=10)}return y},g=function(t){return t.type==="PRIV"?D(t):t.type[0]==="W"?d(t):E(t)},D=function(t){if(!(t.size<2)){var i=e(t.data,!0),y=new Uint8Array(t.data.subarray(i.length+1));return{key:t.type,info:i,data:y.buffer}}},E=function(t){if(!(t.size<2)){if(t.type==="TXXX"){var i=1,y=e(t.data.subarray(i),!0);i+=y.length+1;var u=e(t.data.subarray(i));return{key:t.type,info:y,data:u}}var f=e(t.data.subarray(1));return{key:t.type,data:f}}},d=function(t){if(t.type==="WXXX"){if(t.size<2)return;var i=1,y=e(t.data.subarray(i),!0);i+=y.length+1;var u=e(t.data.subarray(i));return{key:t.type,info:y,data:u}}var f=e(t.data);return{key:t.type,data:f}},r=function(t){if(t.data.byteLength===8){var i=new Uint8Array(t.data),y=i[3]&1,u=(i[4]<<23)+(i[5]<<15)+(i[6]<<7)+i[7];return u/=45,y&&(u+=4772185884e-2),Math.round(u)}},e=function(t,i){i===void 0&&(i=!1);var y=h();if(y){var u=y.decode(t);if(i){var f=u.indexOf("\0");return f!==-1?u.substring(0,f):u}return u.replace(/\0/g,"")}for(var c=t.length,s,o,v,S="",A=0;A<c;){if(s=t[A++],s===0&&i)return S;if(s===0||s===3)continue;switch(s>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:S+=String.fromCharCode(s);break;case 12:case 13:o=t[A++],S+=String.fromCharCode((s&31)<<6|o&63);break;case 14:o=t[A++],v=t[A++],S+=String.fromCharCode((s&15)<<12|(o&63)<<6|(v&63)<<0);break}}return S},a={decodeTextFrame:E},l;function h(){return!l&&typeof self.TextDecoder<"u"&&(l=new self.TextDecoder("utf-8")),l}},"./src/demux/mp3demuxer.ts":function(K,M,L){L.r(M);var x=L("./src/demux/base-audio-demuxer.ts"),R=L("./src/demux/id3.ts"),O=L("./src/utils/logger.ts"),b=L("./src/demux/mpegaudio.ts");function C(m,p){m.prototype=Object.create(p.prototype),m.prototype.constructor=m,I(m,p)}function I(m,p){return I=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(D,E){return D.__proto__=E,D},I(m,p)}var T=function(m){C(p,m);function p(){return m.apply(this,arguments)||this}var g=p.prototype;return g.resetInitSegment=function(E,d,r,e){m.prototype.resetInitSegment.call(this,E,d,r,e),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:d,duration:e,inputTimeScale:9e4,dropped:0}},p.probe=function(E){if(!E)return!1;for(var d=R.getID3Data(E,0)||[],r=d.length,e=E.length;r<e;r++)if(b.probe(E,r))return O.logger.log("MPEG Audio sync word found !"),!0;return!1},g.canParse=function(E,d){return b.canParse(E,d)},g.appendFrame=function(E,d,r){if(this.basePTS!==null)return b.appendFrame(E,d,r,this.basePTS,this.frameIndex)},p}(x.default);T.minProbeByteLength=4,M.default=T},"./src/demux/mp4demuxer.ts":function(K,M,L){L.r(M);var x=L("./src/polyfills/number.ts"),R=L("./src/types/demuxer.ts"),O=L("./src/utils/mp4-tools.ts"),b=L("./src/demux/dummy-demuxed-track.ts"),C=/\/emsg[-/]ID3/i,I=function(){function T(p,g){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=g}var m=T.prototype;return m.resetTimeStamp=function(){},m.resetInitSegment=function(g,D,E,d){var r=Object(O.parseInitSegment)(g),e=this.videoTrack=Object(b.dummyTrack)("video",1),a=this.audioTrack=Object(b.dummyTrack)("audio",1),l=this.txtTrack=Object(b.dummyTrack)("text",1);if(this.id3Track=Object(b.dummyTrack)("id3",1),this.timeOffset=0,r.video){var h=r.video,n=h.id,t=h.timescale,i=h.codec;e.id=n,e.timescale=l.timescale=t,e.codec=i}if(r.audio){var y=r.audio,u=y.id,f=y.timescale,c=y.codec;a.id=u,a.timescale=f,a.codec=c}l.id=O.RemuxerTrackIdConfig.text,e.sampleDuration=0,e.duration=a.duration=d},m.resetContiguity=function(){},T.probe=function(g){return g=g.length>16384?g.subarray(0,16384):g,Object(O.findBox)(g,["moof"]).length>0},m.demux=function(g,D){this.timeOffset=D;var E=g,d=this.videoTrack,r=this.txtTrack;if(this.config.progressive){this.remainderData&&(E=Object(O.appendUint8Array)(this.remainderData,g));var e=Object(O.segmentValidRange)(E);this.remainderData=e.remainder,d.samples=e.valid||new Uint8Array}else d.samples=E;var a=this.extractID3Track(d,D);return r.samples=Object(O.parseSamples)(D,d),{videoTrack:d,audioTrack:this.audioTrack,id3Track:a,textTrack:this.txtTrack}},m.flush=function(){var g=this.timeOffset,D=this.videoTrack,E=this.txtTrack;D.samples=this.remainderData||new Uint8Array,this.remainderData=null;var d=this.extractID3Track(D,this.timeOffset);return E.samples=Object(O.parseSamples)(g,D),{videoTrack:D,audioTrack:Object(b.dummyTrack)(),id3Track:d,textTrack:Object(b.dummyTrack)()}},m.extractID3Track=function(g,D){var E=this.id3Track;if(g.samples.length){var d=Object(O.findBox)(g.samples,["emsg"]);d&&d.forEach(function(r){var e=Object(O.parseEmsg)(r);if(C.test(e.schemeIdUri)){var a=Object(x.isFiniteNumber)(e.presentationTime)?e.presentationTime/e.timeScale:D+e.presentationTimeDelta/e.timeScale,l=e.payload;E.samples.push({data:l,len:l.byteLength,dts:a,pts:a,type:R.MetadataSchema.emsg})}})}return E},m.demuxSampleAes=function(g,D,E){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))},m.destroy=function(){},T}();I.minProbeByteLength=1024,M.default=I},"./src/demux/mpegaudio.ts":function(K,M,L){L.r(M),L.d(M,"appendFrame",function(){return I}),L.d(M,"parseHeader",function(){return T}),L.d(M,"isHeaderPattern",function(){return m}),L.d(M,"isHeader",function(){return p}),L.d(M,"canParse",function(){return g}),L.d(M,"probe",function(){return D});var x=null,R=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],O=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],b=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],C=[0,1,1,4];function I(E,d,r,e,a){if(!(r+24>d.length)){var l=T(d,r);if(l&&r+l.frameLength<=d.length){var h=l.samplesPerFrame*9e4/l.sampleRate,n=e+a*h,t={unit:d.subarray(r,r+l.frameLength),pts:n,dts:n};return E.config=[],E.channelCount=l.channelCount,E.samplerate=l.sampleRate,E.samples.push(t),{sample:t,length:l.frameLength,missing:0}}}}function T(E,d){var r=E[d+1]>>3&3,e=E[d+1]>>1&3,a=E[d+2]>>4&15,l=E[d+2]>>2&3;if(r!==1&&a!==0&&a!==15&&l!==3){var h=E[d+2]>>1&1,n=E[d+3]>>6,t=r===3?3-e:e===3?3:4,i=R[t*14+a-1]*1e3,y=r===3?0:r===2?1:2,u=O[y*3+l],f=n===3?1:2,c=b[r][e],s=C[e],o=c*8*s,v=Math.floor(c*i/u+h)*s;if(x===null){var S=navigator.userAgent||"",A=S.match(/Chrome\/(\d+)/i);x=A?parseInt(A[1]):0}var P=!!x&&x<=87;return P&&e===2&&i>=224e3&&n===0&&(E[d+3]=E[d+3]|128),{sampleRate:u,channelCount:f,frameLength:v,samplesPerFrame:o}}}function m(E,d){return E[d]===255&&(E[d+1]&224)===224&&(E[d+1]&6)!==0}function p(E,d){return d+1<E.length&&m(E,d)}function g(E,d){var r=4;return m(E,d)&&r<=E.length-d}function D(E,d){if(d+1<E.length&&m(E,d)){var r=4,e=T(E,d),a=r;e!=null&&e.frameLength&&(a=e.frameLength);var l=d+a;return l===E.length||p(E,l)}return!1}},"./src/demux/sample-aes.ts":function(K,M,L){L.r(M);var x=L("./src/crypt/decrypter.ts"),R=L("./src/demux/tsdemuxer.ts"),O=function(){function b(I,T,m){this.keyData=void 0,this.decrypter=void 0,this.keyData=m,this.decrypter=new x.default(I,T,{removePKCS7Padding:!1})}var C=b.prototype;return C.decryptBuffer=function(T,m){this.decrypter.decrypt(T,this.keyData.key.buffer,this.keyData.iv.buffer,m)},C.decryptAacSample=function(T,m,p,g){var D=T[m].unit;if(!(D.length<=16)){var E=D.subarray(16,D.length-D.length%16),d=E.buffer.slice(E.byteOffset,E.byteOffset+E.length),r=this;this.decryptBuffer(d,function(e){var a=new Uint8Array(e);D.set(a,16),g||r.decryptAacSamples(T,m+1,p)})}},C.decryptAacSamples=function(T,m,p){for(;;m++){if(m>=T.length){p();return}if(!(T[m].unit.length<32)){var g=this.decrypter.isSync();if(this.decryptAacSample(T,m,p,g),!g)return}}},C.getAvcEncryptedData=function(T){for(var m=Math.floor((T.length-48)/160)*16+16,p=new Int8Array(m),g=0,D=32;D<T.length-16;D+=160,g+=16)p.set(T.subarray(D,D+16),g);return p},C.getAvcDecryptedUnit=function(T,m){for(var p=new Uint8Array(m),g=0,D=32;D<T.length-16;D+=160,g+=16)T.set(p.subarray(g,g+16),D);return T},C.decryptAvcSample=function(T,m,p,g,D,E){var d=Object(R.discardEPB)(D.data),r=this.getAvcEncryptedData(d),e=this;this.decryptBuffer(r.buffer,function(a){D.data=e.getAvcDecryptedUnit(d,a),E||e.decryptAvcSamples(T,m,p+1,g)})},C.decryptAvcSamples=function(T,m,p,g){if(T instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;m++,p=0){if(m>=T.length){g();return}for(var D=T[m].units;!(p>=D.length);p++){var E=D[p];if(!(E.data.length<=48||E.type!==1&&E.type!==5)){var d=this.decrypter.isSync();if(this.decryptAvcSample(T,m,p,g,E,d),!d)return}}}},b}();M.default=O},"./src/demux/transmuxer-interface.ts":function(K,M,L){L.r(M),L.d(M,"default",function(){return p});var x=L("./node_modules/webworkify-webpack/index.js"),R=L("./src/events.ts"),O=L("./src/demux/transmuxer.ts"),b=L("./src/utils/logger.ts"),C=L("./src/errors.ts"),I=L("./src/utils/mediasource-helper.ts"),T=L("./node_modules/eventemitter3/index.js"),m=Object(I.getMediaSource)()||{isTypeSupported:function(){return!1}},p=function(){function g(E,d,r,e){var a=this;this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.worker=void 0,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.hls=E,this.id=d,this.onTransmuxComplete=r,this.onFlush=e;var l=E.config,h=function(u,f){f=f||{},f.frag=a.frag,f.id=a.id,E.trigger(u,f)};this.observer=new T.EventEmitter,this.observer.on(R.Events.FRAG_DECRYPTED,h),this.observer.on(R.Events.ERROR,h);var n={mp4:m.isTypeSupported("video/mp4"),mpeg:m.isTypeSupported("audio/mpeg"),mp3:m.isTypeSupported('audio/mp4; codecs="mp3"')},t=navigator.vendor;if(l.enableWorker&&typeof Worker<"u"){b.logger.log("demuxing in webworker");var i;try{i=this.worker=x("./src/demux/transmuxer-worker.ts"),this.onwmsg=this.onWorkerMessage.bind(this),i.addEventListener("message",this.onwmsg),i.onerror=function(y){E.trigger(R.Events.ERROR,{type:C.ErrorTypes.OTHER_ERROR,details:C.ErrorDetails.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",error:new Error(y.message+"  ("+y.filename+":"+y.lineno+")")})},i.postMessage({cmd:"init",typeSupported:n,vendor:t,id:d,config:JSON.stringify(l)})}catch(y){b.logger.warn("Error in worker:",y),b.logger.error("Error while initializing DemuxerWorker, fallback to inline"),i&&self.URL.revokeObjectURL(i.objectURL),this.transmuxer=new O.default(this.observer,n,l,t,d),this.worker=null}}else this.transmuxer=new O.default(this.observer,n,l,t,d)}var D=g.prototype;return D.destroy=function(){var d=this.worker;if(d)d.removeEventListener("message",this.onwmsg),d.terminate(),this.worker=null,this.onwmsg=void 0;else{var r=this.transmuxer;r&&(r.destroy(),this.transmuxer=null)}var e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.observer=null,this.hls=null},D.push=function(d,r,e,a,l,h,n,t,i,y){var u,f,c=this;i.transmuxing.start=self.performance.now();var s=this.transmuxer,o=this.worker,v=h?h.start:l.start,S=l.decryptdata,A=this.frag,P=!(A&&l.cc===A.cc),_=!(A&&i.level===A.level),F=A?i.sn-A.sn:-1,k=this.part?i.part-this.part.index:-1,B=F===0&&i.id>1&&i.id===(A==null?void 0:A.stats.chunkCount),w=!_&&(F===1||F===0&&(k===1||B&&k<=0)),U=self.performance.now();(_||F||l.stats.parsing.start===0)&&(l.stats.parsing.start=U),h&&(k||!w)&&(h.stats.parsing.start=U);var N=!(A&&((u=l.initSegment)===null||u===void 0?void 0:u.url)===((f=A.initSegment)===null||f===void 0?void 0:f.url)),W=new O.TransmuxState(P,w,t,_,v,N);if(!w||P||N){b.logger.log("[transmuxer-interface, "+l.type+"]: Starting new transmux session for sn: "+i.sn+" p: "+i.part+" level: "+i.level+" id: "+i.id+`
        discontinuity: `+P+`
        trackSwitch: `+_+`
        contiguous: `+w+`
        accurateTimeOffset: `+t+`
        timeOffset: `+v+`
        initSegmentChange: `+N);var j=new O.TransmuxConfig(e,a,r,n,y);this.configureTransmuxer(j)}if(this.frag=l,this.part=h,o)o.postMessage({cmd:"demux",data:d,decryptdata:S,chunkMeta:i,state:W},d instanceof ArrayBuffer?[d]:[]);else if(s){var H=s.push(d,S,i,W);Object(O.isPromise)(H)?H.then(function(G){c.handleTransmuxComplete(G)}):this.handleTransmuxComplete(H)}},D.flush=function(d){var r=this;d.transmuxing.start=self.performance.now();var e=this.transmuxer,a=this.worker;if(a)a.postMessage({cmd:"flush",chunkMeta:d});else if(e){var l=e.flush(d);Object(O.isPromise)(l)?l.then(function(h){r.handleFlushResult(h,d)}):this.handleFlushResult(l,d)}},D.handleFlushResult=function(d,r){var e=this;d.forEach(function(a){e.handleTransmuxComplete(a)}),this.onFlush(r)},D.onWorkerMessage=function(d){var r=d.data,e=this.hls;switch(r.event){case"init":{self.URL.revokeObjectURL(this.worker.objectURL);break}case"transmuxComplete":{this.handleTransmuxComplete(r.data);break}case"flush":{this.onFlush(r.data);break}case"workerLog":b.logger[r.data.logType]&&b.logger[r.data.logType](r.data.message);break;default:{r.data=r.data||{},r.data.frag=this.frag,r.data.id=this.id,e.trigger(r.event,r.data);break}}},D.configureTransmuxer=function(d){var r=this.worker,e=this.transmuxer;r?r.postMessage({cmd:"configure",config:d}):e&&e.configure(d)},D.handleTransmuxComplete=function(d){d.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(d)},g}()},"./src/demux/transmuxer-worker.ts":function(K,M,L){L.r(M),L.d(M,"default",function(){return C});var x=L("./src/demux/transmuxer.ts"),R=L("./src/events.ts"),O=L("./src/utils/logger.ts"),b=L("./node_modules/eventemitter3/index.js");function C(g){var D=new b.EventEmitter,E=function(e,a){g.postMessage({event:e,data:a})};D.on(R.Events.FRAG_DECRYPTED,E),D.on(R.Events.ERROR,E);var d=function(){var e=function(h){var n=function(i){E("workerLog",{logType:h,message:i})};O.logger[h]=n};for(var a in O.logger)e(a)};g.addEventListener("message",function(r){var e=r.data;switch(e.cmd){case"init":{var a=JSON.parse(e.config);g.transmuxer=new x.default(D,e.typeSupported,a,e.vendor,e.id),Object(O.enableLogs)(a.debug),d(),E("init",null);break}case"configure":{g.transmuxer.configure(e.config);break}case"demux":{var l=g.transmuxer.push(e.data,e.decryptdata,e.chunkMeta,e.state);Object(x.isPromise)(l)?l.then(function(t){I(g,t)}):I(g,l);break}case"flush":{var h=e.chunkMeta,n=g.transmuxer.flush(h);Object(x.isPromise)(n)?n.then(function(t){m(g,t,h)}):m(g,n,h);break}}})}function I(g,D){if(p(D.remuxResult))return!1;var E=[],d=D.remuxResult,r=d.audio,e=d.video;return r&&T(E,r),e&&T(E,e),g.postMessage({event:"transmuxComplete",data:D},E),!0}function T(g,D){D.data1&&g.push(D.data1.buffer),D.data2&&g.push(D.data2.buffer)}function m(g,D,E){var d=D.reduce(function(r,e){return I(g,e)||r},!1);d||g.postMessage({event:"transmuxComplete",data:D[0]}),g.postMessage({event:"flush",data:E})}function p(g){return!g.audio&&!g.video&&!g.text&&!g.id3&&!g.initSegment}},"./src/demux/transmuxer.ts":function(K,M,L){L.r(M),L.d(M,"default",function(){return a}),L.d(M,"isPromise",function(){return n}),L.d(M,"TransmuxConfig",function(){return t}),L.d(M,"TransmuxState",function(){return i});var x=L("./src/events.ts"),R=L("./src/errors.ts"),O=L("./src/crypt/decrypter.ts"),b=L("./src/demux/aacdemuxer.ts"),C=L("./src/demux/mp4demuxer.ts"),I=L("./src/demux/tsdemuxer.ts"),T=L("./src/demux/mp3demuxer.ts"),m=L("./src/remux/mp4-remuxer.ts"),p=L("./src/remux/passthrough-remuxer.ts"),g=L("./src/demux/chunk-cache.ts"),D=L("./src/utils/mp4-tools.ts"),E=L("./src/utils/logger.ts"),d;try{d=self.performance.now.bind(self.performance)}catch{E.logger.debug("Unable to use Performance API on this environment"),d=self.Date.now}var r=[{demux:I.default,remux:m.default},{demux:C.default,remux:p.default},{demux:b.default,remux:m.default},{demux:T.default,remux:m.default}],e=1024;r.forEach(function(y){var u=y.demux;e=Math.max(e,u.minProbeByteLength)});var a=function(){function y(f,c,s,o,v){this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.cache=new g.default,this.observer=f,this.typeSupported=c,this.config=s,this.vendor=o,this.id=v}var u=y.prototype;return u.configure=function(c){this.transmuxConfig=c,this.decrypter&&this.decrypter.reset()},u.push=function(c,s,o,v){var S=this,A=o.transmuxing;A.executeStart=d();var P=new Uint8Array(c),_=this.cache,F=this.config,k=this.currentTransmuxState,B=this.transmuxConfig;v&&(this.currentTransmuxState=v);var w=l(P,s);if(w&&w.method==="AES-128"){var U=this.getDecrypter();if(F.enableSoftwareAES){var N=U.softwareDecrypt(P,w.key.buffer,w.iv.buffer);if(!N)return A.executeEnd=d(),h(o);P=new Uint8Array(N)}else return this.decryptionPromise=U.webCryptoDecrypt(P,w.key.buffer,w.iv.buffer).then(function(re){var oe=S.push(re,null,o);return S.decryptionPromise=null,oe}),this.decryptionPromise}var W=v||k,j=W.contiguous,H=W.discontinuity,G=W.trackSwitch,z=W.accurateTimeOffset,Z=W.timeOffset,Y=W.initSegmentChange,V=B.audioCodec,$=B.videoCodec,X=B.defaultInitPts,Q=B.duration,J=B.initSegmentData;if((H||G||Y)&&this.resetInitSegment(J,V,$,Q),(H||Y)&&this.resetInitialTimestamp(X),j||this.resetContiguity(),this.needsProbing(P,H,G)){if(_.dataLength){var q=_.flush();P=Object(D.appendUint8Array)(q,P)}this.configureTransmuxer(P,B)}var ee=this.transmux(P,w,Z,z,o),te=this.currentTransmuxState;return te.contiguous=!0,te.discontinuity=!1,te.trackSwitch=!1,A.executeEnd=d(),ee},u.flush=function(c){var s=this,o=c.transmuxing;o.executeStart=d();var v=this.decrypter,S=this.cache,A=this.currentTransmuxState,P=this.decryptionPromise;if(P)return P.then(function(){return s.flush(c)});var _=[],F=A.timeOffset;if(v){var k=v.flush();k&&_.push(this.push(k,null,c))}var B=S.dataLength;S.reset();var w=this.demuxer,U=this.remuxer;if(!w||!U)return B>=e&&this.observer.emit(x.Events.ERROR,x.Events.ERROR,{type:R.ErrorTypes.MEDIA_ERROR,details:R.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"}),o.executeEnd=d(),[h(c)];var N=w.flush(F);return n(N)?N.then(function(W){return s.flushRemux(_,W,c),_}):(this.flushRemux(_,N,c),_)},u.flushRemux=function(c,s,o){var v=s.audioTrack,S=s.videoTrack,A=s.id3Track,P=s.textTrack,_=this.currentTransmuxState,F=_.accurateTimeOffset,k=_.timeOffset;E.logger.log("[transmuxer.ts]: Flushed fragment "+o.sn+(o.part>-1?" p: "+o.part:"")+" of level "+o.level);var B=this.remuxer.remux(v,S,A,P,k,F,!0,this.id);c.push({remuxResult:B,chunkMeta:o}),o.transmuxing.executeEnd=d()},u.resetInitialTimestamp=function(c){var s=this.demuxer,o=this.remuxer;!s||!o||(s.resetTimeStamp(c),o.resetTimeStamp(c))},u.resetContiguity=function(){var c=this.demuxer,s=this.remuxer;!c||!s||(c.resetContiguity(),s.resetNextTimestamp())},u.resetInitSegment=function(c,s,o,v){var S=this.demuxer,A=this.remuxer;!S||!A||(S.resetInitSegment(c,s,o,v),A.resetInitSegment(c,s,o))},u.destroy=function(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)},u.transmux=function(c,s,o,v,S){var A;return s&&s.method==="SAMPLE-AES"?A=this.transmuxSampleAes(c,s,o,v,S):A=this.transmuxUnencrypted(c,o,v,S),A},u.transmuxUnencrypted=function(c,s,o,v){var S=this.demuxer.demux(c,s,!1,!this.config.progressive),A=S.audioTrack,P=S.videoTrack,_=S.id3Track,F=S.textTrack,k=this.remuxer.remux(A,P,_,F,s,o,!1,this.id);return{remuxResult:k,chunkMeta:v}},u.transmuxSampleAes=function(c,s,o,v,S){var A=this;return this.demuxer.demuxSampleAes(c,s,o).then(function(P){var _=A.remuxer.remux(P.audioTrack,P.videoTrack,P.id3Track,P.textTrack,o,v,!1,A.id);return{remuxResult:_,chunkMeta:S}})},u.configureTransmuxer=function(c,s){for(var o=this.config,v=this.observer,S=this.typeSupported,A=this.vendor,P=s.audioCodec,_=s.defaultInitPts,F=s.duration,k=s.initSegmentData,B=s.videoCodec,w,U=0,N=r.length;U<N;U++)if(r[U].demux.probe(c)){w=r[U];break}w||(E.logger.warn("Failed to find demuxer by probing frag, treating as mp4 passthrough"),w={demux:C.default,remux:p.default});var W=this.demuxer,j=this.remuxer,H=w.remux,G=w.demux;(!j||!(j instanceof H))&&(this.remuxer=new H(v,o,S,A)),(!W||!(W instanceof G))&&(this.demuxer=new G(v,o,S),this.probe=G.probe),this.resetInitSegment(k,P,B,F),this.resetInitialTimestamp(_)},u.needsProbing=function(c,s,o){return!this.demuxer||!this.remuxer||s||o},u.getDecrypter=function(){var c=this.decrypter;return c||(c=this.decrypter=new O.default(this.observer,this.config)),c},y}();function l(y,u){var f=null;return y.byteLength>0&&u!=null&&u.key!=null&&u.iv!==null&&u.method!=null&&(f=u),f}var h=function(u){return{remuxResult:{},chunkMeta:u}};function n(y){return"then"in y&&y.then instanceof Function}var t=function(u,f,c,s,o){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=u,this.videoCodec=f,this.initSegmentData=c,this.duration=s,this.defaultInitPts=o},i=function(u,f,c,s,o,v){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=u,this.contiguous=f,this.accurateTimeOffset=c,this.trackSwitch=s,this.timeOffset=o,this.initSegmentChange=v}},"./src/demux/tsdemuxer.ts":function(K,M,L){L.r(M),L.d(M,"discardEPB",function(){return l});var x=L("./src/demux/adts.ts"),R=L("./src/demux/mpegaudio.ts"),O=L("./src/demux/exp-golomb.ts"),b=L("./src/demux/sample-aes.ts"),C=L("./src/events.ts"),I=L("./src/utils/mp4-tools.ts"),T=L("./src/utils/logger.ts"),m=L("./src/errors.ts"),p=L("./src/types/demuxer.ts");function g(){return g=Object.assign?Object.assign.bind():function(h){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(h[i]=t[i])}return h},g.apply(this,arguments)}var D=function(){function h(t,i,y){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.observer=t,this.config=i,this.typeSupported=y}h.probe=function(i){var y=h.syncOffset(i);return y<0?!1:(y&&T.logger.warn("MPEG2-TS detected but first sync word found @ offset "+y+", junk ahead ?"),!0)},h.syncOffset=function(i){for(var y=Math.min(1e3,i.length-564),u=0;u<y;){if(i[u]===71&&i[u+188]===71&&i[u+2*188]===71)return u;u++}return-1},h.createTrack=function(i,y){return{container:i==="video"||i==="audio"?"video/mp2t":void 0,type:i,id:I.RemuxerTrackIdConfig[i],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:i==="audio"?y:void 0}};var n=h.prototype;return n.resetInitSegment=function(i,y,u,f){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=h.createTrack("video"),this._audioTrack=h.createTrack("audio",f),this._id3Track=h.createTrack("id3"),this._txtTrack=h.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.avcSample=null,this.audioCodec=y,this.videoCodec=u,this._duration=f},n.resetTimeStamp=function(){},n.resetContiguity=function(){var i=this._audioTrack,y=this._avcTrack,u=this._id3Track;i&&(i.pesData=null),y&&(y.pesData=null),u&&(u.pesData=null),this.aacOverFlow=null},n.demux=function(i,y,u,f){u===void 0&&(u=!1),f===void 0&&(f=!1),u||(this.sampleAes=null);var c,s=this._avcTrack,o=this._audioTrack,v=this._id3Track,S=this._txtTrack,A=s.pid,P=s.pesData,_=o.pid,F=v.pid,k=o.pesData,B=v.pesData,w=!1,U=this.pmtParsed,N=this._pmtId,W=i.length;if(this.remainderData&&(i=Object(I.appendUint8Array)(this.remainderData,i),W=i.length,this.remainderData=null),W<188&&!f)return this.remainderData=i,{audioTrack:o,videoTrack:s,id3Track:v,textTrack:S};var j=Math.max(0,h.syncOffset(i));W-=(W+j)%188,W<i.byteLength&&!f&&(this.remainderData=new Uint8Array(i.buffer,W,i.buffer.byteLength-W));for(var H=0,G=j;G<W;G+=188)if(i[G]===71){var z=!!(i[G+1]&64),Z=((i[G+1]&31)<<8)+i[G+2],Y=(i[G+3]&48)>>4,V=void 0;if(Y>1){if(V=G+5+i[G+4],V===G+188)continue}else V=G+4;switch(Z){case A:z&&(P&&(c=e(P))&&this.parseAVCPES(s,S,c,!1),P={data:[],size:0}),P&&(P.data.push(i.subarray(V,G+188)),P.size+=G+188-V);break;case _:if(z){if(k&&(c=e(k)))switch(o.segmentCodec){case"aac":this.parseAACPES(o,c);break;case"mp3":this.parseMPEGPES(o,c);break}k={data:[],size:0}}k&&(k.data.push(i.subarray(V,G+188)),k.size+=G+188-V);break;case F:z&&(B&&(c=e(B))&&this.parseID3PES(v,c),B={data:[],size:0}),B&&(B.data.push(i.subarray(V,G+188)),B.size+=G+188-V);break;case 0:z&&(V+=i[V]+1),N=this._pmtId=d(i,V);break;case N:{z&&(V+=i[V]+1);var $=r(i,V,this.typeSupported,u);A=$.avc,A>0&&(s.pid=A),_=$.audio,_>0&&(o.pid=_,o.segmentCodec=$.segmentCodec),F=$.id3,F>0&&(v.pid=F),w&&!U&&(T.logger.log("reparse from beginning"),w=!1,G=j-188),U=this.pmtParsed=!0;break}case 17:case 8191:break;default:w=!0;break}}else H++;H>0&&this.observer.emit(C.Events.ERROR,C.Events.ERROR,{type:m.ErrorTypes.MEDIA_ERROR,details:m.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"Found "+H+" TS packet/s that do not start with 0x47"}),s.pesData=P,o.pesData=k,v.pesData=B;var X={audioTrack:o,videoTrack:s,id3Track:v,textTrack:S};return f&&this.extractRemainingSamples(X),X},n.flush=function(){var i=this.remainderData;this.remainderData=null;var y;return i?y=this.demux(i,-1,!1,!0):y={videoTrack:this._avcTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(y),this.sampleAes?this.decrypt(y,this.sampleAes):y},n.extractRemainingSamples=function(i){var y=i.audioTrack,u=i.videoTrack,f=i.id3Track,c=i.textTrack,s=u.pesData,o=y.pesData,v=f.pesData,S;if(s&&(S=e(s))?(this.parseAVCPES(u,c,S,!0),u.pesData=null):u.pesData=s,o&&(S=e(o))){switch(y.segmentCodec){case"aac":this.parseAACPES(y,S);break;case"mp3":this.parseMPEGPES(y,S);break}y.pesData=null}else o!=null&&o.size&&T.logger.log("last AAC PES packet truncated,might overlap between fragments"),y.pesData=o;v&&(S=e(v))?(this.parseID3PES(f,S),f.pesData=null):f.pesData=v},n.demuxSampleAes=function(i,y,u){var f=this.demux(i,u,!0,!this.config.progressive),c=this.sampleAes=new b.default(this.observer,this.config,y);return this.decrypt(f,c)},n.decrypt=function(i,y){return new Promise(function(u){var f=i.audioTrack,c=i.videoTrack;f.samples&&f.segmentCodec==="aac"?y.decryptAacSamples(f.samples,0,function(){c.samples?y.decryptAvcSamples(c.samples,0,0,function(){u(i)}):u(i)}):c.samples&&y.decryptAvcSamples(c.samples,0,0,function(){u(i)})})},n.destroy=function(){this._duration=0},n.parseAVCPES=function(i,y,u,f){var c=this,s=this.parseAVCNALu(i,u.data),o=this.avcSample,v,S=!1;u.data=null,o&&s.length&&!i.audFound&&(a(o,i),o=this.avcSample=E(!1,u.pts,u.dts,"")),s.forEach(function(A){switch(A.type){case 1:{v=!0,o||(o=c.avcSample=E(!0,u.pts,u.dts,"")),o.frame=!0;var P=A.data;if(S&&P.length>4){var _=new O.default(P).readSliceType();(_===2||_===4||_===7||_===9)&&(o.key=!0)}break}case 5:v=!0,o||(o=c.avcSample=E(!0,u.pts,u.dts,"")),o.key=!0,o.frame=!0;break;case 6:{v=!0,Object(I.parseSEIMessageFromNALu)(l(A.data),u.pts,y.samples);break}case 7:if(v=!0,S=!0,!i.sps){var F=new O.default(A.data),k=F.readSPS();i.width=k.width,i.height=k.height,i.pixelRatio=k.pixelRatio,i.sps=[A.data],i.duration=c._duration;for(var B=A.data.subarray(1,4),w="avc1.",U=0;U<3;U++){var N=B[U].toString(16);N.length<2&&(N="0"+N),w+=N}i.codec=w}break;case 8:v=!0,i.pps||(i.pps=[A.data]);break;case 9:v=!1,i.audFound=!0,o&&a(o,i),o=c.avcSample=E(!1,u.pts,u.dts,"");break;case 12:v=!0;break;default:v=!1,o&&(o.debug+="unknown NAL "+A.type+" ");break}if(o&&v){var W=o.units;W.push(A)}}),f&&o&&(a(o,i),this.avcSample=null)},n.getLastNalUnit=function(i){var y,u=this.avcSample,f;if((!u||u.units.length===0)&&(u=i[i.length-1]),(y=u)!==null&&y!==void 0&&y.units){var c=u.units;f=c[c.length-1]}return f},n.parseAVCNALu=function(i,y){var u=y.byteLength,f=i.naluState||0,c=f,s=[],o=0,v,S,A,P=-1,_=0;for(f===-1&&(P=0,_=y[0]&31,f=0,o=1);o<u;){if(v=y[o++],!f){f=v?0:1;continue}if(f===1){f=v?0:2;continue}if(!v)f=3;else if(v===1){if(P>=0){var F={data:y.subarray(P,o-f-1),type:_};s.push(F)}else{var k=this.getLastNalUnit(i.samples);if(k&&(c&&o<=4-c&&k.state&&(k.data=k.data.subarray(0,k.data.byteLength-c)),S=o-f-1,S>0)){var B=new Uint8Array(k.data.byteLength+S);B.set(k.data,0),B.set(y.subarray(0,S),k.data.byteLength),k.data=B,k.state=0}}o<u?(A=y[o]&31,P=o,_=A,f=0):f=-1}else f=0}if(P>=0&&f>=0){var w={data:y.subarray(P,u),type:_,state:f};s.push(w)}if(s.length===0){var U=this.getLastNalUnit(i.samples);if(U){var N=new Uint8Array(U.data.byteLength+y.byteLength);N.set(U.data,0),N.set(y,U.data.byteLength),U.data=N}}return i.naluState=f,s},n.parseAACPES=function(i,y){var u=0,f=this.aacOverFlow,c=y.data;if(f){this.aacOverFlow=null;var s=f.missing,o=f.sample.unit.byteLength;if(s===-1){var v=new Uint8Array(o+c.byteLength);v.set(f.sample.unit,0),v.set(c,o),c=v}else{var S=o-s;f.sample.unit.set(c.subarray(0,s),S),i.samples.push(f.sample),u=f.missing}}var A,P;for(A=u,P=c.length;A<P-1&&!x.isHeader(c,A);A++);if(A!==u){var _,F;if(A<P-1?(_="AAC PES did not start with ADTS header,offset:"+A,F=!1):(_="no ADTS header found in AAC PES",F=!0),T.logger.warn("parsing error:"+_),this.observer.emit(C.Events.ERROR,C.Events.ERROR,{type:m.ErrorTypes.MEDIA_ERROR,details:m.ErrorDetails.FRAG_PARSING_ERROR,fatal:F,reason:_}),F)return}x.initTrackConfig(i,this.observer,c,A,this.audioCodec);var k;if(y.pts!==void 0)k=y.pts;else if(f){var B=x.getFrameDuration(i.samplerate);k=f.sample.pts+B}else{T.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}for(var w=0,U;A<P;)if(U=x.appendFrame(i,c,A,k,w),A+=U.length,U.missing){this.aacOverFlow=U;break}else for(w++;A<P-1&&!x.isHeader(c,A);A++);},n.parseMPEGPES=function(i,y){var u=y.data,f=u.length,c=0,s=0,o=y.pts;if(o===void 0){T.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;s<f;)if(R.isHeader(u,s)){var v=R.appendFrame(i,u,s,o,c);if(v)s+=v.length,c++;else break}else s++},n.parseID3PES=function(i,y){if(y.pts===void 0){T.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}var u=g({},y,{type:this._avcTrack?p.MetadataSchema.emsg:p.MetadataSchema.audioId3});i.samples.push(u)},h}();D.minProbeByteLength=188;function E(h,n,t,i){return{key:h,frame:!1,pts:n,dts:t,units:[],debug:i,length:0}}function d(h,n){return(h[n+10]&31)<<8|h[n+11]}function r(h,n,t,i){var y={audio:-1,avc:-1,id3:-1,segmentCodec:"aac"},u=(h[n+1]&15)<<8|h[n+2],f=n+3+u-4,c=(h[n+10]&15)<<8|h[n+11];for(n+=12+c;n<f;){var s=(h[n+1]&31)<<8|h[n+2];switch(h[n]){case 207:if(!i){T.logger.log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:y.audio===-1&&(y.audio=s);break;case 21:y.id3===-1&&(y.id3=s);break;case 219:if(!i){T.logger.log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:y.avc===-1&&(y.avc=s);break;case 3:case 4:t.mpeg!==!0&&t.mp3!==!0?T.logger.log("MPEG audio found, not supported in this browser"):y.audio===-1&&(y.audio=s,y.segmentCodec="mp3");break;case 36:T.logger.warn("Unsupported HEVC stream type found");break}n+=((h[n+3]&15)<<8|h[n+4])+5}return y}function e(h){var n=0,t,i,y,u,f,c=h.data;if(!h||h.size===0)return null;for(;c[0].length<19&&c.length>1;){var s=new Uint8Array(c[0].length+c[1].length);s.set(c[0]),s.set(c[1],c[0].length),c[0]=s,c.splice(1,1)}t=c[0];var o=(t[0]<<16)+(t[1]<<8)+t[2];if(o===1){if(i=(t[4]<<8)+t[5],i&&i>h.size-6)return null;var v=t[7];v&192&&(u=(t[9]&14)*536870912+(t[10]&255)*4194304+(t[11]&254)*16384+(t[12]&255)*128+(t[13]&254)/2,v&64?(f=(t[14]&14)*536870912+(t[15]&255)*4194304+(t[16]&254)*16384+(t[17]&255)*128+(t[18]&254)/2,u-f>60*9e4&&(T.logger.warn(Math.round((u-f)/9e4)+"s delta between PTS and DTS, align them"),u=f)):f=u),y=t[8];var S=y+9;if(h.size<=S)return null;h.size-=S;for(var A=new Uint8Array(h.size),P=0,_=c.length;P<_;P++){t=c[P];var F=t.byteLength;if(S)if(S>F){S-=F;continue}else t=t.subarray(S),F-=S,S=0;A.set(t,n),n+=F}return i&&(i-=y+3),{data:A,pts:u,dts:f,len:i}}return null}function a(h,n){if(h.units.length&&h.frame){if(h.pts===void 0){var t=n.samples,i=t.length;if(i){var y=t[i-1];h.pts=y.pts,h.dts=y.dts}else{n.dropped++;return}}n.samples.push(h)}h.debug.length&&T.logger.log(h.pts+"/"+h.dts+":"+h.debug)}function l(h){for(var n=h.byteLength,t=[],i=1;i<n-2;)h[i]===0&&h[i+1]===0&&h[i+2]===3?(t.push(i+2),i+=2):i++;if(t.length===0)return h;var y=n-t.length,u=new Uint8Array(y),f=0;for(i=0;i<y;f++,i++)f===t[0]&&(f++,t.shift()),u[i]=h[f];return u}M.default=D},"./src/errors.ts":function(K,M,L){L.r(M),L.d(M,"ErrorTypes",function(){return x}),L.d(M,"ErrorDetails",function(){return R});var x;(function(O){O.NETWORK_ERROR="networkError",O.MEDIA_ERROR="mediaError",O.KEY_SYSTEM_ERROR="keySystemError",O.MUX_ERROR="muxError",O.OTHER_ERROR="otherError"})(x||(x={}));var R;(function(O){O.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",O.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",O.KEY_SYSTEM_NO_SESSION="keySystemNoSession",O.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",O.KEY_SYSTEM_NO_INIT_DATA="keySystemNoInitData",O.MANIFEST_LOAD_ERROR="manifestLoadError",O.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",O.MANIFEST_PARSING_ERROR="manifestParsingError",O.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",O.LEVEL_EMPTY_ERROR="levelEmptyError",O.LEVEL_LOAD_ERROR="levelLoadError",O.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",O.LEVEL_SWITCH_ERROR="levelSwitchError",O.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",O.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",O.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",O.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",O.FRAG_LOAD_ERROR="fragLoadError",O.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",O.FRAG_DECRYPT_ERROR="fragDecryptError",O.FRAG_PARSING_ERROR="fragParsingError",O.REMUX_ALLOC_ERROR="remuxAllocError",O.KEY_LOAD_ERROR="keyLoadError",O.KEY_LOAD_TIMEOUT="keyLoadTimeOut",O.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",O.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",O.BUFFER_APPEND_ERROR="bufferAppendError",O.BUFFER_APPENDING_ERROR="bufferAppendingError",O.BUFFER_STALLED_ERROR="bufferStalledError",O.BUFFER_FULL_ERROR="bufferFullError",O.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",O.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",O.INTERNAL_EXCEPTION="internalException",O.INTERNAL_ABORTED="aborted",O.UNKNOWN="unknown"})(R||(R={}))},"./src/events.ts":function(K,M,L){L.r(M),L.d(M,"Events",function(){return x});var x;(function(R){R.MEDIA_ATTACHING="hlsMediaAttaching",R.MEDIA_ATTACHED="hlsMediaAttached",R.MEDIA_DETACHING="hlsMediaDetaching",R.MEDIA_DETACHED="hlsMediaDetached",R.BUFFER_RESET="hlsBufferReset",R.BUFFER_CODECS="hlsBufferCodecs",R.BUFFER_CREATED="hlsBufferCreated",R.BUFFER_APPENDING="hlsBufferAppending",R.BUFFER_APPENDED="hlsBufferAppended",R.BUFFER_EOS="hlsBufferEos",R.BUFFER_FLUSHING="hlsBufferFlushing",R.BUFFER_FLUSHED="hlsBufferFlushed",R.MANIFEST_LOADING="hlsManifestLoading",R.MANIFEST_LOADED="hlsManifestLoaded",R.MANIFEST_PARSED="hlsManifestParsed",R.LEVEL_SWITCHING="hlsLevelSwitching",R.LEVEL_SWITCHED="hlsLevelSwitched",R.LEVEL_LOADING="hlsLevelLoading",R.LEVEL_LOADED="hlsLevelLoaded",R.LEVEL_UPDATED="hlsLevelUpdated",R.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",R.LEVELS_UPDATED="hlsLevelsUpdated",R.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",R.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",R.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",R.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",R.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",R.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",R.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",R.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",R.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",R.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",R.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",R.CUES_PARSED="hlsCuesParsed",R.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",R.INIT_PTS_FOUND="hlsInitPtsFound",R.FRAG_LOADING="hlsFragLoading",R.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",R.FRAG_LOADED="hlsFragLoaded",R.FRAG_DECRYPTED="hlsFragDecrypted",R.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",R.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",R.FRAG_PARSING_METADATA="hlsFragParsingMetadata",R.FRAG_PARSED="hlsFragParsed",R.FRAG_BUFFERED="hlsFragBuffered",R.FRAG_CHANGED="hlsFragChanged",R.FPS_DROP="hlsFpsDrop",R.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",R.ERROR="hlsError",R.DESTROYING="hlsDestroying",R.KEY_LOADING="hlsKeyLoading",R.KEY_LOADED="hlsKeyLoaded",R.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",R.BACK_BUFFER_REACHED="hlsBackBufferReached"})(x||(x={}))},"./src/hls.ts":function(K,M,L){L.r(M),L.d(M,"default",function(){return l});var x=L("./node_modules/url-toolkit/src/url-toolkit.js"),R=L("./src/loader/playlist-loader.ts"),O=L("./src/loader/key-loader.ts"),b=L("./src/controller/id3-track-controller.ts"),C=L("./src/controller/latency-controller.ts"),I=L("./src/controller/level-controller.ts"),T=L("./src/controller/fragment-tracker.ts"),m=L("./src/controller/stream-controller.ts"),p=L("./src/is-supported.ts"),g=L("./src/utils/logger.ts"),D=L("./src/config.ts"),E=L("./node_modules/eventemitter3/index.js"),d=L("./src/events.ts"),r=L("./src/errors.ts");function e(h,n){for(var t=0;t<n.length;t++){var i=n[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(h,i.key,i)}}function a(h,n,t){return n&&e(h.prototype,n),t&&e(h,t),Object.defineProperty(h,"prototype",{writable:!1}),h}var l=function(){h.isSupported=function(){return Object(p.isSupported)()};function h(t){t===void 0&&(t={}),this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new E.EventEmitter,this._autoLevelCapping=void 0,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null;var i=this.config=Object(D.mergeConfig)(h.DefaultConfig,t);this.userConfig=t,Object(g.enableLogs)(i.debug),this._autoLevelCapping=-1,i.progressive&&Object(D.enableStreamingMode)(i);var y=i.abrController,u=i.bufferController,f=i.capLevelController,c=i.fpsController,s=this.abrController=new y(this),o=this.bufferController=new u(this),v=this.capLevelController=new f(this),S=new c(this),A=new R.default(this),P=new O.default(this),_=new b.default(this),F=this.levelController=new I.default(this),k=new T.FragmentTracker(this),B=this.streamController=new m.default(this,k);v.setStreamController(B),S.setStreamController(B);var w=[F,B];this.networkControllers=w;var U=[A,P,s,o,v,S,_,k];this.audioTrackController=this.createController(i.audioTrackController,null,w),this.createController(i.audioStreamController,k,w),this.subtitleTrackController=this.createController(i.subtitleTrackController,null,w),this.createController(i.subtitleStreamController,k,w),this.createController(i.timelineController,null,U),this.emeController=this.createController(i.emeController,null,U),this.cmcdController=this.createController(i.cmcdController,null,U),this.latencyController=this.createController(C.default,null,U),this.coreComponents=U}var n=h.prototype;return n.createController=function(i,y,u){if(i){var f=y?new i(this,y):new i(this);return u&&u.push(f),f}return null},n.on=function(i,y,u){u===void 0&&(u=this),this._emitter.on(i,y,u)},n.once=function(i,y,u){u===void 0&&(u=this),this._emitter.once(i,y,u)},n.removeAllListeners=function(i){this._emitter.removeAllListeners(i)},n.off=function(i,y,u,f){u===void 0&&(u=this),this._emitter.off(i,y,u,f)},n.listeners=function(i){return this._emitter.listeners(i)},n.emit=function(i,y,u){return this._emitter.emit(i,y,u)},n.trigger=function(i,y){if(this.config.debug)return this.emit(i,i,y);try{return this.emit(i,i,y)}catch(u){g.logger.error("An internal error happened while handling event "+i+'. Error message: "'+u.message+'". Here is a stacktrace:',u),this.trigger(d.Events.ERROR,{type:r.ErrorTypes.OTHER_ERROR,details:r.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:i,error:u})}return!1},n.listenerCount=function(i){return this._emitter.listenerCount(i)},n.destroy=function(){g.logger.log("destroy"),this.trigger(d.Events.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach(function(i){return i.destroy()}),this.networkControllers.length=0,this.coreComponents.forEach(function(i){return i.destroy()}),this.coreComponents.length=0},n.attachMedia=function(i){g.logger.log("attachMedia"),this._media=i,this.trigger(d.Events.MEDIA_ATTACHING,{media:i})},n.detachMedia=function(){g.logger.log("detachMedia"),this.trigger(d.Events.MEDIA_DETACHING,void 0),this._media=null},n.loadSource=function(i){this.stopLoad();var y=this.media,u=this.url,f=this.url=x.buildAbsoluteURL(self.location.href,i,{alwaysNormalize:!0});g.logger.log("loadSource:"+f),y&&u&&u!==f&&this.bufferController.hasSourceTypes()&&(this.detachMedia(),this.attachMedia(y)),this.trigger(d.Events.MANIFEST_LOADING,{url:i})},n.startLoad=function(i){i===void 0&&(i=-1),g.logger.log("startLoad("+i+")"),this.networkControllers.forEach(function(y){y.startLoad(i)})},n.stopLoad=function(){g.logger.log("stopLoad"),this.networkControllers.forEach(function(i){i.stopLoad()})},n.swapAudioCodec=function(){g.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()},n.recoverMediaError=function(){g.logger.log("recoverMediaError");var i=this._media;this.detachMedia(),i&&this.attachMedia(i)},n.removeLevel=function(i,y){y===void 0&&(y=0),this.levelController.removeLevel(i,y)},a(h,[{key:"levels",get:function(){var i=this.levelController.levels;return i||[]}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(i){g.logger.log("set currentLevel:"+i),this.loadLevel=i,this.abrController.clearTimer(),this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(i){g.logger.log("set nextLevel:"+i),this.levelController.manualLevel=i,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(i){g.logger.log("set loadLevel:"+i),this.levelController.manualLevel=i}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(i){this.levelController.nextLoadLevel=i}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(i){g.logger.log("set firstLevel:"+i),this.levelController.firstLevel=i}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(i){g.logger.log("set startLevel:"+i),i!==-1&&(i=Math.max(i,this.minAutoLevel)),this.levelController.startLevel=i}},{key:"capLevelToPlayerSize",get:function(){return this.config.capLevelToPlayerSize},set:function(i){var y=!!i;y!==this.config.capLevelToPlayerSize&&(y?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=y)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(i){this._autoLevelCapping!==i&&(g.logger.log("set autoLevelCapping:"+i),this._autoLevelCapping=i)}},{key:"bandwidthEstimate",get:function(){var i=this.abrController.bwEstimator;return i?i.getEstimate():NaN}},{key:"autoLevelEnabled",get:function(){return this.levelController.manualLevel===-1}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){var i=this.levels,y=this.config.minAutoBitrate;if(!i)return 0;for(var u=i.length,f=0;f<u;f++)if(i[f].maxBitrate>=y)return f;return 0}},{key:"maxAutoLevel",get:function(){var i=this.levels,y=this.autoLevelCapping,u;return y===-1&&i&&i.length?u=i.length-1:u=y,u}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(i){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,i)}},{key:"playingDate",get:function(){return this.streamController.currentProgramDateTime}},{key:"audioTracks",get:function(){var i=this.audioTrackController;return i?i.audioTracks:[]}},{key:"audioTrack",get:function(){var i=this.audioTrackController;return i?i.audioTrack:-1},set:function(i){var y=this.audioTrackController;y&&(y.audioTrack=i)}},{key:"subtitleTracks",get:function(){var i=this.subtitleTrackController;return i?i.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var i=this.subtitleTrackController;return i?i.subtitleTrack:-1},set:function(i){var y=this.subtitleTrackController;y&&(y.subtitleTrack=i)}},{key:"media",get:function(){return this._media}},{key:"subtitleDisplay",get:function(){var i=this.subtitleTrackController;return i?i.subtitleDisplay:!1},set:function(i){var y=this.subtitleTrackController;y&&(y.subtitleDisplay=i)}},{key:"lowLatencyMode",get:function(){return this.config.lowLatencyMode},set:function(i){this.config.lowLatencyMode=i}},{key:"liveSyncPosition",get:function(){return this.latencyController.liveSyncPosition}},{key:"latency",get:function(){return this.latencyController.latency}},{key:"maxLatency",get:function(){return this.latencyController.maxLatency}},{key:"targetLatency",get:function(){return this.latencyController.targetLatency}},{key:"drift",get:function(){return this.latencyController.drift}},{key:"forceStartLoad",get:function(){return this.streamController.forceStartLoad}}],[{key:"version",get:function(){return"1.2.1"}},{key:"Events",get:function(){return d.Events}},{key:"ErrorTypes",get:function(){return r.ErrorTypes}},{key:"ErrorDetails",get:function(){return r.ErrorDetails}},{key:"DefaultConfig",get:function(){return h.defaultConfig?h.defaultConfig:D.hlsDefaultConfig},set:function(i){h.defaultConfig=i}}]),h}();l.defaultConfig=void 0},"./src/is-supported.ts":function(K,M,L){L.r(M),L.d(M,"isSupported",function(){return O}),L.d(M,"changeTypeSupported",function(){return b});var x=L("./src/utils/mediasource-helper.ts");function R(){return self.SourceBuffer||self.WebKitSourceBuffer}function O(){var C=Object(x.getMediaSource)();if(!C)return!1;var I=R(),T=C&&typeof C.isTypeSupported=="function"&&C.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),m=!I||I.prototype&&typeof I.prototype.appendBuffer=="function"&&typeof I.prototype.remove=="function";return!!T&&!!m}function b(){var C,I=R();return typeof(I==null||(C=I.prototype)===null||C===void 0?void 0:C.changeType)=="function"}},"./src/loader/date-range.ts":function(K,M,L){L.r(M),L.d(M,"DateRangeAttribute",function(){return T}),L.d(M,"DateRange",function(){return m});var x=L("./src/polyfills/number.ts"),R=L("./src/utils/attr-list.ts"),O=L("./src/utils/logger.ts");function b(){return b=Object.assign?Object.assign.bind():function(p){for(var g=1;g<arguments.length;g++){var D=arguments[g];for(var E in D)Object.prototype.hasOwnProperty.call(D,E)&&(p[E]=D[E])}return p},b.apply(this,arguments)}function C(p,g){for(var D=0;D<g.length;D++){var E=g[D];E.enumerable=E.enumerable||!1,E.configurable=!0,"value"in E&&(E.writable=!0),Object.defineProperty(p,E.key,E)}}function I(p,g,D){return g&&C(p.prototype,g),D&&C(p,D),Object.defineProperty(p,"prototype",{writable:!1}),p}var T;(function(p){p.ID="ID",p.CLASS="CLASS",p.START_DATE="START-DATE",p.DURATION="DURATION",p.END_DATE="END-DATE",p.END_ON_NEXT="END-ON-NEXT",p.PLANNED_DURATION="PLANNED-DURATION",p.SCTE35_OUT="SCTE35-OUT",p.SCTE35_IN="SCTE35-IN"})(T||(T={}));var m=function(){function p(g,D){if(this.attr=void 0,this._startDate=void 0,this._endDate=void 0,this._badValueForSameId=void 0,D){var E=D.attr;for(var d in E)if(Object.prototype.hasOwnProperty.call(g,d)&&g[d]!==E[d]){O.logger.warn('DATERANGE tag attribute: "'+d+'" does not match for tags with ID: "'+g.ID+'"'),this._badValueForSameId=d;break}g=b(new R.AttrList({}),E,g)}if(this.attr=g,this._startDate=new Date(g[T.START_DATE]),T.END_DATE in this.attr){var r=new Date(this.attr[T.END_DATE]);Object(x.isFiniteNumber)(r.getTime())&&(this._endDate=r)}}return I(p,[{key:"id",get:function(){return this.attr.ID}},{key:"class",get:function(){return this.attr.CLASS}},{key:"startDate",get:function(){return this._startDate}},{key:"endDate",get:function(){if(this._endDate)return this._endDate;var D=this.duration;return D!==null?new Date(this._startDate.getTime()+D*1e3):null}},{key:"duration",get:function(){if(T.DURATION in this.attr){var D=this.attr.decimalFloatingPoint(T.DURATION);if(Object(x.isFiniteNumber)(D))return D}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}},{key:"plannedDuration",get:function(){return T.PLANNED_DURATION in this.attr?this.attr.decimalFloatingPoint(T.PLANNED_DURATION):null}},{key:"endOnNext",get:function(){return this.attr.bool(T.END_ON_NEXT)}},{key:"isValid",get:function(){return!!this.id&&!this._badValueForSameId&&Object(x.isFiniteNumber)(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)}}]),p}()},"./src/loader/fragment-loader.ts":function(K,M,L){L.r(M),L.d(M,"default",function(){return D}),L.d(M,"LoadError",function(){return d});var x=L("./src/polyfills/number.ts"),R=L("./src/errors.ts");function O(r,e){r.prototype=Object.create(e.prototype),r.prototype.constructor=r,m(r,e)}function b(r){var e=typeof Map=="function"?new Map:void 0;return b=function(l){if(l===null||!T(l))return l;if(typeof l!="function")throw new TypeError("Super expression must either be null or a function");if(typeof e<"u"){if(e.has(l))return e.get(l);e.set(l,h)}function h(){return C(l,arguments,p(this).constructor)}return h.prototype=Object.create(l.prototype,{constructor:{value:h,enumerable:!1,writable:!0,configurable:!0}}),m(h,l)},b(r)}function C(r,e,a){return I()?C=Reflect.construct.bind():C=function(h,n,t){var i=[null];i.push.apply(i,n);var y=Function.bind.apply(h,i),u=new y;return t&&m(u,t.prototype),u},C.apply(null,arguments)}function I(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function T(r){return Function.toString.call(r).indexOf("[native code]")!==-1}function m(r,e){return m=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(l,h){return l.__proto__=h,l},m(r,e)}function p(r){return p=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(a){return a.__proto__||Object.getPrototypeOf(a)},p(r)}var g=Math.pow(2,17),D=function(){function r(a){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=a}var e=r.prototype;return e.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},e.abort=function(){this.loader&&this.loader.abort()},e.load=function(l,h){var n=this,t=l.url;if(!t)return Promise.reject(new d({type:R.ErrorTypes.NETWORK_ERROR,details:R.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:l,networkDetails:null},"Fragment does not have a "+(t?"part list":"url")));this.abort();var i=this.config,y=i.fLoader,u=i.loader;return new Promise(function(f,c){n.loader&&n.loader.destroy();var s=n.loader=l.loader=y?new y(i):new u(i),o=E(l),v={timeout:i.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:i.fragLoadingMaxRetryTimeout,highWaterMark:l.sn==="initSegment"?1/0:g};l.stats=s.stats,s.load(o,v,{onSuccess:function(A,P,_,F){n.resetLoader(l,s),f({frag:l,part:null,payload:A.data,networkDetails:F})},onError:function(A,P,_){n.resetLoader(l,s),c(new d({type:R.ErrorTypes.NETWORK_ERROR,details:R.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:l,response:A,networkDetails:_}))},onAbort:function(A,P,_){n.resetLoader(l,s),c(new d({type:R.ErrorTypes.NETWORK_ERROR,details:R.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:l,networkDetails:_}))},onTimeout:function(A,P,_){n.resetLoader(l,s),c(new d({type:R.ErrorTypes.NETWORK_ERROR,details:R.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:l,networkDetails:_}))},onProgress:function(A,P,_,F){h&&h({frag:l,part:null,payload:_,networkDetails:F})}})})},e.loadPart=function(l,h,n){var t=this;this.abort();var i=this.config,y=i.fLoader,u=i.loader;return new Promise(function(f,c){t.loader&&t.loader.destroy();var s=t.loader=l.loader=y?new y(i):new u(i),o=E(l,h),v={timeout:i.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:i.fragLoadingMaxRetryTimeout,highWaterMark:g};h.stats=s.stats,s.load(o,v,{onSuccess:function(A,P,_,F){t.resetLoader(l,s),t.updateStatsFromPart(l,h);var k={frag:l,part:h,payload:A.data,networkDetails:F};n(k),f(k)},onError:function(A,P,_){t.resetLoader(l,s),c(new d({type:R.ErrorTypes.NETWORK_ERROR,details:R.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:l,part:h,response:A,networkDetails:_}))},onAbort:function(A,P,_){l.stats.aborted=h.stats.aborted,t.resetLoader(l,s),c(new d({type:R.ErrorTypes.NETWORK_ERROR,details:R.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:l,part:h,networkDetails:_}))},onTimeout:function(A,P,_){t.resetLoader(l,s),c(new d({type:R.ErrorTypes.NETWORK_ERROR,details:R.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:l,part:h,networkDetails:_}))}})})},e.updateStatsFromPart=function(l,h){var n=l.stats,t=h.stats,i=t.total;if(n.loaded+=t.loaded,i){var y=Math.round(l.duration/h.duration),u=Math.min(Math.round(n.loaded/i),y),f=y-u,c=f*Math.round(n.loaded/u);n.total=n.loaded+c}else n.total=Math.max(n.loaded,n.total);var s=n.loading,o=t.loading;s.start?s.first+=o.first-o.start:(s.start=o.start,s.first=o.first),s.end=o.end},e.resetLoader=function(l,h){l.loader=null,this.loader===h&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),h.destroy()},r}();function E(r,e){e===void 0&&(e=null);var a=e||r,l={frag:r,part:e,responseType:"arraybuffer",url:a.url,headers:{},rangeStart:0,rangeEnd:0},h=a.byteRangeStartOffset,n=a.byteRangeEndOffset;return Object(x.isFiniteNumber)(h)&&Object(x.isFiniteNumber)(n)&&(l.rangeStart=h,l.rangeEnd=n),l}var d=function(r){O(e,r);function e(a){for(var l,h=arguments.length,n=new Array(h>1?h-1:0),t=1;t<h;t++)n[t-1]=arguments[t];return l=r.call.apply(r,[this].concat(n))||this,l.data=void 0,l.data=a,l}return e}(b(Error))},"./src/loader/fragment.ts":function(K,M,L){L.r(M),L.d(M,"ElementaryStreamTypes",function(){return g}),L.d(M,"BaseSegment",function(){return D}),L.d(M,"Fragment",function(){return E}),L.d(M,"Part",function(){return d});var x=L("./src/polyfills/number.ts"),R=L("./node_modules/url-toolkit/src/url-toolkit.js"),O=L("./src/utils/logger.ts"),b=L("./src/loader/level-key.ts"),C=L("./src/loader/load-stats.ts");function I(r,e){r.prototype=Object.create(e.prototype),r.prototype.constructor=r,T(r,e)}function T(r,e){return T=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(l,h){return l.__proto__=h,l},T(r,e)}function m(r,e){for(var a=0;a<e.length;a++){var l=e[a];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(r,l.key,l)}}function p(r,e,a){return e&&m(r.prototype,e),a&&m(r,a),Object.defineProperty(r,"prototype",{writable:!1}),r}var g;(function(r){r.AUDIO="audio",r.VIDEO="video",r.AUDIOVIDEO="audiovideo"})(g||(g={}));var D=function(){function r(a){var l;this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams=(l={},l[g.AUDIO]=null,l[g.VIDEO]=null,l[g.AUDIOVIDEO]=null,l),this.baseurl=a}var e=r.prototype;return e.setByteRange=function(l,h){var n=l.split("@",2),t=[];n.length===1?t[0]=h?h.byteRangeEndOffset:0:t[0]=parseInt(n[1]),t[1]=parseInt(n[0])+t[0],this._byteRange=t},p(r,[{key:"byteRange",get:function(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"url",get:function(){return!this._url&&this.baseurl&&this.relurl&&(this._url=Object(R.buildAbsoluteURL)(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""},set:function(l){this._url=l}}]),r}(),E=function(r){I(e,r);function e(l,h){var n;return n=r.call(this,h)||this,n._decryptdata=null,n.rawProgramDateTime=null,n.programDateTime=null,n.tagList=[],n.duration=0,n.sn=0,n.levelkey=void 0,n.type=void 0,n.loader=null,n.level=-1,n.cc=0,n.startPTS=void 0,n.endPTS=void 0,n.appendedPTS=void 0,n.startDTS=void 0,n.endDTS=void 0,n.start=0,n.deltaPTS=void 0,n.maxStartPTS=void 0,n.minEndPTS=void 0,n.stats=new C.LoadStats,n.urlId=0,n.data=void 0,n.bitrateTest=!1,n.title=null,n.initSegment=null,n.type=l,n}var a=e.prototype;return a.createInitializationVector=function(h){for(var n=new Uint8Array(16),t=12;t<16;t++)n[t]=h>>8*(15-t)&255;return n},a.setDecryptDataFromLevelKey=function(h,n){var t=h;return(h==null?void 0:h.method)==="AES-128"&&h.uri&&!h.iv&&(t=b.LevelKey.fromURI(h.uri),t.method=h.method,t.iv=this.createInitializationVector(n),t.keyFormat="identity"),t},a.setElementaryStreamInfo=function(h,n,t,i,y,u){u===void 0&&(u=!1);var f=this.elementaryStreams,c=f[h];if(!c){f[h]={startPTS:n,endPTS:t,startDTS:i,endDTS:y,partial:u};return}c.startPTS=Math.min(c.startPTS,n),c.endPTS=Math.max(c.endPTS,t),c.startDTS=Math.min(c.startDTS,i),c.endDTS=Math.max(c.endDTS,y)},a.clearElementaryStreamInfo=function(){var h=this.elementaryStreams;h[g.AUDIO]=null,h[g.VIDEO]=null,h[g.AUDIOVIDEO]=null},p(e,[{key:"decryptdata",get:function(){if(!this.levelkey&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkey){var h=this.sn;typeof h!="number"&&(this.levelkey&&this.levelkey.method==="AES-128"&&!this.levelkey.iv&&O.logger.warn('missing IV for initialization segment with method="'+this.levelkey.method+'" - compliance issue'),h=0),this._decryptdata=this.setDecryptDataFromLevelKey(this.levelkey,h)}return this._decryptdata}},{key:"end",get:function(){return this.start+this.duration}},{key:"endProgramDateTime",get:function(){if(this.programDateTime===null||!Object(x.isFiniteNumber)(this.programDateTime))return null;var h=Object(x.isFiniteNumber)(this.duration)?this.duration:0;return this.programDateTime+h*1e3}},{key:"encrypted",get:function(){var h;return!!((h=this.decryptdata)!==null&&h!==void 0&&h.keyFormat&&this.decryptdata.uri)}}]),e}(D),d=function(r){I(e,r);function e(a,l,h,n,t){var i;i=r.call(this,h)||this,i.fragOffset=0,i.duration=0,i.gap=!1,i.independent=!1,i.relurl=void 0,i.fragment=void 0,i.index=void 0,i.stats=new C.LoadStats,i.duration=a.decimalFloatingPoint("DURATION"),i.gap=a.bool("GAP"),i.independent=a.bool("INDEPENDENT"),i.relurl=a.enumeratedString("URI"),i.fragment=l,i.index=n;var y=a.enumeratedString("BYTERANGE");return y&&i.setByteRange(y,t),t&&(i.fragOffset=t.fragOffset+t.duration),i}return p(e,[{key:"start",get:function(){return this.fragment.start+this.fragOffset}},{key:"end",get:function(){return this.start+this.duration}},{key:"loaded",get:function(){var l=this.elementaryStreams;return!!(l.audio||l.video||l.audiovideo)}}]),e}(D)},"./src/loader/key-loader.ts":function(K,M,L){L.r(M),L.d(M,"default",function(){return b});var x=L("./src/events.ts"),R=L("./src/errors.ts"),O=L("./src/utils/logger.ts"),b=function(){function C(T){this.hls=void 0,this.loaders={},this.decryptkey=null,this.decrypturl=null,this.hls=T,this._registerListeners()}var I=C.prototype;return I._registerListeners=function(){this.hls.on(x.Events.KEY_LOADING,this.onKeyLoading,this)},I._unregisterListeners=function(){this.hls.off(x.Events.KEY_LOADING,this.onKeyLoading)},I.destroy=function(){this._unregisterListeners();for(var m in this.loaders){var p=this.loaders[m];p&&p.destroy()}this.loaders={}},I.onKeyLoading=function(m,p){var g=p.frag,D=g.type,E=this.loaders[D];if(!g.decryptdata){O.logger.warn("Missing decryption data on fragment in onKeyLoading");return}var d=g.decryptdata.uri;if(d!==this.decrypturl||this.decryptkey===null){var r=this.hls.config;if(E&&(O.logger.warn("abort previous key loader for type:"+D),E.abort()),!d){O.logger.warn("key uri is falsy");return}var e=r.loader,a=g.loader=this.loaders[D]=new e(r);this.decrypturl=d,this.decryptkey=null;var l={url:d,frag:g,responseType:"arraybuffer"},h={timeout:r.fragLoadingTimeOut,maxRetry:0,retryDelay:r.fragLoadingRetryDelay,maxRetryDelay:r.fragLoadingMaxRetryTimeout,highWaterMark:0},n={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};a.load(l,h,n)}else this.decryptkey&&(g.decryptdata.key=this.decryptkey,this.hls.trigger(x.Events.KEY_LOADED,{frag:g}))},I.loadsuccess=function(m,p,g){var D=g.frag;if(!D.decryptdata){O.logger.error("after key load, decryptdata unset");return}this.decryptkey=D.decryptdata.key=new Uint8Array(m.data),D.loader=null,delete this.loaders[D.type],this.hls.trigger(x.Events.KEY_LOADED,{frag:D})},I.loaderror=function(m,p){var g=p.frag,D=g.loader;D&&D.abort(),delete this.loaders[g.type],this.hls.trigger(x.Events.ERROR,{type:R.ErrorTypes.NETWORK_ERROR,details:R.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag:g,response:m})},I.loadtimeout=function(m,p){var g=p.frag,D=g.loader;D&&D.abort(),delete this.loaders[g.type],this.hls.trigger(x.Events.ERROR,{type:R.ErrorTypes.NETWORK_ERROR,details:R.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag:g})},C}()},"./src/loader/level-details.ts":function(K,M,L){L.r(M),L.d(M,"LevelDetails",function(){return C});var x=L("./src/polyfills/number.ts");function R(I,T){for(var m=0;m<T.length;m++){var p=T[m];p.enumerable=p.enumerable||!1,p.configurable=!0,"value"in p&&(p.writable=!0),Object.defineProperty(I,p.key,p)}}function O(I,T,m){return T&&R(I.prototype,T),m&&R(I,m),Object.defineProperty(I,"prototype",{writable:!1}),I}var b=10,C=function(){function I(m){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.needSidxRanges=!1,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.fragments=[],this.dateRanges={},this.url=m}var T=I.prototype;return T.reloaded=function(p){if(!p){this.advanced=!0,this.updated=!0;return}var g=this.lastPartSn-p.lastPartSn,D=this.lastPartIndex-p.lastPartIndex;this.updated=this.endSN!==p.endSN||!!D||!!g,this.advanced=this.endSN>p.endSN||g>0||g===0&&D>0,this.updated||this.advanced?this.misses=Math.floor(p.misses*.6):this.misses=p.misses+1,this.availabilityDelay=p.availabilityDelay},O(I,[{key:"hasProgramDateTime",get:function(){return this.fragments.length?Object(x.isFiniteNumber)(this.fragments[this.fragments.length-1].programDateTime):!1}},{key:"levelTargetDuration",get:function(){return this.averagetargetduration||this.targetduration||b}},{key:"drift",get:function(){var p=this.driftEndTime-this.driftStartTime;if(p>0){var g=this.driftEnd-this.driftStart;return g*1e3/p}return 1}},{key:"edge",get:function(){return this.partEnd||this.fragmentEnd}},{key:"partEnd",get:function(){var p;return(p=this.partList)!==null&&p!==void 0&&p.length?this.partList[this.partList.length-1].end:this.fragmentEnd}},{key:"fragmentEnd",get:function(){var p;return(p=this.fragments)!==null&&p!==void 0&&p.length?this.fragments[this.fragments.length-1].end:0}},{key:"age",get:function(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}},{key:"lastPartIndex",get:function(){var p;return(p=this.partList)!==null&&p!==void 0&&p.length?this.partList[this.partList.length-1].index:-1}},{key:"lastPartSn",get:function(){var p;return(p=this.partList)!==null&&p!==void 0&&p.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}]),I}()},"./src/loader/level-key.ts":function(K,M,L){L.r(M),L.d(M,"LevelKey",function(){return b});var x=L("./node_modules/url-toolkit/src/url-toolkit.js");function R(C,I){for(var T=0;T<I.length;T++){var m=I[T];m.enumerable=m.enumerable||!1,m.configurable=!0,"value"in m&&(m.writable=!0),Object.defineProperty(C,m.key,m)}}function O(C,I,T){return I&&R(C.prototype,I),T&&R(C,T),Object.defineProperty(C,"prototype",{writable:!1}),C}var b=function(){C.fromURL=function(T,m){return new C(T,m)},C.fromURI=function(T){return new C(T)};function C(I,T){this._uri=null,this.method=null,this.keyFormat=null,this.keyFormatVersions=null,this.keyID=null,this.key=null,this.iv=null,T?this._uri=Object(x.buildAbsoluteURL)(I,T,{alwaysNormalize:!0}):this._uri=I}return O(C,[{key:"uri",get:function(){return this._uri}}]),C}()},"./src/loader/load-stats.ts":function(K,M,L){L.r(M),L.d(M,"LoadStats",function(){return x});var x=function(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}},"./src/loader/m3u8-parser.ts":function(K,M,L){L.r(M),L.d(M,"default",function(){return a});var x=L("./src/polyfills/number.ts"),R=L("./node_modules/url-toolkit/src/url-toolkit.js"),O=L("./src/loader/date-range.ts"),b=L("./src/loader/fragment.ts"),C=L("./src/loader/level-details.ts"),I=L("./src/loader/level-key.ts"),T=L("./src/utils/attr-list.ts"),m=L("./src/utils/logger.ts"),p=L("./src/utils/codecs.ts"),g=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-SESSION-DATA:([^\r\n]*)[\r\n]+/g,D=/#EXT-X-MEDIA:(.*)/g,E=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),d=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(DATERANGE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),r=/\.(mp4|m4s|m4v|m4a)$/i;function e(y){var u,f;return r.test((u=(f=R.parseURL(y))===null||f===void 0?void 0:f.path)!=null?u:"")}var a=function(){function y(){}return y.findGroup=function(f,c){for(var s=0;s<f.length;s++){var o=f[s];if(o.id===c)return o}},y.convertAVC1ToAVCOTI=function(f){var c=f.split(".");if(c.length>2){var s=c.shift()+".";return s+=parseInt(c.shift()).toString(16),s+=("000"+parseInt(c.shift()).toString(16)).slice(-4),s}return f},y.resolve=function(f,c){return R.buildAbsoluteURL(c,f,{alwaysNormalize:!0})},y.parseMasterPlaylist=function(f,c){var s=[],o={},v=!1;g.lastIndex=0;for(var S;(S=g.exec(f))!=null;)if(S[1]){var A=new T.AttrList(S[1]),P={attrs:A,bitrate:A.decimalInteger("AVERAGE-BANDWIDTH")||A.decimalInteger("BANDWIDTH"),name:A.NAME,url:y.resolve(S[2],c)},_=A.decimalResolution("RESOLUTION");_&&(P.width=_.width,P.height=_.height),l((A.CODECS||"").split(/[ ,]+/).filter(function(k){return k}),P),P.videoCodec&&P.videoCodec.indexOf("avc1")!==-1&&(P.videoCodec=y.convertAVC1ToAVCOTI(P.videoCodec)),s.push(P)}else if(S[3]){var F=new T.AttrList(S[3]);F["DATA-ID"]&&(v=!0,o[F["DATA-ID"]]=F)}return{levels:s,sessionData:v?o:null}},y.parseMasterPlaylistMedia=function(f,c,s,o){o===void 0&&(o=[]);var v,S=[],A=0;for(D.lastIndex=0;(v=D.exec(f))!==null;){var P=new T.AttrList(v[1]);if(P.TYPE===s){var _={attrs:P,bitrate:0,id:A++,groupId:P["GROUP-ID"],instreamId:P["INSTREAM-ID"],name:P.NAME||P.LANGUAGE||"",type:s,default:P.bool("DEFAULT"),autoselect:P.bool("AUTOSELECT"),forced:P.bool("FORCED"),lang:P.LANGUAGE,url:P.URI?y.resolve(P.URI,c):""};if(o.length){var F=y.findGroup(o,_.groupId)||o[0];h(_,F,"audioCodec"),h(_,F,"textCodec")}S.push(_)}}return S},y.parseLevelPlaylist=function(f,c,s,o,v){var S=new C.LevelDetails(c),A=S.fragments,P=null,_=0,F=0,k=0,B=0,w=null,U=new b.Fragment(o,c),N,W,j,H=-1,G=!1;for(E.lastIndex=0,S.m3u8=f;(N=E.exec(f))!==null;){G&&(G=!1,U=new b.Fragment(o,c),U.start=k,U.sn=_,U.cc=B,U.level=s,P&&(U.initSegment=P,U.rawProgramDateTime=P.rawProgramDateTime,P.rawProgramDateTime=null));var z=N[1];if(z){U.duration=parseFloat(z);var Z=(" "+N[2]).slice(1);U.title=Z||null,U.tagList.push(Z?["INF",z,Z]:["INF",z])}else if(N[3])Object(x.isFiniteNumber)(U.duration)&&(U.start=k,j&&(U.levelkey=j),U.sn=_,U.level=s,U.cc=B,U.urlId=v,A.push(U),U.relurl=(" "+N[3]).slice(1),t(U,w),w=U,k+=U.duration,_++,F=0,G=!0);else if(N[4]){var Y=(" "+N[4]).slice(1);w?U.setByteRange(Y,w):U.setByteRange(Y)}else if(N[5])U.rawProgramDateTime=(" "+N[5]).slice(1),U.tagList.push(["PROGRAM-DATE-TIME",U.rawProgramDateTime]),H===-1&&(H=A.length);else{if(N=N[0].match(d),!N){m.logger.warn("No matches on slow regex match for level playlist!");continue}for(W=1;W<N.length&&!(typeof N[W]<"u");W++);var V=(" "+N[W]).slice(1),$=(" "+N[W+1]).slice(1),X=N[W+2]?(" "+N[W+2]).slice(1):"";switch(V){case"PLAYLIST-TYPE":S.type=$.toUpperCase();break;case"MEDIA-SEQUENCE":_=S.startSN=parseInt($);break;case"SKIP":{var Q=new T.AttrList($),J=Q.decimalInteger("SKIPPED-SEGMENTS");if(Object(x.isFiniteNumber)(J)){S.skippedSegments=J;for(var q=J;q--;)A.unshift(null);_+=J}var ee=Q.enumeratedString("RECENTLY-REMOVED-DATERANGES");ee&&(S.recentlyRemovedDateranges=ee.split("	"));break}case"TARGETDURATION":S.targetduration=parseFloat($);break;case"VERSION":S.version=parseInt($);break;case"EXTM3U":break;case"ENDLIST":S.live=!1;break;case"#":($||X)&&U.tagList.push(X?[$,X]:[$]);break;case"DISCONTINUITY":B++,U.tagList.push(["DIS"]);break;case"GAP":U.tagList.push([V]);break;case"BITRATE":U.tagList.push([V,$]);break;case"DATERANGE":{var te=new T.AttrList($),re=new O.DateRange(te,S.dateRanges[te.ID]);re.isValid||S.skippedSegments?S.dateRanges[re.id]=re:m.logger.warn('Ignoring invalid DATERANGE tag: "'+$+'"'),U.tagList.push(["EXT-X-DATERANGE",$]);break}case"DISCONTINUITY-SEQUENCE":B=parseInt($);break;case"KEY":{var oe,fe=new T.AttrList($),he=fe.enumeratedString("METHOD"),ae=fe.URI,Se=fe.hexadecimalInteger("IV"),ce=fe.enumeratedString("KEYFORMATVERSIONS"),le=fe.enumeratedString("KEYID"),pe=(oe=fe.enumeratedString("KEYFORMAT"))!=null?oe:"identity",ye=["com.apple.streamingkeydelivery","com.microsoft.playready","urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed","com.widevine"];if(ye.indexOf(pe)>-1){m.logger.warn("Keyformat "+pe+" is not supported from the manifest");continue}else if(pe!=="identity")continue;he&&(j=I.LevelKey.fromURL(c,ae),ae&&["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(he)>=0&&(j.method=he,j.keyFormat=pe,le&&(j.keyID=le),ce&&(j.keyFormatVersions=ce),j.iv=Se));break}case"START":{var Ee=new T.AttrList($),ne=Ee.decimalFloatingPoint("TIME-OFFSET");Object(x.isFiniteNumber)(ne)&&(S.startTimeOffset=ne);break}case"MAP":{var ue=new T.AttrList($);if(U.duration){var ve=new b.Fragment(o,c);i(ve,ue,s,j),P=ve,U.initSegment=P,P.rawProgramDateTime&&!U.rawProgramDateTime&&(U.rawProgramDateTime=P.rawProgramDateTime)}else i(U,ue,s,j),P=U,G=!0;break}case"SERVER-CONTROL":{var ge=new T.AttrList($);S.canBlockReload=ge.bool("CAN-BLOCK-RELOAD"),S.canSkipUntil=ge.optionalFloat("CAN-SKIP-UNTIL",0),S.canSkipDateRanges=S.canSkipUntil>0&&ge.bool("CAN-SKIP-DATERANGES"),S.partHoldBack=ge.optionalFloat("PART-HOLD-BACK",0),S.holdBack=ge.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{var Te=new T.AttrList($);S.partTarget=Te.decimalFloatingPoint("PART-TARGET");break}case"PART":{var se=S.partList;se||(se=S.partList=[]);var me=F>0?se[se.length-1]:void 0,Le=F++,Ae=new b.Part(new T.AttrList($),U,c,Le,me);se.push(Ae),U.duration+=Ae.duration;break}case"PRELOAD-HINT":{var Oe=new T.AttrList($);S.preloadHint=Oe;break}case"RENDITION-REPORT":{var De=new T.AttrList($);S.renditionReports=S.renditionReports||[],S.renditionReports.push(De);break}default:m.logger.warn("line parsed but not handled: "+N);break}}}w&&!w.relurl?(A.pop(),k-=w.duration,S.partList&&(S.fragmentHint=w)):S.partList&&(t(U,w),U.cc=B,S.fragmentHint=U);var Pe=A.length,Ce=A[0],Re=A[Pe-1];if(k+=S.skippedSegments*S.targetduration,k>0&&Pe&&Re){S.averagetargetduration=k/Pe;var Me=Re.sn;S.endSN=Me!=="initSegment"?Me:0,Ce&&(S.startCC=Ce.cc,Ce.initSegment||S.fragments.every(function(Ie){return Ie.relurl&&e(Ie.relurl)})&&(m.logger.warn("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),U=new b.Fragment(o,c),U.relurl=Re.relurl,U.level=s,U.sn="initSegment",Ce.initSegment=U,S.needSidxRanges=!0))}else S.endSN=0,S.startCC=0;return S.fragmentHint&&(k+=S.fragmentHint.duration),S.totalduration=k,S.endCC=B,H>0&&n(A,H),S},y}();function l(y,u){["video","audio","text"].forEach(function(f){var c=y.filter(function(o){return Object(p.isCodecType)(o,f)});if(c.length){var s=c.filter(function(o){return o.lastIndexOf("avc1",0)===0||o.lastIndexOf("mp4a",0)===0});u[f+"Codec"]=s.length>0?s[0]:c[0],y=y.filter(function(o){return c.indexOf(o)===-1})}}),u.unknownCodecs=y}function h(y,u,f){var c=u[f];c&&(y[f]=c)}function n(y,u){for(var f=y[u],c=u;c--;){var s=y[c];if(!s)return;s.programDateTime=f.programDateTime-s.duration*1e3,f=s}}function t(y,u){y.rawProgramDateTime?y.programDateTime=Date.parse(y.rawProgramDateTime):u!=null&&u.programDateTime&&(y.programDateTime=u.endProgramDateTime),Object(x.isFiniteNumber)(y.programDateTime)||(y.programDateTime=null,y.rawProgramDateTime=null)}function i(y,u,f,c){y.relurl=u.URI,u.BYTERANGE&&y.setByteRange(u.BYTERANGE),y.level=f,y.sn="initSegment",c&&(y.levelkey=c),y.initSegment=null}},"./src/loader/playlist-loader.ts":function(K,M,L){L.r(M);var x=L("./src/polyfills/number.ts"),R=L("./src/events.ts"),O=L("./src/errors.ts"),b=L("./src/utils/logger.ts"),C=L("./src/utils/mp4-tools.ts"),I=L("./src/loader/m3u8-parser.ts"),T=L("./src/types/loader.ts"),m=L("./src/utils/attr-list.ts");function p(E){var d=E.type;switch(d){case T.PlaylistContextType.AUDIO_TRACK:return T.PlaylistLevelType.AUDIO;case T.PlaylistContextType.SUBTITLE_TRACK:return T.PlaylistLevelType.SUBTITLE;default:return T.PlaylistLevelType.MAIN}}function g(E,d){var r=E.url;return(r===void 0||r.indexOf("data:")===0)&&(r=d.url),r}var D=function(){function E(r){this.hls=void 0,this.loaders=Object.create(null),this.hls=r,this.registerListeners()}var d=E.prototype;return d.registerListeners=function(){var e=this.hls;e.on(R.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(R.Events.LEVEL_LOADING,this.onLevelLoading,this),e.on(R.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(R.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},d.unregisterListeners=function(){var e=this.hls;e.off(R.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(R.Events.LEVEL_LOADING,this.onLevelLoading,this),e.off(R.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(R.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},d.createInternalLoader=function(e){var a=this.hls.config,l=a.pLoader,h=a.loader,n=l||h,t=new n(a);return e.loader=t,this.loaders[e.type]=t,t},d.getInternalLoader=function(e){return this.loaders[e.type]},d.resetInternalLoader=function(e){this.loaders[e]&&delete this.loaders[e]},d.destroyInternalLoaders=function(){for(var e in this.loaders){var a=this.loaders[e];a&&a.destroy(),this.resetInternalLoader(e)}},d.destroy=function(){this.unregisterListeners(),this.destroyInternalLoaders()},d.onManifestLoading=function(e,a){var l=a.url;this.load({id:null,groupId:null,level:0,responseType:"text",type:T.PlaylistContextType.MANIFEST,url:l,deliveryDirectives:null})},d.onLevelLoading=function(e,a){var l=a.id,h=a.level,n=a.url,t=a.deliveryDirectives;this.load({id:l,groupId:null,level:h,responseType:"text",type:T.PlaylistContextType.LEVEL,url:n,deliveryDirectives:t})},d.onAudioTrackLoading=function(e,a){var l=a.id,h=a.groupId,n=a.url,t=a.deliveryDirectives;this.load({id:l,groupId:h,level:null,responseType:"text",type:T.PlaylistContextType.AUDIO_TRACK,url:n,deliveryDirectives:t})},d.onSubtitleTrackLoading=function(e,a){var l=a.id,h=a.groupId,n=a.url,t=a.deliveryDirectives;this.load({id:l,groupId:h,level:null,responseType:"text",type:T.PlaylistContextType.SUBTITLE_TRACK,url:n,deliveryDirectives:t})},d.load=function(e){var a,l=this.hls.config,h=this.getInternalLoader(e);if(h){var n=h.context;if(n&&n.url===e.url){b.logger.trace("[playlist-loader]: playlist request ongoing");return}b.logger.log("[playlist-loader]: aborting previous loader for type: "+e.type),h.abort()}var t,i,y,u;switch(e.type){case T.PlaylistContextType.MANIFEST:t=l.manifestLoadingMaxRetry,i=l.manifestLoadingTimeOut,y=l.manifestLoadingRetryDelay,u=l.manifestLoadingMaxRetryTimeout;break;case T.PlaylistContextType.LEVEL:case T.PlaylistContextType.AUDIO_TRACK:case T.PlaylistContextType.SUBTITLE_TRACK:t=0,i=l.levelLoadingTimeOut;break;default:t=l.levelLoadingMaxRetry,i=l.levelLoadingTimeOut,y=l.levelLoadingRetryDelay,u=l.levelLoadingMaxRetryTimeout;break}if(h=this.createInternalLoader(e),(a=e.deliveryDirectives)!==null&&a!==void 0&&a.part){var f;if(e.type===T.PlaylistContextType.LEVEL&&e.level!==null?f=this.hls.levels[e.level].details:e.type===T.PlaylistContextType.AUDIO_TRACK&&e.id!==null?f=this.hls.audioTracks[e.id].details:e.type===T.PlaylistContextType.SUBTITLE_TRACK&&e.id!==null&&(f=this.hls.subtitleTracks[e.id].details),f){var c=f.partTarget,s=f.targetduration;c&&s&&(i=Math.min(Math.max(c*3,s*.8)*1e3,i))}}var o={timeout:i,maxRetry:t,retryDelay:y,maxRetryDelay:u,highWaterMark:0},v={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};h.load(e,o,v)},d.loadsuccess=function(e,a,l,h){if(h===void 0&&(h=null),l.isSidxRequest){this.handleSidxRequest(e,l),this.handlePlaylistLoaded(e,a,l,h);return}this.resetInternalLoader(l.type);var n=e.data;if(n.indexOf("#EXTM3U")!==0){this.handleManifestParsingError(e,l,"no EXTM3U delimiter",h);return}a.parsing.start=performance.now(),n.indexOf("#EXTINF:")>0||n.indexOf("#EXT-X-TARGETDURATION:")>0?this.handleTrackOrLevelPlaylist(e,a,l,h):this.handleMasterPlaylist(e,a,l,h)},d.loaderror=function(e,a,l){l===void 0&&(l=null),this.handleNetworkError(a,l,!1,e)},d.loadtimeout=function(e,a,l){l===void 0&&(l=null),this.handleNetworkError(a,l,!0)},d.handleMasterPlaylist=function(e,a,l,h){var n=this.hls,t=e.data,i=g(e,l),y=I.default.parseMasterPlaylist(t,i),u=y.levels,f=y.sessionData;if(!u.length){this.handleManifestParsingError(e,l,"no level found in manifest",h);return}var c=u.map(function(P){return{id:P.attrs.AUDIO,audioCodec:P.audioCodec}}),s=u.map(function(P){return{id:P.attrs.SUBTITLES,textCodec:P.textCodec}}),o=I.default.parseMasterPlaylistMedia(t,i,"AUDIO",c),v=I.default.parseMasterPlaylistMedia(t,i,"SUBTITLES",s),S=I.default.parseMasterPlaylistMedia(t,i,"CLOSED-CAPTIONS");if(o.length){var A=o.some(function(P){return!P.url});!A&&u[0].audioCodec&&!u[0].attrs.AUDIO&&(b.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),o.unshift({type:"main",name:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new m.AttrList({}),bitrate:0,url:""}))}n.trigger(R.Events.MANIFEST_LOADED,{levels:u,audioTracks:o,subtitles:v,captions:S,url:i,stats:a,networkDetails:h,sessionData:f})},d.handleTrackOrLevelPlaylist=function(e,a,l,h){var n=this.hls,t=l.id,i=l.level,y=l.type,u=g(e,l),f=Object(x.isFiniteNumber)(t)?t:0,c=Object(x.isFiniteNumber)(i)?i:f,s=p(l),o=I.default.parseLevelPlaylist(e.data,u,c,s,f);if(!o.fragments.length){n.trigger(R.Events.ERROR,{type:O.ErrorTypes.NETWORK_ERROR,details:O.ErrorDetails.LEVEL_EMPTY_ERROR,fatal:!1,url:u,reason:"no fragments found in level",level:typeof l.level=="number"?l.level:void 0});return}if(y===T.PlaylistContextType.MANIFEST){var v={attrs:new m.AttrList({}),bitrate:0,details:o,name:"",url:u};n.trigger(R.Events.MANIFEST_LOADED,{levels:[v],audioTracks:[],url:u,stats:a,networkDetails:h,sessionData:null})}if(a.parsing.end=performance.now(),o.needSidxRanges){var S,A=(S=o.fragments[0].initSegment)===null||S===void 0?void 0:S.url;this.load({url:A,isSidxRequest:!0,type:y,level:i,levelDetails:o,id:t,groupId:null,rangeStart:0,rangeEnd:2048,responseType:"arraybuffer",deliveryDirectives:null});return}l.levelDetails=o,this.handlePlaylistLoaded(e,a,l,h)},d.handleSidxRequest=function(e,a){var l=new Uint8Array(e.data),h=Object(C.findBox)(l,["sidx"])[0];if(!!h){var n=Object(C.parseSegmentIndex)(h);if(!!n){var t=n.references,i=a.levelDetails;t.forEach(function(y,u){var f=y.info,c=i.fragments[u];if(c.byteRange.length===0&&c.setByteRange(String(1+f.end-f.start)+"@"+String(f.start)),c.initSegment){var s=Object(C.findBox)(l,["moov"])[0],o=s?s.length:null;c.initSegment.setByteRange(String(o)+"@0")}})}}},d.handleManifestParsingError=function(e,a,l,h){this.hls.trigger(R.Events.ERROR,{type:O.ErrorTypes.NETWORK_ERROR,details:O.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:a.type===T.PlaylistContextType.MANIFEST,url:e.url,reason:l,response:e,context:a,networkDetails:h})},d.handleNetworkError=function(e,a,l,h){l===void 0&&(l=!1),b.logger.warn("[playlist-loader]: A network "+(l?"timeout":"error")+" occurred while loading "+e.type+" level: "+e.level+" id: "+e.id+' group-id: "'+e.groupId+'"');var n=O.ErrorDetails.UNKNOWN,t=!1,i=this.getInternalLoader(e);switch(e.type){case T.PlaylistContextType.MANIFEST:n=l?O.ErrorDetails.MANIFEST_LOAD_TIMEOUT:O.ErrorDetails.MANIFEST_LOAD_ERROR,t=!0;break;case T.PlaylistContextType.LEVEL:n=l?O.ErrorDetails.LEVEL_LOAD_TIMEOUT:O.ErrorDetails.LEVEL_LOAD_ERROR,t=!1;break;case T.PlaylistContextType.AUDIO_TRACK:n=l?O.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:O.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,t=!1;break;case T.PlaylistContextType.SUBTITLE_TRACK:n=l?O.ErrorDetails.SUBTITLE_TRACK_LOAD_TIMEOUT:O.ErrorDetails.SUBTITLE_LOAD_ERROR,t=!1;break}i&&this.resetInternalLoader(e.type);var y={type:O.ErrorTypes.NETWORK_ERROR,details:n,fatal:t,url:e.url,loader:i,context:e,networkDetails:a};h&&(y.response=h),this.hls.trigger(R.Events.ERROR,y)},d.handlePlaylistLoaded=function(e,a,l,h){var n=l.type,t=l.level,i=l.id,y=l.groupId,u=l.loader,f=l.levelDetails,c=l.deliveryDirectives;if(!(f!=null&&f.targetduration)){this.handleManifestParsingError(e,l,"invalid target duration",h);return}if(!!u)switch(f.live&&(u.getCacheAge&&(f.ageHeader=u.getCacheAge()||0),(!u.getCacheAge||isNaN(f.ageHeader))&&(f.ageHeader=0)),n){case T.PlaylistContextType.MANIFEST:case T.PlaylistContextType.LEVEL:this.hls.trigger(R.Events.LEVEL_LOADED,{details:f,level:t||0,id:i||0,stats:a,networkDetails:h,deliveryDirectives:c});break;case T.PlaylistContextType.AUDIO_TRACK:this.hls.trigger(R.Events.AUDIO_TRACK_LOADED,{details:f,id:i||0,groupId:y||"",stats:a,networkDetails:h,deliveryDirectives:c});break;case T.PlaylistContextType.SUBTITLE_TRACK:this.hls.trigger(R.Events.SUBTITLE_TRACK_LOADED,{details:f,id:i||0,groupId:y||"",stats:a,networkDetails:h,deliveryDirectives:c});break}},E}();M.default=D},"./src/polyfills/number.ts":function(K,M,L){L.r(M),L.d(M,"isFiniteNumber",function(){return x}),L.d(M,"MAX_SAFE_INTEGER",function(){return R});var x=Number.isFinite||function(O){return typeof O=="number"&&isFinite(O)},R=Number.MAX_SAFE_INTEGER||9007199254740991},"./src/remux/aac-helper.ts":function(K,M,L){L.r(M);var x=function(){function R(){}return R.getSilentFrame=function(b,C){switch(b){case"mp4a.40.2":if(C===1)return new Uint8Array([0,200,0,128,35,128]);if(C===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(C===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(C===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(C===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(C===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(C===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(C===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(C===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}},R}();M.default=x},"./src/remux/mp4-generator.ts":function(K,M,L){L.r(M);var x=Math.pow(2,32)-1,R=function(){function O(){}return O.init=function(){O.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};var C;for(C in O.types)O.types.hasOwnProperty(C)&&(O.types[C]=[C.charCodeAt(0),C.charCodeAt(1),C.charCodeAt(2),C.charCodeAt(3)]);var I=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),T=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);O.HDLR_TYPES={video:I,audio:T};var m=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),p=new Uint8Array([0,0,0,0,0,0,0,0]);O.STTS=O.STSC=O.STCO=p,O.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),O.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),O.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),O.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var g=new Uint8Array([105,115,111,109]),D=new Uint8Array([97,118,99,49]),E=new Uint8Array([0,0,0,1]);O.FTYP=O.box(O.types.ftyp,g,E,g,D),O.DINF=O.box(O.types.dinf,O.box(O.types.dref,m))},O.box=function(C){for(var I=8,T=arguments.length,m=new Array(T>1?T-1:0),p=1;p<T;p++)m[p-1]=arguments[p];for(var g=m.length,D=g;g--;)I+=m[g].byteLength;var E=new Uint8Array(I);for(E[0]=I>>24&255,E[1]=I>>16&255,E[2]=I>>8&255,E[3]=I&255,E.set(C,4),g=0,I=8;g<D;g++)E.set(m[g],I),I+=m[g].byteLength;return E},O.hdlr=function(C){return O.box(O.types.hdlr,O.HDLR_TYPES[C])},O.mdat=function(C){return O.box(O.types.mdat,C)},O.mdhd=function(C,I){I*=C;var T=Math.floor(I/(x+1)),m=Math.floor(I%(x+1));return O.box(O.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,C>>24&255,C>>16&255,C>>8&255,C&255,T>>24,T>>16&255,T>>8&255,T&255,m>>24,m>>16&255,m>>8&255,m&255,85,196,0,0]))},O.mdia=function(C){return O.box(O.types.mdia,O.mdhd(C.timescale,C.duration),O.hdlr(C.type),O.minf(C))},O.mfhd=function(C){return O.box(O.types.mfhd,new Uint8Array([0,0,0,0,C>>24,C>>16&255,C>>8&255,C&255]))},O.minf=function(C){return C.type==="audio"?O.box(O.types.minf,O.box(O.types.smhd,O.SMHD),O.DINF,O.stbl(C)):O.box(O.types.minf,O.box(O.types.vmhd,O.VMHD),O.DINF,O.stbl(C))},O.moof=function(C,I,T){return O.box(O.types.moof,O.mfhd(C),O.traf(T,I))},O.moov=function(C){for(var I=C.length,T=[];I--;)T[I]=O.trak(C[I]);return O.box.apply(null,[O.types.moov,O.mvhd(C[0].timescale,C[0].duration)].concat(T).concat(O.mvex(C)))},O.mvex=function(C){for(var I=C.length,T=[];I--;)T[I]=O.trex(C[I]);return O.box.apply(null,[O.types.mvex].concat(T))},O.mvhd=function(C,I){I*=C;var T=Math.floor(I/(x+1)),m=Math.floor(I%(x+1)),p=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,C>>24&255,C>>16&255,C>>8&255,C&255,T>>24,T>>16&255,T>>8&255,T&255,m>>24,m>>16&255,m>>8&255,m&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return O.box(O.types.mvhd,p)},O.sdtp=function(C){var I=C.samples||[],T=new Uint8Array(4+I.length),m,p;for(m=0;m<I.length;m++)p=I[m].flags,T[m+4]=p.dependsOn<<4|p.isDependedOn<<2|p.hasRedundancy;return O.box(O.types.sdtp,T)},O.stbl=function(C){return O.box(O.types.stbl,O.stsd(C),O.box(O.types.stts,O.STTS),O.box(O.types.stsc,O.STSC),O.box(O.types.stsz,O.STSZ),O.box(O.types.stco,O.STCO))},O.avc1=function(C){var I=[],T=[],m,p,g;for(m=0;m<C.sps.length;m++)p=C.sps[m],g=p.byteLength,I.push(g>>>8&255),I.push(g&255),I=I.concat(Array.prototype.slice.call(p));for(m=0;m<C.pps.length;m++)p=C.pps[m],g=p.byteLength,T.push(g>>>8&255),T.push(g&255),T=T.concat(Array.prototype.slice.call(p));var D=O.box(O.types.avcC,new Uint8Array([1,I[3],I[4],I[5],255,224|C.sps.length].concat(I).concat([C.pps.length]).concat(T))),E=C.width,d=C.height,r=C.pixelRatio[0],e=C.pixelRatio[1];return O.box(O.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,E>>8&255,E&255,d>>8&255,d&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),D,O.box(O.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),O.box(O.types.pasp,new Uint8Array([r>>24,r>>16&255,r>>8&255,r&255,e>>24,e>>16&255,e>>8&255,e&255])))},O.esds=function(C){var I=C.config.length;return new Uint8Array([0,0,0,0,3,23+I,0,1,0,4,15+I,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([I]).concat(C.config).concat([6,1,2]))},O.mp4a=function(C){var I=C.samplerate;return O.box(O.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,C.channelCount,0,16,0,0,0,0,I>>8&255,I&255,0,0]),O.box(O.types.esds,O.esds(C)))},O.mp3=function(C){var I=C.samplerate;return O.box(O.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,C.channelCount,0,16,0,0,0,0,I>>8&255,I&255,0,0]))},O.stsd=function(C){return C.type==="audio"?C.segmentCodec==="mp3"&&C.codec==="mp3"?O.box(O.types.stsd,O.STSD,O.mp3(C)):O.box(O.types.stsd,O.STSD,O.mp4a(C)):O.box(O.types.stsd,O.STSD,O.avc1(C))},O.tkhd=function(C){var I=C.id,T=C.duration*C.timescale,m=C.width,p=C.height,g=Math.floor(T/(x+1)),D=Math.floor(T%(x+1));return O.box(O.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,I>>24&255,I>>16&255,I>>8&255,I&255,0,0,0,0,g>>24,g>>16&255,g>>8&255,g&255,D>>24,D>>16&255,D>>8&255,D&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,m>>8&255,m&255,0,0,p>>8&255,p&255,0,0]))},O.traf=function(C,I){var T=O.sdtp(C),m=C.id,p=Math.floor(I/(x+1)),g=Math.floor(I%(x+1));return O.box(O.types.traf,O.box(O.types.tfhd,new Uint8Array([0,0,0,0,m>>24,m>>16&255,m>>8&255,m&255])),O.box(O.types.tfdt,new Uint8Array([1,0,0,0,p>>24,p>>16&255,p>>8&255,p&255,g>>24,g>>16&255,g>>8&255,g&255])),O.trun(C,T.length+16+20+8+16+8+8),T)},O.trak=function(C){return C.duration=C.duration||4294967295,O.box(O.types.trak,O.tkhd(C),O.mdia(C))},O.trex=function(C){var I=C.id;return O.box(O.types.trex,new Uint8Array([0,0,0,0,I>>24,I>>16&255,I>>8&255,I&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},O.trun=function(C,I){var T=C.samples||[],m=T.length,p=12+16*m,g=new Uint8Array(p),D,E,d,r,e,a;for(I+=8+p,g.set([0,0,15,1,m>>>24&255,m>>>16&255,m>>>8&255,m&255,I>>>24&255,I>>>16&255,I>>>8&255,I&255],0),D=0;D<m;D++)E=T[D],d=E.duration,r=E.size,e=E.flags,a=E.cts,g.set([d>>>24&255,d>>>16&255,d>>>8&255,d&255,r>>>24&255,r>>>16&255,r>>>8&255,r&255,e.isLeading<<2|e.dependsOn,e.isDependedOn<<6|e.hasRedundancy<<4|e.paddingValue<<1|e.isNonSync,e.degradPrio&240<<8,e.degradPrio&15,a>>>24&255,a>>>16&255,a>>>8&255,a&255],12+16*D);return O.box(O.types.trun,g)},O.initSegment=function(C){O.types||O.init();var I=O.moov(C),T=new Uint8Array(O.FTYP.byteLength+I.byteLength);return T.set(O.FTYP),T.set(I,O.FTYP.byteLength),T},O}();R.types=void 0,R.HDLR_TYPES=void 0,R.STTS=void 0,R.STSC=void 0,R.STCO=void 0,R.STSZ=void 0,R.VMHD=void 0,R.SMHD=void 0,R.STSD=void 0,R.FTYP=void 0,R.DINF=void 0,M.default=R},"./src/remux/mp4-remuxer.ts":function(K,M,L){L.r(M),L.d(M,"default",function(){return a}),L.d(M,"normalizePts",function(){return l}),L.d(M,"flushTextTrackMetadataCueSamples",function(){return n}),L.d(M,"flushTextTrackUserdataCueSamples",function(){return t});var x=L("./src/polyfills/number.ts"),R=L("./src/remux/aac-helper.ts"),O=L("./src/remux/mp4-generator.ts"),b=L("./src/events.ts"),C=L("./src/errors.ts"),I=L("./src/utils/logger.ts"),T=L("./src/types/loader.ts"),m=L("./src/utils/timescale-conversion.ts");function p(){return p=Object.assign?Object.assign.bind():function(u){for(var f=1;f<arguments.length;f++){var c=arguments[f];for(var s in c)Object.prototype.hasOwnProperty.call(c,s)&&(u[s]=c[s])}return u},p.apply(this,arguments)}var g=10*1e3,D=1024,E=1152,d=null,r=null,e=!1,a=function(){function u(c,s,o,v){if(this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=void 0,this._initDTS=void 0,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=c,this.config=s,this.typeSupported=o,this.ISGenerated=!1,d===null){var S=navigator.userAgent||"",A=S.match(/Chrome\/(\d+)/i);d=A?parseInt(A[1]):0}if(r===null){var P=navigator.userAgent.match(/Safari\/(\d+)/i);r=P?parseInt(P[1]):0}e=!(!!d&&d>=75||!!r&&r>=600)}var f=u.prototype;return f.destroy=function(){},f.resetTimeStamp=function(s){I.logger.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=s},f.resetNextTimestamp=function(){I.logger.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1},f.resetInitSegment=function(){I.logger.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1},f.getVideoStartPts=function(s){var o=!1,v=s.reduce(function(S,A){var P=A.pts-S;return P<-4294967296?(o=!0,l(S,A.pts)):P>0?S:A.pts},s[0].pts);return o&&I.logger.debug("PTS rollover detected"),v},f.remux=function(s,o,v,S,A,P,_,F){var k,B,w,U,N,W,j=A,H=A,G=s.pid>-1,z=o.pid>-1,Z=o.samples.length,Y=s.samples.length>0,V=_&&Z>0||Z>1,$=(!G||Y)&&(!z||V)||this.ISGenerated||_;if($){this.ISGenerated||(w=this.generateIS(s,o,A));var X=this.isVideoContiguous,Q=-1,J;if(V&&(Q=h(o.samples),!X&&this.config.forceKeyFrameOnDiscontinuity))if(W=!0,Q>0){I.logger.warn("[mp4-remuxer]: Dropped "+Q+" out of "+Z+" video samples due to a missing keyframe");var q=this.getVideoStartPts(o.samples);o.samples=o.samples.slice(Q),o.dropped+=Q,H+=(o.samples[0].pts-q)/o.inputTimeScale,J=H}else Q===-1&&(I.logger.warn("[mp4-remuxer]: No keyframe found out of "+Z+" video samples"),W=!1);if(this.ISGenerated){if(Y&&V){var ee=this.getVideoStartPts(o.samples),te=l(s.samples[0].pts,ee)-ee,re=te/o.inputTimeScale;j+=Math.max(0,re),H+=Math.max(0,-re)}if(Y){if(s.samplerate||(I.logger.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),w=this.generateIS(s,o,A)),B=this.remuxAudio(s,j,this.isAudioContiguous,P,z||V||F===T.PlaylistLevelType.AUDIO?H:void 0),V){var oe=B?B.endPTS-B.startPTS:0;o.inputTimeScale||(I.logger.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),w=this.generateIS(s,o,A)),k=this.remuxVideo(o,H,X,oe)}}else V&&(k=this.remuxVideo(o,H,X,0));k&&(k.firstKeyFrame=Q,k.independent=Q!==-1,k.firstKeyFramePTS=J)}}return this.ISGenerated&&(v.samples.length&&(N=n(v,A,this._initPTS,this._initDTS)),S.samples.length&&(U=t(S,A,this._initPTS))),{audio:B,video:k,initSegment:w,independent:W,text:U,id3:N}},f.generateIS=function(s,o,v){var S=s.samples,A=o.samples,P=this.typeSupported,_={},F=!Object(x.isFiniteNumber)(this._initPTS),k="audio/mp4",B,w,U;if(F&&(B=w=1/0),s.config&&S.length){switch(s.timescale=s.samplerate,s.segmentCodec){case"mp3":P.mpeg?(k="audio/mpeg",s.codec=""):P.mp3&&(s.codec="mp3");break}_.audio={id:"audio",container:k,codec:s.codec,initSegment:s.segmentCodec==="mp3"&&P.mpeg?new Uint8Array(0):O.default.initSegment([s]),metadata:{channelCount:s.channelCount}},F&&(U=s.inputTimeScale,B=w=S[0].pts-Math.round(U*v))}if(o.sps&&o.pps&&A.length&&(o.timescale=o.inputTimeScale,_.video={id:"main",container:"video/mp4",codec:o.codec,initSegment:O.default.initSegment([o]),metadata:{width:o.width,height:o.height}},F)){U=o.inputTimeScale;var N=this.getVideoStartPts(A),W=Math.round(U*v);w=Math.min(w,l(A[0].dts,N)-W),B=Math.min(B,N-W)}if(Object.keys(_).length)return this.ISGenerated=!0,F&&(this._initPTS=B,this._initDTS=w),{tracks:_,initPTS:B,timescale:U}},f.remuxVideo=function(s,o,v,S){var A=s.inputTimeScale,P=s.samples,_=[],F=P.length,k=this._initPTS,B=this.nextAvcDts,w=8,U=this.videoSampleDuration,N,W,j=Number.POSITIVE_INFINITY,H=Number.NEGATIVE_INFINITY,G=0,z=!1;if(!v||B===null){var Z=o*A,Y=P[0].pts-l(P[0].dts,P[0].pts);B=Z-Y}for(var V=0;V<F;V++){var $=P[V];if($.pts=l($.pts-k,B),$.dts=l($.dts-k,B),$.dts>$.pts){var X=18e3;G=Math.max(Math.min(G,$.pts-$.dts),-1*X)}$.dts<P[V>0?V-1:V].dts&&(z=!0)}z&&P.sort(function(_e,we){var Xe=_e.dts-we.dts,Ze=_e.pts-we.pts;return Xe||Ze}),N=P[0].dts,W=P[P.length-1].dts;var Q=W-N,J=Q?Math.round(Q/(F-1)):U||s.inputTimeScale/30;if(G<0){if(G<J*-2){I.logger.warn("PTS < DTS detected in video samples, offsetting DTS from PTS by "+Object(m.toMsFromMpegTsClock)(-J,!0)+" ms");for(var q=G,ee=0;ee<F;ee++)P[ee].dts=q=Math.max(q,P[ee].pts-J),P[ee].pts=Math.max(q,P[ee].pts)}else{I.logger.warn("PTS < DTS detected in video samples, shifting DTS by "+Object(m.toMsFromMpegTsClock)(G,!0)+" ms to overcome this issue");for(var te=0;te<F;te++)P[te].dts=P[te].dts+G}N=P[0].dts}if(v){var re=N-B,oe=re>J,fe=re<-1;if(oe||fe){oe?I.logger.warn("AVC: "+Object(m.toMsFromMpegTsClock)(re,!0)+" ms ("+re+"dts) hole between fragments detected, filling it"):I.logger.warn("AVC: "+Object(m.toMsFromMpegTsClock)(-re,!0)+" ms ("+re+"dts) overlapping between fragments detected"),N=B;var he=P[0].pts-re;P[0].dts=N,P[0].pts=he,I.logger.log("Video: First PTS/DTS adjusted: "+Object(m.toMsFromMpegTsClock)(he,!0)+"/"+Object(m.toMsFromMpegTsClock)(N,!0)+", delta: "+Object(m.toMsFromMpegTsClock)(re,!0)+" ms")}}e&&(N=Math.max(0,N));for(var ae=0,Se=0,ce=0;ce<F;ce++){for(var le=P[ce],pe=le.units,ye=pe.length,Ee=0,ne=0;ne<ye;ne++)Ee+=pe[ne].data.length;Se+=Ee,ae+=ye,le.length=Ee,le.dts=Math.max(le.dts,N),le.pts=Math.max(le.pts,le.dts,0),j=Math.min(le.pts,j),H=Math.max(le.pts,H)}W=P[F-1].dts;var ue=Se+4*ae+8,ve;try{ve=new Uint8Array(ue)}catch{this.observer.emit(b.Events.ERROR,b.Events.ERROR,{type:C.ErrorTypes.MUX_ERROR,details:C.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:ue,reason:"fail allocating video mdat "+ue});return}var ge=new DataView(ve.buffer);ge.setUint32(0,ue),ve.set(O.default.types.mdat,4);for(var Te=!1,se=0;se<F;se++){for(var me=P[se],Le=me.units,Ae=0,Oe=0,De=Le.length;Oe<De;Oe++){var Pe=Le[Oe],Ce=Pe.data,Re=Pe.data.byteLength;ge.setUint32(w,Re),w+=4,ve.set(Ce,w),w+=Re,Ae+=4+Re}if(se<F-1)U=P[se+1].dts-me.dts;else{var Me=this.config,Ie=se>0?me.dts-P[se-1].dts:J;if(Me.stretchShortVideoTrack&&this.nextAudioPts!==null){var He=Math.floor(Me.maxBufferHole*A),Fe=(S?j+S*A:this.nextAudioPts)-me.pts;Fe>He?(U=Fe-Ie,U<0?U=Ie:Te=!0,I.logger.log("[mp4-remuxer]: It is approximately "+Fe/90+" ms to the next segment; using duration "+U/90+" ms for the last video frame.")):U=Ie}else U=Ie}var Ve=Math.round(me.pts-me.dts);_.push(new i(me.key,U,Ae,Ve))}if(_.length&&d&&d<70){var Ue=_[0].flags;Ue.dependsOn=2,Ue.isNonSync=0}console.assert(U!==null,"mp4SampleDuration must be computed"),U=Te||!U?J:U,this.nextAvcDts=B=W+U,this.videoSampleDuration=U,this.isVideoContiguous=!0;var $e=O.default.moof(s.sequenceNumber++,N,p({},s,{samples:_})),ze="video",Ye={data1:$e,data2:ve,startPTS:j/A,endPTS:(H+U)/A,startDTS:N/A,endDTS:B/A,type:ze,hasAudio:!1,hasVideo:!0,nb:_.length,dropped:s.dropped};return s.samples=[],s.dropped=0,console.assert(ve.length,"MDAT length must not be zero"),Ye},f.remuxAudio=function(s,o,v,S,A){var P=s.inputTimeScale,_=s.samplerate?s.samplerate:P,F=P/_,k=s.segmentCodec==="aac"?D:E,B=k*F,w=this._initPTS,U=s.segmentCodec==="mp3"&&this.typeSupported.mpeg,N=[],W=A!==void 0,j=s.samples,H=U?0:8,G=this.nextAudioPts||-1,z=o*P;if(this.isAudioContiguous=v=v||j.length&&G>0&&(S&&Math.abs(z-G)<9e3||Math.abs(l(j[0].pts-w,z)-G)<20*B),j.forEach(function(De){De.pts=l(De.pts-w,z)}),!v||G<0){if(j=j.filter(function(De){return De.pts>=0}),!j.length)return;A===0?G=0:S&&!W?G=Math.max(0,z):G=j[0].pts}if(s.segmentCodec==="aac")for(var Z=this.config.maxAudioFramesDrift,Y=0,V=G;Y<j.length;Y++){var $=j[Y],X=$.pts,Q=X-V,J=Math.abs(1e3*Q/P);if(Q<=-Z*B&&W)Y===0&&(I.logger.warn("Audio frame @ "+(X/P).toFixed(3)+"s overlaps nextAudioPts by "+Math.round(1e3*Q/P)+" ms."),this.nextAudioPts=G=V=X);else if(Q>=Z*B&&J<g&&W){var q=Math.round(Q/B);V=X-q*B,V<0&&(q--,V+=B),Y===0&&(this.nextAudioPts=G=V),I.logger.warn("[mp4-remuxer]: Injecting "+q+" audio frame @ "+(V/P).toFixed(3)+"s due to "+Math.round(1e3*Q/P)+" ms gap.");for(var ee=0;ee<q;ee++){var te=Math.max(V,0),re=R.default.getSilentFrame(s.manifestCodec||s.codec,s.channelCount);re||(I.logger.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),re=$.unit.subarray()),j.splice(Y,0,{unit:re,pts:te}),V+=B,Y++}}$.pts=V,V+=B}for(var oe=null,fe=null,he,ae=0,Se=j.length;Se--;)ae+=j[Se].unit.byteLength;for(var ce=0,le=j.length;ce<le;ce++){var pe=j[ce],ye=pe.unit,Ee=pe.pts;if(fe!==null){var ne=N[ce-1];ne.duration=Math.round((Ee-fe)/F)}else if(v&&s.segmentCodec==="aac"&&(Ee=G),oe=Ee,ae>0){ae+=H;try{he=new Uint8Array(ae)}catch{this.observer.emit(b.Events.ERROR,b.Events.ERROR,{type:C.ErrorTypes.MUX_ERROR,details:C.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:ae,reason:"fail allocating audio mdat "+ae});return}if(!U){var ue=new DataView(he.buffer);ue.setUint32(0,ae),he.set(O.default.types.mdat,4)}}else return;he.set(ye,H);var ve=ye.byteLength;H+=ve,N.push(new i(!0,k,ve,0)),fe=Ee}var ge=N.length;if(!!ge){var Te=N[N.length-1];this.nextAudioPts=G=fe+F*Te.duration;var se=U?new Uint8Array(0):O.default.moof(s.sequenceNumber++,oe/F,p({},s,{samples:N}));s.samples=[];var me=oe/P,Le=G/P,Ae="audio",Oe={data1:se,data2:he,startPTS:me,endPTS:Le,startDTS:me,endDTS:Le,type:Ae,hasAudio:!0,hasVideo:!1,nb:ge};return this.isAudioContiguous=!0,console.assert(he.length,"MDAT length must not be zero"),Oe}},f.remuxEmptyAudio=function(s,o,v,S){var A=s.inputTimeScale,P=s.samplerate?s.samplerate:A,_=A/P,F=this.nextAudioPts,k=(F!==null?F:S.startDTS*A)+this._initDTS,B=S.endDTS*A+this._initDTS,w=_*D,U=Math.ceil((B-k)/w),N=R.default.getSilentFrame(s.manifestCodec||s.codec,s.channelCount);if(I.logger.warn("[mp4-remuxer]: remux empty Audio"),!N){I.logger.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec");return}for(var W=[],j=0;j<U;j++){var H=k+j*w;W.push({unit:N,pts:H,dts:H})}return s.samples=W,this.remuxAudio(s,o,v,!1)},u}();function l(u,f){var c;if(f===null)return u;for(f<u?c=-8589934592:c=8589934592;Math.abs(u-f)>4294967296;)u+=c;return u}function h(u){for(var f=0;f<u.length;f++)if(u[f].key)return f;return-1}function n(u,f,c,s){var o=u.samples.length;if(!!o){for(var v=u.inputTimeScale,S=0;S<o;S++){var A=u.samples[S];A.pts=l(A.pts-c,f*v)/v,A.dts=l(A.dts-s,f*v)/v}var P=u.samples;return u.samples=[],{samples:P}}}function t(u,f,c){var s=u.samples.length;if(!!s){for(var o=u.inputTimeScale,v=0;v<s;v++){var S=u.samples[v];S.pts=l(S.pts-c,f*o)/o}u.samples.sort(function(P,_){return P.pts-_.pts});var A=u.samples;return u.samples=[],{samples:A}}}var i=function(f,c,s,o){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=c,this.size=s,this.cts=o,this.flags=new y(f)},y=function(f){this.isLeading=0,this.isDependedOn=0,this.hasRedundancy=0,this.degradPrio=0,this.dependsOn=1,this.isNonSync=1,this.dependsOn=f?2:1,this.isNonSync=f?0:1}},"./src/remux/passthrough-remuxer.ts":function(K,M,L){L.r(M);var x=L("./src/polyfills/number.ts"),R=L("./src/remux/mp4-remuxer.ts"),O=L("./src/utils/mp4-tools.ts"),b=L("./src/loader/fragment.ts"),C=L("./src/utils/logger.ts"),I=function(){function p(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=void 0,this.initTracks=void 0,this.lastEndDTS=null}var g=p.prototype;return g.destroy=function(){},g.resetTimeStamp=function(E){this.initPTS=E,this.lastEndDTS=null},g.resetNextTimestamp=function(){this.lastEndDTS=null},g.resetInitSegment=function(E,d,r){this.audioCodec=d,this.videoCodec=r,this.generateInitSegment(E),this.emitInitSegment=!0},g.generateInitSegment=function(E){var d=this.audioCodec,r=this.videoCodec;if(!E||!E.byteLength){this.initTracks=void 0,this.initData=void 0;return}var e=this.initData=Object(O.parseInitSegment)(E);d||(d=m(e.audio,b.ElementaryStreamTypes.AUDIO)),r||(r=m(e.video,b.ElementaryStreamTypes.VIDEO));var a={};e.audio&&e.video?a.audiovideo={container:"video/mp4",codec:d+","+r,initSegment:E,id:"main"}:e.audio?a.audio={container:"audio/mp4",codec:d,initSegment:E,id:"audio"}:e.video?a.video={container:"video/mp4",codec:r,initSegment:E,id:"main"}:C.logger.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=a},g.remux=function(E,d,r,e,a){var l,h=this.initPTS,n=this.lastEndDTS,t={audio:void 0,video:void 0,text:e,id3:r,initSegment:void 0};Object(x.isFiniteNumber)(n)||(n=this.lastEndDTS=a||0);var i=d.samples;if(!i||!i.length)return t;var y={initPTS:void 0,timescale:1},u=this.initData;if((!u||!u.length)&&(this.generateInitSegment(i),u=this.initData),!u||!u.length)return C.logger.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),t;this.emitInitSegment&&(y.tracks=this.initTracks,this.emitInitSegment=!1),Object(x.isFiniteNumber)(h)||(this.initPTS=y.initPTS=h=T(u,i,n));var f=Object(O.getDuration)(i,u),c=n,s=f+c;Object(O.offsetStartDTS)(u,i,h),f>0?this.lastEndDTS=s:(C.logger.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());var o=!!u.audio,v=!!u.video,S="";o&&(S+="audio"),v&&(S+="video");var A={data1:i,startPTS:c,startDTS:c,endPTS:s,endDTS:s,type:S,hasAudio:o,hasVideo:v,nb:1,dropped:0};t.audio=A.type==="audio"?A:void 0,t.video=A.type!=="audio"?A:void 0,t.initSegment=y;var P=(l=this.initPTS)!=null?l:0;return t.id3=Object(R.flushTextTrackMetadataCueSamples)(r,a,P,P),e.samples.length&&(t.text=Object(R.flushTextTrackUserdataCueSamples)(e,a,P)),t},p}(),T=function(g,D,E){return Object(O.getStartDTS)(g,D)-E};function m(p,g){var D=p==null?void 0:p.codec;return D&&D.length>4?D:D==="hvc1"||D==="hev1"?"hvc1.1.c.L120.90":D==="av01"?"av01.0.04M.08":D==="avc1"||g===b.ElementaryStreamTypes.VIDEO?"avc1.42e01e":"mp4a.40.5"}M.default=I},"./src/task-loop.ts":function(K,M,L){L.r(M),L.d(M,"default",function(){return x});var x=function(){function R(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}var O=R.prototype;return O.destroy=function(){this.onHandlerDestroying(),this.onHandlerDestroyed()},O.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},O.onHandlerDestroyed=function(){},O.hasInterval=function(){return!!this._tickInterval},O.hasNextTick=function(){return!!this._tickTimer},O.setInterval=function(C){return this._tickInterval?!1:(this._tickInterval=self.setInterval(this._boundTick,C),!0)},O.clearInterval=function(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1},O.clearNextTick=function(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1},O.tick=function(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)},O.tickImmediate=function(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)},O.doTick=function(){},R}()},"./src/types/cmcd.ts":function(K,M,L){L.r(M),L.d(M,"CMCDVersion",function(){return x}),L.d(M,"CMCDObjectType",function(){return R}),L.d(M,"CMCDStreamingFormat",function(){return O}),L.d(M,"CMCDStreamType",function(){return b});var x=1,R;(function(C){C.MANIFEST="m",C.AUDIO="a",C.VIDEO="v",C.MUXED="av",C.INIT="i",C.CAPTION="c",C.TIMED_TEXT="tt",C.KEY="k",C.OTHER="o"})(R||(R={}));var O;(function(C){C.DASH="d",C.HLS="h",C.SMOOTH="s",C.OTHER="o"})(O||(O={}));var b;(function(C){C.VOD="v",C.LIVE="l"})(b||(b={}))},"./src/types/demuxer.ts":function(K,M,L){L.r(M),L.d(M,"MetadataSchema",function(){return x});var x;(function(R){R.audioId3="org.id3",R.dateRange="com.apple.quicktime.HLS",R.emsg="https://aomedia.org/emsg/ID3"})(x||(x={}))},"./src/types/level.ts":function(K,M,L){L.r(M),L.d(M,"HlsSkip",function(){return O}),L.d(M,"getSkipValue",function(){return b}),L.d(M,"HlsUrlParameters",function(){return C}),L.d(M,"Level",function(){return I});function x(T,m){for(var p=0;p<m.length;p++){var g=m[p];g.enumerable=g.enumerable||!1,g.configurable=!0,"value"in g&&(g.writable=!0),Object.defineProperty(T,g.key,g)}}function R(T,m,p){return m&&x(T.prototype,m),p&&x(T,p),Object.defineProperty(T,"prototype",{writable:!1}),T}var O;(function(T){T.No="",T.Yes="YES",T.v2="v2"})(O||(O={}));function b(T,m){var p=T.canSkipUntil,g=T.canSkipDateRanges,D=T.endSN,E=m!==void 0?m-D:0;return p&&E<p?g?O.v2:O.Yes:O.No}var C=function(){function T(p,g,D){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=p,this.part=g,this.skip=D}var m=T.prototype;return m.addDirectives=function(g){var D=new self.URL(g);return this.msn!==void 0&&D.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&D.searchParams.set("_HLS_part",this.part.toString()),this.skip&&D.searchParams.set("_HLS_skip",this.skip),D.toString()},T}(),I=function(){function T(m){this.attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.audioGroupIds=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this._urlId=0,this.url=[m.url],this.attrs=m.attrs,this.bitrate=m.bitrate,m.details&&(this.details=m.details),this.id=m.id||0,this.name=m.name,this.width=m.width||0,this.height=m.height||0,this.audioCodec=m.audioCodec,this.videoCodec=m.videoCodec,this.unknownCodecs=m.unknownCodecs,this.codecSet=[m.videoCodec,m.audioCodec].filter(function(p){return p}).join(",").replace(/\.[^.,]+/g,"")}return R(T,[{key:"maxBitrate",get:function(){return Math.max(this.realBitrate,this.bitrate)}},{key:"uri",get:function(){return this.url[this._urlId]||""}},{key:"urlId",get:function(){return this._urlId},set:function(p){var g=p%this.url.length;this._urlId!==g&&(this.details=void 0,this._urlId=g)}}]),T}()},"./src/types/loader.ts":function(K,M,L){L.r(M),L.d(M,"PlaylistContextType",function(){return x}),L.d(M,"PlaylistLevelType",function(){return R});var x;(function(O){O.MANIFEST="manifest",O.LEVEL="level",O.AUDIO_TRACK="audioTrack",O.SUBTITLE_TRACK="subtitleTrack"})(x||(x={}));var R;(function(O){O.MAIN="main",O.AUDIO="audio",O.SUBTITLE="subtitle"})(R||(R={}))},"./src/types/transmuxer.ts":function(K,M,L){L.r(M),L.d(M,"ChunkMetadata",function(){return x});var x=function(b,C,I,T,m,p){T===void 0&&(T=0),m===void 0&&(m=-1),p===void 0&&(p=!1),this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=R(),this.buffering={audio:R(),video:R(),audiovideo:R()},this.level=b,this.sn=C,this.id=I,this.size=T,this.part=m,this.partial=p};function R(){return{start:0,executeStart:0,executeEnd:0,end:0}}},"./src/utils/attr-list.ts":function(K,M,L){L.r(M),L.d(M,"AttrList",function(){return O});var x=/^(\d+)x(\d+)$/,R=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,O=function(){function b(I){typeof I=="string"&&(I=b.parseAttrList(I));for(var T in I)I.hasOwnProperty(T)&&(this[T]=I[T])}var C=b.prototype;return C.decimalInteger=function(T){var m=parseInt(this[T],10);return m>Number.MAX_SAFE_INTEGER?1/0:m},C.hexadecimalInteger=function(T){if(this[T]){var m=(this[T]||"0x").slice(2);m=(m.length&1?"0":"")+m;for(var p=new Uint8Array(m.length/2),g=0;g<m.length/2;g++)p[g]=parseInt(m.slice(g*2,g*2+2),16);return p}else return null},C.hexadecimalIntegerAsNumber=function(T){var m=parseInt(this[T],16);return m>Number.MAX_SAFE_INTEGER?1/0:m},C.decimalFloatingPoint=function(T){return parseFloat(this[T])},C.optionalFloat=function(T,m){var p=this[T];return p?parseFloat(p):m},C.enumeratedString=function(T){return this[T]},C.bool=function(T){return this[T]==="YES"},C.decimalResolution=function(T){var m=x.exec(this[T]);if(m!==null)return{width:parseInt(m[1],10),height:parseInt(m[2],10)}},b.parseAttrList=function(T){var m,p={},g='"';for(R.lastIndex=0;(m=R.exec(T))!==null;){var D=m[2];D.indexOf(g)===0&&D.lastIndexOf(g)===D.length-1&&(D=D.slice(1,-1)),p[m[1]]=D}return p},b}()},"./src/utils/binary-search.ts":function(K,M,L){L.r(M);var x={search:function(O,b){for(var C=0,I=O.length-1,T=null,m=null;C<=I;){T=(C+I)/2|0,m=O[T];var p=b(m);if(p>0)C=T+1;else if(p<0)I=T-1;else return m}return null}};M.default=x},"./src/utils/buffer-helper.ts":function(K,M,L){L.r(M),L.d(M,"BufferHelper",function(){return O});var x=L("./src/utils/logger.ts"),R={length:0,start:function(){return 0},end:function(){return 0}},O=function(){function b(){}return b.isBuffered=function(I,T){try{if(I){for(var m=b.getBuffered(I),p=0;p<m.length;p++)if(T>=m.start(p)&&T<=m.end(p))return!0}}catch{}return!1},b.bufferInfo=function(I,T,m){try{if(I){var p=b.getBuffered(I),g=[],D;for(D=0;D<p.length;D++)g.push({start:p.start(D),end:p.end(D)});return this.bufferedInfo(g,T,m)}}catch{}return{len:0,start:T,end:T,nextStart:void 0}},b.bufferedInfo=function(I,T,m){T=Math.max(0,T),I.sort(function(t,i){var y=t.start-i.start;return y||i.end-t.end});var p=[];if(m)for(var g=0;g<I.length;g++){var D=p.length;if(D){var E=p[D-1].end;I[g].start-E<m?I[g].end>E&&(p[D-1].end=I[g].end):p.push(I[g])}else p.push(I[g])}else p=I;for(var d=0,r,e=T,a=T,l=0;l<p.length;l++){var h=p[l].start,n=p[l].end;if(T+m>=h&&T<n)e=h,a=n,d=a-T;else if(T+m<h){r=h;break}}return{len:d,start:e||0,end:a||0,nextStart:r}},b.getBuffered=function(I){try{return I.buffered}catch(T){return x.logger.log("failed to get media.buffered",T),R}},b}()},"./src/utils/cea-608-parser.ts":function(K,M,L){L.r(M),L.d(M,"Row",function(){return a}),L.d(M,"CaptionScreen",function(){return l});var x=L("./src/utils/logger.ts"),R={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},O=function(f){var c=f;return R.hasOwnProperty(f)&&(c=R[f]),String.fromCharCode(c)},b=15,C=100,I={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},T={17:2,18:4,21:6,22:8,23:10,19:13,20:15},m={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},p={25:2,26:4,29:6,30:8,31:10,27:13,28:15},g=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],D;(function(u){u[u.ERROR=0]="ERROR",u[u.TEXT=1]="TEXT",u[u.WARNING=2]="WARNING",u[u.INFO=2]="INFO",u[u.DEBUG=3]="DEBUG",u[u.DATA=3]="DATA"})(D||(D={}));var E=function(){function u(){this.time=null,this.verboseLevel=D.ERROR}var f=u.prototype;return f.log=function(s,o){this.verboseLevel>=s&&x.logger.log(this.time+" ["+s+"] "+o)},u}(),d=function(f){for(var c=[],s=0;s<f.length;s++)c.push(f[s].toString(16));return c},r=function(){function u(c,s,o,v,S){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=c||"white",this.underline=s||!1,this.italics=o||!1,this.background=v||"black",this.flash=S||!1}var f=u.prototype;return f.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},f.setStyles=function(s){for(var o=["foreground","underline","italics","background","flash"],v=0;v<o.length;v++){var S=o[v];s.hasOwnProperty(S)&&(this[S]=s[S])}},f.isDefault=function(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash},f.equals=function(s){return this.foreground===s.foreground&&this.underline===s.underline&&this.italics===s.italics&&this.background===s.background&&this.flash===s.flash},f.copy=function(s){this.foreground=s.foreground,this.underline=s.underline,this.italics=s.italics,this.background=s.background,this.flash=s.flash},f.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},u}(),e=function(){function u(c,s,o,v,S,A){this.uchar=void 0,this.penState=void 0,this.uchar=c||" ",this.penState=new r(s,o,v,S,A)}var f=u.prototype;return f.reset=function(){this.uchar=" ",this.penState.reset()},f.setChar=function(s,o){this.uchar=s,this.penState.copy(o)},f.setPenState=function(s){this.penState.copy(s)},f.equals=function(s){return this.uchar===s.uchar&&this.penState.equals(s.penState)},f.copy=function(s){this.uchar=s.uchar,this.penState.copy(s.penState)},f.isEmpty=function(){return this.uchar===" "&&this.penState.isDefault()},u}(),a=function(){function u(c){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(var s=0;s<C;s++)this.chars.push(new e);this.logger=c,this.pos=0,this.currPenState=new r}var f=u.prototype;return f.equals=function(s){for(var o=!0,v=0;v<C;v++)if(!this.chars[v].equals(s.chars[v])){o=!1;break}return o},f.copy=function(s){for(var o=0;o<C;o++)this.chars[o].copy(s.chars[o])},f.isEmpty=function(){for(var s=!0,o=0;o<C;o++)if(!this.chars[o].isEmpty()){s=!1;break}return s},f.setCursor=function(s){this.pos!==s&&(this.pos=s),this.pos<0?(this.logger.log(D.DEBUG,"Negative cursor position "+this.pos),this.pos=0):this.pos>C&&(this.logger.log(D.DEBUG,"Too large cursor position "+this.pos),this.pos=C)},f.moveCursor=function(s){var o=this.pos+s;if(s>1)for(var v=this.pos+1;v<o+1;v++)this.chars[v].setPenState(this.currPenState);this.setCursor(o)},f.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},f.insertChar=function(s){s>=144&&this.backSpace();var o=O(s);if(this.pos>=C){this.logger.log(D.ERROR,"Cannot insert "+s.toString(16)+" ("+o+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(o,this.currPenState),this.moveCursor(1)},f.clearFromPos=function(s){var o;for(o=s;o<C;o++)this.chars[o].reset()},f.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},f.clearToEndOfRow=function(){this.clearFromPos(this.pos)},f.getTextString=function(){for(var s=[],o=!0,v=0;v<C;v++){var S=this.chars[v].uchar;S!==" "&&(o=!1),s.push(S)}return o?"":s.join("")},f.setPenStyles=function(s){this.currPenState.setStyles(s);var o=this.chars[this.pos];o.setPenState(this.currPenState)},u}(),l=function(){function u(c){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(var s=0;s<b;s++)this.rows.push(new a(c));this.logger=c,this.currRow=b-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}var f=u.prototype;return f.reset=function(){for(var s=0;s<b;s++)this.rows[s].clear();this.currRow=b-1},f.equals=function(s){for(var o=!0,v=0;v<b;v++)if(!this.rows[v].equals(s.rows[v])){o=!1;break}return o},f.copy=function(s){for(var o=0;o<b;o++)this.rows[o].copy(s.rows[o])},f.isEmpty=function(){for(var s=!0,o=0;o<b;o++)if(!this.rows[o].isEmpty()){s=!1;break}return s},f.backSpace=function(){var s=this.rows[this.currRow];s.backSpace()},f.clearToEndOfRow=function(){var s=this.rows[this.currRow];s.clearToEndOfRow()},f.insertChar=function(s){var o=this.rows[this.currRow];o.insertChar(s)},f.setPen=function(s){var o=this.rows[this.currRow];o.setPenStyles(s)},f.moveCursor=function(s){var o=this.rows[this.currRow];o.moveCursor(s)},f.setCursor=function(s){this.logger.log(D.INFO,"setCursor: "+s);var o=this.rows[this.currRow];o.setCursor(s)},f.setPAC=function(s){this.logger.log(D.INFO,"pacData = "+JSON.stringify(s));var o=s.row-1;if(this.nrRollUpRows&&o<this.nrRollUpRows-1&&(o=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==o){for(var v=0;v<b;v++)this.rows[v].clear();var S=this.currRow+1-this.nrRollUpRows,A=this.lastOutputScreen;if(A){var P=A.rows[S].cueStartTime,_=this.logger.time;if(P&&_!==null&&P<_)for(var F=0;F<this.nrRollUpRows;F++)this.rows[o-this.nrRollUpRows+F+1].copy(A.rows[S+F])}}this.currRow=o;var k=this.rows[this.currRow];if(s.indent!==null){var B=s.indent,w=Math.max(B-1,0);k.setCursor(s.indent),s.color=k.chars[w].penState.foreground}var U={foreground:s.color,underline:s.underline,italics:s.italics,background:"black",flash:!1};this.setPen(U)},f.setBkgData=function(s){this.logger.log(D.INFO,"bkgData = "+JSON.stringify(s)),this.backSpace(),this.setPen(s),this.insertChar(32)},f.setRollUpRows=function(s){this.nrRollUpRows=s},f.rollUp=function(){if(this.nrRollUpRows===null){this.logger.log(D.DEBUG,"roll_up but nrRollUpRows not set yet");return}this.logger.log(D.TEXT,this.getDisplayText());var s=this.currRow+1-this.nrRollUpRows,o=this.rows.splice(s,1)[0];o.clear(),this.rows.splice(this.currRow,0,o),this.logger.log(D.INFO,"Rolling up")},f.getDisplayText=function(s){s=s||!1;for(var o=[],v="",S=-1,A=0;A<b;A++){var P=this.rows[A].getTextString();P&&(S=A+1,s?o.push("Row "+S+": '"+P+"'"):o.push(P.trim()))}return o.length>0&&(s?v="["+o.join(" | ")+"]":v=o.join(`
`)),v},f.getTextAndFormat=function(){return this.rows},u}(),h=function(){function u(c,s,o){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=c,this.outputFilter=s,this.mode=null,this.verbose=0,this.displayedMemory=new l(o),this.nonDisplayedMemory=new l(o),this.lastOutputScreen=new l(o),this.currRollUpRow=this.displayedMemory.rows[b-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=o}var f=u.prototype;return f.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[b-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null},f.getHandler=function(){return this.outputFilter},f.setHandler=function(s){this.outputFilter=s},f.setPAC=function(s){this.writeScreen.setPAC(s)},f.setBkgData=function(s){this.writeScreen.setBkgData(s)},f.setMode=function(s){s!==this.mode&&(this.mode=s,this.logger.log(D.INFO,"MODE="+s),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=s)},f.insertChars=function(s){for(var o=0;o<s.length;o++)this.writeScreen.insertChar(s[o]);var v=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(D.INFO,v+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(D.TEXT,"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},f.ccRCL=function(){this.logger.log(D.INFO,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},f.ccBS=function(){this.logger.log(D.INFO,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},f.ccAOF=function(){},f.ccAON=function(){},f.ccDER=function(){this.logger.log(D.INFO,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},f.ccRU=function(s){this.logger.log(D.INFO,"RU("+s+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(s)},f.ccFON=function(){this.logger.log(D.INFO,"FON - Flash On"),this.writeScreen.setPen({flash:!0})},f.ccRDC=function(){this.logger.log(D.INFO,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},f.ccTR=function(){this.logger.log(D.INFO,"TR"),this.setMode("MODE_TEXT")},f.ccRTD=function(){this.logger.log(D.INFO,"RTD"),this.setMode("MODE_TEXT")},f.ccEDM=function(){this.logger.log(D.INFO,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},f.ccCR=function(){this.logger.log(D.INFO,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},f.ccENM=function(){this.logger.log(D.INFO,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},f.ccEOC=function(){if(this.logger.log(D.INFO,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){var s=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=s,this.writeScreen=this.nonDisplayedMemory,this.logger.log(D.TEXT,"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)},f.ccTO=function(s){this.logger.log(D.INFO,"TO("+s+") - Tab Offset"),this.writeScreen.moveCursor(s)},f.ccMIDROW=function(s){var o={flash:!1};if(o.underline=s%2===1,o.italics=s>=46,o.italics)o.foreground="white";else{var v=Math.floor(s/2)-16,S=["white","green","blue","cyan","red","yellow","magenta"];o.foreground=S[v]}this.logger.log(D.INFO,"MIDROW: "+JSON.stringify(o)),this.writeScreen.setPen(o)},f.outputDataUpdate=function(s){s===void 0&&(s=!1);var o=this.logger.time;o!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=o:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,o,this.lastOutputScreen),s&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:o),this.lastOutputScreen.copy(this.displayedMemory))},f.cueSplitAtTime=function(s){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,s,this.displayedMemory),this.cueStartTime=s))},u}(),n=function(){function u(c,s,o){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;var v=new E;this.channels=[null,new h(c,s,v),new h(c+1,o,v)],this.cmdHistory=y(),this.logger=v}var f=u.prototype;return f.getHandler=function(s){return this.channels[s].getHandler()},f.setHandler=function(s,o){this.channels[s].setHandler(o)},f.addData=function(s,o){var v,S,A,P=!1;this.logger.time=s;for(var _=0;_<o.length;_+=2)if(S=o[_]&127,A=o[_+1]&127,!(S===0&&A===0)){if(this.logger.log(D.DATA,"["+d([o[_],o[_+1]])+"] -> ("+d([S,A])+")"),v=this.parseCmd(S,A),v||(v=this.parseMidrow(S,A)),v||(v=this.parsePAC(S,A)),v||(v=this.parseBackgroundAttributes(S,A)),!v&&(P=this.parseChars(S,A),P)){var F=this.currentChannel;if(F&&F>0){var k=this.channels[F];k.insertChars(P)}else this.logger.log(D.WARNING,"No channel found yet. TEXT-MODE?")}!v&&!P&&this.logger.log(D.WARNING,"Couldn't parse cleaned data "+d([S,A])+" orig: "+d([o[_],o[_+1]]))}},f.parseCmd=function(s,o){var v=this.cmdHistory,S=(s===20||s===28||s===21||s===29)&&o>=32&&o<=47,A=(s===23||s===31)&&o>=33&&o<=35;if(!(S||A))return!1;if(i(s,o,v))return t(null,null,v),this.logger.log(D.DEBUG,"Repeated command ("+d([s,o])+") is dropped"),!0;var P=s===20||s===21||s===23?1:2,_=this.channels[P];return s===20||s===21||s===28||s===29?o===32?_.ccRCL():o===33?_.ccBS():o===34?_.ccAOF():o===35?_.ccAON():o===36?_.ccDER():o===37?_.ccRU(2):o===38?_.ccRU(3):o===39?_.ccRU(4):o===40?_.ccFON():o===41?_.ccRDC():o===42?_.ccTR():o===43?_.ccRTD():o===44?_.ccEDM():o===45?_.ccCR():o===46?_.ccENM():o===47&&_.ccEOC():_.ccTO(o-32),t(s,o,v),this.currentChannel=P,!0},f.parseMidrow=function(s,o){var v=0;if((s===17||s===25)&&o>=32&&o<=47){if(s===17?v=1:v=2,v!==this.currentChannel)return this.logger.log(D.ERROR,"Mismatch channel in midrow parsing"),!1;var S=this.channels[v];return S?(S.ccMIDROW(o),this.logger.log(D.DEBUG,"MIDROW ("+d([s,o])+")"),!0):!1}return!1},f.parsePAC=function(s,o){var v,S=this.cmdHistory,A=(s>=17&&s<=23||s>=25&&s<=31)&&o>=64&&o<=127,P=(s===16||s===24)&&o>=64&&o<=95;if(!(A||P))return!1;if(i(s,o,S))return t(null,null,S),!0;var _=s<=23?1:2;o>=64&&o<=95?v=_===1?I[s]:m[s]:v=_===1?T[s]:p[s];var F=this.channels[_];return F?(F.setPAC(this.interpretPAC(v,o)),t(s,o,S),this.currentChannel=_,!0):!1},f.interpretPAC=function(s,o){var v,S={color:null,italics:!1,indent:null,underline:!1,row:s};return o>95?v=o-96:v=o-64,S.underline=(v&1)===1,v<=13?S.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(v/2)]:v<=15?(S.italics=!0,S.color="white"):S.indent=Math.floor((v-16)/2)*4,S},f.parseChars=function(s,o){var v,S=null,A=null;if(s>=25?(v=2,A=s-8):(v=1,A=s),A>=17&&A<=19){var P;A===17?P=o+80:A===18?P=o+112:P=o+144,this.logger.log(D.INFO,"Special char '"+O(P)+"' in channel "+v),S=[P]}else s>=32&&s<=127&&(S=o===0?[s]:[s,o]);if(S){var _=d(S);this.logger.log(D.DEBUG,"Char codes =  "+_.join(",")),t(s,o,this.cmdHistory)}return S},f.parseBackgroundAttributes=function(s,o){var v=(s===16||s===24)&&o>=32&&o<=47,S=(s===23||s===31)&&o>=45&&o<=47;if(!(v||S))return!1;var A,P={};s===16||s===24?(A=Math.floor((o-32)/2),P.background=g[A],o%2===1&&(P.background=P.background+"_semi")):o===45?P.background="transparent":(P.foreground="black",o===47&&(P.underline=!0));var _=s<=23?1:2,F=this.channels[_];return F.setBkgData(P),t(s,o,this.cmdHistory),!0},f.reset=function(){for(var s=0;s<Object.keys(this.channels).length;s++){var o=this.channels[s];o&&o.reset()}this.cmdHistory=y()},f.cueSplitAtTime=function(s){for(var o=0;o<this.channels.length;o++){var v=this.channels[o];v&&v.cueSplitAtTime(s)}},u}();function t(u,f,c){c.a=u,c.b=f}function i(u,f,c){return c.a===u&&c.b===f}function y(){return{a:null,b:null}}M.default=n},"./src/utils/codecs.ts":function(K,M,L){L.r(M),L.d(M,"isCodecType",function(){return R}),L.d(M,"isCodecSupportedInMp4",function(){return O});var x={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,av01:!0,drac:!0,dvav:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0},text:{stpp:!0,wvtt:!0}};function R(b,C){var I=x[C];return!!I&&I[b.slice(0,4)]===!0}function O(b,C){return MediaSource.isTypeSupported((C||"video")+'/mp4;codecs="'+b+'"')}},"./src/utils/cues.ts":function(K,M,L){L.r(M);var x=L("./src/utils/vttparser.ts"),R=L("./src/utils/webvtt-parser.ts"),O=L("./src/utils/texttrack-utils.ts"),b=/\s/,C={newCue:function(T,m,p,g){for(var D=[],E,d,r,e,a,l=self.VTTCue||self.TextTrackCue,h=0;h<g.rows.length;h++)if(E=g.rows[h],r=!0,e=0,a="",!E.isEmpty()){for(var n=0;n<E.chars.length;n++)b.test(E.chars[n].uchar)&&r?e++:(a+=E.chars[n].uchar,r=!1);E.cueStartTime=m,m===p&&(p+=1e-4),e>=16?e--:e++;var t=Object(x.fixLineBreaks)(a.trim()),i=Object(R.generateCueId)(m,p,t);(!T||!T.cues||!T.cues.getCueById(i))&&(d=new l(m,p,t),d.id=i,d.line=h+1,d.align="left",d.position=10+Math.min(80,Math.floor(e*8/32)*10),D.push(d))}return T&&D.length&&(D.sort(function(y,u){return y.line==="auto"||u.line==="auto"?0:y.line>8&&u.line>8?u.line-y.line:y.line-u.line}),D.forEach(function(y){return Object(O.addCueToTrack)(T,y)})),D}};M.default=C},"./src/utils/discontinuities.ts":function(K,M,L){L.r(M),L.d(M,"findFirstFragWithCC",function(){return b}),L.d(M,"shouldAlignOnDiscontinuities",function(){return C}),L.d(M,"findDiscontinuousReferenceFrag",function(){return I}),L.d(M,"adjustSlidingStart",function(){return m}),L.d(M,"alignStream",function(){return p}),L.d(M,"alignPDT",function(){return D}),L.d(M,"alignFragmentByPDTDelta",function(){return E}),L.d(M,"alignMediaPlaylistByPDT",function(){return d});var x=L("./src/polyfills/number.ts"),R=L("./src/utils/logger.ts"),O=L("./src/controller/level-helper.ts");function b(r,e){for(var a=null,l=0,h=r.length;l<h;l++){var n=r[l];if(n&&n.cc===e){a=n;break}}return a}function C(r,e,a){return!!(e.details&&(a.endCC>a.startCC||r&&r.cc<a.startCC))}function I(r,e){var a=r.fragments,l=e.fragments;if(!l.length||!a.length){R.logger.log("No fragments to align");return}var h=b(a,l[0].cc);if(!h||h&&!h.startPTS){R.logger.log("No frag in previous level to align on");return}return h}function T(r,e){if(r){var a=r.start+e;r.start=r.startPTS=a,r.endPTS=a+r.duration}}function m(r,e){for(var a=e.fragments,l=0,h=a.length;l<h;l++)T(a[l],r);e.fragmentHint&&T(e.fragmentHint,r),e.alignedSliding=!0}function p(r,e,a){!e||(g(r,a,e),!a.alignedSliding&&e.details&&D(a,e.details),!a.alignedSliding&&e.details&&!a.skippedSegments&&Object(O.adjustSliding)(e.details,a))}function g(r,e,a){if(C(r,a,e)){var l=I(a.details,e);l&&Object(x.isFiniteNumber)(l.start)&&(R.logger.log("Adjusting PTS using last level due to CC increase within current level "+e.url),m(l.start,e))}}function D(r,e){if(!(!e.fragments.length||!r.hasProgramDateTime||!e.hasProgramDateTime)){var a=e.fragments[0].programDateTime,l=r.fragments[0].programDateTime,h=(l-a)/1e3+e.fragments[0].start;h&&Object(x.isFiniteNumber)(h)&&(R.logger.log("Adjusting PTS using programDateTime delta "+(l-a)+"ms, sliding:"+h.toFixed(3)+" "+r.url+" "),m(h,r))}}function E(r,e){var a=r.programDateTime;if(!!a){var l=(a-e)/1e3;r.start=r.startPTS=l,r.endPTS=l+r.duration}}function d(r,e){if(!(!e.fragments.length||!r.hasProgramDateTime||!e.hasProgramDateTime)){var a=e.fragments[0].programDateTime,l=e.fragments[0].start,h=a-l*1e3;r.fragments.forEach(function(n){E(n,h)}),r.fragmentHint&&E(r.fragmentHint,h),r.alignedSliding=!0}}},"./src/utils/ewma-bandwidth-estimator.ts":function(K,M,L){L.r(M);var x=L("./src/utils/ewma.ts"),R=function(){function O(C,I,T){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultEstimate_=T,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new x.default(C),this.fast_=new x.default(I)}var b=O.prototype;return b.update=function(I,T){var m=this.slow_,p=this.fast_;this.slow_.halfLife!==I&&(this.slow_=new x.default(I,m.getEstimate(),m.getTotalWeight())),this.fast_.halfLife!==T&&(this.fast_=new x.default(T,p.getEstimate(),p.getTotalWeight()))},b.sample=function(I,T){I=Math.max(I,this.minDelayMs_);var m=8*T,p=I/1e3,g=m/p;this.fast_.sample(p,g),this.slow_.sample(p,g)},b.canEstimate=function(){var I=this.fast_;return I&&I.getTotalWeight()>=this.minWeight_},b.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},b.destroy=function(){},O}();M.default=R},"./src/utils/ewma.ts":function(K,M,L){L.r(M);var x=function(){function R(b,C,I){C===void 0&&(C=0),I===void 0&&(I=0),this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=b,this.alpha_=b?Math.exp(Math.log(.5)/b):0,this.estimate_=C,this.totalWeight_=I}var O=R.prototype;return O.sample=function(C,I){var T=Math.pow(this.alpha_,C);this.estimate_=I*(1-T)+T*this.estimate_,this.totalWeight_+=C},O.getTotalWeight=function(){return this.totalWeight_},O.getEstimate=function(){if(this.alpha_){var C=1-Math.pow(this.alpha_,this.totalWeight_);if(C)return this.estimate_/C}return this.estimate_},R}();M.default=x},"./src/utils/fetch-loader.ts":function(K,M,L){L.r(M),L.d(M,"fetchSupported",function(){return E});var x=L("./src/polyfills/number.ts"),R=L("./src/loader/load-stats.ts"),O=L("./src/demux/chunk-cache.ts");function b(l,h){l.prototype=Object.create(h.prototype),l.prototype.constructor=l,p(l,h)}function C(l){var h=typeof Map=="function"?new Map:void 0;return C=function(t){if(t===null||!m(t))return t;if(typeof t!="function")throw new TypeError("Super expression must either be null or a function");if(typeof h<"u"){if(h.has(t))return h.get(t);h.set(t,i)}function i(){return I(t,arguments,g(this).constructor)}return i.prototype=Object.create(t.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),p(i,t)},C(l)}function I(l,h,n){return T()?I=Reflect.construct.bind():I=function(i,y,u){var f=[null];f.push.apply(f,y);var c=Function.bind.apply(i,f),s=new c;return u&&p(s,u.prototype),s},I.apply(null,arguments)}function T(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function m(l){return Function.toString.call(l).indexOf("[native code]")!==-1}function p(l,h){return p=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,i){return t.__proto__=i,t},p(l,h)}function g(l){return g=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},g(l)}function D(){return D=Object.assign?Object.assign.bind():function(l){for(var h=1;h<arguments.length;h++){var n=arguments[h];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(l[t]=n[t])}return l},D.apply(this,arguments)}function E(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}var d=function(){function l(n){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=void 0,this.response=void 0,this.controller=void 0,this.context=void 0,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=n.fetchSetup||e,this.controller=new self.AbortController,this.stats=new R.LoadStats}var h=l.prototype;return h.destroy=function(){this.loader=this.callbacks=null,this.abortInternal()},h.abortInternal=function(){var t=this.response;(!t||!t.ok)&&(this.stats.aborted=!0,this.controller.abort())},h.abort=function(){var t;this.abortInternal(),(t=this.callbacks)!==null&&t!==void 0&&t.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)},h.load=function(t,i,y){var u=this,f=this.stats;if(f.loading.start)throw new Error("Loader can only be used once.");f.loading.start=self.performance.now();var c=r(t,this.controller.signal),s=y.onProgress,o=t.responseType==="arraybuffer",v=o?"byteLength":"length";this.context=t,this.config=i,this.callbacks=y,this.request=this.fetchSetup(t,c),self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(function(){u.abortInternal(),y.onTimeout(f,t,u.response)},i.timeout),self.fetch(this.request).then(function(S){if(u.response=u.loader=S,!S.ok){var A=S.status,P=S.statusText;throw new a(P||"fetch, bad network response",A,S)}return f.loading.first=Math.max(self.performance.now(),f.loading.start),f.total=parseInt(S.headers.get("Content-Length")||"0"),s&&Object(x.isFiniteNumber)(i.highWaterMark)?u.loadProgressively(S,f,t,i.highWaterMark,s):o?S.arrayBuffer():S.text()}).then(function(S){var A=u.response;self.clearTimeout(u.requestTimeout),f.loading.end=Math.max(self.performance.now(),f.loading.first),f.loaded=f.total=S[v];var P={url:A.url,data:S};s&&!Object(x.isFiniteNumber)(i.highWaterMark)&&s(f,t,S,A),y.onSuccess(P,f,t,A)}).catch(function(S){if(self.clearTimeout(u.requestTimeout),!f.aborted){var A=S&&S.code||0,P=S?S.message:null;y.onError({code:A,text:P},t,S?S.details:null)}})},h.getCacheAge=function(){var t=null;if(this.response){var i=this.response.headers.get("age");t=i?parseFloat(i):null}return t},h.loadProgressively=function(t,i,y,u,f){u===void 0&&(u=0);var c=new O.default,s=t.body.getReader(),o=function v(){return s.read().then(function(S){if(S.done)return c.dataLength&&f(i,y,c.flush(),t),Promise.resolve(new ArrayBuffer(0));var A=S.value,P=A.length;return i.loaded+=P,P<u||c.dataLength?(c.push(A),c.dataLength>=u&&f(i,y,c.flush(),t)):f(i,y,A,t),v()}).catch(function(){return Promise.reject()})};return o()},l}();function r(l,h){var n={method:"GET",mode:"cors",credentials:"same-origin",signal:h,headers:new self.Headers(D({},l.headers))};return l.rangeEnd&&n.headers.set("Range","bytes="+l.rangeStart+"-"+String(l.rangeEnd-1)),n}function e(l,h){return new self.Request(l.url,h)}var a=function(l){b(h,l);function h(n,t,i){var y;return y=l.call(this,n)||this,y.code=void 0,y.details=void 0,y.code=t,y.details=i,y}return h}(C(Error));M.default=d},"./src/utils/imsc1-ttml-parser.ts":function(K,M,L){L.r(M),L.d(M,"IMSC1_CODEC",function(){return m}),L.d(M,"parseIMSC1",function(){return E});var x=L("./src/utils/mp4-tools.ts"),R=L("./src/utils/vttparser.ts"),O=L("./src/utils/vttcue.ts"),b=L("./src/demux/id3.ts"),C=L("./src/utils/timescale-conversion.ts"),I=L("./src/utils/webvtt-parser.ts");function T(){return T=Object.assign?Object.assign.bind():function(u){for(var f=1;f<arguments.length;f++){var c=arguments[f];for(var s in c)Object.prototype.hasOwnProperty.call(c,s)&&(u[s]=c[s])}return u},T.apply(this,arguments)}var m="stpp.ttml.im1t",p=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,g=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,D={left:"start",center:"center",right:"end",start:"start",end:"end"};function E(u,f,c,s,o){var v=Object(x.findBox)(new Uint8Array(u),["mdat"]);if(v.length===0){o(new Error("Could not parse IMSC1 mdat"));return}var S=v.map(function(P){return Object(b.utf8ArrayToStr)(P)}),A=Object(C.toTimescaleFromScale)(f,1,c);try{S.forEach(function(P){return s(d(P,A))})}catch(P){o(P)}}function d(u,f){var c=new DOMParser,s=c.parseFromString(u,"text/xml"),o=s.getElementsByTagName("tt")[0];if(!o)throw new Error("Invalid ttml");var v={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},S=Object.keys(v).reduce(function(k,B){return k[B]=o.getAttribute("ttp:"+B)||v[B],k},{}),A=o.getAttribute("xml:space")!=="preserve",P=e(r(o,"styling","style")),_=e(r(o,"layout","region")),F=r(o,"body","[begin]");return[].map.call(F,function(k){var B=a(k,A);if(!B||!k.hasAttribute("begin"))return null;var w=t(k.getAttribute("begin"),S),U=t(k.getAttribute("dur"),S),N=t(k.getAttribute("end"),S);if(w===null)throw n(k);if(N===null){if(U===null)throw n(k);N=w+U}var W=new O.default(w-f,N-f,B);W.id=Object(I.generateCueId)(W.startTime,W.endTime,W.text);var j=_[k.getAttribute("region")],H=P[k.getAttribute("style")];W.position=10,W.size=80;var G=l(j,H,P),z=G.textAlign;if(z){var Z=D[z];Z&&(W.lineAlign=Z),W.align=z}return T(W,G),W}).filter(function(k){return k!==null})}function r(u,f,c){var s=u.getElementsByTagName(f)[0];return s?[].slice.call(s.querySelectorAll(c)):[]}function e(u){return u.reduce(function(f,c){var s=c.getAttribute("xml:id");return s&&(f[s]=c),f},{})}function a(u,f){return[].slice.call(u.childNodes).reduce(function(c,s,o){var v;return s.nodeName==="br"&&o?c+`
`:(v=s.childNodes)!==null&&v!==void 0&&v.length?a(s,f):f?c+s.textContent.trim().replace(/\s+/g," "):c+s.textContent},"")}function l(u,f,c){var s="http://www.w3.org/ns/ttml#styling",o=null,v=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],S=u!=null&&u.hasAttribute("style")?u.getAttribute("style"):null;return S&&c.hasOwnProperty(S)&&(o=c[S]),v.reduce(function(A,P){var _=h(f,s,P)||h(u,s,P)||h(o,s,P);return _&&(A[P]=_),A},{})}function h(u,f,c){return u&&u.hasAttributeNS(f,c)?u.getAttributeNS(f,c):null}function n(u){return new Error("Could not parse ttml timestamp "+u)}function t(u,f){if(!u)return null;var c=Object(R.parseTimeStamp)(u);return c===null&&(p.test(u)?c=i(u,f):g.test(u)&&(c=y(u,f))),c}function i(u,f){var c=p.exec(u),s=(c[4]|0)+(c[5]|0)/f.subFrameRate;return(c[1]|0)*3600+(c[2]|0)*60+(c[3]|0)+s/f.frameRate}function y(u,f){var c=g.exec(u),s=Number(c[1]),o=c[2];switch(o){case"h":return s*3600;case"m":return s*60;case"ms":return s*1e3;case"f":return s/f.frameRate;case"t":return s/f.tickRate}return s}},"./src/utils/logger.ts":function(K,M,L){L.r(M),L.d(M,"enableLogs",function(){return I}),L.d(M,"logger",function(){return T});var x=function(){},R={trace:x,debug:x,log:x,warn:x,info:x,error:x},O=R;function b(m){var p=self.console[m];return p?p.bind(self.console,"["+m+"] >"):x}function C(m){for(var p=arguments.length,g=new Array(p>1?p-1:0),D=1;D<p;D++)g[D-1]=arguments[D];g.forEach(function(E){O[E]=m[E]?m[E].bind(m):b(E)})}function I(m){if(self.console&&m===!0||typeof m=="object"){C(m,"debug","log","info","warn","error");try{O.log()}catch{O=R}}else O=R}var T=O},"./src/utils/mediakeys-helper.ts":function(K,M,L){L.r(M),L.d(M,"KeySystems",function(){return x}),L.d(M,"requestMediaKeySystemAccess",function(){return R});var x;(function(O){O.WIDEVINE="com.widevine.alpha",O.PLAYREADY="com.microsoft.playready"})(x||(x={}));var R=function(){return typeof self<"u"&&self.navigator&&self.navigator.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null}()},"./src/utils/mediasource-helper.ts":function(K,M,L){L.r(M),L.d(M,"getMediaSource",function(){return x});function x(){return self.MediaSource||self.WebKitMediaSource}},"./src/utils/mp4-tools.ts":function(K,M,L){L.r(M),L.d(M,"RemuxerTrackIdConfig",function(){return I}),L.d(M,"bin2str",function(){return T}),L.d(M,"readUint16",function(){return m}),L.d(M,"readUint32",function(){return p}),L.d(M,"readSint32",function(){return g}),L.d(M,"writeUint32",function(){return D}),L.d(M,"findBox",function(){return E}),L.d(M,"parseSegmentIndex",function(){return d}),L.d(M,"parseInitSegment",function(){return r}),L.d(M,"getStartDTS",function(){return e}),L.d(M,"getDuration",function(){return a}),L.d(M,"computeRawDurationFromSamples",function(){return l}),L.d(M,"offsetStartDTS",function(){return h}),L.d(M,"segmentValidRange",function(){return n}),L.d(M,"appendUint8Array",function(){return t}),L.d(M,"parseSamples",function(){return i}),L.d(M,"parseSEIMessageFromNALu",function(){return f}),L.d(M,"parseEmsg",function(){return s});var x=L("./src/utils/typed-array.ts"),R=L("./src/loader/fragment.ts"),O=L("./src/demux/id3.ts"),b=Math.pow(2,32)-1,C=[].push,I={video:1,audio:2,id3:3,text:4};function T(o){return String.fromCharCode.apply(null,o)}function m(o,v){var S=o[v]<<8|o[v+1];return S<0?65536+S:S}function p(o,v){var S=g(o,v);return S<0?4294967296+S:S}function g(o,v){return o[v]<<24|o[v+1]<<16|o[v+2]<<8|o[v+3]}function D(o,v,S){o[v]=S>>24,o[v+1]=S>>16&255,o[v+2]=S>>8&255,o[v+3]=S&255}function E(o,v){var S=[];if(!v.length)return S;for(var A=o.byteLength,P=0;P<A;){var _=p(o,P),F=T(o.subarray(P+4,P+8)),k=_>1?P+_:A;if(F===v[0])if(v.length===1)S.push(o.subarray(P+8,k));else{var B=E(o.subarray(P+8,k),v.slice(1));B.length&&C.apply(S,B)}P=k}return S}function d(o){var v=[],S=o[0],A=8,P=p(o,A);A+=4;var _=0,F=0;S===0?A+=8:A+=16,A+=2;var k=o.length+F,B=m(o,A);A+=2;for(var w=0;w<B;w++){var U=A,N=p(o,U);U+=4;var W=N&2147483647,j=(N&2147483648)>>>31;if(j===1)return console.warn("SIDX has hierarchical references (not supported)"),null;var H=p(o,U);U+=4,v.push({referenceSize:W,subsegmentDuration:H,info:{duration:H/P,start:k,end:k+W-1}}),k+=W,U+=4,A=U}return{earliestPresentationTime:_,timescale:P,version:S,referencesCount:B,references:v}}function r(o){for(var v=[],S=E(o,["moov","trak"]),A=0;A<S.length;A++){var P=S[A],_=E(P,["tkhd"])[0];if(_){var F=_[0],k=F===0?12:20,B=p(_,k),w=E(P,["mdia","mdhd"])[0];if(w){F=w[0],k=F===0?12:20;var U=p(w,k),N=E(P,["mdia","hdlr"])[0];if(N){var W=T(N.subarray(8,12)),j={soun:R.ElementaryStreamTypes.AUDIO,vide:R.ElementaryStreamTypes.VIDEO}[W];if(j){var H=E(P,["mdia","minf","stbl","stsd"])[0],G=void 0;H&&(G=T(H.subarray(12,16))),v[B]={timescale:U,type:j},v[j]={timescale:U,id:B,codec:G}}}}}}var z=E(o,["moov","mvex","trex"]);return z.forEach(function(Z){var Y=p(Z,4),V=v[Y];V&&(V.default={duration:p(Z,12),flags:p(Z,20)})}),v}function e(o,v){return E(v,["moof","traf"]).reduce(function(S,A){var P=E(A,["tfdt"])[0],_=P[0],F=E(A,["tfhd"]).reduce(function(k,B){var w=p(B,4),U=o[w];if(U){var N=p(P,4);_===1&&(N*=Math.pow(2,32),N+=p(P,8));var W=U.timescale||9e4,j=N/W;if(isFinite(j)&&(k===null||j<k))return j}return k},null);return F!==null&&isFinite(F)&&(S===null||F<S)?F:S},null)||0}function a(o,v){for(var S=0,A=0,P=0,_=E(o,["moof","traf"]),F=0;F<_.length;F++){var k=_[F],B=E(k,["tfhd"])[0],w=p(B,4),U=v[w];if(!!U){var N=U.default,W=p(B,0)|(N==null?void 0:N.flags),j=N==null?void 0:N.duration;W&8&&(W&2?j=p(B,12):j=p(B,8));for(var H=U.timescale||9e4,G=E(k,["trun"]),z=0;z<G.length;z++){if(S=l(G[z]),!S&&j){var Z=p(G[z],4);S=j*Z}U.type===R.ElementaryStreamTypes.VIDEO?A+=S/H:U.type===R.ElementaryStreamTypes.AUDIO&&(P+=S/H)}}}if(A===0&&P===0){for(var Y=0,V=E(o,["sidx"]),$=0;$<V.length;$++){var X=d(V[$]);X!=null&&X.references&&(Y+=X.references.reduce(function(Q,J){return Q+J.info.duration||0},0))}return Y}return A||P}function l(o){var v=p(o,0),S=8;v&1&&(S+=4),v&4&&(S+=4);for(var A=0,P=p(o,4),_=0;_<P;_++){if(v&256){var F=p(o,S);A+=F,S+=4}v&512&&(S+=4),v&1024&&(S+=4),v&2048&&(S+=4)}return A}function h(o,v,S){E(v,["moof","traf"]).forEach(function(A){E(A,["tfhd"]).forEach(function(P){var _=p(P,4),F=o[_];if(!!F){var k=F.timescale||9e4;E(A,["tfdt"]).forEach(function(B){var w=B[0],U=p(B,4);if(w===0)U-=S*k,U=Math.max(U,0),D(B,4,U);else{U*=Math.pow(2,32),U+=p(B,8),U-=S*k,U=Math.max(U,0);var N=Math.floor(U/(b+1)),W=Math.floor(U%(b+1));D(B,4,N),D(B,8,W)}})}})})}function n(o){var v={valid:null,remainder:null},S=E(o,["moof"]);if(S){if(S.length<2)return v.remainder=o,v}else return v;var A=S[S.length-1];return v.valid=Object(x.sliceUint8)(o,0,A.byteOffset-8),v.remainder=Object(x.sliceUint8)(o,A.byteOffset-8),v}function t(o,v){var S=new Uint8Array(o.length+v.length);return S.set(o),S.set(v,o.length),S}function i(o,v){var S=[],A=v.samples,P=v.timescale,_=v.id,F=!1,k=E(A,["moof"]);return k.map(function(B){var w=B.byteOffset-8,U=E(B,["traf"]);U.map(function(N){var W=E(N,["tfdt"]).map(function(j){var H=j[0],G=p(j,4);return H===1&&(G*=Math.pow(2,32),G+=p(j,8)),G/P})[0];return W!==void 0&&(o=W),E(N,["tfhd"]).map(function(j){var H=p(j,4),G=p(j,0)&16777215,z=(G&1)!==0,Z=(G&2)!==0,Y=(G&8)!==0,V=0,$=(G&16)!==0,X=0,Q=(G&32)!==0,J=8;H===_&&(z&&(J+=8),Z&&(J+=4),Y&&(V=p(j,J),J+=4),$&&(X=p(j,J),J+=4),Q&&(J+=4),v.type==="video"&&(F=y(v.codec)),E(N,["trun"]).map(function(q){var ee=q[0],te=p(q,0)&16777215,re=(te&1)!==0,oe=0,fe=(te&4)!==0,he=(te&256)!==0,ae=0,Se=(te&512)!==0,ce=0,le=(te&1024)!==0,pe=(te&2048)!==0,ye=0,Ee=p(q,4),ne=8;re&&(oe=p(q,ne),ne+=4),fe&&(ne+=4);for(var ue=oe+w,ve=0;ve<Ee;ve++){if(he?(ae=p(q,ne),ne+=4):ae=V,Se?(ce=p(q,ne),ne+=4):ce=X,le&&(ne+=4),pe&&(ee===0?ye=p(q,ne):ye=g(q,ne),ne+=4),v.type===R.ElementaryStreamTypes.VIDEO)for(var ge=0;ge<ce;){var Te=p(A,ue);ue+=4;var se=A[ue]&31;if(u(F,se)){var me=A.subarray(ue,ue+Te);f(me,o+ye/P,S)}ue+=Te,ge+=Te+4}o+=ae/P}}))})})}),S}function y(o){if(!o)return!1;var v=o.indexOf("."),S=v<0?o:o.substring(0,v);return S==="hvc1"||S==="hev1"||S==="dvh1"||S==="dvhe"}function u(o,v){return o?v===39||v===40:v===6}function f(o,v,S){var A=c(o),P=0;P++;for(var _=0,F=0,k=!1,B=0;P<A.length;){_=0;do{if(P>=A.length)break;B=A[P++],_+=B}while(B===255);F=0;do{if(P>=A.length)break;B=A[P++],F+=B}while(B===255);var w=A.length-P;if(!k&&_===4&&P<A.length){k=!0;var U=A[P++];if(U===181){var N=m(A,P);if(P+=2,N===49){var W=p(A,P);if(P+=4,W===1195456820){var j=A[P++];if(j===3){var H=A[P++],G=31&H,z=64&H,Z=z?2+G*3:0,Y=new Uint8Array(Z);if(z){Y[0]=H;for(var V=1;V<Z;V++)Y[V]=A[P++]}S.push({type:j,payloadType:_,pts:v,bytes:Y})}}}}}else if(_===5&&F<w){if(k=!0,F>16){for(var $=[],X=0;X<16;X++){var Q=A[P++].toString(16);$.push(Q.length==1?"0"+Q:Q),(X===3||X===5||X===7||X===9)&&$.push("-")}for(var J=F-16,q=new Uint8Array(J),ee=0;ee<J;ee++)q[ee]=A[P++];S.push({payloadType:_,pts:v,uuid:$.join(""),userData:Object(O.utf8ArrayToStr)(q),userDataBytes:q})}}else if(F<w)P+=F;else if(F>w)break}}function c(o){for(var v=o.byteLength,S=[],A=1;A<v-2;)o[A]===0&&o[A+1]===0&&o[A+2]===3?(S.push(A+2),A+=2):A++;if(S.length===0)return o;var P=v-S.length,_=new Uint8Array(P),F=0;for(A=0;A<P;F++,A++)F===S[0]&&(F++,S.shift()),_[A]=o[F];return _}function s(o){var v=o[0],S="",A="",P=0,_=0,F=0,k=0,B=0,w=0;if(v===0){for(;T(o.subarray(w,w+1))!=="\0";)S+=T(o.subarray(w,w+1)),w+=1;for(S+=T(o.subarray(w,w+1)),w+=1;T(o.subarray(w,w+1))!=="\0";)A+=T(o.subarray(w,w+1)),w+=1;A+=T(o.subarray(w,w+1)),w+=1,P=p(o,12),_=p(o,16),k=p(o,20),B=p(o,24),w=28}else if(v===1){w+=4,P=p(o,w),w+=4;var U=p(o,w);w+=4;var N=p(o,w);for(w+=4,F=Math.pow(2,32)*U+N,Number.isSafeInteger(F)||(F=Number.MAX_SAFE_INTEGER,console.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),k=p(o,w),w+=4,B=p(o,w),w+=4;T(o.subarray(w,w+1))!=="\0";)S+=T(o.subarray(w,w+1)),w+=1;for(S+=T(o.subarray(w,w+1)),w+=1;T(o.subarray(w,w+1))!=="\0";)A+=T(o.subarray(w,w+1)),w+=1;A+=T(o.subarray(w,w+1)),w+=1}var W=o.subarray(w,o.byteLength);return{schemeIdUri:S,value:A,timeScale:P,presentationTime:F,presentationTimeDelta:_,eventDuration:k,id:B,payload:W}}},"./src/utils/output-filter.ts":function(K,M,L){L.r(M),L.d(M,"default",function(){return x});var x=function(){function R(b,C){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=b,this.trackName=C}var O=R.prototype;return O.dispatchCue=function(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)},O.newCue=function(C,I,T){(this.startTime===null||this.startTime>C)&&(this.startTime=C),this.endTime=I,this.screen=T,this.timelineController.createCaptionsTrack(this.trackName)},O.reset=function(){this.cueRanges=[],this.startTime=null},R}()},"./src/utils/texttrack-utils.ts":function(K,M,L){L.r(M),L.d(M,"sendAddTrackEvent",function(){return R}),L.d(M,"addCueToTrack",function(){return O}),L.d(M,"clearCurrentCues",function(){return b}),L.d(M,"removeCuesInRange",function(){return C}),L.d(M,"getCuesInRange",function(){return T});var x=L("./src/utils/logger.ts");function R(m,p){var g;try{g=new Event("addtrack")}catch{g=document.createEvent("Event"),g.initEvent("addtrack",!1,!1)}g.track=m,p.dispatchEvent(g)}function O(m,p){var g=m.mode;if(g==="disabled"&&(m.mode="hidden"),m.cues&&!m.cues.getCueById(p.id))try{if(m.addCue(p),!m.cues.getCueById(p.id))throw new Error("addCue is failed for: "+p)}catch(E){x.logger.debug("[texttrack-utils]: "+E);var D=new self.TextTrackCue(p.startTime,p.endTime,p.text);D.id=p.id,m.addCue(D)}g==="disabled"&&(m.mode=g)}function b(m){var p=m.mode;if(p==="disabled"&&(m.mode="hidden"),m.cues)for(var g=m.cues.length;g--;)m.removeCue(m.cues[g]);p==="disabled"&&(m.mode=p)}function C(m,p,g,D){var E=m.mode;if(E==="disabled"&&(m.mode="hidden"),m.cues&&m.cues.length>0)for(var d=T(m.cues,p,g),r=0;r<d.length;r++)(!D||D(d[r]))&&m.removeCue(d[r]);E==="disabled"&&(m.mode=E)}function I(m,p){if(p<m[0].startTime)return 0;var g=m.length-1;if(p>m[g].endTime)return-1;for(var D=0,E=g;D<=E;){var d=Math.floor((E+D)/2);if(p<m[d].startTime)E=d-1;else if(p>m[d].startTime&&D<g)D=d+1;else return d}return m[D].startTime-p<p-m[E].startTime?D:E}function T(m,p,g){var D=[],E=I(m,p);if(E>-1)for(var d=E,r=m.length;d<r;d++){var e=m[d];if(e.startTime>=p&&e.endTime<=g)D.push(e);else if(e.startTime>g)return D}return D}},"./src/utils/time-ranges.ts":function(K,M,L){L.r(M);var x={toString:function(O){for(var b="",C=O.length,I=0;I<C;I++)b+="["+O.start(I).toFixed(3)+","+O.end(I).toFixed(3)+"]";return b}};M.default=x},"./src/utils/timescale-conversion.ts":function(K,M,L){L.r(M),L.d(M,"toTimescaleFromBase",function(){return R}),L.d(M,"toTimescaleFromScale",function(){return O}),L.d(M,"toMsFromMpegTsClock",function(){return b}),L.d(M,"toMpegTsClockFromTimescale",function(){return C});var x=9e4;function R(I,T,m,p){m===void 0&&(m=1),p===void 0&&(p=!1);var g=I*T*m;return p?Math.round(g):g}function O(I,T,m,p){return m===void 0&&(m=1),p===void 0&&(p=!1),R(I,T,1/m,p)}function b(I,T){return T===void 0&&(T=!1),R(I,1e3,1/x,T)}function C(I,T){return T===void 0&&(T=1),R(I,x,1/T)}},"./src/utils/typed-array.ts":function(K,M,L){L.r(M),L.d(M,"sliceUint8",function(){return x});function x(R,O,b){return Uint8Array.prototype.slice?R.slice(O,b):new Uint8Array(Array.prototype.slice.call(R,O,b))}},"./src/utils/vttcue.ts":function(K,M,L){L.r(M),M.default=function(){if(typeof self<"u"&&self.VTTCue)return self.VTTCue;var x=["","lr","rl"],R=["start","middle","end","left","right"];function O(m,p){if(typeof p!="string"||!Array.isArray(m))return!1;var g=p.toLowerCase();return~m.indexOf(g)?g:!1}function b(m){return O(x,m)}function C(m){return O(R,m)}function I(m){for(var p=arguments.length,g=new Array(p>1?p-1:0),D=1;D<p;D++)g[D-1]=arguments[D];for(var E=1;E<arguments.length;E++){var d=arguments[E];for(var r in d)m[r]=d[r]}return m}function T(m,p,g){var D=this,E={enumerable:!0};D.hasBeenReset=!1;var d="",r=!1,e=m,a=p,l=g,h=null,n="",t=!0,i="auto",y="start",u=50,f="middle",c=50,s="middle";Object.defineProperty(D,"id",I({},E,{get:function(){return d},set:function(v){d=""+v}})),Object.defineProperty(D,"pauseOnExit",I({},E,{get:function(){return r},set:function(v){r=!!v}})),Object.defineProperty(D,"startTime",I({},E,{get:function(){return e},set:function(v){if(typeof v!="number")throw new TypeError("Start time must be set to a number.");e=v,this.hasBeenReset=!0}})),Object.defineProperty(D,"endTime",I({},E,{get:function(){return a},set:function(v){if(typeof v!="number")throw new TypeError("End time must be set to a number.");a=v,this.hasBeenReset=!0}})),Object.defineProperty(D,"text",I({},E,{get:function(){return l},set:function(v){l=""+v,this.hasBeenReset=!0}})),Object.defineProperty(D,"region",I({},E,{get:function(){return h},set:function(v){h=v,this.hasBeenReset=!0}})),Object.defineProperty(D,"vertical",I({},E,{get:function(){return n},set:function(v){var S=b(v);if(S===!1)throw new SyntaxError("An invalid or illegal string was specified.");n=S,this.hasBeenReset=!0}})),Object.defineProperty(D,"snapToLines",I({},E,{get:function(){return t},set:function(v){t=!!v,this.hasBeenReset=!0}})),Object.defineProperty(D,"line",I({},E,{get:function(){return i},set:function(v){if(typeof v!="number"&&v!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");i=v,this.hasBeenReset=!0}})),Object.defineProperty(D,"lineAlign",I({},E,{get:function(){return y},set:function(v){var S=C(v);if(!S)throw new SyntaxError("An invalid or illegal string was specified.");y=S,this.hasBeenReset=!0}})),Object.defineProperty(D,"position",I({},E,{get:function(){return u},set:function(v){if(v<0||v>100)throw new Error("Position must be between 0 and 100.");u=v,this.hasBeenReset=!0}})),Object.defineProperty(D,"positionAlign",I({},E,{get:function(){return f},set:function(v){var S=C(v);if(!S)throw new SyntaxError("An invalid or illegal string was specified.");f=S,this.hasBeenReset=!0}})),Object.defineProperty(D,"size",I({},E,{get:function(){return c},set:function(v){if(v<0||v>100)throw new Error("Size must be between 0 and 100.");c=v,this.hasBeenReset=!0}})),Object.defineProperty(D,"align",I({},E,{get:function(){return s},set:function(v){var S=C(v);if(!S)throw new SyntaxError("An invalid or illegal string was specified.");s=S,this.hasBeenReset=!0}})),D.displayState=void 0}return T.prototype.getCueAsHTML=function(){var m=self.WebVTT;return m.convertCueToDOMTree(self,this.text)},T}()},"./src/utils/vttparser.ts":function(K,M,L){L.r(M),L.d(M,"parseTimeStamp",function(){return O}),L.d(M,"fixLineBreaks",function(){return p}),L.d(M,"VTTParser",function(){return g});var x=L("./src/utils/vttcue.ts"),R=function(){function D(){}var E=D.prototype;return E.decode=function(r,e){if(!r)return"";if(typeof r!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(r))},D}();function O(D){function E(r,e,a,l){return(r|0)*3600+(e|0)*60+(a|0)+parseFloat(l||0)}var d=D.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return d?parseFloat(d[2])>59?E(d[2],d[3],0,d[4]):E(d[1],d[2],d[3],d[4]):null}var b=function(){function D(){this.values=Object.create(null)}var E=D.prototype;return E.set=function(r,e){!this.get(r)&&e!==""&&(this.values[r]=e)},E.get=function(r,e,a){return a?this.has(r)?this.values[r]:e[a]:this.has(r)?this.values[r]:e},E.has=function(r){return r in this.values},E.alt=function(r,e,a){for(var l=0;l<a.length;++l)if(e===a[l]){this.set(r,e);break}},E.integer=function(r,e){/^-?\d+$/.test(e)&&this.set(r,parseInt(e,10))},E.percent=function(r,e){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(e)){var a=parseFloat(e);if(a>=0&&a<=100)return this.set(r,a),!0}return!1},D}();function C(D,E,d,r){var e=r?D.split(r):[D];for(var a in e)if(typeof e[a]=="string"){var l=e[a].split(d);if(l.length===2){var h=l[0],n=l[1];E(h,n)}}}var I=new x.default(0,0,""),T=I.align==="middle"?"middle":"center";function m(D,E,d){var r=D;function e(){var h=O(D);if(h===null)throw new Error("Malformed timestamp: "+r);return D=D.replace(/^[^\sa-zA-Z-]+/,""),h}function a(h,n){var t=new b;C(h,function(u,f){var c;switch(u){case"region":for(var s=d.length-1;s>=0;s--)if(d[s].id===f){t.set(u,d[s].region);break}break;case"vertical":t.alt(u,f,["rl","lr"]);break;case"line":c=f.split(","),t.integer(u,c[0]),t.percent(u,c[0])&&t.set("snapToLines",!1),t.alt(u,c[0],["auto"]),c.length===2&&t.alt("lineAlign",c[1],["start",T,"end"]);break;case"position":c=f.split(","),t.percent(u,c[0]),c.length===2&&t.alt("positionAlign",c[1],["start",T,"end","line-left","line-right","auto"]);break;case"size":t.percent(u,f);break;case"align":t.alt(u,f,["start",T,"end","left","right"]);break}},/:/,/\s/),n.region=t.get("region",null),n.vertical=t.get("vertical","");var i=t.get("line","auto");i==="auto"&&I.line===-1&&(i=-1),n.line=i,n.lineAlign=t.get("lineAlign","start"),n.snapToLines=t.get("snapToLines",!0),n.size=t.get("size",100),n.align=t.get("align",T);var y=t.get("position","auto");y==="auto"&&I.position===50&&(y=n.align==="start"||n.align==="left"?0:n.align==="end"||n.align==="right"?100:50),n.position=y}function l(){D=D.replace(/^\s+/,"")}if(l(),E.startTime=e(),l(),D.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+r);D=D.slice(3),l(),E.endTime=e(),l(),a(D,E)}function p(D){return D.replace(/<br(?: \/)?>/gi,`
`)}var g=function(){function D(){this.state="INITIAL",this.buffer="",this.decoder=new R,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}var E=D.prototype;return E.parse=function(r){var e=this;r&&(e.buffer+=e.decoder.decode(r,{stream:!0}));function a(){var y=e.buffer,u=0;for(y=p(y);u<y.length&&y[u]!=="\r"&&y[u]!==`
`;)++u;var f=y.slice(0,u);return y[u]==="\r"&&++u,y[u]===`
`&&++u,e.buffer=y.slice(u),f}function l(y){C(y,function(u,f){},/:/)}try{var h="";if(e.state==="INITIAL"){if(!/\r\n|\n/.test(e.buffer))return this;h=a();var n=h.match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(!n||!n[0])throw new Error("Malformed WebVTT signature.");e.state="HEADER"}for(var t=!1;e.buffer;){if(!/\r\n|\n/.test(e.buffer))return this;switch(t?t=!1:h=a(),e.state){case"HEADER":/:/.test(h)?l(h):h||(e.state="ID");continue;case"NOTE":h||(e.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(h)){e.state="NOTE";break}if(!h)continue;if(e.cue=new x.default(0,0,""),e.state="CUE",h.indexOf("-->")===-1){e.cue.id=h;continue}case"CUE":if(!e.cue){e.state="BADCUE";continue}try{m(h,e.cue,e.regionList)}catch{e.cue=null,e.state="BADCUE";continue}e.state="CUETEXT";continue;case"CUETEXT":{var i=h.indexOf("-->")!==-1;if(!h||i&&(t=!0)){e.oncue&&e.cue&&e.oncue(e.cue),e.cue=null,e.state="ID";continue}if(e.cue===null)continue;e.cue.text&&(e.cue.text+=`
`),e.cue.text+=h}continue;case"BADCUE":h||(e.state="ID")}}}catch{e.state==="CUETEXT"&&e.cue&&e.oncue&&e.oncue(e.cue),e.cue=null,e.state=e.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this},E.flush=function(){var r=this;try{if((r.cue||r.state==="HEADER")&&(r.buffer+=`

`,r.parse()),r.state==="INITIAL"||r.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(e){r.onparsingerror&&r.onparsingerror(e)}return r.onflush&&r.onflush(),this},D}()},"./src/utils/webvtt-parser.ts":function(K,M,L){L.r(M),L.d(M,"generateCueId",function(){return g}),L.d(M,"parseWebVTT",function(){return E});var x=L("./src/polyfills/number.ts"),R=L("./src/utils/vttparser.ts"),O=L("./src/demux/id3.ts"),b=L("./src/utils/timescale-conversion.ts"),C=L("./src/remux/mp4-remuxer.ts"),I=/\r\n|\n\r|\n|\r/g,T=function(r,e,a){return a===void 0&&(a=0),r.slice(a,a+e.length)===e},m=function(r){var e=parseInt(r.slice(-3)),a=parseInt(r.slice(-6,-4)),l=parseInt(r.slice(-9,-7)),h=r.length>9?parseInt(r.substring(0,r.indexOf(":"))):0;if(!Object(x.isFiniteNumber)(e)||!Object(x.isFiniteNumber)(a)||!Object(x.isFiniteNumber)(l)||!Object(x.isFiniteNumber)(h))throw Error("Malformed X-TIMESTAMP-MAP: Local:"+r);return e+=1e3*a,e+=60*1e3*l,e+=60*60*1e3*h,e},p=function(r){for(var e=5381,a=r.length;a;)e=e*33^r.charCodeAt(--a);return(e>>>0).toString()};function g(d,r,e){return p(d.toString())+p(r.toString())+p(e)}var D=function(r,e,a){var l=r[e],h=r[l.prevCC];if(!h||!h.new&&l.new){r.ccOffset=r.presentationOffset=l.start,l.new=!1;return}for(;(n=h)!==null&&n!==void 0&&n.new;){var n;r.ccOffset+=l.start-h.start,l.new=!1,l=h,h=r[l.prevCC]}r.presentationOffset=a};function E(d,r,e,a,l,h,n,t){var i=new R.VTTParser,y=Object(O.utf8ArrayToStr)(new Uint8Array(d)).trim().replace(I,`
`).split(`
`),u=[],f=Object(b.toMpegTsClockFromTimescale)(r,e),c="00:00.000",s=0,o=0,v,S=!0;i.oncue=function(A){var P=a[l],_=a.ccOffset,F=(s-f)/9e4;P!=null&&P.new&&(o!==void 0?_=a.ccOffset=P.start:D(a,l,F)),F&&(_=F-a.presentationOffset);var k=A.endTime-A.startTime,B=Object(C.normalizePts)((A.startTime+_-o)*9e4,h*9e4)/9e4;A.startTime=Math.max(B,0),A.endTime=Math.max(B+k,0);var w=A.text.trim();A.text=decodeURIComponent(encodeURIComponent(w)),A.id||(A.id=g(A.startTime,A.endTime,w)),A.endTime>0&&u.push(A)},i.onparsingerror=function(A){v=A},i.onflush=function(){if(v){t(v);return}n(u)},y.forEach(function(A){if(S)if(T(A,"X-TIMESTAMP-MAP=")){S=!1,A.slice(16).split(",").forEach(function(P){T(P,"LOCAL:")?c=P.slice(6):T(P,"MPEGTS:")&&(s=parseInt(P.slice(7)))});try{o=m(c)/1e3}catch(P){v=P}return}else A===""&&(S=!1);i.parse(A+`
`)}),i.flush()}},"./src/utils/xhr-loader.ts":function(K,M,L){L.r(M);var x=L("./src/utils/logger.ts"),R=L("./src/loader/load-stats.ts"),O=/^age:\s*[\d.]+\s*$/m,b=function(){function C(T){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=void 0,this.loader=null,this.stats=void 0,this.xhrSetup=T?T.xhrSetup:null,this.stats=new R.LoadStats,this.retryDelay=0}var I=C.prototype;return I.destroy=function(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null},I.abortInternal=function(){var m=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),m&&(m.onreadystatechange=null,m.onprogress=null,m.readyState!==4&&(this.stats.aborted=!0,m.abort()))},I.abort=function(){var m;this.abortInternal(),(m=this.callbacks)!==null&&m!==void 0&&m.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)},I.load=function(m,p,g){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=m,this.config=p,this.callbacks=g,this.retryDelay=p.retryDelay,this.loadInternal()},I.loadInternal=function(){var m=this.config,p=this.context;if(!!m){var g=this.loader=new self.XMLHttpRequest,D=this.stats;D.loading.first=0,D.loaded=0;var E=this.xhrSetup;try{if(E)try{E(g,p.url)}catch{g.open("GET",p.url,!0),E(g,p.url)}g.readyState||g.open("GET",p.url,!0);var d=this.context.headers;if(d)for(var r in d)g.setRequestHeader(r,d[r])}catch(e){this.callbacks.onError({code:g.status,text:e.message},p,g);return}p.rangeEnd&&g.setRequestHeader("Range","bytes="+p.rangeStart+"-"+(p.rangeEnd-1)),g.onreadystatechange=this.readystatechange.bind(this),g.onprogress=this.loadprogress.bind(this),g.responseType=p.responseType,self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),m.timeout),g.send()}},I.readystatechange=function(){var m=this.context,p=this.loader,g=this.stats;if(!(!m||!p)){var D=p.readyState,E=this.config;if(!g.aborted&&D>=2)if(self.clearTimeout(this.requestTimeout),g.loading.first===0&&(g.loading.first=Math.max(self.performance.now(),g.loading.start)),D===4){p.onreadystatechange=null,p.onprogress=null;var d=p.status;if(d>=200&&d<300){g.loading.end=Math.max(self.performance.now(),g.loading.first);var r,e;if(m.responseType==="arraybuffer"?(r=p.response,e=r.byteLength):(r=p.responseText,e=r.length),g.loaded=g.total=e,!this.callbacks)return;var a=this.callbacks.onProgress;if(a&&a(g,m,r,p),!this.callbacks)return;var l={url:p.responseURL,data:r};this.callbacks.onSuccess(l,g,m,p)}else g.retry>=E.maxRetry||d>=400&&d<499?(x.logger.error(d+" while loading "+m.url),this.callbacks.onError({code:d,text:p.statusText},m,p)):(x.logger.warn(d+" while loading "+m.url+", retrying in "+this.retryDelay+"..."),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,E.maxRetryDelay),g.retry++)}else self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),E.timeout)}},I.loadtimeout=function(){x.logger.warn("timeout while loading "+this.context.url);var m=this.callbacks;m&&(this.abortInternal(),m.onTimeout(this.stats,this.context,this.loader))},I.loadprogress=function(m){var p=this.stats;p.loaded=m.loaded,m.lengthComputable&&(p.total=m.total)},I.getCacheAge=function(){var m=null;if(this.loader&&O.test(this.loader.getAllResponseHeaders())){var p=this.loader.getResponseHeader("age");m=p?parseFloat(p):null}return m},C}();M.default=b}}).default})})(je);const lt=Ke(je.exports);export{lt as H,ot as a,st as b};
